import{_ as qn}from"./DcZKsx5T.js";import{b as An,a2 as Vs,a as Mn,r as B,t as k,a5 as Y,a7 as xn,a6 as Ln,af as In,L as Rn,F as b,ao as Pn,E as _,P as H,ab as Lt,G as a,H as g,M as rs,a4 as jn,a8 as Kn,ac as Jn,ap as ea,Q as w,R as xe,a0 as U,_ as On,o as ta,aq as sa,ar as na,w as Fs,a3 as aa,I as os,J as Us,as as cn,K as W,$ as ls,am as ia}from"./DRE7tGjo.js";import{f as lt,g as me,h as Ks,v as Rs,j as dn,s as vn,_ as oa,C as la,a as ra,L as ua,P as ca,b as da,p as va,c as pa,d as fa,i as ma,e as ha}from"./DIyxUuLN.js";import{u as ga}from"./Rc8wkXTP.js";const ba={class:"session-picker-modal"},_a={class:"spm-header"},ya={class:"spm-subtitle"},Sa={class:"spm-link-section"},Ta={class:"link-input-row"},Ca=["disabled"],ka={key:0,class:"link-error"},Ea={class:"spm-list"},Aa=["onClick"],Ma={class:"row-left"},xa={class:"session-date"},La={class:"session-time"},Ia={class:"session-car"},Ra={class:"row-right"},Pa={class:"stat-chips"},Oa={class:"stat-chip"},Da={class:"stat-chip"},wa={class:"time-slot"},Ba={key:0,class:"time-badge time-badge--qualy"},Na={key:1,class:"time-badge time-badge--qualy time-badge--empty"},$a={class:"time-slot"},za={key:0,class:"time-badge time-badge--race"},Fa={key:1,class:"time-badge time-badge--race time-badge--empty"},Ua={key:0,class:"spm-empty"},Ga=An({__name:"SessionPickerModal",props:{isOpen:{type:Boolean},currentTrack:{},excludeSessionId:{}},emits:["close","select"],setup(e,{emit:l}){const r=e,v=l,{sessions:d,fetchSessionFull:m}=Vs(),{getUserProfile:y}=Mn(),T=B(""),E=B(""),L=B(!1);function D(oe){const I=oe.match(/\/sessioni\/([^?]+)\?userId=([^&]+)/);return I&&I[1]&&I[2]?{sessionId:I[1],userId:I[2]}:null}async function G(){E.value="";const oe=D(T.value);if(!oe){E.value="Link non valido. Formato atteso: .../sessioni/ID?userId=...";return}L.value=!0;try{const I=await m(oe.sessionId,oe.userId);if(!I){E.value="Sessione non trovata o non piÃ¹ condivisa";return}const j=(I.session_info?.track||"").toLowerCase().replace(/[^a-z0-9]/g,"_"),Ve=r.currentTrack.toLowerCase().replace(/[^a-z0-9]/g,"_");if(!j.includes(Ve)&&!Ve.includes(j)){E.value=`Pista non corrispondente: ${I.session_info?.track||"sconosciuta"} vs ${r.currentTrack}`;return}let ut="Utente Esterno";try{const Ye=await y(oe.userId);ut=Ye?.nickname||Ye?.displayName||"Utente Esterno"}catch{}v("select",oe.sessionId,oe.userId,ut),v("close")}catch(I){console.error("[SHARE] Error loading shared session:",I),E.value=I?.code==="permission-denied"?"Sessione non piÃ¹ condivisa o accesso negato":"Errore nel caricamento della sessione"}finally{L.value=!1}}const Z=k(()=>{const oe=r.currentTrack.toLowerCase().replace(/[^a-z0-9]/g,"_");return d.value.filter(I=>{if(I.sessionId===r.excludeSessionId)return!1;const j=I.meta.track.toLowerCase().replace(/[^a-z0-9]/g,"_");return j.includes(oe)||oe.includes(j)}).map(I=>({id:I.sessionId,date:q(I.meta.date_start),time:In(I.meta.date_start),type:Ln(I.meta.session_type),car:xn(I.meta.car),laps:I.summary.laps||0,stints:I.summary.stintCount||1,bestQualy:I.summary.best_qualy_ms?Y(I.summary.best_qualy_ms):null,bestRace:I.summary.best_race_ms?Y(I.summary.best_race_ms):null}))});function q(oe){if(!oe)return"-";const I=new Date(oe);return`${I.getDate()} ${["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"][I.getMonth()]} ${I.getFullYear()}`}function Ge(oe){return{practice:"PRACTICE",qualify:"QUALIFY",race:"RACE"}[oe]||oe.toUpperCase()}function Se(oe){v("select",oe),v("close")}function rt(){v("close")}return(oe,I)=>(b(),Rn(Pn,{to:"body"},[e.isOpen?(b(),_("div",{key:0,class:"session-picker-overlay",onClick:Lt(rt,["self"])},[a("div",ba,[a("div",_a,[I[1]||(I[1]=a("h2",{class:"spm-title"},"Aggiungi Sorgente Dati",-1)),a("p",ya,g(rs(jn)(e.currentTrack))+" Â· "+g(Z.value.length)+" sessioni disponibili",1),a("button",{class:"spm-close",onClick:rt},"âœ•")]),a("div",Sa,[I[2]||(I[2]=a("label",{class:"link-label"},"ðŸ“‹ Incolla link sessione condivisa",-1)),a("div",Ta,[Kn(a("input",{"onUpdate:modelValue":I[0]||(I[0]=j=>T.value=j),type:"text",class:"link-input",placeholder:"https://...?userId=...",onKeyup:ea(G,["enter"])},null,544),[[Jn,T.value]]),a("button",{class:"link-load-btn",disabled:L.value||!T.value,onClick:G},g(L.value?"...":"Carica"),9,Ca)]),E.value?(b(),_("p",ka,g(E.value),1)):H("",!0)]),I[3]||(I[3]=a("div",{class:"spm-divider"},[a("span",null,"oppure seleziona dalle tue sessioni")],-1)),a("div",Ea,[(b(!0),_(w,null,xe(Z.value,j=>(b(),_("div",{key:j.id,class:"session-row",onClick:Ve=>Se(j.id)},[a("div",Ma,[a("span",{class:U(["session-chip",`session-chip--${j.type}`])},g(Ge(j.type)),3),a("span",xa,g(j.date),1),a("span",La,g(j.time),1),a("span",Ia,g(j.car),1)]),a("div",Ra,[a("div",Pa,[a("span",Oa,"GIRI "+g(j.laps),1),a("span",Da,"STINT "+g(j.stints),1)]),a("div",wa,[j.bestQualy?(b(),_("span",Ba," Q "+g(j.bestQualy),1)):(b(),_("span",Na," Q â€” "))]),a("div",$a,[j.bestRace?(b(),_("span",za," R "+g(j.bestRace),1)):(b(),_("span",Fa," R â€” "))])])],8,Aa))),128)),Z.value.length===0?(b(),_("div",Ua," Nessuna altra sessione disponibile per questa pista. ")):H("",!0)])])])):H("",!0)]))}}),Qa=Object.assign(On(Ga,[["__scopeId","data-v-72b43332"]]),{__name:"UiSessionPickerModal"});function Ha(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Gs={exports:{}};var pn;function Va(){return pn||(pn=1,(function(e){(function(l,r,v,d){var m=["","webkit","Moz","MS","ms","o"],y=r.createElement("div"),T="function",E=Math.round,L=Math.abs,D=Date.now;function G(s,i,u){return setTimeout(j(s,u),i)}function Z(s,i,u){return Array.isArray(s)?(q(s,u[i],u),!0):!1}function q(s,i,u){var f;if(s)if(s.forEach)s.forEach(i,u);else if(s.length!==d)for(f=0;f<s.length;)i.call(u,s[f],f,s),f++;else for(f in s)s.hasOwnProperty(f)&&i.call(u,s[f],f,s)}function Ge(s,i,u){var f="DEPRECATED METHOD: "+i+`
`+u+` AT 
`;return function(){var S=new Error("get-stack-trace"),C=S&&S.stack?S.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",N=l.console&&(l.console.warn||l.console.log);return N&&N.call(l.console,f,C),s.apply(this,arguments)}}var Se;typeof Object.assign!="function"?Se=function(i){if(i===d||i===null)throw new TypeError("Cannot convert undefined or null to object");for(var u=Object(i),f=1;f<arguments.length;f++){var S=arguments[f];if(S!==d&&S!==null)for(var C in S)S.hasOwnProperty(C)&&(u[C]=S[C])}return u}:Se=Object.assign;var rt=Ge(function(i,u,f){for(var S=Object.keys(u),C=0;C<S.length;)(!f||f&&i[S[C]]===d)&&(i[S[C]]=u[S[C]]),C++;return i},"extend","Use `assign`."),oe=Ge(function(i,u){return rt(i,u,!0)},"merge","Use `assign`.");function I(s,i,u){var f=i.prototype,S;S=s.prototype=Object.create(f),S.constructor=s,S._super=f,u&&Se(S,u)}function j(s,i){return function(){return s.apply(i,arguments)}}function Ve(s,i){return typeof s==T?s.apply(i&&i[0]||d,i):s}function ut(s,i){return s===d?i:s}function Ye(s,i,u){q(Ke(i),function(f){s.addEventListener(f,u,!1)})}function Rt(s,i,u){q(Ke(i),function(f){s.removeEventListener(f,u,!1)})}function vs(s,i){for(;s;){if(s==i)return!0;s=s.parentNode}return!1}function je(s,i){return s.indexOf(i)>-1}function Ke(s){return s.trim().split(/\s+/g)}function We(s,i,u){if(s.indexOf&&!u)return s.indexOf(i);for(var f=0;f<s.length;){if(u&&s[f][u]==i||!u&&s[f]===i)return f;f++}return-1}function Ze(s){return Array.prototype.slice.call(s,0)}function Pt(s,i,u){for(var f=[],S=[],C=0;C<s.length;){var N=s[C][i];We(S,N)<0&&f.push(s[C]),S[C]=N,C++}return f=f.sort(function(fe,Ae){return fe[i]>Ae[i]}),f}function Je(s,i){for(var u,f,S=i[0].toUpperCase()+i.slice(1),C=0;C<m.length;){if(u=m[C],f=u?u+S:i,f in s)return f;C++}return d}var ct=1;function Vt(){return ct++}function ps(s){var i=s.ownerDocument||s;return i.defaultView||i.parentWindow||l}var Yt=/mobile|tablet|ip(ad|hone|od)|android/i,fs="ontouchstart"in l,Wt=Je(l,"PointerEvent")!==d,we=fs&&Yt.test(navigator.userAgent),le="touch",Xe="pen",$e="mouse",Ot="kinect",Zt=25,Q=1,Le=2,re=4,Te=8,Dt=1,dt=2,vt=4,pt=8,ft=16,M=dt|vt,R=pt|ft,J=M|R,de=["x","y"],he=["clientX","clientY"];function ae(s,i){var u=this;this.manager=s,this.callback=i,this.element=s.element,this.target=s.options.inputTarget,this.domHandler=function(f){Ve(s.options.enable,[s])&&u.handler(f)},this.init()}ae.prototype={handler:function(){},init:function(){this.evEl&&Ye(this.element,this.evEl,this.domHandler),this.evTarget&&Ye(this.target,this.evTarget,this.domHandler),this.evWin&&Ye(ps(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Rt(this.element,this.evEl,this.domHandler),this.evTarget&&Rt(this.target,this.evTarget,this.domHandler),this.evWin&&Rt(ps(this.element),this.evWin,this.domHandler)}};function Ps(s){var i,u=s.options.inputClass;return u?i=u:Wt?i=Nt:we?i=gt:fs?i=es:i=ee,new i(s,ue)}function ue(s,i,u){var f=u.pointers.length,S=u.changedPointers.length,C=i&Q&&f-S===0,N=i&(re|Te)&&f-S===0;u.isFirst=!!C,u.isFinal=!!N,C&&(s.session={}),u.eventType=i,F(s,u),s.emit("hammer.input",u),s.recognize(u),s.session.prevInput=u}function F(s,i){var u=s.session,f=i.pointers,S=f.length;u.firstInput||(u.firstInput=et(i)),S>1&&!u.firstMultiple?u.firstMultiple=et(i):S===1&&(u.firstMultiple=!1);var C=u.firstInput,N=u.firstMultiple,_e=N?N.center:C.center,fe=i.center=Xt(f);i.timeStamp=D(),i.deltaTime=i.timeStamp-C.timeStamp,i.angle=ht(_e,fe),i.distance=mt(_e,fe),z(u,i),i.offsetDirection=hs(i.deltaX,i.deltaY);var Ae=ms(i.deltaTime,i.deltaX,i.deltaY);i.overallVelocityX=Ae.x,i.overallVelocityY=Ae.y,i.overallVelocity=L(Ae.x)>L(Ae.y)?Ae.x:Ae.y,i.scale=N?Bt(N.pointers,f):1,i.rotation=N?K(N.pointers,f):0,i.maxPointers=u.prevInput?i.pointers.length>u.prevInput.maxPointers?i.pointers.length:u.prevInput.maxPointers:i.pointers.length,wt(u,i);var Ue=s.element;vs(i.srcEvent.target,Ue)&&(Ue=i.srcEvent.target),i.target=Ue}function z(s,i){var u=i.center,f=s.offsetDelta||{},S=s.prevDelta||{},C=s.prevInput||{};(i.eventType===Q||C.eventType===re)&&(S=s.prevDelta={x:C.deltaX||0,y:C.deltaY||0},f=s.offsetDelta={x:u.x,y:u.y}),i.deltaX=S.x+(u.x-f.x),i.deltaY=S.y+(u.y-f.y)}function wt(s,i){var u=s.lastInterval||i,f=i.timeStamp-u.timeStamp,S,C,N,_e;if(i.eventType!=Te&&(f>Zt||u.velocity===d)){var fe=i.deltaX-u.deltaX,Ae=i.deltaY-u.deltaY,Ue=ms(f,fe,Ae);C=Ue.x,N=Ue.y,S=L(Ue.x)>L(Ue.y)?Ue.x:Ue.y,_e=hs(fe,Ae),s.lastInterval=i}else S=u.velocity,C=u.velocityX,N=u.velocityY,_e=u.direction;i.velocity=S,i.velocityX=C,i.velocityY=N,i.direction=_e}function et(s){for(var i=[],u=0;u<s.pointers.length;)i[u]={clientX:E(s.pointers[u].clientX),clientY:E(s.pointers[u].clientY)},u++;return{timeStamp:D(),pointers:i,center:Xt(i),deltaX:s.deltaX,deltaY:s.deltaY}}function Xt(s){var i=s.length;if(i===1)return{x:E(s[0].clientX),y:E(s[0].clientY)};for(var u=0,f=0,S=0;S<i;)u+=s[S].clientX,f+=s[S].clientY,S++;return{x:E(u/i),y:E(f/i)}}function ms(s,i,u){return{x:i/s||0,y:u/s||0}}function hs(s,i){return s===i?Dt:L(s)>=L(i)?s<0?dt:vt:i<0?pt:ft}function mt(s,i,u){u||(u=de);var f=i[u[0]]-s[u[0]],S=i[u[1]]-s[u[1]];return Math.sqrt(f*f+S*S)}function ht(s,i,u){u||(u=de);var f=i[u[0]]-s[u[0]],S=i[u[1]]-s[u[1]];return Math.atan2(S,f)*180/Math.PI}function K(s,i){return ht(i[1],i[0],he)+ht(s[1],s[0],he)}function Bt(s,i){return mt(i[0],i[1],he)/mt(s[0],s[1],he)}var Os={mousedown:Q,mousemove:Le,mouseup:re},gs="mousedown",Ds="mousemove mouseup";function ee(){this.evEl=gs,this.evWin=Ds,this.pressed=!1,ae.apply(this,arguments)}I(ee,ae,{handler:function(i){var u=Os[i.type];u&Q&&i.button===0&&(this.pressed=!0),u&Le&&i.which!==1&&(u=re),this.pressed&&(u&re&&(this.pressed=!1),this.callback(this.manager,u,{pointers:[i],changedPointers:[i],pointerType:$e,srcEvent:i}))}});var ce={pointerdown:Q,pointermove:Le,pointerup:re,pointercancel:Te,pointerout:Te},qt={2:le,3:Xe,4:$e,5:Ot},bs="pointerdown",_s="pointermove pointerup pointercancel";l.MSPointerEvent&&!l.PointerEvent&&(bs="MSPointerDown",_s="MSPointerMove MSPointerUp MSPointerCancel");function Nt(){this.evEl=bs,this.evWin=_s,ae.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}I(Nt,ae,{handler:function(i){var u=this.store,f=!1,S=i.type.toLowerCase().replace("ms",""),C=ce[S],N=qt[i.pointerType]||i.pointerType,_e=N==le,fe=We(u,i.pointerId,"pointerId");C&Q&&(i.button===0||_e)?fe<0&&(u.push(i),fe=u.length-1):C&(re|Te)&&(f=!0),!(fe<0)&&(u[fe]=i,this.callback(this.manager,C,{pointers:u,changedPointers:[i],pointerType:N,srcEvent:i}),f&&u.splice(fe,1))}});var jt={touchstart:Q,touchmove:Le,touchend:re,touchcancel:Te},$t="touchstart",Kt="touchstart touchmove touchend touchcancel";function Jt(){this.evTarget=$t,this.evWin=Kt,this.started=!1,ae.apply(this,arguments)}I(Jt,ae,{handler:function(i){var u=jt[i.type];if(u===Q&&(this.started=!0),!!this.started){var f=ys.call(this,i,u);u&(re|Te)&&f[0].length-f[1].length===0&&(this.started=!1),this.callback(this.manager,u,{pointers:f[0],changedPointers:f[1],pointerType:le,srcEvent:i})}}});function ys(s,i){var u=Ze(s.touches),f=Ze(s.changedTouches);return i&(re|Te)&&(u=Pt(u.concat(f),"identifier")),[u,f]}var Ss={touchstart:Q,touchmove:Le,touchend:re,touchcancel:Te},Ts="touchstart touchmove touchend touchcancel";function gt(){this.evTarget=Ts,this.targetIds={},ae.apply(this,arguments)}I(gt,ae,{handler:function(i){var u=Ss[i.type],f=Cs.call(this,i,u);f&&this.callback(this.manager,u,{pointers:f[0],changedPointers:f[1],pointerType:le,srcEvent:i})}});function Cs(s,i){var u=Ze(s.touches),f=this.targetIds;if(i&(Q|Le)&&u.length===1)return f[u[0].identifier]=!0,[u,u];var S,C,N=Ze(s.changedTouches),_e=[],fe=this.target;if(C=u.filter(function(Ae){return vs(Ae.target,fe)}),i===Q)for(S=0;S<C.length;)f[C[S].identifier]=!0,S++;for(S=0;S<N.length;)f[N[S].identifier]&&_e.push(N[S]),i&(re|Te)&&delete f[N[S].identifier],S++;if(_e.length)return[Pt(C.concat(_e),"identifier"),_e]}var ws=2500,ks=25;function es(){ae.apply(this,arguments);var s=j(this.handler,this);this.touch=new gt(this.manager,s),this.mouse=new ee(this.manager,s),this.primaryTouch=null,this.lastTouches=[]}I(es,ae,{handler:function(i,u,f){var S=f.pointerType==le,C=f.pointerType==$e;if(!(C&&f.sourceCapabilities&&f.sourceCapabilities.firesTouchEvents)){if(S)Bs.call(this,u,f);else if(C&&Ns.call(this,f))return;this.callback(i,u,f)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Bs(s,i){s&Q?(this.primaryTouch=i.changedPointers[0].identifier,Es.call(this,i)):s&(re|Te)&&Es.call(this,i)}function Es(s){var i=s.changedPointers[0];if(i.identifier===this.primaryTouch){var u={x:i.clientX,y:i.clientY};this.lastTouches.push(u);var f=this.lastTouches,S=function(){var C=f.indexOf(u);C>-1&&f.splice(C,1)};setTimeout(S,ws)}}function Ns(s){for(var i=s.srcEvent.clientX,u=s.srcEvent.clientY,f=0;f<this.lastTouches.length;f++){var S=this.lastTouches[f],C=Math.abs(i-S.x),N=Math.abs(u-S.y);if(C<=ks&&N<=ks)return!0}return!1}var As=Je(y.style,"touchAction"),Ms=As!==d,zt="compute",Ft="auto",ts="manipulation",at="none",bt="pan-x",O="pan-y",ge=ie();function Ie(s,i){this.manager=s,this.set(i)}Ie.prototype={set:function(s){s==zt&&(s=this.compute()),Ms&&this.manager.element.style&&ge[s]&&(this.manager.element.style[As]=s),this.actions=s.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var s=[];return q(this.manager.recognizers,function(i){Ve(i.options.enable,[i])&&(s=s.concat(i.getTouchAction()))}),ss(s.join(" "))},preventDefaults:function(s){var i=s.srcEvent,u=s.offsetDirection;if(this.manager.session.prevented){i.preventDefault();return}var f=this.actions,S=je(f,at)&&!ge[at],C=je(f,O)&&!ge[O],N=je(f,bt)&&!ge[bt];if(S){var _e=s.pointers.length===1,fe=s.distance<2,Ae=s.deltaTime<250;if(_e&&fe&&Ae)return}if(!(N&&C)&&(S||C&&u&M||N&&u&R))return this.preventSrc(i)},preventSrc:function(s){this.manager.session.prevented=!0,s.preventDefault()}};function ss(s){if(je(s,at))return at;var i=je(s,bt),u=je(s,O);return i&&u?at:i||u?i?bt:O:je(s,ts)?ts:Ft}function ie(){if(!Ms)return!1;var s={},i=l.CSS&&l.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(u){s[u]=i?l.CSS.supports("touch-action",u):!0}),s}var Ce=1,Re=2,it=4,qe=8,ze=qe,_t=16,Ee=32;function ke(s){this.options=Se({},this.defaults,s||{}),this.id=Vt(),this.manager=null,this.options.enable=ut(this.options.enable,!0),this.state=Ce,this.simultaneous={},this.requireFail=[]}ke.prototype={defaults:{},set:function(s){return Se(this.options,s),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(s){if(Z(s,"recognizeWith",this))return this;var i=this.simultaneous;return s=Fe(s,this),i[s.id]||(i[s.id]=s,s.recognizeWith(this)),this},dropRecognizeWith:function(s){return Z(s,"dropRecognizeWith",this)?this:(s=Fe(s,this),delete this.simultaneous[s.id],this)},requireFailure:function(s){if(Z(s,"requireFailure",this))return this;var i=this.requireFail;return s=Fe(s,this),We(i,s)===-1&&(i.push(s),s.requireFailure(this)),this},dropRequireFailure:function(s){if(Z(s,"dropRequireFailure",this))return this;s=Fe(s,this);var i=We(this.requireFail,s);return i>-1&&this.requireFail.splice(i,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(s){return!!this.simultaneous[s.id]},emit:function(s){var i=this,u=this.state;function f(S){i.manager.emit(S,s)}u<qe&&f(i.options.event+yt(u)),f(i.options.event),s.additionalEvent&&f(s.additionalEvent),u>=qe&&f(i.options.event+yt(u))},tryEmit:function(s){if(this.canEmit())return this.emit(s);this.state=Ee},canEmit:function(){for(var s=0;s<this.requireFail.length;){if(!(this.requireFail[s].state&(Ee|Ce)))return!1;s++}return!0},recognize:function(s){var i=Se({},s);if(!Ve(this.options.enable,[this,i])){this.reset(),this.state=Ee;return}this.state&(ze|_t|Ee)&&(this.state=Ce),this.state=this.process(i),this.state&(Re|it|qe|_t)&&this.tryEmit(i)},process:function(s){},getTouchAction:function(){},reset:function(){}};function yt(s){return s&_t?"cancel":s&qe?"end":s&it?"move":s&Re?"start":""}function ns(s){return s==ft?"down":s==pt?"up":s==dt?"left":s==vt?"right":""}function Fe(s,i){var u=i.manager;return u?u.get(s):s}function be(){ke.apply(this,arguments)}I(be,ke,{defaults:{pointers:1},attrTest:function(s){var i=this.options.pointers;return i===0||s.pointers.length===i},process:function(s){var i=this.state,u=s.eventType,f=i&(Re|it),S=this.attrTest(s);return f&&(u&Te||!S)?i|_t:f||S?u&re?i|qe:i&Re?i|it:Re:Ee}});function St(){be.apply(this,arguments),this.pX=null,this.pY=null}I(St,be,{defaults:{event:"pan",threshold:10,pointers:1,direction:J},getTouchAction:function(){var s=this.options.direction,i=[];return s&M&&i.push(O),s&R&&i.push(bt),i},directionTest:function(s){var i=this.options,u=!0,f=s.distance,S=s.direction,C=s.deltaX,N=s.deltaY;return S&i.direction||(i.direction&M?(S=C===0?Dt:C<0?dt:vt,u=C!=this.pX,f=Math.abs(s.deltaX)):(S=N===0?Dt:N<0?pt:ft,u=N!=this.pY,f=Math.abs(s.deltaY))),s.direction=S,u&&f>i.threshold&&S&i.direction},attrTest:function(s){return be.prototype.attrTest.call(this,s)&&(this.state&Re||!(this.state&Re)&&this.directionTest(s))},emit:function(s){this.pX=s.deltaX,this.pY=s.deltaY;var i=ns(s.direction);i&&(s.additionalEvent=this.options.event+i),this._super.emit.call(this,s)}});function tt(){be.apply(this,arguments)}I(tt,be,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[at]},attrTest:function(s){return this._super.attrTest.call(this,s)&&(Math.abs(s.scale-1)>this.options.threshold||this.state&Re)},emit:function(s){if(s.scale!==1){var i=s.scale<1?"in":"out";s.additionalEvent=this.options.event+i}this._super.emit.call(this,s)}});function Tt(){ke.apply(this,arguments),this._timer=null,this._input=null}I(Tt,ke,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ft]},process:function(s){var i=this.options,u=s.pointers.length===i.pointers,f=s.distance<i.threshold,S=s.deltaTime>i.time;if(this._input=s,!f||!u||s.eventType&(re|Te)&&!S)this.reset();else if(s.eventType&Q)this.reset(),this._timer=G(function(){this.state=ze,this.tryEmit()},i.time,this);else if(s.eventType&re)return ze;return Ee},reset:function(){clearTimeout(this._timer)},emit:function(s){this.state===ze&&(s&&s.eventType&re?this.manager.emit(this.options.event+"up",s):(this._input.timeStamp=D(),this.manager.emit(this.options.event,this._input)))}});function as(){be.apply(this,arguments)}I(as,be,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[at]},attrTest:function(s){return this._super.attrTest.call(this,s)&&(Math.abs(s.rotation)>this.options.threshold||this.state&Re)}});function is(){be.apply(this,arguments)}I(is,be,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:M|R,pointers:1},getTouchAction:function(){return St.prototype.getTouchAction.call(this)},attrTest:function(s){var i=this.options.direction,u;return i&(M|R)?u=s.overallVelocity:i&M?u=s.overallVelocityX:i&R&&(u=s.overallVelocityY),this._super.attrTest.call(this,s)&&i&s.offsetDirection&&s.distance>this.options.threshold&&s.maxPointers==this.options.pointers&&L(u)>this.options.velocity&&s.eventType&re},emit:function(s){var i=ns(s.offsetDirection);i&&this.manager.emit(this.options.event+i,s),this.manager.emit(this.options.event,s)}});function Ct(){ke.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}I(Ct,ke,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ts]},process:function(s){var i=this.options,u=s.pointers.length===i.pointers,f=s.distance<i.threshold,S=s.deltaTime<i.time;if(this.reset(),s.eventType&Q&&this.count===0)return this.failTimeout();if(f&&S&&u){if(s.eventType!=re)return this.failTimeout();var C=this.pTime?s.timeStamp-this.pTime<i.interval:!0,N=!this.pCenter||mt(this.pCenter,s.center)<i.posThreshold;this.pTime=s.timeStamp,this.pCenter=s.center,!N||!C?this.count=1:this.count+=1,this._input=s;var _e=this.count%i.taps;if(_e===0)return this.hasRequireFailures()?(this._timer=G(function(){this.state=ze,this.tryEmit()},i.interval,this),Re):ze}return Ee},failTimeout:function(){return this._timer=G(function(){this.state=Ee},this.options.interval,this),Ee},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ze&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Qe(s,i){return i=i||{},i.recognizers=ut(i.recognizers,Qe.defaults.preset),new kt(s,i)}Qe.VERSION="2.0.7",Qe.defaults={domEvents:!1,touchAction:zt,enable:!0,inputTarget:null,inputClass:null,preset:[[as,{enable:!1}],[tt,{enable:!1},["rotate"]],[is,{direction:M}],[St,{direction:M},["swipe"]],[Ct],[Ct,{event:"doubletap",taps:2},["tap"]],[Tt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var $s=1,Ut=2;function kt(s,i){this.options=Se({},Qe.defaults,i||{}),this.options.inputTarget=this.options.inputTarget||s,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=s,this.input=Ps(this),this.touchAction=new Ie(this,this.options.touchAction),Gt(this,!0),q(this.options.recognizers,function(u){var f=this.add(new u[0](u[1]));u[2]&&f.recognizeWith(u[2]),u[3]&&f.requireFailure(u[3])},this)}kt.prototype={set:function(s){return Se(this.options,s),s.touchAction&&this.touchAction.update(),s.inputTarget&&(this.input.destroy(),this.input.target=s.inputTarget,this.input.init()),this},stop:function(s){this.session.stopped=s?Ut:$s},recognize:function(s){var i=this.session;if(!i.stopped){this.touchAction.preventDefaults(s);var u,f=this.recognizers,S=i.curRecognizer;(!S||S&&S.state&ze)&&(S=i.curRecognizer=null);for(var C=0;C<f.length;)u=f[C],i.stopped!==Ut&&(!S||u==S||u.canRecognizeWith(S))?u.recognize(s):u.reset(),!S&&u.state&(Re|it|qe)&&(S=i.curRecognizer=u),C++}},get:function(s){if(s instanceof ke)return s;for(var i=this.recognizers,u=0;u<i.length;u++)if(i[u].options.event==s)return i[u];return null},add:function(s){if(Z(s,"add",this))return this;var i=this.get(s.options.event);return i&&this.remove(i),this.recognizers.push(s),s.manager=this,this.touchAction.update(),s},remove:function(s){if(Z(s,"remove",this))return this;if(s=this.get(s),s){var i=this.recognizers,u=We(i,s);u!==-1&&(i.splice(u,1),this.touchAction.update())}return this},on:function(s,i){if(s!==d&&i!==d){var u=this.handlers;return q(Ke(s),function(f){u[f]=u[f]||[],u[f].push(i)}),this}},off:function(s,i){if(s!==d){var u=this.handlers;return q(Ke(s),function(f){i?u[f]&&u[f].splice(We(u[f],i),1):delete u[f]}),this}},emit:function(s,i){this.options.domEvents&&Et(s,i);var u=this.handlers[s]&&this.handlers[s].slice();if(!(!u||!u.length)){i.type=s,i.preventDefault=function(){i.srcEvent.preventDefault()};for(var f=0;f<u.length;)u[f](i),f++}},destroy:function(){this.element&&Gt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Gt(s,i){var u=s.element;if(u.style){var f;q(s.options.cssProps,function(S,C){f=Je(u.style,C),i?(s.oldCssProps[f]=u.style[f],u.style[f]=S):u.style[f]=s.oldCssProps[f]||""}),i||(s.oldCssProps={})}}function Et(s,i){var u=r.createEvent("Event");u.initEvent(s,!0,!0),u.gesture=i,i.target.dispatchEvent(u)}Se(Qe,{INPUT_START:Q,INPUT_MOVE:Le,INPUT_END:re,INPUT_CANCEL:Te,STATE_POSSIBLE:Ce,STATE_BEGAN:Re,STATE_CHANGED:it,STATE_ENDED:qe,STATE_RECOGNIZED:ze,STATE_CANCELLED:_t,STATE_FAILED:Ee,DIRECTION_NONE:Dt,DIRECTION_LEFT:dt,DIRECTION_RIGHT:vt,DIRECTION_UP:pt,DIRECTION_DOWN:ft,DIRECTION_HORIZONTAL:M,DIRECTION_VERTICAL:R,DIRECTION_ALL:J,Manager:kt,Input:ae,TouchAction:Ie,TouchInput:gt,MouseInput:ee,PointerEventInput:Nt,TouchMouseInput:es,SingleTouchInput:Jt,Recognizer:ke,AttrRecognizer:be,Tap:Ct,Pan:St,Swipe:is,Pinch:tt,Rotate:as,Press:Tt,on:Ye,off:Rt,each:q,merge:oe,extend:rt,assign:Se,inherit:I,bindFn:j,prefixed:Je});var He=typeof l<"u"?l:typeof self<"u"?self:{};He.Hammer=Qe,e.exports?e.exports=Qe:l[v]=Qe})(window,document,"Hammer")})(Gs)),Gs.exports}var Ya=Va();const us=Ha(Ya);const ds=e=>e&&e.enabled&&e.modifierKey,Dn=(e,l)=>e&&l[e+"Key"],Js=(e,l)=>e&&!l[e+"Key"];function ot(e,l,r){return e===void 0?!0:typeof e=="string"?e.indexOf(l)!==-1:typeof e=="function"?e({chart:r}).indexOf(l)!==-1:!1}function Qs(e,l){return typeof e=="function"&&(e=e({chart:l})),typeof e=="string"?{x:e.indexOf("x")!==-1,y:e.indexOf("y")!==-1}:{x:!1,y:!1}}function Wa(e,l){let r;return function(){return clearTimeout(r),r=setTimeout(e,l),l}}function Za({x:e,y:l},r){const v=r.scales,d=Object.keys(v);for(let m=0;m<d.length;m++){const y=v[d[m]];if(l>=y.top&&l<=y.bottom&&e>=y.left&&e<=y.right)return y}return null}function wn(e,l,r){const{mode:v="xy",scaleMode:d,overScaleMode:m}=e||{},y=Za(l,r),T=Qs(v,r),E=Qs(d,r);if(m){const D=Qs(m,r);for(const G of["x","y"])D[G]&&(E[G]=T[G],T[G]=!1)}if(y&&E[y.axis])return[y];const L=[];return lt(r.scales,function(D){T[D.axis]&&L.push(D)}),L}const Ys=new WeakMap;function pe(e){let l=Ys.get(e);return l||(l={originalScaleLimits:{},updatedScaleLimits:{},handlers:{},panDelta:{},dragging:!1,panning:!1},Ys.set(e,l)),l}function Xa(e){Ys.delete(e)}function Bn(e,l,r,v){const d=Math.max(0,Math.min(1,(e-l)/r||0)),m=1-d;return{min:v*d,max:v*m}}function Nn(e,l){const r=e.isHorizontal()?l.x:l.y;return e.getValueForPixel(r)}function $n(e,l,r){const v=e.max-e.min,d=v*(l-1),m=Nn(e,r);return Bn(m,e.min,v,d)}function qa(e,l,r){const v=Nn(e,r);if(v===void 0)return{min:e.min,max:e.max};const d=Math.log10(e.min),m=Math.log10(e.max),y=Math.log10(v),T=m-d,E=T*(l-1),L=Bn(y,d,T,E);return{min:Math.pow(10,d+L.min),max:Math.pow(10,m-L.max)}}function ja(e,l){return l&&(l[e.id]||l[e.axis])||{}}function fn(e,l,r,v,d){let m=r[v];if(m==="original"){const y=e.originalScaleLimits[l.id][v];m=Rs(y.options,y.scale)}return Rs(m,d)}function Ka(e,l,r){const v=e.getValueForPixel(l),d=e.getValueForPixel(r);return{min:Math.min(v,d),max:Math.max(v,d)}}function Ja(e,{min:l,max:r,minLimit:v,maxLimit:d},m){const y=(e-r+l)/2;l-=y,r+=y;const T=m.min.options??m.min.scale,E=m.max.options??m.max.scale,L=e/1e6;return dn(l,T,L)&&(l=T),dn(r,E,L)&&(r=E),l<v?(l=v,r=Math.min(v+e,d)):r>d&&(r=d,l=Math.max(d-e,v)),{min:l,max:r}}function It(e,{min:l,max:r},v,d=!1){const m=pe(e.chart),{options:y}=e,T=ja(e,v),{minRange:E=0}=T,L=fn(m,e,T,"min",-1/0),D=fn(m,e,T,"max",1/0);if(d==="pan"&&(l<L||r>D))return!0;const G=e.max-e.min,Z=d?Math.max(r-l,E):G;if(d&&Z===E&&G<=E)return!0;const q=Ja(Z,{min:l,max:r,minLimit:L,maxLimit:D},m.originalScaleLimits[e.id]);return y.min=q.min,y.max=q.max,m.updatedScaleLimits[e.id]=q,e.parse(q.min)!==e.min||e.parse(q.max)!==e.max}function ei(e,l,r,v){const d=$n(e,l,r),m={min:e.min+d.min,max:e.max-d.max};return It(e,m,v,!0)}function ti(e,l,r,v){const d=qa(e,l,r);return It(e,d,v,!0)}function si(e,l,r,v){It(e,Ka(e,l,r),v,!0)}const mn=e=>e===0||isNaN(e)?0:e<0?Math.min(Math.round(e),-1):Math.max(Math.round(e),1);function ni(e){const r=e.getLabels().length-1;e.min>0&&(e.min-=1),e.max<r&&(e.max+=1)}function ai(e,l,r,v){const d=$n(e,l,r);e.min===e.max&&l<1&&ni(e);const m={min:e.min+mn(d.min),max:e.max-mn(d.max)};return It(e,m,v,!0)}function ii(e){return e.isHorizontal()?e.width:e.height}function oi(e,l,r){const d=e.getLabels().length-1;let{min:m,max:y}=e;const T=Math.max(y-m,1),E=Math.round(ii(e)/Math.max(T,10)),L=Math.round(Math.abs(l/E));let D;return l<-E?(y=Math.min(y+L,d),m=T===1?y:y-T,D=y===d):l>E&&(m=Math.max(0,m-L),y=T===1?m:m+T,D=m===0),It(e,{min:m,max:y},r)||D}const li={second:500,minute:30*1e3,hour:1800*1e3,day:720*60*1e3,week:3.5*24*60*60*1e3,month:360*60*60*1e3,quarter:1440*60*60*1e3,year:4368*60*60*1e3};function zn(e,l,r,v=!1){const{min:d,max:m,options:y}=e,T=y.time&&y.time.round,E=li[T]||0,L=e.getValueForPixel(e.getPixelForValue(d+E)-l),D=e.getValueForPixel(e.getPixelForValue(m+E)-l);return isNaN(L)||isNaN(D)?!0:It(e,{min:L,max:D},r,v?"pan":!1)}function hn(e,l,r){return zn(e,l,r,!0)}const Ws={category:ai,default:ei,logarithmic:ti},Zs={default:si},Xs={category:oi,default:zn,logarithmic:hn,timeseries:hn};function ri(e,l,r){const{id:v,options:{min:d,max:m}}=e;if(!l[v]||!r[v])return!0;const y=r[v];return y.min!==d||y.max!==m}function gn(e,l){lt(e,(r,v)=>{l[v]||delete e[v]})}function Ht(e,l){const{scales:r}=e,{originalScaleLimits:v,updatedScaleLimits:d}=l;return lt(r,function(m){ri(m,v,d)&&(v[m.id]={min:{scale:m.min,options:m.options.min},max:{scale:m.max,options:m.options.max}})}),gn(v,r),gn(d,r),v}function bn(e,l,r,v){const d=Ws[e.type]||Ws.default;me(d,[e,l,r,v])}function _n(e,l,r,v){const d=Zs[e.type]||Zs.default;me(d,[e,l,r,v])}function ui(e){const l=e.chartArea;return{x:(l.left+l.right)/2,y:(l.top+l.bottom)/2}}function en(e,l,r="none",v="api"){const{x:d=1,y:m=1,focalPoint:y=ui(e)}=typeof l=="number"?{x:l,y:l}:l,T=pe(e),{options:{limits:E,zoom:L}}=T;Ht(e,T);const D=d!==1,G=m!==1,Z=wn(L,y,e);lt(Z||e.scales,function(q){q.isHorizontal()&&D?bn(q,d,y,E):!q.isHorizontal()&&G&&bn(q,m,y,E)}),e.update(r),me(L.onZoom,[{chart:e,trigger:v}])}function Fn(e,l,r,v="none",d="api"){const m=pe(e),{options:{limits:y,zoom:T}}=m,{mode:E="xy"}=T;Ht(e,m);const L=ot(E,"x",e),D=ot(E,"y",e);lt(e.scales,function(G){G.isHorizontal()&&L?_n(G,l.x,r.x,y):!G.isHorizontal()&&D&&_n(G,l.y,r.y,y)}),e.update(v),me(T.onZoom,[{chart:e,trigger:d}])}function ci(e,l,r,v="none",d="api"){const m=pe(e);Ht(e,m);const y=e.scales[l];It(y,r,void 0,!0),e.update(v),me(m.options.zoom?.onZoom,[{chart:e,trigger:d}])}function di(e,l="default"){const r=pe(e),v=Ht(e,r);lt(e.scales,function(d){const m=d.options;v[d.id]?(m.min=v[d.id].min.options,m.max=v[d.id].max.options):(delete m.min,delete m.max),delete r.updatedScaleLimits[d.id]}),e.update(l),me(r.options.zoom.onZoomComplete,[{chart:e}])}function vi(e,l){const r=e.originalScaleLimits[l];if(!r)return;const{min:v,max:d}=r;return Rs(d.options,d.scale)-Rs(v.options,v.scale)}function pi(e){const l=pe(e);let r=1,v=1;return lt(e.scales,function(d){const m=vi(l,d.id);if(m){const y=Math.round(m/(d.max-d.min)*100)/100;r=Math.min(r,y),v=Math.max(v,y)}}),r<1?r:v}function yn(e,l,r,v){const{panDelta:d}=v,m=d[e.id]||0;vn(m)===vn(l)&&(l+=m);const y=Xs[e.type]||Xs.default;me(y,[e,l,r])?d[e.id]=0:d[e.id]=l}function Un(e,l,r,v="none"){const{x:d=0,y:m=0}=typeof l=="number"?{x:l,y:l}:l,y=pe(e),{options:{pan:T,limits:E}}=y,{onPan:L}=T||{};Ht(e,y);const D=d!==0,G=m!==0;lt(r||e.scales,function(Z){Z.isHorizontal()&&D?yn(Z,d,E,y):!Z.isHorizontal()&&G&&yn(Z,m,E,y)}),e.update(v),me(L,[{chart:e}])}function Gn(e){const l=pe(e);Ht(e,l);const r={};for(const v of Object.keys(e.scales)){const{min:d,max:m}=l.originalScaleLimits[v]||{min:{},max:{}};r[v]={min:d.scale,max:m.scale}}return r}function fi(e){const l=pe(e),r={};for(const v of Object.keys(e.scales))r[v]=l.updatedScaleLimits[v];return r}function mi(e){const l=Gn(e);for(const r of Object.keys(e.scales)){const{min:v,max:d}=l[r];if(v!==void 0&&e.scales[r].min!==v||d!==void 0&&e.scales[r].max!==d)return!0}return!1}function Sn(e){const l=pe(e);return l.panning||l.dragging}const Tn=(e,l,r)=>Math.min(r,Math.max(l,e));function Ne(e,l){const{handlers:r}=pe(e),v=r[l];v&&v.target&&(v.target.removeEventListener(l,v),delete r[l])}function cs(e,l,r,v){const{handlers:d,options:m}=pe(e),y=d[r];if(y&&y.target===l)return;Ne(e,r),d[r]=E=>v(e,E,m),d[r].target=l;const T=r==="wheel"?!1:void 0;l.addEventListener(r,d[r],{passive:T})}function hi(e,l){const r=pe(e);r.dragStart&&(r.dragging=!0,r.dragEnd=l,e.update("none"))}function gi(e,l){const r=pe(e);!r.dragStart||l.key!=="Escape"||(Ne(e,"keydown"),r.dragging=!1,r.dragStart=r.dragEnd=null,e.update("none"))}function qs(e,l){if(e.target!==l.canvas){const r=l.canvas.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top}}return Ks(e,l)}function Qn(e,l,r){const{onZoomStart:v,onZoomRejected:d}=r;if(v){const m=qs(l,e);if(me(v,[{chart:e,event:l,point:m}])===!1)return me(d,[{chart:e,event:l}]),!1}}function bi(e,l){if(e.legend){const m=Ks(l,e);if(oa(m,e.legend))return}const r=pe(e),{pan:v,zoom:d={}}=r.options;if(l.button!==0||Dn(ds(v),l)||Js(ds(d.drag),l))return me(d.onZoomRejected,[{chart:e,event:l}]);Qn(e,l,d)!==!1&&(r.dragStart=l,cs(e,e.canvas.ownerDocument,"mousemove",hi),cs(e,window.document,"keydown",gi))}function _i({begin:e,end:l},r){let v=l.x-e.x,d=l.y-e.y;const m=Math.abs(v/d);m>r?v=Math.sign(v)*Math.abs(d*r):m<r&&(d=Math.sign(d)*Math.abs(v/r)),l.x=e.x+v,l.y=e.y+d}function Cn(e,l,r,{min:v,max:d,prop:m}){e[v]=Tn(Math.min(r.begin[m],r.end[m]),l[v],l[d]),e[d]=Tn(Math.max(r.begin[m],r.end[m]),l[v],l[d])}function yi(e,l,r){const v={begin:qs(l.dragStart,e),end:qs(l.dragEnd,e)};if(r){const d=e.chartArea.width/e.chartArea.height;_i(v,d)}return v}function Hn(e,l,r,v){const d=ot(l,"x",e),m=ot(l,"y",e),{top:y,left:T,right:E,bottom:L,width:D,height:G}=e.chartArea,Z={top:y,left:T,right:E,bottom:L},q=yi(e,r,v&&d&&m);d&&Cn(Z,e.chartArea,q,{min:"left",max:"right",prop:"x"}),m&&Cn(Z,e.chartArea,q,{min:"top",max:"bottom",prop:"y"});const Ge=Z.right-Z.left,Se=Z.bottom-Z.top;return{...Z,width:Ge,height:Se,zoomX:d&&Ge?1+(D-Ge)/D:1,zoomY:m&&Se?1+(G-Se)/G:1}}function Si(e,l){const r=pe(e);if(!r.dragStart)return;Ne(e,"mousemove");const{mode:v,onZoomComplete:d,drag:{threshold:m=0,maintainAspectRatio:y}}=r.options.zoom,T=Hn(e,v,{dragStart:r.dragStart,dragEnd:l},y),E=ot(v,"x",e)?T.width:0,L=ot(v,"y",e)?T.height:0,D=Math.sqrt(E*E+L*L);if(r.dragStart=r.dragEnd=null,D<=m){r.dragging=!1,e.update("none");return}Fn(e,{x:T.left,y:T.top},{x:T.right,y:T.bottom},"zoom","drag"),r.dragging=!1,r.filterNextClick=!0,me(d,[{chart:e}])}function Ti(e,l,r){if(Js(ds(r.wheel),l)){me(r.onZoomRejected,[{chart:e,event:l}]);return}if(Qn(e,l,r)!==!1&&(l.cancelable&&l.preventDefault(),l.deltaY!==void 0))return!0}function Ci(e,l){const{handlers:{onZoomComplete:r},options:{zoom:v}}=pe(e);if(!Ti(e,l,v))return;const d=l.target.getBoundingClientRect(),m=v.wheel.speed,y=l.deltaY>=0?2-1/(1-m):1+m,T={x:y,y,focalPoint:{x:l.clientX-d.left,y:l.clientY-d.top}};en(e,T,"zoom","wheel"),me(r,[{chart:e}])}function ki(e,l,r,v){r&&(pe(e).handlers[l]=Wa(()=>me(r,[{chart:e}]),v))}function Ei(e,l){const r=e.canvas,{wheel:v,drag:d,onZoomComplete:m}=l.zoom;v.enabled?(cs(e,r,"wheel",Ci),ki(e,"onZoomComplete",m,250)):Ne(e,"wheel"),d.enabled?(cs(e,r,"mousedown",bi),cs(e,r.ownerDocument,"mouseup",Si)):(Ne(e,"mousedown"),Ne(e,"mousemove"),Ne(e,"mouseup"),Ne(e,"keydown"))}function Ai(e){Ne(e,"mousedown"),Ne(e,"mousemove"),Ne(e,"mouseup"),Ne(e,"wheel"),Ne(e,"click"),Ne(e,"keydown")}function Mi(e,l){return function(r,v){const{pan:d,zoom:m={}}=l.options;if(!d||!d.enabled)return!1;const y=v&&v.srcEvent;return y&&!l.panning&&v.pointerType==="mouse"&&(Js(ds(d),y)||Dn(ds(m.drag),y))?(me(d.onPanRejected,[{chart:e,event:v}]),!1):!0}}function xi(e,l){const r=Math.abs(e.clientX-l.clientX),v=Math.abs(e.clientY-l.clientY),d=r/v;let m,y;return d>.3&&d<1.7?m=y=!0:r>v?m=!0:y=!0,{x:m,y}}function Vn(e,l,r){if(l.scale){const{center:v,pointers:d}=r,m=1/l.scale*r.scale,y=r.target.getBoundingClientRect(),T=xi(d[0],d[1]),E=l.options.zoom.mode,L={x:T.x&&ot(E,"x",e)?m:1,y:T.y&&ot(E,"y",e)?m:1,focalPoint:{x:v.x-y.left,y:v.y-y.top}};en(e,L,"zoom","pinch"),l.scale=r.scale}}function Li(e,l,r){if(l.options.zoom.pinch.enabled){const v=Ks(r,e);me(l.options.zoom.onZoomStart,[{chart:e,event:r,point:v}])===!1?(l.scale=null,me(l.options.zoom.onZoomRejected,[{chart:e,event:r}])):l.scale=1}}function Ii(e,l,r){l.scale&&(Vn(e,l,r),l.scale=null,me(l.options.zoom.onZoomComplete,[{chart:e}]))}function Yn(e,l,r){const v=l.delta;v&&(l.panning=!0,Un(e,{x:r.deltaX-v.x,y:r.deltaY-v.y},l.panScales),l.delta={x:r.deltaX,y:r.deltaY})}function Ri(e,l,r){const{enabled:v,onPanStart:d,onPanRejected:m}=l.options.pan;if(!v)return;const y=r.target.getBoundingClientRect(),T={x:r.center.x-y.left,y:r.center.y-y.top};if(me(d,[{chart:e,event:r,point:T}])===!1)return me(m,[{chart:e,event:r}]);l.panScales=wn(l.options.pan,T,e),l.delta={x:0,y:0},Yn(e,l,r)}function Pi(e,l){l.delta=null,l.panning&&(l.panning=!1,l.filterNextClick=!0,me(l.options.pan.onPanComplete,[{chart:e}]))}const js=new WeakMap;function kn(e,l){const r=pe(e),v=e.canvas,{pan:d,zoom:m}=l,y=new us.Manager(v);m&&m.pinch.enabled&&(y.add(new us.Pinch),y.on("pinchstart",T=>Li(e,r,T)),y.on("pinch",T=>Vn(e,r,T)),y.on("pinchend",T=>Ii(e,r,T))),d&&d.enabled&&(y.add(new us.Pan({threshold:d.threshold,enable:Mi(e,r)})),y.on("panstart",T=>Ri(e,r,T)),y.on("panmove",T=>Yn(e,r,T)),y.on("panend",()=>Pi(e,r))),js.set(e,y)}function En(e){const l=js.get(e);l&&(l.remove("pinchstart"),l.remove("pinch"),l.remove("pinchend"),l.remove("panstart"),l.remove("pan"),l.remove("panend"),l.destroy(),js.delete(e))}function Oi(e,l){const{pan:r,zoom:v}=e,{pan:d,zoom:m}=l;return v?.zoom?.pinch?.enabled!==m?.zoom?.pinch?.enabled||r?.enabled!==d?.enabled||r?.threshold!==d?.threshold}var Di="2.2.0";function Is(e,l,r){const v=r.zoom.drag,{dragStart:d,dragEnd:m}=pe(e);if(v.drawTime!==l||!m)return;const{left:y,top:T,width:E,height:L}=Hn(e,r.zoom.mode,{dragStart:d,dragEnd:m},v.maintainAspectRatio),D=e.ctx;D.save(),D.beginPath(),D.fillStyle=v.backgroundColor||"rgba(225,225,225,0.3)",D.fillRect(y,T,E,L),v.borderWidth>0&&(D.lineWidth=v.borderWidth,D.strokeStyle=v.borderColor||"rgba(225,225,225)",D.strokeRect(y,T,E,L)),D.restore()}var wi={id:"zoom",version:Di,defaults:{pan:{enabled:!1,mode:"xy",threshold:10,modifierKey:null},zoom:{wheel:{enabled:!1,speed:.1,modifierKey:null},drag:{enabled:!1,drawTime:"beforeDatasetsDraw",modifierKey:null},pinch:{enabled:!1},mode:"xy"}},start:function(e,l,r){const v=pe(e);v.options=r,Object.prototype.hasOwnProperty.call(r.zoom,"enabled")&&console.warn("The option `zoom.enabled` is no longer supported. Please use `zoom.wheel.enabled`, `zoom.drag.enabled`, or `zoom.pinch.enabled`."),(Object.prototype.hasOwnProperty.call(r.zoom,"overScaleMode")||Object.prototype.hasOwnProperty.call(r.pan,"overScaleMode"))&&console.warn("The option `overScaleMode` is deprecated. Please use `scaleMode` instead (and update `mode` as desired)."),us&&kn(e,r),e.pan=(d,m,y)=>Un(e,d,m,y),e.zoom=(d,m)=>en(e,d,m),e.zoomRect=(d,m,y)=>Fn(e,d,m,y),e.zoomScale=(d,m,y)=>ci(e,d,m,y),e.resetZoom=d=>di(e,d),e.getZoomLevel=()=>pi(e),e.getInitialScaleBounds=()=>Gn(e),e.getZoomedScaleBounds=()=>fi(e),e.isZoomedOrPanned=()=>mi(e),e.isZoomingOrPanning=()=>Sn(e)},beforeEvent(e,{event:l}){if(Sn(e))return!1;if(l.type==="click"||l.type==="mouseup"){const r=pe(e);if(r.filterNextClick)return r.filterNextClick=!1,!1}},beforeUpdate:function(e,l,r){const v=pe(e),d=v.options;v.options=r,Oi(d,r)&&(En(e),kn(e,r)),Ei(e,r)},beforeDatasetsDraw(e,l,r){Is(e,"beforeDatasetsDraw",r)},afterDatasetsDraw(e,l,r){Is(e,"afterDatasetsDraw",r)},beforeDraw(e,l,r){Is(e,"beforeDraw",r)},afterDraw(e,l,r){Is(e,"afterDraw",r)},stop:function(e){Ai(e),us&&En(e),Xa(e)},panFunctions:Xs,zoomFunctions:Ws,zoomRectFunctions:Zs};const Bi={class:"session-detail-wrapper"},Ni={key:0,class:"share-notification"},$i={key:0,class:"autoselect-notification"},zi={class:"nav-bar"},Fi={key:0,class:"loading-state"},Ui={key:1,class:"error-state"},Gi={class:"error-text"},Qi={class:"session-header"},Hi={class:"header-row"},Vi={class:"track-name"},Yi={class:"header-meta"},Wi={class:"car"},Zi={class:"master-detail"},Xi={class:"master"},qi={class:"builder-panel"},ji={class:"builder-panel-header"},Ki={class:"builder-slot builder-slot--a"},Ji={class:"builder-slot-content"},eo={key:0,class:"builder-slot-empty"},to={key:0,class:"chip-session-tag"},so=["title"],no={key:0,class:"chip-session-tag"},ao={class:"builder-slot builder-slot--b"},io={class:"builder-slot-content"},oo={key:0,class:"builder-slot-empty"},lo={key:0,class:"chip-session-tag"},ro=["title"],uo={key:0,class:"chip-session-tag"},co={class:"cross-session-section"},vo={class:"cross-session-header cross-session-header--a"},po={class:"cross-session-label"},fo={class:"cross-session-date"},mo={class:"stint-list stint-list--builder"},ho=["onClick"],go=["disabled","title","onClick"],bo=["disabled","title","onClick"],_o={class:"stint-icon-slot"},yo={class:"stint-number"},So={class:"stint-laps"},To={class:"cross-session-section"},Co={class:"cross-session-header cross-session-header--b"},ko={class:"cross-session-label"},Eo={class:"stint-list stint-list--builder"},Ao=["onClick"],Mo=["disabled","title","onClick"],xo=["disabled","title","onClick"],Lo={class:"stint-icon-slot"},Io={class:"stint-number"},Ro={class:"stint-laps"},Po={class:"stint-list stint-list--builder"},Oo=["onClick"],Do=["disabled","title","onClick"],wo=["disabled","title","onClick"],Bo={class:"stint-icon-slot"},No={class:"stint-number"},$o={class:"stint-laps"},zo={class:"detail"},Fo={key:0,class:"empty-state-panel"},Uo={key:1,class:"limited-data"},Go={key:2,class:"compare-layout compare-style--A"},Qo={class:"compare-conditions"},Ho={class:"compare-condition-card compare-condition-card--a"},Vo={class:"cond-stint-label"},Yo={class:"cond-details"},Wo={class:"cond-item"},Zo={class:"cond-item"},Xo={class:"compare-condition-card compare-condition-card--b"},qo={class:"cond-stint-label"},jo={class:"cond-details"},Ko={class:"cond-item"},Jo={class:"cond-item"},el={class:"compare-table-wrap"},tl={class:"ssc-table"},sl={key:0,class:"ssc-stint-separator"},nl={class:"ssc-table-row"},al={class:"ssc-td ssc-td--value"},il={class:"ssc-td ssc-td--value"},ol={class:"ssc-td"},ll={key:1,class:"ssc-delta ssc-delta--empty"},rl={class:"ssc-table-row"},ul={class:"ssc-td"},cl={key:1,class:"ssc-delta ssc-delta--empty"},dl={class:"ssc-table-row ssc-table-row--compact"},vl={class:"ssc-td ssc-td--compact"},pl={class:"ssc-td ssc-td--compact"},fl={class:"ssc-table-row ssc-table-row--total"},ml={class:"ssc-td ssc-td--value ssc-td--duration"},hl={class:"ssc-td ssc-td--value ssc-td--duration"},gl={class:"ssc-header"},bl={class:"ssc-header-left"},_l={class:"ssc-stint-label"},yl={class:"ssc-condition-text"},Sl={class:"ssc-cond-val"},Tl={class:"ssc-condition-text"},Cl={class:"ssc-cond-val"},kl={class:"ssc-header-right"},El={class:"ssc-duration-label"},Al={class:"ssc-table"},Ml={class:"ssc-table-row"},xl={class:"ssc-td ssc-td--value"},Ll={class:"ssc-td ssc-td--value ssc-td--theo"},Il={class:"ssc-td"},Rl={class:"ssc-table-row"},Pl={class:"ssc-td ssc-td--value"},Ol={class:"ssc-td ssc-td--value ssc-td--theo"},Dl={class:"ssc-td"},wl={key:1,class:"ssc-delta ssc-delta--na"},Bl={key:0,class:"ssc-target-section"},Nl={class:"ssc-target-row-bottom"},$l={class:"ssc-target-value"},zl={class:"ssc-progress-section"},Fl={key:0,class:"ssc-progress-row"},Ul={class:"ssc-progress-label"},Gl={class:"ssc-progress-count"},Ql={class:"ssc-progress-bar"},Hl={key:1,class:"ssc-progress-row"},Vl={class:"ssc-progress-label"},Yl={class:"ssc-progress-count"},Wl={class:"ssc-progress-bar"},Zl={class:"chart-section"},Xl={class:"chart-header-row"},ql={class:"chart-title"},jl={class:"chart-toolbar"},Kl={key:0,class:"lap-manager"},Jl={class:"lap-manager-section"},er={class:"lap-manager-header"},tr={class:"lap-manager-title"},sr=["disabled"],nr={class:"lap-manager-stint-header"},ar={class:"lap-manager-grid"},ir=["onClick","title"],or={key:1,class:"lap-manager-grid"},lr=["onClick","title"],rr={key:2,class:"lap-manager-info"},ur={key:0,class:"lap-manager-section lap-manager-section--b"},cr={class:"lap-manager-header"},dr={class:"lap-manager-title"},vr=["disabled"],pr={class:"lap-manager-stint-header lap-manager-stint-header--b"},fr={class:"lap-manager-grid"},mr=["onClick","title"],hr={key:1,class:"lap-manager-grid"},gr=["onClick","title"],br={key:2,class:"lap-manager-info"},_r={key:1,class:"lap-manager-section lap-manager-section--b"},yr={class:"lap-manager-header"},Sr={class:"lap-manager-title"},Tr=["disabled"],Cr={class:"lap-manager-grid"},kr=["onClick","title"],Er={key:0,class:"lap-manager-info"},Ar={class:"chart-wrap"},Mr={key:1,class:"grip-legend"},xr={class:"grip-legend-label"},Lr={class:"grip-legend-laps"},Ir={class:"laps-section"},Rr={class:"laps-header-row"},Pr={key:0,class:"laps-tabs"},Or=["onClick"],Dr=["onClick"],wr={key:1,class:"laps-title"},Br={key:0,class:"laps-table-wrap"},Nr={class:"laps-table laps-table--compare"},$r={key:0,class:"stint-header-row"},zr={colspan:"4",class:"stint-header-cell stint-header-cell--a"},Fr={key:0,class:"stint-header-label"},Ur={colspan:"4",class:"stint-header-cell stint-header-cell--b"},Gr={key:0,class:"stint-header-label"},Qr={class:"col-index"},Hr={class:"col-a time"},Vr={class:"col-a sector"},Yr={class:"col-a sector"},Wr={class:"col-a sector"},Zr={class:"col-b time"},Xr={class:"col-b sector"},qr={class:"col-b sector"},jr={class:"col-b sector"},Kr={key:1,class:"laps-table-wrap"},Jr={class:"laps-table"},eu={class:"time"},tu={class:"stato"},su={key:0,class:"badge badge--pit"},nu={key:1,class:"badge badge--invalid"},au={key:2,class:"badge badge--valid"},Hs=.6,iu=An({__name:"SessionDetailPage",props:{sessionId:{},externalUserId:{}},emits:["back","go-to-track"],setup(e,{emit:l}){la.register(ra,ua,ca,da,va,pa,fa,ma,wi);const{currentUser:r,getUserProfile:v}=Mn(),d=B(""),m=e,y=l;k(()=>!!m.externalUserId),B(!1);const T=B(new Set),E=B(new Set),L=B(new Set),D=B(!1),G=B(null);B(1);const Z=B("gold");B("A");function q(n){const t=new Set(T.value);t.has(n)?t.delete(n):t.add(n),T.value=t}function Ge(n){const t=new Set(E.value);t.has(n)?t.delete(n):t.add(n),E.value=t}function Se(n){const t=new Set(L.value);t.has(n)?t.delete(n):t.add(n),L.value=t}function rt(){T.value=new Set}function oe(){E.value=new Set}function I(){L.value=new Set}function j(){G.value?.chart&&G.value.chart.resetZoom()}function Ve(){G.value?.chart&&G.value.chart.zoom(1.2)}function ut(){G.value?.chart&&G.value.chart.zoom(.8)}const{fetchSessionFull:Ye,loadSessions:Rt,getTheoreticalTimes:vs,generateShareLink:je}=Vs(),Ke=B(null),We=B(!0),Ze=B(null),Pt=B(!1),Je=B(!1),ct=B(!1);let Vt=null;async function ps(){if(!(!m.sessionId||Pt.value)){Pt.value=!0,Je.value=!1;try{const n=await je(m.sessionId);await navigator.clipboard.writeText(n),Je.value=!0,console.log("[SHARE] Link copied:",n),setTimeout(()=>{Je.value=!1},2e3)}catch(n){console.error("[SHARE] Error sharing session:",n)}finally{Pt.value=!1}}}const Yt=ga();ta(async()=>{We.value=!0,Ze.value=null;try{if(r.value?.uid){const c=await v(r.value.uid);d.value=c?.nickname||r.value.displayName||"Tu"}const n=m.externalUserId||Yt.value||void 0;m.externalUserId||await Rt(n);const t=await Ye(m.sessionId,n,!!Yt.value&&!m.externalUserId);t?(Ke.value=t,console.log("[SESSION_DETAIL] Loaded session:",t.session_info.track,t.stints.length,"stints",m.externalUserId?"(SHARED)":"")):Ze.value="Sessione non trovata"}catch(n){console.error("[SESSION_DETAIL] Load error:",n),Ze.value=n.code==="permission-denied"?"Sessione non condivisa o accesso negato":n.message||"Errore caricamento"}finally{We.value=!1}});const fs=B(!1),Wt=B([]),we=B("COMPARE"),le=k(()=>fs.value&&Wt.value.length===2),Xe=k(()=>Wt.value[0]??Ie.value),$e=k(()=>Wt.value[1]??null),Ot=B(!1),Zt=B(null),Q=B(null),Le=k(()=>Zt.value!==null),re=B(null),Te=B(null),Dt=k(()=>re.value!==null);function dt(){Ot.value=!0}function vt(n){const c=(Gt.value||kt.value)?.number||O.value.stints[0]?.number;if(!c){console.warn("[AUTO-SELECT] No S1 stints available");return}const p=n.stints||[];let o=null,h=null;if(p.forEach(x=>{const P=(x.laps||[]).filter(se=>se.is_valid&&!se.has_pit_stop);if(P.length===0)return;const Pe=Math.min(...P.map(se=>se.lap_time_ms)),X=x.type!=="Qualify",te=o!==null&&p.find(se=>se.stint_number===o)?.type!=="Qualify";(h===null||X&&!te||X===te&&Pe<h)&&(h=Pe,o=x.stint_number)}),o===null&&p.length>0&&(o=p[0]?.stint_number??null),!o){console.warn("[AUTO-SELECT] No S2 stints available");return}M.value=c,J.value="a",R.value=o,de.value="b",console.log(`[AUTO-SELECT] S1 best: #${c}, S2 best: #${o}`),Vt&&clearTimeout(Vt),ct.value=!0,Vt=setTimeout(()=>{ct.value=!1},5e3)}async function pt(n,t,c){Zt.value=n,re.value=t||null,Te.value=c||null,Ot.value=!1;const{fetchSessionFull:p}=Vs(),o=await p(n,t);o&&(Q.value=o,console.log("[CROSS-SESSION] Loaded session B:",n,t?`(external: ${c})`:"(own)",o.session_info.track),await ia(),vt(o))}function ft(){Zt.value=null,Q.value=null,re.value=null,Te.value=null,M.value=null,R.value=null,F.value=null,z.value=null,J.value="a",de.value="b",he.value="a",ae.value="b"}const M=B(null),R=B(null),J=B("a"),de=B("b"),he=B("a"),ae=B("b"),Ps=k(()=>Q.value?(Q.value.stints||[]).map(t=>({number:t.stint_number,type:t.type==="Qualify"?"Q":t.type==="Race"?"R":"P",laps:t.laps?.length||0,best:t.laps?.reduce((c,p)=>!p.is_valid||p.has_pit_stop?c:c===null?p.lap_time_ms:Math.min(c,p.lap_time_ms),null),avgCleanLap:t.avg_clean_lap})):[]),ue=k(()=>Le.value&&M.value!==null&&R.value!==null),F=B(null),z=B(null),wt=k(()=>F.value!==null||z.value!==null);function et(n){return n==="a"||!Q.value?O.value.stints:(Q.value.stints||[]).map(t=>({number:t.stint_number,type:t.type==="Qualify"?"Q":t.type==="Race"?"R":"P",laps:t.laps?.length||0,best:Y(t.laps?.reduce((c,p)=>!p.is_valid||p.has_pit_stop?c:c===null?p.lap_time_ms:Math.min(c,p.lap_time_ms),null)),bestMs:t.laps?.reduce((c,p)=>!p.is_valid||p.has_pit_stop?c:c===null?p.lap_time_ms:Math.min(c,p.lap_time_ms),null),avg:Y(t.avg_clean_lap),avgMs:t.avg_clean_lap,avgWarning:(t.laps?.filter(c=>c.is_valid&&!c.has_pit_stop).length||0)<5,validLapsCount:t.laps?.filter(c=>c.is_valid&&!c.has_pit_stop).length||0,durationMs:t.laps?.reduce((c,p)=>c+(p.lap_time_ms||0),0)||0}))}function Xt(n,t){if(n==="a")return O.value.lapsData[t]||[];if(!Q.value)return[];const c=(Q.value.stints||[]).find(p=>p.stint_number===t);return c?.laps?c.laps.map((p,o)=>({number:o+1,time:Y(p.lap_time_ms),timeMs:p.lap_time_ms,valid:p.is_valid,pit:p.has_pit_stop,grip:p.grip_level||"Opt",temp:p.air_temp||0})):[]}k(()=>{if(!M.value||F.value!==null)return!1;const n=M.value+1;return et(J.value).some(c=>c.number===n)}),k(()=>{if(!R.value||z.value!==null)return!1;const n=R.value+1;return et(de.value).some(c=>c.number===n)});function ms(){F.value=null}function hs(){z.value=null}B(null),B(null);const mt=k(()=>M.value!==null||R.value!==null),ht=k(()=>M.value!==null&&R.value!==null),K=k(()=>ht.value&&!Le.value),Bt=k(()=>mt.value&&!ht.value&&!Le.value),Os=k(()=>{if(!Bt.value)return null;const n=M.value??R.value;return n&&O.value.stints.find(t=>t.number===n)||null}),gs=k(()=>M.value??R.value??null),Ds=k(()=>{const n=gs.value;return n?O.value.lapsData[n]||[]:[]});k(()=>M.value&&O.value.stints.find(n=>n.number===M.value)||null),k(()=>R.value&&O.value.stints.find(n=>n.number===R.value)||null),k(()=>M.value?O.value.lapsData[M.value]||[]:[]),k(()=>R.value?O.value.lapsData[R.value]||[]:[]);const ee=k(()=>{const n=[];if(M.value){const c=et(J.value).find(p=>p.number===M.value);c&&n.push(c)}if(F.value){const c=et(he.value).find(p=>p.number===F.value);c&&n.push(c)}return n}),ce=k(()=>{const n=[];if(R.value){const c=et(de.value).find(p=>p.number===R.value);c&&n.push(c)}if(z.value){const c=et(ae.value).find(p=>p.number===z.value);c&&n.push(c)}return n}),qt=k(()=>Math.max(ee.value.length,ce.value.length)),bs=k(()=>ee.value.reduce((n,t)=>n+(t.durationMs||0),0)),_s=k(()=>ce.value.reduce((n,t)=>n+(t.durationMs||0),0)),Nt=k(()=>{const n=[],t=[J.value,he.value];return ee.value.forEach((c,p)=>{const o=t[p]||"a";Xt(o,c.number).forEach((x,P)=>{n.push({...x,_stintIndex:p,_stintNumber:c.number,_isStintStart:P===0,_globalIndex:n.length+1})})}),n}),jt=k(()=>{const n=[],t=[de.value,ae.value];return ce.value.forEach((c,p)=>{const o=t[p]||"b";Xt(o,c.number).forEach((x,P)=>{n.push({...x,_stintIndex:p,_stintNumber:c.number,_isStintStart:P===0,_globalIndex:n.length+1})})}),n});function $t(n){if(!n)return"â€”";const t=n,c=Math.floor(t/6e4),p=Math.floor(t%6e4/1e3),o=t%1e3;return`${c}m ${String(p).padStart(2,"0")}.${String(o).padStart(3,"0")}s`}function Kt(){M.value=null,F.value=null,R.value=null,z.value=null,J.value="a",de.value="b",he.value="a",ae.value="b"}function Jt(n){return R.value===n&&de.value==="a"||z.value===n&&ae.value==="a"?!1:M.value?M.value===n||F.value===n||J.value!=="a"||F.value?!1:n===M.value+1:!0}function ys(n){return M.value===n&&J.value==="a"||F.value===n&&he.value==="a"?!1:R.value?R.value===n||z.value===n||de.value!=="a"||z.value?!1:n===R.value+1:!0}function Ss(n){return R.value===n&&de.value==="a"||z.value===n&&ae.value==="a"?"GiÃ  in Strategia B":M.value?M.value===n||F.value===n?"GiÃ  in Strategia A":J.value!=="a"?"Solo stint dalla stessa sessione":!F.value&&n===M.value+1?"Aggiungi come secondo stint":F.value?"Massimo 2 stint per strategia":"Solo stint consecutivo ammesso":"Aggiungi a Strategia A"}function Ts(n){return M.value===n&&J.value==="a"||F.value===n&&he.value==="a"?"GiÃ  in Strategia A":R.value?R.value===n||z.value===n?"GiÃ  in Strategia B":de.value!=="a"?"Solo stint dalla stessa sessione":!z.value&&n===R.value+1?"Aggiungi come secondo stint":z.value?"Massimo 2 stint per strategia":"Solo stint consecutivo ammesso":"Aggiungi a Strategia B"}function gt(n,t="a"){if(!M.value){M.value=n,J.value=t;return}!F.value&&n===M.value+1&&t===J.value&&(F.value=n,he.value=t)}function Cs(n,t="a"){if(!R.value){R.value=n,de.value=t;return}!z.value&&n===R.value+1&&t===de.value&&(z.value=n,ae.value=t)}function ws(n){return M.value?M.value===n&&J.value==="b"||F.value===n&&he.value==="b"||J.value!=="b"?!1:!F.value&&n===M.value+1:!0}function ks(n){return M.value?M.value===n&&J.value==="b"||F.value===n&&he.value==="b"?"GiÃ  in Strategia A":J.value!=="b"?"Solo stint dalla stessa sessione":!F.value&&n===M.value+1?"Aggiungi come secondo stint":F.value?"Massimo 2 stint per strategia":"Solo stint consecutivi dalla stessa sessione":"Aggiungi a Strategia A (da S2)"}function es(n){return M.value===n&&J.value==="b"||F.value===n&&he.value==="b"?!1:R.value?R.value===n||z.value===n||de.value!=="b"||z.value?!1:n===R.value+1:!0}function Bs(n){return M.value===n&&J.value==="b"||F.value===n&&he.value==="b"?"GiÃ  in Strategia A":R.value?R.value===n||z.value===n?"GiÃ  in Strategia B":de.value!=="b"?"Solo stint dalla stessa sessione":!z.value&&n===R.value+1?"Aggiungi come secondo stint":z.value?"Massimo 2 stint per strategia":"Solo stint consecutivo ammesso":"Aggiungi a Strategia B"}function Es(n){if(!R.value){R.value=n,de.value="b";return}!z.value&&n===R.value+1&&de.value==="b"&&(z.value=n,ae.value="b")}function Ns(n){if(!M.value){M.value=n,J.value="b";return}!F.value&&n===M.value+1&&J.value==="b"&&(F.value=n,he.value="b")}function As(){M.value=null,F.value=null,J.value="a",he.value="a"}function Ms(){R.value=null,z.value=null,de.value="b",ae.value="b"}function zt(n,t="a"){return M.value===n&&J.value===t||F.value===n&&he.value===t}function Ft(n,t="a"){return R.value===n&&de.value===t||z.value===n&&ae.value===t}function ts(n){Ie.value=n}function at(n){}function bt(n){Ie.value=n}const O=k(()=>{if(!Ke.value)return{id:m.sessionId,track:"Caricamento...",trackId:"",type:"practice",date:"-",time:"-",car:"-",startConditions:{weather:"-",airTemp:0,trackTemp:0},bestQualy:"--:--.---",bestRace:"--:--.---",theoQualy:"--:--.---",theoRace:"--:--.---",bestDeltaQ:{value:"-",stintNum:0},bestDeltaR:{value:"-",stintNum:0},stints:[],lapsData:{}};const n=Ke.value,t=n.session_info,c=t.session_best_lap&&t.session_best_lap>0&&t.session_best_lap<=sa?t.session_best_lap:0,p=n.stints.map(X=>{const te=X.laps.filter(ve=>ve.is_valid&&!ve.has_pit_stop),se=te.length,Oe=se>0?Math.min(...te.map(ve=>ve.lap_time_ms)):null,xt=5,De=se>=xt&&X.avg_clean_lap?X.avg_clean_lap:null,Qt=se>0&&se<xt,nt=De?Y(De):Qt?"min 5 giri":"â€”";return{number:X.stint_number,type:X.type==="Qualify"?"Q":"R",intent:X.type==="Qualify"?"Qualy Push":"Race Pace",fuelStart:X.fuel_start,laps:X.laps.length,validLapsCount:se,best:Oe?Y(Oe):"â€”",bestMs:Oe,avg:nt,avgWarning:Qt,avgMs:De,durationMs:X.stint_drive_time_ms||0,theoretical:Y(c),deltaVsTheo:Oe&&c?`+${((Oe-c)/1e3).toFixed(3)}`:"-",conditions:{weather:t.start_weather,avgAirTemp:t.start_air_temp,avgTrackTemp:t.start_road_temp},breakdown:{base:"-",deltaTemp:"-",deltaGrip:"-"}}}),o={};n.stints.forEach(X=>{o[X.stint_number]=X.laps.map(te=>({lap:te.lap_number,time:Y(te.lap_time_ms),lap_time_ms:te.lap_time_ms,delta:c?`+${((te.lap_time_ms-c)/1e3).toFixed(3)}`:"-",valid:te.is_valid,pit:te.has_pit_stop,sectors:te.sector_times_ms?.map(se=>(se/1e3).toFixed(3))||["-","-","-"],sector_times_ms:te.sector_times_ms||[],fuel:Math.round(te.fuel_remaining),airTemp:te.air_temp||0,weather:te.rain_intensity||"No Rain",grip:te.track_grip_status||"Opt"}))});let h=null,x=null,P=0,Pe=0;return n.stints.forEach(X=>{const te=X.laps.filter(Oe=>Oe.is_valid&&!Oe.has_pit_stop);if(te.length===0)return;const se=Math.min(...te.map(Oe=>Oe.lap_time_ms));X.type==="Qualify"?(!h||se<h)&&(h=se,P=X.stint_number):(!x||se<x)&&(x=se,Pe=X.stint_number)}),{id:m.sessionId,track:t.track,trackId:t.track.toLowerCase().replace(/[^a-z0-9]/g,"_"),type:Ln(t.session_type),date:na(t.date_start),time:In(t.date_start),car:xn(t.car),startConditions:{weather:t.start_weather,airTemp:t.start_air_temp,trackTemp:t.start_road_temp},bestQualy:h?Y(h):"--:--.---",bestRace:x?Y(x):"--:--.---",theoQualy:Y(c),theoRace:Y(c),bestDeltaQ:{value:h&&c?`+${((h-c)/1e3).toFixed(3)}`:"-",stintNum:P},bestDeltaR:{value:x&&c?`+${((x-c)/1e3).toFixed(3)}`:"-",stintNum:Pe},stints:p,lapsData:o}}),ge=B({theoQualy:null,theoRace:null,theoAvgRace:null,dominantGrip:"Optimum",stintTemp:23,historicQualy:null,historicQualyTemp:null,historicRace:null,historicRaceTemp:null,historicAvgRace:null,historicAvgRaceTemp:null}),Ie=B(1),ss=B(!1),ie=k(()=>O.value.stints.find(n=>n.number===Ie.value)),Ce=k(()=>O.value.lapsData[Ie.value]||[]),Re=k(()=>Bt.value?Os.value:ie.value),it=k(()=>Bt.value?gs.value:Ie.value),qe=k(()=>Bt.value?Ds.value:Ce.value);k(()=>qe.value.length<=1),k(()=>O.value.stints.length===1),Fs(Ce,n=>{if(n.length>0){const t=n[0]?.lap;T.value=new Set(t!=null?[t]:[])}else T.value=new Set},{immediate:!0});const ze=k(()=>Xe.value?O.value.stints.find(n=>n.number===Xe.value):null),_t=k(()=>$e.value?O.value.stints.find(n=>n.number===$e.value):null),Ee=k(()=>Xe.value?O.value.lapsData[Xe.value]||[]:[]),ke=k(()=>$e.value?O.value.lapsData[$e.value]||[]:[]),yt=k(()=>{if(!M.value)return null;const n=O.value.stints.find(t=>t.number===M.value);return n?{...n,avgCleanLap:n.avg}:null}),ns=k(()=>{if(!R.value||!Q.value)return null;const t=(Q.value.stints||[]).find(c=>c.stint_number===R.value);return t?{number:t.stint_number,type:t.type==="Qualify"?"Q":t.type==="Race"?"R":"P",laps:t.laps?.length||0,best:Y(t.laps?.reduce((c,p)=>!p.is_valid||p.has_pit_stop?c:c===null?p.lap_time_ms:Math.min(c,p.lap_time_ms),null)),avgCleanLap:Y(t.avg_clean_lap),deltaVsTheo:"â€”"}:null}),Fe=k(()=>M.value?O.value.lapsData[M.value]||[]:[]),be=k(()=>{if(!R.value||!Q.value)return[];const t=(Q.value.stints||[]).find(c=>c.stint_number===R.value);return!t||!t.laps?[]:t.laps.map((c,p)=>({lapNumber:c.lap_number||p+1,lapTime:Y(c.lap_time_ms),lapTimeMs:c.lap_time_ms,valid:c.is_valid&&!c.has_pit_stop,pit:c.has_pit_stop,s1:Y(c.sector_times_ms?.[0]),s2:Y(c.sector_times_ms?.[1]),s3:Y(c.sector_times_ms?.[2]),fuel:c.fuel_remaining,air:c.air_temp,road:c.road_temp,grip:c.track_grip_status}))});k(()=>we.value==="A"?Ee.value:ke.value),k(()=>we.value==="A"?ze.value:_t.value),k(()=>we.value==="A"?Fe.value:be.value),k(()=>we.value==="A"?yt.value:ns.value);function St(){const n=we.value;if(n.startsWith("A-")){const t=parseInt(n.slice(2));if(!isNaN(t))return O.value.lapsData[t]||[]}else if(n.startsWith("B-")){const t=parseInt(n.slice(2));if(!isNaN(t)){if(K.value)return O.value.lapsData[t]||[];if(ue.value&&Q.value){const p=(Q.value.stints||[]).find(o=>o.stint_number===t);if(p?.laps)return p.laps.map((o,h)=>({lapNumber:o.lap_number||h+1,lapTime:Y(o.lap_time_ms),lapTimeMs:o.lap_time_ms,valid:o.is_valid&&!o.has_pit_stop,pit:o.has_pit_stop,s1:Y(o.sector_times_ms?.[0]),s2:Y(o.sector_times_ms?.[1]),s3:Y(o.sector_times_ms?.[2]),fuel:o.fuel_remaining,air:o.air_temp,road:o.road_temp,grip:o.track_grip_status}))}return O.value.lapsData[t]||[]}}return Ce.value}const tt=k(()=>{const n=St();let t=1/0,c=1/0,p=1/0,o=1/0;for(const h of n){if(!h.valid||h.pit)continue;const x=h.sector_times_ms||[];x[0]&&x[0]>0&&x[0]<t&&(t=x[0]),x[1]&&x[1]>0&&x[1]<c&&(c=x[1]),x[2]&&x[2]>0&&x[2]<p&&(p=x[2]);const P=h.lap_time_ms||h.lapTimeMs;P&&P>0&&P<o&&(o=P)}return{s1:t===1/0?null:t,s2:c===1/0?null:c,s3:p===1/0?null:p,lapMs:o===1/0?null:o}});function Tt(n,t){const p=(n.sector_times_ms||[])[t];if(!p||p<=0)return!1;const o=[tt.value.s1,tt.value.s2,tt.value.s3][t];return o!==null&&p===o}function as(n){const t=n.lap_time_ms||n.lapTimeMs;return tt.value.lapMs!==null&&t===tt.value.lapMs}const is=k(()=>{let n=[],t=[];K.value?(n=Nt.value||[],t=jt.value||[]):ue.value?(n=Fe.value||[],t=be.value||[]):le.value&&(n=Ee.value||[],t=ke.value||[]);const c=Math.max(n.length,t.length),p=[];for(let o=0;o<c;o++){const h=n[o]||null,x=t[o]||null;let P=null;if(h&&x){const Pe=Be(h.time||h.lapTime||""),X=Be(x.time||x.lapTime||"");Pe>0&&X>0&&(P=Pe-X)}p.push({index:o+1,lapA:h,lapB:x,delta:P,deltaFormatted:P!==null?P>=0?`+${P.toFixed(3)}`:P.toFixed(3):"â€”",deltaClass:P!==null?P<0?"faster":P<=.3?"close":P<=.5?"margin":"far":"neutral",_isStintStartA:h?._isStintStart||!1,_isStintStartB:x?._isStintStart||!1,_stintNumberA:h?._stintNumber||null,_stintNumberB:x?._stintNumber||null})}return p}),Ct=k(()=>{if(!F.value)return null;const n=O.value.stints.find(t=>t.number===F.value);return n?{...n,avgCleanLap:n.avg}:null}),Qe=k(()=>F.value?O.value.lapsData[F.value]||[]:[]),$s=k(()=>{if(!z.value||!Q.value)return null;const t=(Q.value.stints||[]).find(c=>c.stint_number===z.value);return t?{number:t.stint_number,type:t.type==="Qualify"?"Q":t.type==="Race"?"R":"P",laps:t.laps?.length||0,best:Y(t.laps?.reduce((c,p)=>!p.is_valid||p.has_pit_stop?c:c===null?p.lap_time_ms:Math.min(c,p.lap_time_ms),null)),avgCleanLap:Y(t.avg_clean_lap),durationMs:t.laps?.reduce((c,p)=>c+(p.lap_time_ms||0),0)||0}:null}),Ut=k(()=>{if(!z.value||!Q.value)return[];const t=(Q.value.stints||[]).find(c=>c.stint_number===z.value);return!t||!t.laps?[]:t.laps.map((c,p)=>({lapNumber:c.lap_number||p+1,lapTime:Y(c.lap_time_ms),lapTimeMs:c.lap_time_ms,valid:c.is_valid&&!c.has_pit_stop,pit:c.has_pit_stop,s1:Y(c.sector_times_ms?.[0]),s2:Y(c.sector_times_ms?.[1]),s3:Y(c.sector_times_ms?.[2]),fuel:c.fuel_remaining,air:c.air_temp,grip:c.track_grip_status}))});k(()=>{let n=0;if(yt.value){const t=f(yt.value)||S(Fe.value);n+=t}if(Ct.value){const t=f(Ct.value)||S(Qe.value);n+=t}return n}),k(()=>{let n=0;return ns.value&&(n+=S(be.value)),$s.value&&(n+=S(Ut.value)),n});const kt=k(()=>{const n=O.value.stints.filter(c=>c.type==="Q"&&c.laps>=2);if(n.length===0)return null;let t=n[0];return n.forEach(c=>{parseFloat(c.deltaVsTheo)<parseFloat(t.deltaVsTheo)&&(t=c)}),t}),Gt=k(()=>{const n=O.value.stints.filter(c=>c.type==="R"&&c.laps>=2);if(n.length===0)return null;let t=n[0];return n.forEach(c=>{parseFloat(c.deltaVsTheo)<parseFloat(t.deltaVsTheo)&&(t=c)}),t});Fs([Gt,kt],([n,t])=>{ss.value||(n?(Ie.value=n.number,ss.value=!0,console.log("[PRESELECTION] Best R stint:",n.number,"delta:",n.deltaVsTheo)):t&&(Ie.value=t.number,ss.value=!0,console.log("[PRESELECTION] Best Q stint:",t.number,"delta:",t.deltaVsTheo)))});function Et(n){return n.type==="Q"?kt.value?.number===n.number:n.type==="R"?Gt.value?.number===n.number:!1}function He(n){const c=(O.value.lapsData[n.number]||[]).filter(o=>!o.pit),p=c.filter(o=>o.valid);return c.length>0&&p.length===0?{icon:"âš ï¸",message:"Tutti i giri invalidi"}:n.type==="R"&&c.length<5?{icon:"âš ï¸",message:`Stint gara troppo corto (${c.length} giri, min. 5)`}:n.type==="Q"&&c.length<=1?{icon:"âš ï¸",message:"Dati limitati (1 giro)"}:null}function s(n){if(n<=30){const t=n/30,c=239,p=Math.round(68+47*t),o=Math.round(68+-46*t);return`rgb(${c}, ${p}, ${o})`}else if(n<=70){const t=(n-30)/40,c=Math.round(249+2*t),p=Math.round(115+76*t),o=Math.round(22+14*t);return`rgb(${c}, ${p}, ${o})`}else{const t=(n-70)/30,c=Math.round(251+-235*t),p=Math.round(191+-6*t),o=Math.round(36+93*t);return`rgb(${c}, ${p}, ${o})`}}function i(n){const t=n.filter(p=>!p.pit&&(p.airTemp||p.air));if(t.length===0)return 0;const c=t.reduce((p,o)=>p+(o.airTemp||o.air||0),0);return Math.round(c/t.length)}function u(n){const t=n.filter(h=>!h.pit&&h.grip&&h.grip!=="Unknown");if(t.length===0)return"Optimum";const c={};for(const h of t){let x=h.grip==="Opt"?"Optimum":h.grip;c[x]=(c[x]||0)+1}let p="Optimum",o=0;for(const[h,x]of Object.entries(c))x>o&&(o=x,p=h);return p}function f(n){return n?.durationMs?Math.floor(n.durationMs/6e4):0}function S(n){if(!n||n.length===0)return 0;const t=n.reduce((c,p)=>c+(p.lapTimeMs||0),0);return Math.round(t/6e4)}function C(n){if(!n)return"â€”";if(typeof n=="string"){const t=n,c=t.split(".");if(c.length===2&&c[1]){const p=c[1].padEnd(3,"0").slice(0,3);return`${c[0]}.${p}`}return t}return typeof n=="number"?(n>1e3?n/1e3:n).toFixed(3):"â€”"}function N(n,t){if(!n||!t)return"â€”";const p=(n-t)/1e3;return p===0?"0.000":`${p>0?"+":""}${p.toFixed(3)}`}function _e(n,t){if(!n||!t)return"far";const p=(n-t)/1e3;return p<0?"faster":p===0?"ontarget":p<=.3?"close":p<=.5?"margin":"far"}const fe=k(()=>{const n=Ce.value.filter(ve=>!ve.pit);if(n.length===0)return{airTemp:{start:0,mid:0,end:0,changed:!1},grip:{dominant:"Optimum",percentages:[],changed:!1,display:"Optimum"}};const t=Math.floor(n.length/2),c=n.length-1,p=Math.round(n[0]?.airTemp||0),o=Math.round(n[t]?.airTemp||p),h=Math.round(n[c]?.airTemp||p),x=Math.abs(p-h)>=2||Math.abs(p-o)>=2,P={},Pe=[];let X=0;const te=ve=>ve==="Opt"?"Optimum":ve;for(const ve of n){let ye=ve.grip||"Unknown";ye=te(ye),ye!=="Unknown"&&(P[ye]||Pe.push(ye),P[ye]=(P[ye]||0)+1,X++)}const se=[];let Oe="Optimum",xt=0;for(const ve of Pe){const ye=P[ve]||0;if(ye===0)continue;const A=Math.round(ye/X*100);se.push({grip:ve,pct:A}),ye>xt&&(xt=ye,Oe=ve)}const De=se.length>1;let Qt=Oe;De&&(Qt=se.map(ve=>`${ve.grip} (${ve.pct}%)`).join(" â†’ "));const nt=x?Math.round((p+o+h)/3):p;return{airTemp:{start:p,mid:o,end:h,changed:x,avg:nt},grip:{dominant:Oe,percentages:se,changed:De,display:Qt}}});Fs([()=>Ke.value,()=>fe.value],async([n,t])=>{if(!n)return;const c=n.session_info,p=(c.track||"").toLowerCase().replace(/[^a-z0-9]/g,"_"),o=t.grip.dominant||"Optimum",h=t.airTemp.avg||Math.round(c.start_air_temp||23),x=aa(c.car||""),P=await vs(p,o,h,x,Yt.value||void 0);ge.value={theoQualy:P.theoQualy,theoRace:P.theoRace,theoAvgRace:P.theoAvgRace,dominantGrip:o,stintTemp:h,historicQualy:P.historicQualy,historicQualyTemp:P.historicQualyTemp,historicRace:P.historicRace,historicRaceTemp:P.historicRaceTemp,historicAvgRace:P.historicAvgRace,historicAvgRaceTemp:P.historicAvgRaceTemp}},{immediate:!0});const Ae=k(()=>{let n=[];if(K.value)n=Nt.value.map((A,$)=>({...A,lap:$+1}));else if(ue.value){if(n=Fe.value,wt.value&&F.value){const A=Qe.value,$=n.length,ne=A.map((V,Me)=>({...V,lap:$+Me+1,_originalLap:V.lap,_isSecondStint:!0}));n=[...n,...ne]}}else le.value?n=Ee.value:n=Ce.value;const t=n.filter(A=>!T.value.has(A.lap)),c=ue.value?yt.value:le.value?ze.value:ie.value,p=c?.type==="Q",o=p?ge.value.theoQualy:ge.value.theoRace,h=o?o/1e3:0,x=h>0?h+Hs:0,P=c?.best;Be(P);const Pe=A=>A.pit?!1:Be(A.time)<=x,X=A=>A.pit||!A.valid?!1:Pe(A),te=A=>A.pit||!A.valid?!1:A.time===P,se=t.map(A=>A.pit?"#6b7280":A.valid?Mt.value&&te(A)?"#a855f7":Mt.value&&X(A)?"#10b981":"#3b82f6":"#ef4444"),Oe=t.map(A=>A.pit?"#6b7280":A.valid?Mt.value&&te(A)?"#a855f7":Mt.value&&X(A)?"#10b981":"#3b82f6":Mt.value&&Pe(A)?"#10b981":"#ef4444"),xt=t.map(A=>!A.valid&&!A.pit&&Mt.value&&Pe(A)?2:1),De=[{label:K.value?`Strategia A (${ee.value.map(A=>`#${A.number}`).join("+")})`:le.value?`A: Stint #${Xe.value}`:"Tempo",data:t.map(A=>Be(A.time)),borderColor:"#3b82f6",backgroundColor:"rgba(59,130,246,0.1)",pointBackgroundColor:se,pointBorderColor:Oe,pointBorderWidth:xt,pointRadius:5,tension:0,order:1,segment:K.value?{borderColor:A=>t[A.p1DataIndex]?._stintIndex>0?"#60a5fa":"#3b82f6"}:void 0},{label:`Teorico ${c?.type==="Q"?"Q":"R"}`,data:t.map(()=>h),borderColor:"#f59e0b",borderDash:[5,5],pointRadius:0,order:3}];if(!p&&Mt.value&&t.length>0&&De.push({label:`Target (+${Hs}s)`,data:t.map(()=>x),borderColor:"rgba(16, 185, 129, 0.6)",borderWidth:2,borderDash:[3,3],backgroundColor:"rgba(16, 185, 129, 0.05)",fill:"origin",pointRadius:0,order:4}),an.value&&on.value&&t.length>0){const A=Math.max(...t.map($=>Be($.time)))+5;ln.value.forEach(($,ne)=>{const V=Ls[$.gripLevel]||Ls.Opt,Me=t.map((rn,Xn)=>{const un=Xn+1;return un>=$.startLap&&un<=$.endLap?A:null});De.push({label:`_grip_${ne}`,data:Me,borderColor:"transparent",backgroundColor:V?.bg,fill:"origin",pointRadius:0,order:10+ne,spanGaps:!1})})}let nt=[];if(K.value&&jt.value.length>0){nt=jt.value.map((V,Me)=>({...V,lap:Me+1})).filter(V=>!E.value.has(V.lap));const $=ce.value.map(V=>`#${V.number}`).join("+"),ne=nt.map(V=>V.pit?"#6b7280":V.valid?V._stintIndex>0?"#a78bfa":"#8b5cf6":"#ef4444");De.splice(1,0,{label:`Strategia B (${$})`,data:nt.map(V=>Be(V.time)),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,0.1)",pointBackgroundColor:ne,pointRadius:5,tension:0,segment:{borderColor:V=>nt[V.p1DataIndex]?._stintIndex>0?"#a78bfa":"#8b5cf6"}})}if(le.value&&ke.value.length>0){const $=ke.value.filter(ne=>!E.value.has(ne.lap));De.splice(1,0,{label:`B: Stint #${$e.value}`,data:$.map(ne=>Be(ne.time)),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,0.1)",pointBackgroundColor:$.map(ne=>ne.pit?"#6b7280":ne.valid?"#8b5cf6":"#ef4444"),pointRadius:5,tension:0})}if(ue.value&&be.value.length>0){let A=be.value.map(($,ne)=>({...$,_chartIdx:ne+1}));if(wt.value&&z.value){const $=Ut.value,ne=A.length,V=$.map((Me,rn)=>({...Me,_chartIdx:ne+rn+1,_isSecondStint:!0}));A=[...A,...V]}De.splice(1,0,{label:wt.value?`Strategia B (${z.value?"Stint #"+R.value+"+#"+z.value:"Stint #"+R.value})`:`Strategia B Â· Stint #${R.value}`,data:A.map($=>L.value.has($.lapNumber)?null:Be($.lapTime)),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,0.1)",pointBackgroundColor:A.map($=>L.value.has($.lapNumber)?"transparent":$.pit?"#6b7280":$.valid?"#8b5cf6":"#ef4444"),pointRadius:A.map($=>L.value.has($.lapNumber)?0:5),tension:0,spanGaps:!1})}let ve;if(K.value||ue.value||le.value){let A=t.length;if(K.value)A=Math.max(t.length,nt.length);else if(ue.value){let $=be.value.length;wt.value&&z.value&&($+=Ut.value.length),A=Math.max(t.length,$)}else le.value&&(A=Math.max(t.length,ke.value.length));ve=Array.from({length:A},($,ne)=>`G${ne+1}`)}else ve=t.map(A=>`G${A.lap}`);const ye=ve.length;if((K.value||ue.value||le.value)&&t.length<ye){const A=De.find(V=>V.label?.startsWith("Strategia A")||V.label?.startsWith("A:"));if(A&&Array.isArray(A.data)){const V=A.data.length;for(let Me=V;Me<ye;Me++)A.data.push(null),Array.isArray(A.pointBackgroundColor)&&A.pointBackgroundColor.push("transparent"),Array.isArray(A.pointRadius)&&A.pointRadius.push(0)}const $=De.find(V=>V.label?.startsWith("Teorico"));if($&&Array.isArray($.data)&&$.data.length<ye){const V=$.data[0];for(let Me=$.data.length;Me<ye;Me++)$.data.push(V)}const ne=De.find(V=>V.label?.startsWith("Target"));if(ne&&Array.isArray(ne.data)&&ne.data.length<ye){const V=ne.data[0];for(let Me=ne.data.length;Me<ye;Me++)ne.data.push(V)}}return{labels:ve,datasets:De}}),Ue={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom",labels:{color:"rgba(255,255,255,0.7)",font:{size:11},filter:n=>!n.text.startsWith("_")}},tooltip:{backgroundColor:"rgba(15,15,25,0.95)",callbacks:{title:n=>n.length?`Giro ${n[0].label?.replace("G","")||""}`:"",label:n=>n.dataset.label?.startsWith("_")?"":`${n.dataset.label}: ${zs(n.raw)}`}},zoom:{pan:{enabled:!0,mode:"x",modifierKey:void 0},zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"x",drag:{enabled:!1}},limits:{x:{min:"original",max:"original"}}}},scales:{x:{grid:{color:"rgba(255,255,255,0.08)"},ticks:{color:"rgba(255,255,255,0.6)",font:{size:11}}},y:{grid:{color:"rgba(255,255,255,0.08)"},ticks:{color:"rgba(255,255,255,0.6)",font:{size:11},callback:n=>typeof n=="number"?zs(n):n}}}};function Be(n){if(!n)return 0;const t=n.split(":"),c=Number(t[0])||0,p=Number(t[1])||0;return c*60+p}function zs(n){return`${Math.floor(n/60)}:${(n%60).toFixed(3).padStart(6,"0")}`}function Wn(n){return{practice:"PRACTICE",qualify:"QUALIFY",race:"RACE"}[n]||n.toUpperCase()}function xs(n){if(!n||n==="-")return"far";const t=parseFloat(n);return isNaN(t)?"far":t<0?"faster":t===0?"ontarget":t<=.3?"close":t<=.5?"margin":"far"}function tn(n){if(!n)return"-";const c=n.type==="Q"?ge.value.theoQualy:ge.value.theoRace;if(!c)return"-";const p=Be(n.best);if(p===0)return"-";const o=c/1e3,h=p-o;return h>=0?`+${h.toFixed(3)}`:h.toFixed(3)}const sn=k(()=>{if(!ie.value)return{value:"-",seconds:0,class:"neutral"};const n=Be(ie.value.best);if(n===0)return{value:"-",seconds:0,class:"neutral"};let t=null;if(ie.value.type==="Q"?t=ge.value.theoQualy:t=ge.value.theoRace,!t)return{value:"-",seconds:0,class:"neutral"};const c=t/1e3,p=n-c,o=p>=0?`+${p.toFixed(3)}`:p.toFixed(3);return{value:o,seconds:p,class:xs(o)}}),nn=k(()=>{if(!ie.value)return{value:"-",seconds:0,class:"neutral"};const n=Be(ie.value.avg);if(n===0)return{value:"-",seconds:0,class:"neutral"};if(ie.value.type==="Q")return{value:"-",seconds:0,class:"neutral"};const t=ge.value.theoAvgRace;if(!t)return{value:"-",seconds:0,class:"neutral"};const c=t/1e3,p=n-c,o=p>=0?`+${p.toFixed(3)}`:p.toFixed(3);return{value:o,seconds:p,class:xs(o)}}),st=k(()=>{if(!ie.value||Ce.value.length===0)return{onTarget:0,total:0,pct:0,targetLine:"-"};const t=ie.value.type==="Q"?ge.value.theoQualy:ge.value.theoRace;if(!t)return{onTarget:0,total:0,pct:0,targetLine:"-"};const p=t/1e3+Hs,o=Ce.value.filter(P=>!P.pit),h=o.length;let x=0;return o.forEach(P=>{Be(P.time)<=p&&x++}),{onTarget:x,total:h,pct:h>0?Math.round(x/h*100):0,targetLine:zs(p)}}),At=k(()=>{const n=Ce.value.filter(o=>!o.pit),t=n.length,c=n.filter(o=>o.valid).length,p=t-c;return{valid:c,invalid:p,total:t,pct:t>0?Math.round(c/t*100):100}}),Zn=k(()=>{if(!ie.value)return{hours:0,minutes:0,seconds:0,milliseconds:0,formatted:"0:00.000",totalMs:0};let n=ie.value.durationMs||0;n===0&&Ce.value.length>0&&Ce.value.forEach(P=>{n+=Be(P.time)*1e3});const t=n/1e3,c=Math.floor(t/3600),p=Math.floor(t%3600/60),o=Math.floor(t%60),h=Math.round(n%1e3);let x="";return c>0?x=`${c}h ${p.toString().padStart(2,"0")}m ${o.toString().padStart(2,"0")}.${h.toString().padStart(3,"0")}s`:x=`${p}m ${o.toString().padStart(2,"0")}.${h.toString().padStart(3,"0")}s`,{hours:c,minutes:p,seconds:o,milliseconds:h,formatted:x,totalMs:n}}),Mt=B(!0),an=B(!1),Ls={Opt:{bg:"rgba(16, 185, 129, 0.15)",border:"#10b981",label:"Optimum"},Green:{bg:"rgba(132, 204, 22, 0.15)",border:"#84cc16",label:"Green"},Greasy:{bg:"rgba(234, 179, 8, 0.15)",border:"#eab308",label:"Greasy"},Damp:{bg:"rgba(249, 115, 22, 0.15)",border:"#f97316",label:"Damp"},Wet:{bg:"rgba(59, 130, 246, 0.15)",border:"#3b82f6",label:"Wet"},Flooded:{bg:"rgba(139, 92, 246, 0.15)",border:"#8b5cf6",label:"Flooded"}},on=k(()=>{const n=Ce.value;if(n.length<2)return!1;const t=n[0]?.grip;return n.some(c=>c.grip!==t)}),ln=k(()=>{const n=Ce.value;if(n.length===0)return[];const t=[];let c=n[0]?.grip||"Opt",p=1;return n.forEach((o,h)=>{o.grip!==c&&(t.push({gripLevel:c,startLap:p,endLap:h}),c=o.grip,p=h+1)}),t.push({gripLevel:c,startLap:p,endLap:n.length}),t});return(n,t)=>{const c=qn,p=Qa;return b(),_("div",Bi,[(b(),Rn(Pn,{to:"body"},[os(cn,{name:"slide-notification"},{default:Us(()=>[Je.value?(b(),_("div",Ni,[...t[8]||(t[8]=[a("span",{class:"share-notification-icon"},"âœ“",-1),a("span",{class:"share-notification-text"},"Link copiato nella clipboard!",-1)])])):H("",!0)]),_:1}),os(cn,{name:"slide-notification"},{default:Us(()=>[ct.value?(b(),_("div",$i,[t[9]||(t[9]=a("span",{class:"autoselect-notification-icon"},"âœ“",-1)),t[10]||(t[10]=a("span",{class:"autoselect-notification-text"}," Confronto attivato con i migliori stint ",-1)),a("button",{class:"autoselect-notification-action",onClick:t[0]||(t[0]=o=>{ct.value=!1,Kt()})},"Cambia"),a("button",{class:"autoselect-notification-close",onClick:t[1]||(t[1]=o=>ct.value=!1)},"âœ•")])):H("",!0)]),_:1})])),os(c,{class:"session-detail-page"},{default:Us(()=>[a("div",zi,[a("button",{class:"nav-btn",onClick:t[2]||(t[2]=o=>y("back"))},[...t[11]||(t[11]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M15 18l-6-6 6-6"})],-1),W(" Torna alle sessioni ",-1)])]),a("button",{class:"nav-btn nav-btn--accent",onClick:t[3]||(t[3]=o=>y("go-to-track",O.value.trackId))},[...t[12]||(t[12]=[W(" Apri pista ",-1),a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M9 18l6-6-6-6"})],-1)])])]),We.value?(b(),_("div",Fi,[...t[13]||(t[13]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Caricamento sessione...",-1)])])):Ze.value?(b(),_("div",Ui,[t[14]||(t[14]=a("p",{class:"error-icon"},"âš ï¸",-1)),a("p",Gi,g(Ze.value),1),a("button",{class:"nav-btn",onClick:t[4]||(t[4]=o=>y("back"))},"Torna alle sessioni")])):(b(),_(w,{key:2},[a("header",Qi,[a("div",Hi,[a("h1",Vi,g(O.value.track.toUpperCase()),1),a("span",{class:U(["type-badge",`type-badge--${O.value.type}`])},g(Wn(O.value.type)),3),a("button",{class:"share-session-btn",onClick:ps,title:"Condividi questa sessione"}," ðŸ”— Condividi ")]),a("div",Yi,[a("span",null,g(O.value.date),1),t[15]||(t[15]=a("span",{class:"sep"},"â€¢",-1)),a("span",null,g(O.value.time),1),t[16]||(t[16]=a("span",{class:"sep"},"â€¢",-1)),a("span",Wi,g(O.value.car),1)])]),a("div",Zi,[a("aside",Xi,[a("div",qi,[a("div",ji,[t[18]||(t[18]=a("span",{class:"builder-panel-title"},"CONFRONTA STINT",-1)),mt.value?(b(),_(w,{key:0},[ht.value?(b(),_("button",{key:0,class:"builder-combo-btn builder-combo-btn--active",onClick:Kt,title:"Confronto attivo - Clicca per resettare"},[...t[17]||(t[17]=[a("span",{class:"combo-status"},"âœ“ Attivo",-1),a("span",{class:"combo-divider"},"|",-1),a("span",{class:"combo-reset"},"Ã—",-1)])])):(b(),_("button",{key:1,class:"builder-combo-btn",onClick:Kt,title:"Azzera selezione"}," Ã— Reset "))],64)):H("",!0)]),a("div",Ki,[t[19]||(t[19]=a("span",{class:"builder-slot-label"},"A",-1)),a("div",Ji,[M.value?(b(),_(w,{key:1},[a("span",{class:U(["builder-chip",J.value==="a"?"builder-chip--s1":"builder-chip--s2"])},[Le.value?(b(),_("span",to,g(J.value==="a"?"S1":"S2"),1)):H("",!0),W(" #"+g(M.value)+" ",1),a("button",{class:"chip-remove",onClick:As,title:F.value?"Rimuovi (rimuoverÃ  anche +"+F.value+")":"Rimuovi"},"Ã—",8,so)],2),F.value?(b(),_("span",{key:0,class:U(["builder-chip",he.value==="a"?"builder-chip--s1":"builder-chip--s2"])},[Le.value?(b(),_("span",no,g(he.value==="a"?"S1":"S2"),1)):H("",!0),W(" + #"+g(F.value)+" ",1),a("button",{class:"chip-remove",onClick:ms,title:"Rimuovi"},"Ã—")],2)):H("",!0)],64)):(b(),_("span",eo,"Seleziona stint con [+A]"))])]),a("div",ao,[t[20]||(t[20]=a("span",{class:"builder-slot-label"},"B",-1)),a("div",io,[R.value?(b(),_(w,{key:1},[a("span",{class:U(["builder-chip",de.value==="a"?"builder-chip--s1":"builder-chip--s2"])},[Le.value?(b(),_("span",lo,g(de.value==="a"?"S1":"S2"),1)):H("",!0),W(" #"+g(R.value)+" ",1),a("button",{class:"chip-remove",onClick:Ms,title:z.value?"Rimuovi (rimuoverÃ  anche +"+z.value+")":"Rimuovi"},"Ã—",8,ro)],2),z.value?(b(),_("span",{key:0,class:U(["builder-chip",ae.value==="a"?"builder-chip--s1":"builder-chip--s2"])},[Le.value?(b(),_("span",uo,g(ae.value==="a"?"S1":"S2"),1)):H("",!0),W(" + #"+g(z.value)+" ",1),a("button",{class:"chip-remove",onClick:hs,title:"Rimuovi"},"Ã—")],2)):H("",!0)],64)):(b(),_("span",oo,"Seleziona stint con [+B]"))])])]),Le.value?(b(),_(w,{key:0},[a("div",co,[a("div",vo,[a("span",po,"S1 â€” "+g(d.value||"Te"),1),a("span",fo,g(O.value.date),1)]),a("div",mo,[(b(!0),_(w,null,xe(O.value.stints,o=>(b(),_("div",{key:"a-"+o.number,class:U(["stint-item stint-item--builder stint-item--session-a",{"builder-selected":zt(o.number,"a")||Ft(o.number,"a"),viewing:Ie.value===o.number,"best-stint":Et(o)}]),onClick:h=>ts(o.number)},[a("button",{class:"stint-add-btn stint-add-btn--a",disabled:!Jt(o.number),title:Ss(o.number),onClick:Lt(h=>gt(o.number,"a"),["stop"])},"+A",8,go),a("button",{class:"stint-add-btn stint-add-btn--b",disabled:!ys(o.number),title:Ts(o.number),onClick:Lt(h=>Cs(o.number,"a"),["stop"])},"+B",8,bo),a("span",_o,[Et(o)?(b(),_(w,{key:0},[W("ðŸ†")],64)):He(o)?(b(),_(w,{key:1},[W(g(He(o)?.icon),1)],64)):H("",!0)]),a("span",yo,"S1 #"+g(o.number),1),a("span",{class:U(["stint-type",`stint-type--${o.type.toLowerCase()}`])},g(o.type),3),a("span",So,g(o.laps)+" Giri",1)],10,ho))),128))])]),a("div",To,[a("div",Co,[a("span",ko,[Dt.value?(b(),_(w,{key:0},[W(" S2 â€” "+g(Te.value||"Utente Esterno"),1)],64)):(b(),_(w,{key:1},[W(" S2 â€” "+g(d.value||"Te")+" (altra) ",1)],64))]),a("button",{class:"cross-session-close",onClick:ft,title:"Rimuovi questa sorgente"},"âœ•")]),a("div",Eo,[(b(!0),_(w,null,xe(Ps.value,o=>(b(),_("div",{key:"b-"+o.number,class:U(["stint-item stint-item--builder stint-item--session-b",{"builder-selected":zt(o.number,"b")||Ft(o.number,"b")}]),onClick:h=>(o.number,void 0)},[a("button",{class:"stint-add-btn stint-add-btn--a",disabled:!ws(o.number),title:ks(o.number),onClick:Lt(h=>Ns(o.number),["stop"])},"+A",8,Mo),a("button",{class:"stint-add-btn stint-add-btn--b",disabled:!es(o.number),title:Bs(o.number),onClick:Lt(h=>Es(o.number),["stop"])},"+B",8,xo),a("span",Lo,[Et(o)?(b(),_(w,{key:0},[W("ðŸ†")],64)):He(o)?(b(),_(w,{key:1},[W(g(He(o)?.icon),1)],64)):H("",!0)]),a("span",Io,"S2 #"+g(o.number),1),a("span",{class:U(["stint-type",`stint-type--${o.type.toLowerCase()}`])},g(o.type),3),a("span",Ro,g(o.laps)+" Giri",1)],10,Ao))),128))])])],64)):(b(),_(w,{key:1},[t[21]||(t[21]=a("h4",{class:"master-title"},"STINT",-1)),a("div",Po,[(b(!0),_(w,null,xe(O.value.stints,o=>(b(),_("div",{key:o.number,class:U(["stint-item stint-item--builder",{selected:Ie.value===o.number,"builder-selected":zt(o.number)||Ft(o.number),"best-stint":Et(o)}]),onClick:h=>bt(o.number)},[a("button",{class:"stint-add-btn stint-add-btn--a",disabled:!Jt(o.number),title:Ss(o.number),onClick:Lt(h=>gt(o.number),["stop"])},"+A",8,Do),a("button",{class:"stint-add-btn stint-add-btn--b",disabled:!ys(o.number),title:Ts(o.number),onClick:Lt(h=>Cs(o.number),["stop"])},"+B",8,wo),a("span",Bo,[Et(o)?(b(),_(w,{key:0},[W("ðŸ†")],64)):He(o)?(b(),_(w,{key:1},[W(g(He(o)?.icon),1)],64)):H("",!0)]),a("span",No,"#"+g(o.number),1),a("span",{class:U(["stint-type",`stint-type--${o.type.toLowerCase()}`])},g(o.type),3),a("span",$o,g(o.laps)+" Giri",1),a("span",{class:U(["stint-delta",`delta--${xs(tn(o))}`])},g(tn(o)),3)],10,Oo))),128))]),a("button",{class:"altra-sessione-btn",onClick:dt}," Confronta con altra sessione ")],64))]),a("section",zo,[!le.value&&!K.value&&!ue.value&&O.value.stints.length===0?(b(),_("div",Fo,[...t[22]||(t[22]=[a("div",{class:"empty-state-content"},[a("h3",{class:"empty-state-title"},"Nessun stint disponibile"),a("p",{class:"empty-state-text"},"Questa sessione non contiene dati di stint.")],-1)])])):H("",!0),!le.value&&!K.value&&ie.value&&He(ie.value)?(b(),_("div",Uo,g(He(ie.value)?.icon)+" "+g(He(ie.value)?.message),1)):H("",!0),le.value||K.value||ue.value?(b(),_("div",Go,[a("div",Qo,[a("div",Ho,[a("div",Vo,"A: Stint #"+g(K.value||ue.value?M.value:Xe.value),1),a("div",Yo,[a("span",Wo,[t[23]||(t[23]=a("span",{class:"cond-lbl"},"Aria:",-1)),W(" "+g(i(K.value||ue.value?Fe.value:Ee.value))+"Â°",1)]),a("span",Zo,[t[24]||(t[24]=a("span",{class:"cond-lbl"},"Grip:",-1)),W(" "+g(u(K.value||ue.value?Fe.value:Ee.value)),1)])])]),a("div",Xo,[a("div",qo,"B: Stint #"+g(K.value||ue.value?R.value:$e.value),1),a("div",jo,[a("span",Ko,[t[25]||(t[25]=a("span",{class:"cond-lbl"},"Aria:",-1)),W(" "+g(i(K.value||ue.value?be.value:ke.value))+"Â°",1)]),a("span",Jo,[t[26]||(t[26]=a("span",{class:"cond-lbl"},"Grip:",-1)),W(" "+g(u(K.value||ue.value?be.value:ke.value)),1)])])])]),a("div",el,[a("div",tl,[t[36]||(t[36]=a("div",{class:"ssc-table-header"},[a("div",{class:"ssc-th ssc-th--label"}),a("div",{class:"ssc-th"},"STRATEGIA A"),a("div",{class:"ssc-th"},"STRATEGIA B"),a("div",{class:"ssc-th"},"- DELTA")],-1)),(b(!0),_(w,null,xe(qt.value,(o,h)=>(b(),_(w,{key:h},[qt.value>1?(b(),_("div",sl,[a("span",null,"STINT "+g(h+1),1)])):H("",!0),a("div",nl,[t[27]||(t[27]=a("div",{class:"ssc-td ssc-td--label"},"BEST",-1)),a("div",al,g(ee.value[h]?.best??"â€”"),1),a("div",il,g(ce.value[h]?.best??"â€”"),1),a("div",ol,[ee.value[h]&&ce.value[h]?(b(),_("span",{key:0,class:U(["ssc-delta",_e(ee.value[h]?.bestMs,ce.value[h]?.bestMs)])},g(N(ee.value[h]?.bestMs,ce.value[h]?.bestMs)),3)):(b(),_("span",ll,"â€”"))])]),a("div",rl,[t[28]||(t[28]=a("div",{class:"ssc-td ssc-td--label"},"AVG",-1)),a("div",{class:U(["ssc-td","ssc-td--value",{"ssc-td--warning":ee.value[h]?.avgWarning}])},[ee.value[h]?.avgWarning?(b(),_(w,{key:0},[W("âš ï¸ "+g(ee.value[h]?.avg),1)],64)):(b(),_(w,{key:1},[W(g(ee.value[h]?.avg??"â€”"),1)],64))],2),a("div",{class:U(["ssc-td","ssc-td--value",{"ssc-td--warning":ce.value[h]?.avgWarning}])},[ce.value[h]?.avgWarning?(b(),_(w,{key:0},[W("âš ï¸ "+g(ce.value[h]?.avg),1)],64)):(b(),_(w,{key:1},[W(g(ce.value[h]?.avg??"â€”"),1)],64))],2),a("div",ul,[ee.value[h]&&ce.value[h]?(b(),_("span",{key:0,class:U(["ssc-delta",_e(ee.value[h]?.avgMs,ce.value[h]?.avgMs)])},g(N(ee.value[h]?.avgMs,ce.value[h]?.avgMs)),3)):(b(),_("span",cl,"â€”"))])]),a("div",dl,[t[31]||(t[31]=a("div",{class:"ssc-td ssc-td--label"},"GIRI VALIDI",-1)),a("div",vl,[ee.value[h]?(b(),_(w,{key:0},[W(g(ee.value[h].validLapsCount??0)+" su "+g(ee.value[h].laps??0)+" ",1),t[29]||(t[29]=a("span",{class:"compact-sep"},"Â·",-1)),W(" "+g($t(ee.value[h]?.durationMs)),1)],64)):(b(),_(w,{key:1},[W("â€”")],64))]),a("div",pl,[ce.value[h]?(b(),_(w,{key:0},[W(g(ce.value[h].validLapsCount??0)+" su "+g(ce.value[h].laps??0)+" ",1),t[30]||(t[30]=a("span",{class:"compact-sep"},"Â·",-1)),W(" "+g($t(ce.value[h]?.durationMs)),1)],64)):(b(),_(w,{key:1},[W("â€”")],64))]),t[32]||(t[32]=a("div",{class:"ssc-td"},null,-1))])],64))),128)),qt.value>1?(b(),_(w,{key:0},[t[35]||(t[35]=a("div",{class:"ssc-stint-separator ssc-stint-separator--total"},[a("span",null,"TOTALE")],-1)),a("div",fl,[t[33]||(t[33]=a("div",{class:"ssc-td ssc-td--label"},"DURATA",-1)),a("div",ml,g($t(bs.value)),1),a("div",hl,g($t(_s.value)),1),t[34]||(t[34]=a("div",{class:"ssc-td"},null,-1))])],64)):H("",!0)])])])):H("",!0),!le.value&&!ue.value&&!K.value&&Re.value?(b(),_("div",{key:3,class:U(["stint-stats-card",`racing-theme--${Z.value}`])},[a("div",gl,[a("div",bl,[a("span",{class:U(["stint-type",`stint-type--${Re.value?.type?.toLowerCase()}`])},g(Re.value?.type==="R"?"Race":"Qualifying"),3),a("span",_l,"STINT #"+g(it.value),1),t[39]||(t[39]=a("span",{class:"ssc-header-divider"},"|",-1)),a("span",yl,[t[37]||(t[37]=a("span",{class:"ssc-cond-lbl"},"ARIA",-1)),a("span",Sl,g(fe.value.airTemp.avg||fe.value.airTemp.start)+"Â°",1)]),a("span",Tl,[t[38]||(t[38]=a("span",{class:"ssc-cond-lbl"},"GRIP",-1)),a("span",Cl,g(fe.value.grip.dominant),1)])]),a("div",kl,[a("span",El,"Durata: "+g(Zn.value.formatted),1)])]),a("div",Al,[t[42]||(t[42]=a("div",{class:"ssc-table-header"},[a("div",{class:"ssc-th ssc-th--label"}),a("div",{class:"ssc-th"},"TEMPI STINT"),a("div",{class:"ssc-th ssc-th--theo"},[W(" TEORICO "),a("span",{class:"theo-info",title:"Tempo Teorico = Storico + (TempStint - TempStorico) Ã— 100ms/Â°C"},"?")]),a("div",{class:"ssc-th"},"- DELTA")],-1)),a("div",Ml,[t[40]||(t[40]=a("div",{class:"ssc-td ssc-td--label"},"BEST",-1)),a("div",xl,g(ie.value?.best??"â€”:â€”.---"),1),a("div",Ll,g(ie.value?.type==="Q"?ge.value.theoQualy?rs(Y)(ge.value.theoQualy):"â€”:â€”.---":ge.value.theoRace?rs(Y)(ge.value.theoRace):"â€”:â€”.---"),1),a("div",Il,[a("span",{class:U(["ssc-delta",sn.value.class])},g(sn.value.value),3)])]),a("div",Rl,[t[41]||(t[41]=a("div",{class:"ssc-td ssc-td--label"},"AVG",-1)),a("div",Pl,g(ie.value?.avg??"â€”:â€”.---"),1),a("div",Ol,g(ie.value?.type==="Q"?"â€”":ge.value.theoAvgRace?rs(Y)(ge.value.theoAvgRace):"â€”:â€”.---"),1),a("div",Dl,[ie.value?.type!=="Q"?(b(),_("span",{key:0,class:U(["ssc-delta",nn.value.class])},g(nn.value.value),3)):(b(),_("span",wl,"â€”"))])])]),ie.value?.type==="R"&&st.value.total>0?(b(),_("div",Bl,[a("div",Nl,[t[43]||(t[43]=a("span",{class:"ssc-target-label"},"TARGET GARA:",-1)),a("span",$l,g(st.value.targetLine),1)])])):H("",!0),a("div",zl,[ie.value?.type==="R"&&st.value.total>0?(b(),_("div",Fl,[a("div",Ul,[t[44]||(t[44]=a("span",{class:"ssc-progress-title"},"GIRI NEL TARGET",-1)),a("span",Gl,g(st.value.onTarget)+" su "+g(st.value.total),1)]),a("div",Ql,[a("div",{class:"ssc-progress-fill",style:ls({width:st.value.pct+"%",background:s(st.value.pct)})},null,4)]),a("span",{class:"ssc-progress-pct",style:ls({color:s(st.value.pct)})},g(st.value.pct)+"%",5)])):H("",!0),At.value.total>0?(b(),_("div",Hl,[a("div",Vl,[t[45]||(t[45]=a("span",{class:"ssc-progress-title"},"GIRI VALIDI",-1)),a("span",Yl,g(At.value.valid)+" su "+g(At.value.total),1)]),a("div",Wl,[a("div",{class:"ssc-progress-fill",style:ls({width:At.value.pct+"%",background:s(At.value.pct)})},null,4)]),a("span",{class:"ssc-progress-pct",style:ls({color:s(At.value.pct)})},g(At.value.pct)+"%",5)])):H("",!0)])],2)):H("",!0),a("div",Zl,[a("div",Xl,[a("h4",ql,[le.value?(b(),_(w,{key:0},[W("Confronto Tempi â€” A: Stint #"+g(Xe.value)+" vs B: Stint #"+g($e.value),1)],64)):(b(),_(w,{key:1},[W("Tempi Giro â€” Stint "+g(Ie.value),1)],64))]),a("div",jl,[a("button",{class:"toolbar-btn",onClick:Ve,title:"Zoom In"},[...t[46]||(t[46]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("circle",{cx:"11",cy:"11",r:"8"}),a("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),a("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),a("line",{x1:"8",y1:"11",x2:"14",y2:"11"})],-1)])]),a("button",{class:"toolbar-btn",onClick:ut,title:"Zoom Out"},[...t[47]||(t[47]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("circle",{cx:"11",cy:"11",r:"8"}),a("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),a("line",{x1:"8",y1:"11",x2:"14",y2:"11"})],-1)])]),a("button",{class:"toolbar-btn",onClick:j,title:"Reset Zoom"},[...t[48]||(t[48]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("polyline",{points:"1 4 1 10 7 10"}),a("polyline",{points:"23 20 23 14 17 14"}),a("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})],-1)])]),t[50]||(t[50]=a("div",{class:"toolbar-divider"},null,-1)),a("button",{class:U(["toolbar-btn",{"toolbar-btn--active":D.value}]),onClick:t[5]||(t[5]=o=>D.value=!D.value),title:"Gestisci Giri"},[...t[49]||(t[49]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),a("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),a("line",{x1:"9",y1:"21",x2:"9",y2:"9"})],-1)])],2)])]),D.value?(b(),_("div",Kl,[a("div",Jl,[a("div",er,[a("span",tr,g(K.value?"Strategia A Â· "+ee.value.map(o=>"#"+o.number).join("+"):ue.value?"Strategia A Â· Stint #"+M.value:le.value?"Strategia A Â· Stint #"+Xe.value:"Escludi Giri"),1),a("button",{class:"lap-manager-reset",onClick:rt,disabled:T.value.size===0}," Reset ",8,sr)]),K.value?(b(!0),_(w,{key:0},xe(ee.value,o=>(b(),_("div",{key:"stint-a-"+o.number,class:"lap-manager-stint-group"},[a("div",nr,"Stint #"+g(o.number),1),a("div",ar,[(b(!0),_(w,null,xe(O.value.lapsData[o.number]||[],h=>(b(),_("button",{key:"a-"+o.number+"-"+h.lap,class:U(["lap-toggle-btn",{"lap-toggle-btn--excluded":T.value.has(h.lap)},{"lap-toggle-btn--invalid":!h.valid&&!h.pit},{"lap-toggle-btn--pit":h.pit}]),onClick:x=>q(h.lap),title:`Giro ${h.lap} - ${h.time}${h.valid?"":" (Invalido)"}${h.pit?" (Pit)":""}`},g(h.lap),11,ir))),128))])]))),128)):(b(),_("div",or,[(b(!0),_(w,null,xe(ue.value?Fe.value:le.value?Ee.value:Ce.value,o=>(b(),_("button",{key:"a-"+o.lap,class:U(["lap-toggle-btn",{"lap-toggle-btn--excluded":T.value.has(o.lap)},{"lap-toggle-btn--invalid":!o.valid&&!o.pit},{"lap-toggle-btn--pit":o.pit}]),onClick:h=>q(o.lap),title:`Giro ${o.lap} - ${o.time}${o.valid?"":" (Invalido)"}${o.pit?" (Pit)":""}`},g(o.lap),11,lr))),128))])),T.value.size>0?(b(),_("div",rr,g(T.value.size)+" giri esclusi ",1)):H("",!0)]),le.value||K.value?(b(),_("div",ur,[a("div",cr,[a("span",dr,g(K.value?"Strategia B Â· "+ce.value.map(o=>"#"+o.number).join("+"):"B: Stint #"+$e.value),1),a("button",{class:"lap-manager-reset",onClick:oe,disabled:E.value.size===0}," Reset ",8,vr)]),K.value?(b(!0),_(w,{key:0},xe(ce.value,o=>(b(),_("div",{key:"stint-b-"+o.number,class:"lap-manager-stint-group"},[a("div",pr,"Stint #"+g(o.number),1),a("div",fr,[(b(!0),_(w,null,xe(O.value.lapsData[o.number]||[],h=>(b(),_("button",{key:"b-"+o.number+"-"+h.lap,class:U(["lap-toggle-btn lap-toggle-btn--b",{"lap-toggle-btn--excluded":E.value.has(h.lap)},{"lap-toggle-btn--invalid":!h.valid&&!h.pit},{"lap-toggle-btn--pit":h.pit}]),onClick:x=>Ge(h.lap),title:`Giro ${h.lap} - ${h.time}${h.valid?"":" (Invalido)"}${h.pit?" (Pit)":""}`},g(h.lap),11,mr))),128))])]))),128)):(b(),_("div",hr,[(b(!0),_(w,null,xe(ke.value,o=>(b(),_("button",{key:"b-"+o.lap,class:U(["lap-toggle-btn lap-toggle-btn--b",{"lap-toggle-btn--excluded":E.value.has(o.lap)},{"lap-toggle-btn--invalid":!o.valid&&!o.pit},{"lap-toggle-btn--pit":o.pit}]),onClick:h=>Ge(o.lap),title:`Giro ${o.lap} - ${o.time}${o.valid?"":" (Invalido)"}${o.pit?" (Pit)":""}`},g(o.lap),11,gr))),128))])),E.value.size>0?(b(),_("div",br,g(E.value.size)+" giri esclusi ",1)):H("",!0)])):H("",!0),ue.value?(b(),_("div",_r,[a("div",yr,[a("span",Sr,"Strategia B Â· Stint #"+g(R.value),1),a("button",{class:"lap-manager-reset",onClick:I,disabled:L.value.size===0}," Reset ",8,Tr)]),a("div",Cr,[(b(!0),_(w,null,xe(be.value,o=>(b(),_("button",{key:"crossb-"+o.lapNumber,class:U(["lap-toggle-btn lap-toggle-btn--b",{"lap-toggle-btn--excluded":L.value.has(o.lapNumber)},{"lap-toggle-btn--invalid":!o.valid&&!o.pit},{"lap-toggle-btn--pit":o.pit}]),onClick:h=>Se(o.lapNumber),title:`Giro ${o.lapNumber} - ${o.lapTime}${o.valid?"":" (Invalido)"}${o.pit?" (Pit)":""}`},g(o.lapNumber),11,kr))),128))]),L.value.size>0?(b(),_("div",Er,g(L.value.size)+" giri esclusi ",1)):H("",!0)])):H("",!0)])):H("",!0),a("div",Ar,[os(rs(ha),{ref_key:"chartRef",ref:G,data:Ae.value,options:Ue},null,8,["data"])]),on.value&&an.value?(b(),_("div",Mr,[t[51]||(t[51]=a("span",{class:"grip-legend-title"},"Grip:",-1)),(b(!0),_(w,null,xe(ln.value,o=>(b(),_("div",{key:`${o.gripLevel}-${o.startLap}`,class:"grip-legend-item"},[a("span",{class:"grip-legend-dot",style:ls({backgroundColor:Ls[o.gripLevel]?.border||"#fff"})},null,4),a("span",xr,g(Ls[o.gripLevel]?.label||o.gripLevel),1),a("span",Lr,"(G"+g(o.startLap)+"-G"+g(o.endLap)+")",1)]))),128))])):H("",!0)]),a("div",Ir,[a("div",Rr,[le.value||ue.value||K.value?(b(),_("div",Pr,[a("button",{class:U(["lap-tab lap-tab--compare",{"lap-tab--active":we.value==="COMPARE"}]),onClick:t[6]||(t[6]=o=>we.value="COMPARE")}," Confronto ",2),(b(!0),_(w,null,xe(ee.value,o=>(b(),_("button",{key:"tab-a-"+o.number,class:U(["lap-tab lap-tab--a",{"lap-tab--active":we.value==="A-"+o.number}]),onClick:h=>we.value="A-"+o.number}," A: Stint #"+g(o.number),11,Or))),128)),(b(!0),_(w,null,xe(ce.value,o=>(b(),_("button",{key:"tab-b-"+o.number,class:U(["lap-tab lap-tab--b",{"lap-tab--active":we.value==="B-"+o.number}]),onClick:h=>we.value="B-"+o.number}," B: Stint #"+g(o.number),11,Dr))),128))])):(b(),_("h4",wr,"Tabella Giri â€” Stint "+g(Ie.value),1))]),we.value==="COMPARE"&&(le.value||ue.value||K.value)?(b(),_("div",Br,[a("table",Nr,[t[54]||(t[54]=a("thead",null,[a("tr",null,[a("th",{class:"col-index"},"#"),a("th",{class:"col-a",colspan:"4"},"Strategia A"),a("th",{class:"col-delta"},"Î” A-B"),a("th",{class:"col-b",colspan:"4"},"Strategia B")]),a("tr",{class:"sub-header"},[a("th"),a("th",{class:"col-a"},"Tempo"),a("th",{class:"col-a"},"S1"),a("th",{class:"col-a"},"S2"),a("th",{class:"col-a"},"S3"),a("th"),a("th",{class:"col-b"},"Tempo"),a("th",{class:"col-b"},"S1"),a("th",{class:"col-b"},"S2"),a("th",{class:"col-b"},"S3")])],-1)),a("tbody",null,[(b(!0),_(w,null,xe(is.value,o=>(b(),_(w,{key:"cmp-"+o.index},[o._isStintStartA||o._isStintStartB?(b(),_("tr",$r,[t[52]||(t[52]=a("td",{class:"stint-header-index"},null,-1)),a("td",zr,[o._isStintStartA?(b(),_("span",Fr,"A: Stint #"+g(o._stintNumberA),1)):H("",!0)]),t[53]||(t[53]=a("td",{class:"stint-header-delta"},null,-1)),a("td",Ur,[o._isStintStartB?(b(),_("span",Gr,"B: Stint #"+g(o._stintNumberB),1)):H("",!0)])])):H("",!0),a("tr",null,[a("td",Qr,g(o.index),1),a("td",Hr,g(o.lapA&&(o.lapA.time||o.lapA.lapTime)||"â€”"),1),a("td",Vr,g(o.lapA?C(o.lapA.sectors?.[0]||o.lapA.s1):"â€”"),1),a("td",Yr,g(o.lapA?C(o.lapA.sectors?.[1]||o.lapA.s2):"â€”"),1),a("td",Wr,g(o.lapA?C(o.lapA.sectors?.[2]||o.lapA.s3):"â€”"),1),a("td",{class:U(["col-delta","delta",`delta--${o.deltaClass}`])},g(o.deltaFormatted),3),a("td",Zr,g(o.lapB&&(o.lapB.time||o.lapB.lapTime)||"â€”"),1),a("td",Xr,g(o.lapB?C(o.lapB.sectors?.[0]||o.lapB.s1):"â€”"),1),a("td",qr,g(o.lapB?C(o.lapB.sectors?.[1]||o.lapB.s2):"â€”"),1),a("td",jr,g(o.lapB?C(o.lapB.sectors?.[2]||o.lapB.s3):"â€”"),1)])],64))),128))])])])):(b(),_("div",Kr,[a("table",Jr,[t[55]||(t[55]=a("thead",null,[a("tr",null,[a("th",null,"Giro"),a("th",null,"Tempo"),a("th",null,"Î” Teorico"),a("th",null,"S1"),a("th",null,"S2"),a("th",null,"S3"),a("th",null,"Fuel"),a("th",null,"AirÂ°"),a("th",null,"Grip"),a("th",null,"Stato")])],-1)),a("tbody",null,[(b(!0),_(w,null,xe(St(),o=>(b(),_("tr",{key:o.lap||o.lapNumber,class:U({"lap-pit":o.pit,"lap-excluded":T.value.has(o.lap||o.lapNumber),"lap-best":as(o)})},[a("td",null,g(o.lap||o.lapNumber),1),a("td",eu,g(o.time||o.lapTime),1),a("td",{class:U(["delta",`delta--${xs(o.delta)}`])},g(o.delta||"â€”"),3),a("td",{class:U(["sector",{"sector--best":Tt(o,0)}])},g(C(o.sectors?.[0]||o.s1)),3),a("td",{class:U(["sector",{"sector--best":Tt(o,1)}])},g(C(o.sectors?.[1]||o.s2)),3),a("td",{class:U(["sector",{"sector--best":Tt(o,2)}])},g(C(o.sectors?.[2]||o.s3)),3),a("td",null,g(o.fuel)+"L",1),a("td",null,g(Math.round(o.airTemp||o.air||0))+"Â°",1),a("td",null,g(o.grip),1),a("td",tu,[o.pit?(b(),_("span",su,"PIT")):o.valid?(b(),_("span",au,"OK")):(b(),_("span",nu,"INV"))])],2))),128))])])]))])])])],64))]),_:1}),os(p,{"is-open":Ot.value,"current-track":O.value?.track||"","exclude-session-id":m.sessionId,onClose:t[7]||(t[7]=o=>Ot.value=!1),onSelect:pt},null,8,["is-open","current-track","exclude-session-id"])])}}}),cu=Object.assign(On(iu,[["__scopeId","data-v-754da8dc"]]),{__name:"PagesSessionDetailPage"});export{cu as _};
