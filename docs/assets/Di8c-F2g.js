import{_ as gt}from"./BZ8YxlIc.js";import{_ as vt}from"./cA5BAEAQ.js";import{b as bt,a2 as yt,o as kt,t as v,r as y,w as H,a3 as O,a4 as k,a5 as _t,a6 as ht,L as ft,F as d,J as Ct,G as t,K as w,H as o,M as L,I as j,a0 as J,E as m,Q as M,R as N,a7 as W,a8 as Rt,a9 as Y,P as R,aa as Q,_ as Tt}from"./DxVKFRpb.js";import{C as St,a as wt,L as It,P as xt,b as Pt,p as Bt,c as Lt,d as Mt,i as Nt,e as Qt}from"./xJY-dFrt.js";import{u as At}from"./zTv11VAj.js";import{u as $t}from"./CZ92alvS.js";const Dt={class:"track-header"},zt={class:"track-header-image"},Gt=["src","alt"],Ft={class:"track-header-info"},Et={class:"track-country-badge"},Vt={class:"track-title"},qt={class:"track-fullname"},Ut={class:"track-meta"},Ht={class:"meta-item"},Ot={class:"meta-item"},jt={class:"meta-item"},Jt={class:"page-layout"},Wt={class:"main-content"},Yt={class:"section"},Kt={class:"chart-container"},Xt={class:"chart-wrapper"},Zt=["onClick"],te={class:"row-left"},ee={class:"session-time"},se={class:"session-date"},ae={class:"session-car"},ne={class:"row-right"},oe={class:"stat-chips"},ie={class:"stat-chip"},le={class:"stat-chip"},re={class:"time-slot"},ce={key:0,class:"time-badge time-badge--qualy"},ue={key:1,class:"time-badge time-badge--qualy time-badge--empty"},de={class:"time-slot"},me={key:0,class:"time-badge time-badge--race"},pe={key:1,class:"time-badge time-badge--race time-badge--empty"},ge={class:"sidebar"},ve={class:"sidebar-section"},be={class:"section-header-row"},ye={class:"filters-row"},ke=["value"],_e=["value"],he={class:"best-times-stack"},fe={class:"best-time-card best-time-card--qualy"},Ce={class:"time-value"},Re={key:0,class:"time-conditions"},Te={key:1,class:"no-data-hint"},Se={class:"best-time-card best-time-card--race"},we={class:"time-value"},Ie={key:0,class:"time-conditions"},xe={key:1,class:"no-data-hint"},Pe={class:"best-time-card best-time-card--avg"},Be={class:"time-value"},Le={key:0,class:"time-conditions"},Me={key:1,class:"no-data-hint"},Ne={class:"sidebar-section"},Qe={class:"activity-stack"},Ae={class:"activity-item"},$e={class:"activity-value"},De={class:"activity-item"},ze={class:"activity-value"},Ge={class:"activity-label"},Fe={class:"activity-item"},Ee={class:"activity-value"},Ve={class:"activity-item"},qe={class:"activity-value"},A=20,Ue=bt({__name:"TrackDetailPage",props:{trackId:{},fromSession:{}},emits:["back","go-to-session"],setup(K,{emit:X}){const{getPublicPath:Z}=At();St.register(wt,It,xt,Pt,Bt,Lt,Mt,Nt);const g=K,$=X,D=$t();function I(a){if(!a)return"";const e=a.split("T")[0]??a,[n="0",l="0",s="0"]=e.split("-"),i=["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"];return`${parseInt(s)} ${i[parseInt(l)-1]??""} ${n}`}const{sessions:tt,trackStats:et,loadSessions:st,getTrackBests:at}=yt();kt(async()=>{await st(D.value||void 0)});const p=v(()=>{const a=g.trackId.toLowerCase().replace(/[^a-z0-9]/g,"_");return tt.value.filter(e=>{const n=e.meta.track.toLowerCase().replace(/[^a-z0-9]/g,"_");return n.includes(a)||a.includes(n)}).sort((e,n)=>n.meta.date_start.localeCompare(e.meta.date_start))}),nt=v(()=>{const a=g.trackId.toLowerCase().replace(/[^a-z0-9]/g,"_");return et.value.find(e=>{const n=e.track.toLowerCase().replace(/[^a-z0-9]/g,"_");return n.includes(a)||a.includes(n)})}),z={monza:{name:"Monza",fullName:"Autodromo Nazionale Monza",country:"Italia",countryCode:"IT",length:"5.793 km",turns:11,image:"/tracks/track_monza.png"},spa:{name:"Spa-Francorchamps",fullName:"Circuit de Spa-Francorchamps",country:"Belgio",countryCode:"BE",length:"7.004 km",turns:19,image:"/tracks/track_spa.png"},spa_francorchamps:{name:"Spa-Francorchamps",fullName:"Circuit de Spa-Francorchamps",country:"Belgio",countryCode:"BE",length:"7.004 km",turns:19,image:"/tracks/track_spa.png"},suzuka:{name:"Suzuka",fullName:"Suzuka International Racing Course",country:"Giappone",countryCode:"JP",length:"5.807 km",turns:18,image:"/tracks/track_suzuka.png"},donington:{name:"Donington Park",fullName:"Donington Park Racing Circuit",country:"Regno Unito",countryCode:"GB",length:"4.020 km",turns:12,image:"/tracks/track_donington.png"},donington_park:{name:"Donington Park",fullName:"Donington Park Racing Circuit",country:"Regno Unito",countryCode:"GB",length:"4.020 km",turns:12,image:"/tracks/track_donington.png"},valencia:{name:"Valencia",fullName:"Circuit Ricardo Tormo",country:"Spagna",countryCode:"ES",length:"4.005 km",turns:14,image:"/tracks/track_valencia.png"},nurburgring:{name:"Nürburgring",fullName:"Nürburgring Grand Prix Strecke",country:"Germania",countryCode:"DE",length:"5.148 km",turns:16,image:"/tracks/track_nurburgring.png"},silverstone:{name:"Silverstone",fullName:"Silverstone Circuit",country:"Regno Unito",countryCode:"GB",length:"5.891 km",turns:18,image:"/tracks/track_silverstone.png"},imola:{name:"Imola",fullName:"Autodromo Enzo e Dino Ferrari",country:"Italia",countryCode:"IT",length:"4.909 km",turns:19,image:"/tracks/track_imola.png"},barcelona:{name:"Barcelona",fullName:"Circuit de Barcelona-Catalunya",country:"Spagna",countryCode:"ES",length:"4.655 km",turns:16,image:"/tracks/track_barcelona.png"}},ot=["Optimum","Fast","Green","Greasy","Damp","Wet","Flood"],h=y("Optimum"),T=y("GT3"),G=y({}),F=y(!1);H([p,T],async()=>{p.value.length>0&&(F.value=!0,G.value=await at(g.trackId,T.value,D.value||void 0),F.value=!1)},{immediate:!0});const r=v(()=>{const a=g.trackId.toLowerCase().replace(/[^a-z0-9]/g,"_"),e=z[a]||z[g.trackId]||{name:O(g.trackId),fullName:O(g.trackId),country:"-",countryCode:"??",length:"-",turns:0,image:"/tracks/track_default.png"},n=nt.value,l=h.value,s=G.value[l],i=s?.bestQualy||null,u=s?.bestRace||null,c=s?.bestAvgRace||null,b=i?{airTemp:s?.bestQualyTemp||0,roadTemp:0,grip:l}:null,C=u?{airTemp:s?.bestRaceTemp||0,roadTemp:0,grip:l}:null,_=c?{airTemp:s?.bestAvgRaceTemp||0,roadTemp:0,grip:l}:null;return{id:g.trackId,...e,sessions:p.value.length,lastSession:n?.lastSession||"-",bestQualy:i?k(i):null,bestRace:u?k(u):null,bestAvgRace:c?k(c):null,bestQualyConditions:b,bestRaceConditions:C,bestAvgRaceConditions:_,bestQualySessionId:s?.bestQualySessionId||null,bestRaceSessionId:s?.bestRaceSessionId||null,bestAvgRaceSessionId:s?.bestAvgRaceSessionId||null,bestQualyDate:s?.bestQualyDate||null,bestRaceDate:s?.bestRaceDate||null,bestAvgRaceDate:s?.bestAvgRaceDate||null,hasGripData:!!i||!!u||!!c}}),x=v(()=>p.value.map(a=>{const e=_t(a.meta.session_type),n=new Date(a.meta.date_start),l=a.summary||{};let s,i;if(l.best_qualy_ms&&(s=k(l.best_qualy_ms)),l.best_race_ms&&(i=k(l.best_race_ms)),!s&&!i&&l.bestLap){const u=k(l.bestLap);a.meta.session_type===1?s=u:(a.meta.session_type,i=u)}return{id:a.sessionId,date:a.meta.date_start?.split("T")[0]||"",time:n.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),type:e,car:ht(a.meta.car),laps:l.laps||0,stints:l.stintCount||0,bestQualy:s,bestRace:i}})),P=y(1),it=v(()=>Math.max(1,Math.ceil(x.value.length/A))),lt=v(()=>{const a=(P.value-1)*A,e=a+A;return x.value.slice(a,e)}),E=y(null),B=y(!1);function rt(){B.value=!0}const f=y({totalLaps:0,validLaps:0,validPercent:0,totalTimeMs:0,totalTimeFormatted:"0h 0m",sessionCount:0});H(p,()=>{if(p.value.length>0){const a=p.value.reduce((i,u)=>i+(u.summary?.laps||0),0),e=p.value.reduce((i,u)=>i+(u.summary?.lapsValid||0),0),n=p.value.reduce((i,u)=>i+(u.summary?.totalTime||0),0),l=Math.floor(n/36e5),s=Math.floor(n%36e5/6e4);f.value={totalLaps:a,validLaps:e,validPercent:a>0?Math.round(e/a*100):0,totalTimeMs:n,totalTimeFormatted:l>0?`${l}h ${s}m`:`${s}m`,sessionCount:p.value.length}}},{immediate:!0});const V=v(()=>[...p.value].sort((e,n)=>e.meta.date_start.localeCompare(n.meta.date_start)).map(e=>{const n=e.summary,l=e.meta.date_start?.split("T")[0]||"",[s,i,u]=l.split("-"),c=["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"],b=u&&i?`${parseInt(u)} ${c[parseInt(i)-1]}`:"N/A";let C=n?.best_qualy_ms||null,_=n?.best_race_ms||null;if(!C&&!_&&n?.bestLap){const U=e.meta.session_type;U===1?C=n.bestLap:_=n.bestLap}return{date:b,sessionId:e.sessionId,bestQualy:C?k(C):void 0,bestRace:_?k(_):void 0}}));function S(a){if(!a||!a.includes(":"))return 0;const e=a.split(":"),n=parseInt(e[0]||"0"),s=(e[1]||"0.000").split("."),i=parseInt(s[0]||"0"),u=parseInt(s[1]||"0");return n*60+i+u/1e3}function q(a){const e=Math.floor(a/60),n=(a%60).toFixed(3);return`${e}:${n.padStart(6,"0")}`}const ct=v(()=>{const a=V.value,e=[],n=[];return a.forEach((s,i)=>{s.bestQualy&&e.push({x:i,y:S(s.bestQualy),label:s.date}),s.bestRace&&n.push({x:i,y:S(s.bestRace),label:s.date})}),{labels:a.map(s=>s.date),datasets:[{label:"Best Qualifying",data:e,borderColor:"#f0b400",backgroundColor:"rgba(240, 180, 0, 0.1)",borderWidth:2.5,pointRadius:5,pointHoverRadius:7,pointBackgroundColor:"#f0b400",pointBorderColor:"#f0b400",tension:0,fill:!1,showLine:!0},{label:"Best Race",data:n,borderColor:"#ff6464",backgroundColor:"rgba(255, 100, 100, 0.1)",borderWidth:2.5,pointRadius:5,pointHoverRadius:7,pointBackgroundColor:"#ff6464",pointBorderColor:"#ff6464",tension:0,fill:!1,showLine:!0}]}}),ut=v(()=>{const a=V.value,e=a.filter(c=>c.bestQualy).map(c=>S(c.bestQualy)),n=a.filter(c=>c.bestRace).map(c=>S(c.bestRace)),l=[...e,...n],s=l.length>0?Math.min(...l)-.5:0,i=l.length>0?Math.max(...l)+.5:120,u=a.map(c=>c.date);return{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"nearest"},plugins:{legend:{display:!0,position:"bottom",labels:{color:"rgba(255, 255, 255, 0.7)",usePointStyle:!0,padding:20,font:{family:"'Inter', sans-serif",size:12}}},tooltip:{enabled:!0,backgroundColor:"rgba(20, 20, 30, 0.95)",titleColor:"#fff",bodyColor:"rgba(255, 255, 255, 0.8)",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,padding:12,callbacks:{title:function(c){return c[0]?.raw?.label||u[c[0]?.parsed?.x]||""},label:function(c){const b=c.parsed.y;return b==null?"":`${c.dataset.label}: ${q(b)}`}}}},scales:{x:{type:"linear",min:-.5,max:a.length-.5,grid:{color:"rgba(255, 255, 255, 0.06)",drawBorder:!1},ticks:{color:"rgba(255, 255, 255, 0.5)",font:{family:"'Inter', sans-serif",size:11},stepSize:1,callback:function(c){return u[Math.round(Number(c))]||""}}},y:{min:s,max:i,grid:{color:"rgba(255, 255, 255, 0.06)",drawBorder:!1},ticks:{color:"rgba(255, 255, 255, 0.5)",font:{family:"'JetBrains Mono', monospace",size:11},callback:function(c){return q(c)}}}}}});function dt(a){const e=new Date(a),n=e.getDate(),s=["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"][e.getMonth()],i=e.getFullYear();return`${n} ${s} ${i}`}function mt(a){return{practice:"PRACTICE",qualify:"QUALIFY",race:"RACE"}[a]}function pt(a){$("go-to-session",a)}return(a,e)=>{const n=gt,l=vt;return d(),ft(l,null,{default:Ct(()=>[t("button",{class:"back-button",onClick:e[0]||(e[0]=s=>$("back"))},[e[8]||(e[8]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1)),w(" "+o(g.fromSession?"Torna alla sessione":"Torna alle piste"),1)]),t("div",Dt,[t("div",zt,[t("img",{src:L(Z)(r.value.image),alt:r.value.name},null,8,Gt)]),t("div",Ft,[t("span",Et,o(r.value.countryCode),1),t("h1",Vt,o(r.value.name),1),t("p",qt,o(r.value.fullName),1),t("div",Ut,[t("span",Ht,[e[9]||(e[9]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),t("path",{d:"M2 17l10 5 10-5"}),t("path",{d:"M2 12l10 5 10-5"})],-1)),w(" "+o(r.value.length),1)]),t("span",Ot,[e[10]||(e[10]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),t("path",{d:"M9 12l2 2 4-4"})],-1)),w(" "+o(r.value.turns)+" curve ",1)]),t("span",jt,[e[11]||(e[11]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),t("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),t("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),t("line",{x1:"3",y1:"10",x2:"21",y2:"10"})],-1)),w(" "+o(r.value.sessions)+" sessioni ",1)])])])]),t("div",Jt,[t("div",Wt,[t("div",Yt,[e[12]||(e[12]=t("h2",{class:"section-title"},"Storico Tempi",-1)),t("div",Kt,[t("div",Xt,[j(L(Qt),{data:ct.value,options:ut.value},null,8,["data","options"])])])]),t("div",{ref_key:"sessionsRef",ref:E,class:"section"},[e[14]||(e[14]=t("h2",{class:"section-title"},"Sessioni Recenti",-1)),t("div",{class:J(["sessions-list",{"sessions-list--fading":B.value}]),onTransitionend:e[1]||(e[1]=s=>B.value=!1)},[(d(!0),m(M,null,N(lt.value,s=>(d(),m("div",{key:s.id,class:"session-row",onClick:i=>pt(s.id)},[t("div",te,[t("span",{class:J(["session-chip",`session-chip--${s.type}`])},o(mt(s.type)),3),t("span",ee,o(s.time),1),t("span",se,o(dt(s.date)),1),t("span",ae,o(s.car),1)]),t("div",ne,[t("div",oe,[t("span",ie,"GIRI "+o(s.laps),1),t("span",le,"STINT "+o(s.stints),1)]),t("div",re,[s.bestQualy?(d(),m("span",ce," Q "+o(s.bestQualy),1)):(d(),m("span",ue," Q — "))]),t("div",de,[s.bestRace?(d(),m("span",me," R "+o(s.bestRace),1)):(d(),m("span",pe," R — "))]),e[13]||(e[13]=t("span",{class:"session-cta"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})])],-1))])],8,Zt))),128))],34)],512),j(n,{currentPage:P.value,"onUpdate:currentPage":e[2]||(e[2]=s=>P.value=s),"total-pages":it.value,"total-items":x.value.length,"scroll-target":E.value,"item-label":"sessioni",onPageChange:rt},null,8,["currentPage","total-pages","total-items","scroll-target"])]),t("aside",ge,[t("div",ve,[t("div",be,[e[15]||(e[15]=t("h2",{class:"section-title"},"Migliori Tempi",-1)),t("div",ye,[W(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>T.value=s),class:"category-selector"},[(d(!0),m(M,null,N(L(Rt),s=>(d(),m("option",{key:s,value:s},o(s),9,ke))),128))],512),[[Y,T.value]]),W(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>h.value=s),class:"grip-selector"},[(d(),m(M,null,N(ot,s=>t("option",{key:s,value:s},o(s),9,_e)),64))],512),[[Y,h.value]])])]),t("div",he,[t("div",fe,[e[18]||(e[18]=t("span",{class:"time-label"},"Best Stint Qualifying",-1)),t("span",Ce,o(r.value.bestQualy||"—:—.---"),1),r.value.bestQualyConditions?(d(),m("span",Re,[t("span",null,o(I(r.value.bestQualyDate)),1),e[16]||(e[16]=t("span",{class:"condition-sep"},"•",-1)),t("span",null,o(r.value.bestQualyConditions.airTemp)+"°C",1)])):r.value.bestQualy?R("",!0):(d(),m("span",Te,"Nessun dato "+o(T.value)+" / "+o(h.value),1)),r.value.bestQualySessionId?(d(),m("button",{key:2,class:"session-link-btn",title:"Vai alla sessione",onClick:e[5]||(e[5]=Q(s=>a.$router.push(`/sessioni/${r.value.bestQualySessionId}`),["stop"]))},[...e[17]||(e[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),t("polyline",{points:"15 3 21 3 21 9"}),t("line",{x1:"10",y1:"14",x2:"21",y2:"3"})],-1)])])):R("",!0)]),t("div",Se,[e[21]||(e[21]=t("span",{class:"time-label"},"Best Stint Race",-1)),t("span",we,o(r.value.bestRace||"—:—.---"),1),r.value.bestRaceConditions?(d(),m("span",Ie,[t("span",null,o(I(r.value.bestRaceDate)),1),e[19]||(e[19]=t("span",{class:"condition-sep"},"•",-1)),t("span",null,o(r.value.bestRaceConditions.airTemp)+"°C",1)])):r.value.bestRace?R("",!0):(d(),m("span",xe,"Nessun dato per "+o(h.value),1)),r.value.bestRaceSessionId?(d(),m("button",{key:2,class:"session-link-btn",title:"Vai alla sessione",onClick:e[6]||(e[6]=Q(s=>a.$router.push(`/sessioni/${r.value.bestRaceSessionId}`),["stop"]))},[...e[20]||(e[20]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),t("polyline",{points:"15 3 21 3 21 9"}),t("line",{x1:"10",y1:"14",x2:"21",y2:"3"})],-1)])])):R("",!0)]),t("div",Pe,[e[24]||(e[24]=t("span",{class:"time-label"},"Best Stint Avg Race",-1)),t("span",Be,o(r.value.bestAvgRace||"—:—.---"),1),r.value.bestAvgRaceConditions?(d(),m("span",Le,[t("span",null,o(I(r.value.bestAvgRaceDate)),1),e[22]||(e[22]=t("span",{class:"condition-sep"},"•",-1)),t("span",null,o(r.value.bestAvgRaceConditions.airTemp)+"°C",1)])):r.value.bestAvgRace?R("",!0):(d(),m("span",Me,"Nessun dato per "+o(h.value),1)),r.value.bestAvgRaceSessionId?(d(),m("button",{key:2,class:"session-link-btn",title:"Vai alla sessione",onClick:e[7]||(e[7]=Q(s=>a.$router.push(`/sessioni/${r.value.bestAvgRaceSessionId}`),["stop"]))},[...e[23]||(e[23]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),t("polyline",{points:"15 3 21 3 21 9"}),t("line",{x1:"10",y1:"14",x2:"21",y2:"3"})],-1)])])):R("",!0)])])]),t("div",Ne,[e[28]||(e[28]=t("h2",{class:"section-title"},"Attività Totale",-1)),t("div",Qe,[t("div",Ae,[t("span",$e,o(f.value.totalLaps),1),e[25]||(e[25]=t("span",{class:"activity-label"},"Giri Totali",-1))]),t("div",De,[t("span",ze,o(f.value.validLaps),1),t("span",Ge,"Giri Validi ("+o(f.value.validPercent)+"%)",1)]),t("div",Fe,[t("span",Ee,o(f.value.totalTimeFormatted),1),e[26]||(e[26]=t("span",{class:"activity-label"},"Tempo in Pista",-1))]),t("div",Ve,[t("span",qe,o(f.value.sessionCount),1),e[27]||(e[27]=t("span",{class:"activity-label"},"Sessioni",-1))])])])])])]),_:1})}}}),Ke=Object.assign(Tt(Ue,[["__scopeId","data-v-178212af"]]),{__name:"PagesTrackDetailPage"});export{Ke as _};
