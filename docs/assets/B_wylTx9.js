import{_ as A}from"./6k9Wj4MA.js";import{b as P,a as V,r as g,m as B,o as E,C as r,D as i,E as t,F as n,K as b,a4 as F,a6 as O,I as v,a7 as q,O as z,P as G,a8 as D,U as y,R as N,a9 as w,V as I,J as H,H as R,N as J,Z as K,_ as Q}from"./cwvVFwCY.js";const Y={class:"piloti-page"},Z={class:"page-title"},j={class:"page-header"},W={class:"page-subtitle"},X={class:"search-box"},ss={key:0,class:"state-box"},es={key:1,class:"state-box state-box--empty"},as={key:2,class:"state-box"},ts={key:3,class:"pilots-list"},ns={class:"lr-name"},os={class:"pilot-avatar"},is={class:"lr-nickname"},ls={class:"lr-sessions"},rs={class:"lr-last"},cs=P({__name:"index",setup(us){const{currentUser:f,isAdmin:d}=V(),c=g([]),k=g(!0),u=g(""),x=B(()=>{if(!u.value.trim())return c.value;const s=u.value.toLowerCase();return c.value.filter(e=>{const l=`${e.firstName||""} ${e.lastName||""}`.toLowerCase(),a=(e.nickname||"").toLowerCase(),h=(e.email||"").toLowerCase();return l.includes(s)||a.includes(s)||h.includes(s)})}),S=async()=>{if(f.value)try{let s;d.value?s=D(y(N,"users")):s=D(y(N,"users"),w("role","==","pilot"),w("coachId","==",f.value.uid));const l=(await I(s)).docs.filter(o=>o.id!==f.value?.uid).map(o=>({uid:o.id,...o.data()})),a=new Date;a.setDate(a.getDate()-7);const h=a.toISOString();for(const o of l)try{const _=y(N,`users/${o.uid}/sessions`),T=await I(_);let m,C=0;T.docs.forEach(U=>{const p=U.data().meta?.date_start;p&&((!m||p>m)&&(m=p),p>=h&&C++)}),o.lastSession=m,o.totalSessions=C}catch(_){console.warn(`Could not fetch sessions for pilot ${o.uid}:`,_)}c.value=l}catch(s){console.error("Error fetching pilots:",s)}finally{k.value=!1}};function $(s){return s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.nickname}function L(s){return s.firstName&&s.lastName?`${s.firstName[0]}${s.lastName[0]}`.toUpperCase():s.nickname.slice(0,2).toUpperCase()}function M(s){if(!s)return"Mai attivo";const e=new Date(s);return`${e.getDate()} ${["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"][e.getMonth()]} ${e.getFullYear()}`}return E(()=>{S()}),(s,e)=>{const l=A;return i(),r("div",Y,[t("h1",Z,n(b(d)?"TUTTI GLI UTENTI":"I MIEI PILOTI"),1),t("div",j,[t("p",W,n(c.value.length)+" "+n(b(d)?"utenti":"piloti assegnati"),1),t("div",X,[e[1]||(e[1]=t("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("circle",{cx:"11",cy:"11",r:"8"}),t("path",{d:"M21 21l-4.35-4.35"})],-1)),F(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),type:"text",placeholder:"Cerca pilota...",class:"search-input"},null,512),[[O,u.value]])])]),k.value?(i(),r("div",ss," Caricamento piloti... ")):c.value.length===0?(i(),r("div",es,[...e[2]||(e[2]=[t("p",null,"Nessun pilota assegnato",-1),t("small",null,[v("Per assegnare un pilota, vai nella Firebase Console e aggiungi il campo "),t("code",null,"coachId"),v(" con il tuo UID al documento del pilota.")],-1)])])):x.value.length===0?(i(),r("div",as,' Nessun pilota trovato per "'+n(u.value)+'" ',1)):(i(),r("div",ts,[e[4]||(e[4]=q('<div class="list-header" data-v-ba144c5b><span class="lh-name" data-v-ba144c5b>Pilota</span><span class="lh-nickname" data-v-ba144c5b>Nickname</span><span class="lh-sessions" data-v-ba144c5b>Sessioni (7gg)</span><span class="lh-last" data-v-ba144c5b>Ultima attivit√†</span><span class="lh-cta" data-v-ba144c5b></span></div>',1)),(i(!0),r(z,null,G(x.value,a=>(i(),H(l,{key:a.uid,to:`/piloti/${a.uid}`,class:"list-row"},{default:R(()=>[t("span",ns,[t("span",os,n(L(a)),1),v(" "+n($(a))+" ",1),b(d)&&a.role?(i(),r("span",{key:0,class:K(["role-badge",`role-badge--${a.role}`])},n(a.role==="coach"?"COACH":"PILOT"),3)):J("",!0)]),t("span",is,n(a.nickname),1),t("span",ls,n(a.totalSessions||0),1),t("span",rs,n(M(a.lastSession)),1),e[3]||(e[3]=t("span",{class:"lr-cta"},[v(" Visualizza "),t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})])],-1))]),_:2},1032,["to"]))),128))]))])}}}),vs=Q(cs,[["__scopeId","data-v-ba144c5b"]]);export{vs as default};
