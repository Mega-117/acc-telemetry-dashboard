import{_ as M}from"./CfmObcn-.js";import{b as B,a as F,r as h,t as P,o as U,E as r,F as i,G as e,H as l,a1 as V,a2 as q,K as m,a3 as A,P as E,Q as G,a4 as O,V as N,S as x,a5 as D,W as w,L as T,J as z,_ as Q}from"./Bf400IeT.js";const H={class:"piloti-page"},J={class:"page-header"},K={class:"page-subtitle"},R={class:"search-box"},W={key:0,class:"state-box"},Y={key:1,class:"state-box state-box--empty"},j={key:2,class:"state-box"},X={key:3,class:"pilots-list"},Z={class:"lr-name"},ss={class:"pilot-avatar"},as={class:"lr-nickname"},es={class:"lr-sessions"},ts={class:"lr-last"},ns=B({__name:"index",setup(os){const{currentUser:_}=F(),c=h([]),g=h(!0),d=h(""),y=P(()=>{if(!d.value.trim())return c.value;const s=d.value.toLowerCase();return c.value.filter(a=>{const n=`${a.firstName||""} ${a.lastName||""}`.toLowerCase(),t=(a.nickname||"").toLowerCase(),f=(a.email||"").toLowerCase();return n.includes(s)||t.includes(s)||f.includes(s)})}),S=async()=>{if(_.value)try{const s=O(N(x,"users"),D("role","==","pilot"),D("coachId","==",_.value.uid)),n=(await w(s)).docs.map(o=>({uid:o.id,...o.data()})),t=new Date;t.setDate(t.getDate()-7);const f=t.toISOString();for(const o of n)try{const v=N(x,`users/${o.uid}/sessions`),I=await w(v);let u,k=0;I.docs.forEach(L=>{const p=L.data().meta?.date_start;p&&((!u||p>u)&&(u=p),p>=f&&k++)}),o.lastSession=u,o.totalSessions=k}catch(v){console.warn(`Could not fetch sessions for pilot ${o.uid}:`,v)}c.value=n}catch(s){console.error("Error fetching pilots:",s)}finally{g.value=!1}};function C(s){return s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.nickname}function $(s){return s.firstName&&s.lastName?`${s.firstName[0]}${s.lastName[0]}`.toUpperCase():s.nickname.slice(0,2).toUpperCase()}function b(s){if(!s)return"Mai attivo";const a=new Date(s);return`${a.getDate()} ${["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"][a.getMonth()]} ${a.getFullYear()}`}return U(()=>{S()}),(s,a)=>{const n=M;return i(),r("div",H,[a[5]||(a[5]=e("h1",{class:"page-title"},"I MIEI PILOTI",-1)),e("div",J,[e("p",K,l(c.value.length)+" piloti assegnati",1),e("div",R,[a[1]||(a[1]=e("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"M21 21l-4.35-4.35"})],-1)),V(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>d.value=t),type:"text",placeholder:"Cerca pilota...",class:"search-input"},null,512),[[q,d.value]])])]),g.value?(i(),r("div",W," Caricamento piloti... ")):c.value.length===0?(i(),r("div",Y,[...a[2]||(a[2]=[e("p",null,"Nessun pilota assegnato",-1),e("small",null,[m("Per assegnare un pilota, vai nella Firebase Console e aggiungi il campo "),e("code",null,"coachId"),m(" con il tuo UID al documento del pilota.")],-1)])])):y.value.length===0?(i(),r("div",j,' Nessun pilota trovato per "'+l(d.value)+'" ',1)):(i(),r("div",X,[a[4]||(a[4]=A('<div class="list-header" data-v-16863fad><span class="lh-name" data-v-16863fad>Pilota</span><span class="lh-nickname" data-v-16863fad>Nickname</span><span class="lh-sessions" data-v-16863fad>Sessioni (7gg)</span><span class="lh-last" data-v-16863fad>Ultima attivit√†</span><span class="lh-cta" data-v-16863fad></span></div>',1)),(i(!0),r(E,null,G(y.value,t=>(i(),T(n,{key:t.uid,to:`/piloti/${t.uid}`,class:"list-row"},{default:z(()=>[e("span",Z,[e("span",ss,l($(t)),1),m(" "+l(C(t)),1)]),e("span",as,l(t.nickname),1),e("span",es,l(t.totalSessions||0),1),e("span",ts,l(b(t.lastSession)),1),a[3]||(a[3]=e("span",{class:"lr-cta"},[m(" Visualizza "),e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 18l6-6-6-6"})])],-1))]),_:2},1032,["to"]))),128))]))])}}}),cs=Q(ns,[["__scopeId","data-v-16863fad"]]);export{cs as default};
