import{_ as L}from"./CLtjru87.js";import{b as E,a2 as D,r as w,o as F,w as G,t as B,a4 as k,L as O,F as l,J as U,G as t,E as c,H as n,a0 as m,Q as S,R as C,M as $,K as _,_ as A}from"./CnFtmtvV.js";import{u as N}from"./Igb2YE-7.js";import{u as H}from"./MSNWjQBY.js";const j={class:"page-header"},V={class:"page-subtitle"},Z={class:"view-toggle"},q={key:0,class:"tracks-grid"},J=["onClick"],K={class:"card-image-section"},W=["src","alt"],Y={key:1,class:"card-image-placeholder"},X={class:"card-content"},ss={class:"track-name"},ts={class:"track-stats"},es={class:"track-sessions"},as={class:"track-last"},ns={class:"track-times"},os={key:1,class:"tracks-list"},is=["onClick"],rs={class:"lr-name"},ls={class:"lr-country"},cs={class:"lr-sessions"},ms={class:"lr-last"},us=E({__name:"PistePage",emits:["go-to-track"],setup(gs,{emit:P}){const{getPublicPath:x}=N(),M=P,{trackStats:h,loadSessions:R,getTrackBests:T,isPrefetchComplete:Q}=D(),y=H(),p=w({});F(async()=>{await R(y.value||void 0)}),G([h,Q],async([a,s])=>{if(!s){console.log("[PISTE] Waiting for prefetch to complete...");return}if(a.length>0){for(const o of a){const e=o.track.toLowerCase().replace(/[^a-z0-9]/g,"_");try{const i=(await T(e,y.value||void 0))?.Optimum;p.value[e]={bestQualy:i?.bestQualy||null,bestRace:i?.bestRace||null}}catch(r){console.warn(`[PISTE] Failed to load trackBests for ${e}:`,r)}}console.log("[PISTE] trackBests loaded (all cache hits):",Object.keys(p.value).length,"tracks")}},{immediate:!0});const u=w("card"),z={monza:{name:"Monza",country:"IT",length:"5.793 km",image:"/tracks/track_monza.png"},donington:{name:"Donington Park",country:"GB",length:"4.020 km",image:"/tracks/track_donington.png"},spa:{name:"Spa-Francorchamps",country:"BE",length:"7.004 km",image:"/tracks/track_spa.png"},paul_ricard:{name:"Paul Ricard",country:"FR",length:"5.842 km",image:"/tracks/track_paul_ricard.png"},valencia:{name:"Valencia",country:"ES",length:"4.005 km",image:"/tracks/track_valencia.png"},barcelona:{name:"Barcelona-Catalunya",country:"ES",length:"4.655 km",image:"/tracks/track_barcelona.png"},brands_hatch:{name:"Brands Hatch",country:"GB",length:"3.908 km",image:"/tracks/track_brands_hatch.png"},hungaroring:{name:"Hungaroring",country:"HU",length:"4.381 km",image:"/tracks/track_hungaroring.png"},imola:{name:"Imola",country:"IT",length:"4.909 km",image:"/tracks/track_imola.png"},kyalami:{name:"Kyalami",country:"ZA",length:"4.522 km",image:"/tracks/track_kyalami.png"},laguna_seca:{name:"Laguna Seca",country:"US",length:"3.602 km",image:"/tracks/track_laguna_seca.png"},misano:{name:"Misano",country:"IT",length:"4.226 km",image:"/tracks/track_misano.png"},mount_panorama:{name:"Mount Panorama",country:"AU",length:"6.213 km",image:"/tracks/track_mount_panorama.png"},nurburgring:{name:"NÃ¼rburgring",country:"DE",length:"5.148 km",image:"/tracks/track_nurburgring.png"},oulton_park:{name:"Oulton Park",country:"GB",length:"4.307 km",image:"/tracks/track_oulton_park.png"},silverstone:{name:"Silverstone",country:"GB",length:"5.891 km",image:"/tracks/track_silverstone.png"},snetterton:{name:"Snetterton",country:"GB",length:"4.779 km",image:"/tracks/track_snetterton.png"},suzuka:{name:"Suzuka",country:"JP",length:"5.807 km",image:"/tracks/track_suzuka.png"},watkins_glen:{name:"Watkins Glen",country:"US",length:"5.472 km",image:"/tracks/track_watkins_glen.png"},zandvoort:{name:"Zandvoort",country:"NL",length:"4.259 km",image:"/tracks/track_zandvoort.png"},zolder:{name:"Zolder",country:"BE",length:"4.011 km",image:"/tracks/track_zolder.png"},cota:{name:"COTA",country:"US",length:"5.513 km",image:"/tracks/track_cota.png"},indianapolis:{name:"Indianapolis",country:"US",length:"4.192 km",image:"/tracks/track_indianapolis.png"},red_bull_ring:{name:"Red Bull Ring",country:"AT",length:"4.318 km",image:"/tracks/track_red_bull_ring.png"}},I=B(()=>{const a=Object.entries(z).map(([s,o])=>({id:s,...o,sessions:0,lastSession:void 0,lastSessionFull:void 0,bestQualy:void 0,bestRace:void 0}));for(const s of h.value){const o=s.track.toLowerCase().replace(/[^a-z0-9]/g,"_"),e=a.find(f=>f.id===o||f.name.toLowerCase()===s.track.toLowerCase()),r=p.value[o],i=r?.bestQualy,g=r?.bestRace;(s.track.toLowerCase().includes("valencia")||s.track.toLowerCase().includes("suzuka"))&&console.log(`[PISTE DEBUG] ${s.track}:`,{trackBestsSource:"trackBestsMap (getTrackBests)",optimumBestQualy:i,optimumBestRace:g,oldBestByGrip:s.bestByGrip?.Optimum}),e?(e.sessions=s.sessions,e.lastSession=s.lastSession?.split("T")[0],e.lastSessionFull=s.lastSession,e.bestQualy=i?k(i):void 0,e.bestRace=g?k(g):void 0):a.push({id:o,name:s.track,country:"??",length:"?.??? km",image:void 0,sessions:s.sessions,lastSession:s.lastSession?.split("T")[0],lastSessionFull:s.lastSession,bestQualy:i?k(i):void 0,bestRace:g?k(g):void 0})}return a}),d=B(()=>[...I.value].sort((a,s)=>a.sessions>0&&s.sessions>0?(s.lastSessionFull||"").localeCompare(a.lastSessionFull||""):a.sessions>0&&s.sessions===0?-1:a.sessions===0&&s.sessions>0?1:a.name.localeCompare(s.name)));function v(a){if(!a)return"Nessuna sessione";const s=new Date(a),o=s.getDate(),r=["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"][s.getMonth()],i=s.getFullYear();return`${o} ${r} ${i}`}function b(a){M("go-to-track",a)}return(a,s)=>{const o=L;return l(),O(o,null,{default:U(()=>[s[9]||(s[9]=t("h1",{class:"page-title"},"PISTE",-1)),t("div",j,[t("p",V,n(d.value.filter(e=>e.sessions>0).length)+" piste visitate su "+n(d.value.length)+" totali",1),t("div",Z,[t("button",{class:m(["view-btn",{"view-btn--active":u.value==="card"}]),onClick:s[0]||(s[0]=e=>u.value="card"),title:"Card"},[...s[2]||(s[2]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),t("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1"}),t("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1"}),t("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"})],-1)])],2),t("button",{class:m(["view-btn",{"view-btn--active":u.value==="list"}]),onClick:s[1]||(s[1]=e=>u.value="list"),title:"Lista"},[...s[3]||(s[3]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"})],-1)])],2)])]),u.value==="card"?(l(),c("div",q,[(l(!0),c(S,null,C(d.value,e=>(l(),c("div",{key:e.id,class:m(["track-card",{"track-card--unplayed":e.sessions===0}]),onClick:r=>b(e.id)},[t("div",K,[e.image?(l(),c("img",{key:0,src:$(x)(e.image),alt:e.name,class:"card-track-image"},null,8,W)):(l(),c("div",Y,[...s[4]||(s[4]=[t("span",{class:"placeholder-icon"},"ðŸ",-1)])]))]),t("div",X,[t("h3",ss,n(e.name),1),t("div",ts,[t("span",es,n(e.sessions)+" sessioni",1),s[5]||(s[5]=t("span",{class:"track-separator"},"Â·",-1)),t("span",as,n(v(e.lastSession)),1)]),t("div",ns,[t("span",{class:m(["time-badge","time-badge--qualy",{"time-badge--empty":!e.bestQualy}])}," Q "+n(e.bestQualy||"â€”:â€”.---"),3),t("span",{class:m(["time-badge","time-badge--race",{"time-badge--empty":!e.bestRace}])}," R "+n(e.bestRace||"â€”:â€”.---"),3)]),s[6]||(s[6]=t("button",{class:"track-cta"},[_(" Dettaglio pista "),t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})])],-1))])],10,J))),128))])):(l(),c("div",os,[s[8]||(s[8]=t("div",{class:"list-header"},[t("span",{class:"lh-name"},"Pista"),t("span",{class:"lh-sessions"},"Sessioni"),t("span",{class:"lh-last"},"Ultima sessione"),t("span",{class:"lh-best"},"Best Q"),t("span",{class:"lh-best"},"Best R"),t("span",{class:"lh-cta"})],-1)),(l(!0),c(S,null,C(d.value,e=>(l(),c("div",{key:e.id,class:m(["list-row",{"list-row--unplayed":e.sessions===0}]),onClick:r=>b(e.id)},[t("span",rs,[t("span",ls,n(e.country),1),_(" "+n(e.name),1)]),t("span",cs,n(e.sessions),1),t("span",ms,n(v(e.lastSession)),1),t("span",{class:m(["lr-time","lr-time--qualy",{"lr-time--empty":!e.bestQualy}])}," Q "+n(e.bestQualy||"â€”:â€”.---"),3),t("span",{class:m(["lr-time","lr-time--race",{"lr-time--empty":!e.bestRace}])}," R "+n(e.bestRace||"â€”:â€”.---"),3),s[7]||(s[7]=t("span",{class:"lr-cta"},[_(" Dettaglio "),t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})])],-1))],10,is))),128))]))]),_:1})}}}),hs=Object.assign(A(us,[["__scopeId","data-v-43d61703"]]),{__name:"PagesPistePage"});export{hs as _};
