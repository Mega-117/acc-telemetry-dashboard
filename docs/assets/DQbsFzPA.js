import{_ as zn}from"./__LTA1r6.js";import{b as gn,a2 as zs,a as _n,r as z,t as E,a5 as Y,a7 as bn,a6 as yn,af as Sn,L as Tn,F as _,ao as Cn,E as b,P as Z,ab as kt,G as a,H as g,M as ns,a4 as Fn,a8 as Un,ac as Gn,ap as Qn,Q as O,R as Se,a0 as H,_ as En,o as Hn,aq as Vn,ar as Yn,w as Ns,a3 as Wn,I as ys,J as en,as as Zn,K as V,$ as ss}from"./RDT9ORhv.js";import{f as ut,g as de,h as Ys,v as Ts,j as tn,s as sn,_ as Xn,C as qn,a as jn,L as Kn,P as Jn,b as ea,p as ta,c as sa,d as na,i as aa,e as ia}from"./CxKvuDNN.js";import{u as oa}from"./BEiCzbAc.js";const la={class:"session-picker-modal"},ra={class:"spm-header"},ua={class:"spm-subtitle"},ca={class:"spm-link-section"},da={class:"link-input-row"},pa=["disabled"],va={key:0,class:"link-error"},fa={class:"spm-list"},ma=["onClick"],ha={class:"row-left"},ga={class:"session-date"},_a={class:"session-time"},ba={class:"session-car"},ya={class:"row-right"},Sa={class:"stat-chips"},Ta={class:"stat-chip"},Ca={class:"stat-chip"},Ea={class:"time-slot"},ka={key:0,class:"time-badge time-badge--qualy"},Aa={key:1,class:"time-badge time-badge--qualy time-badge--empty"},xa={class:"time-slot"},Ma={key:0,class:"time-badge time-badge--race"},Ia={key:1,class:"time-badge time-badge--race time-badge--empty"},La={key:0,class:"spm-empty"},Ra=gn({__name:"SessionPickerModal",props:{isOpen:{type:Boolean},currentTrack:{},excludeSessionId:{}},emits:["close","select"],setup(e,{emit:l}){const r=e,p=l,{sessions:d,fetchSessionFull:f}=zs(),{getUserProfile:y}=_n(),T=z(""),k=z(""),x=z(!1);function R(ae){const M=ae.match(/\/sessioni\/([^?]+)\?userId=([^&]+)/);return M&&M[1]&&M[2]?{sessionId:M[1],userId:M[2]}:null}async function U(){k.value="";const ae=R(T.value);if(!ae){k.value="Link non valido. Formato atteso: .../sessioni/ID?userId=...";return}x.value=!0;try{const M=await f(ae.sessionId,ae.userId);if(!M){k.value="Sessione non trovata o non piÃ¹ condivisa";return}const q=(M.session_info?.track||"").toLowerCase().replace(/[^a-z0-9]/g,"_"),Ye=r.currentTrack.toLowerCase().replace(/[^a-z0-9]/g,"_");if(!q.includes(Ye)&&!Ye.includes(q)){k.value=`Pista non corrispondente: ${M.session_info?.track||"sconosciuta"} vs ${r.currentTrack}`;return}let dt="Utente Esterno";try{const We=await y(ae.userId);dt=We?.nickname||We?.displayName||"Utente Esterno"}catch{}p("select",ae.sessionId,ae.userId,dt),p("close")}catch(M){console.error("[SHARE] Error loading shared session:",M),k.value=M?.code==="permission-denied"?"Sessione non piÃ¹ condivisa o accesso negato":"Errore nel caricamento della sessione"}finally{x.value=!1}}const W=E(()=>{const ae=r.currentTrack.toLowerCase().replace(/[^a-z0-9]/g,"_");return d.value.filter(M=>{if(M.sessionId===r.excludeSessionId)return!1;const q=M.meta.track.toLowerCase().replace(/[^a-z0-9]/g,"_");return q.includes(ae)||ae.includes(q)}).map(M=>({id:M.sessionId,date:X(M.meta.date_start),time:Sn(M.meta.date_start),type:yn(M.meta.session_type),car:bn(M.meta.car),laps:M.summary.laps||0,stints:M.summary.stintCount||1,bestQualy:M.summary.best_qualy_ms?Y(M.summary.best_qualy_ms):null,bestRace:M.summary.best_race_ms?Y(M.summary.best_race_ms):null}))});function X(ae){if(!ae)return"-";const M=new Date(ae);return`${M.getDate()} ${["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"][M.getMonth()]} ${M.getFullYear()}`}function Ge(ae){return{practice:"PRACTICE",qualify:"QUALIFY",race:"RACE"}[ae]||ae.toUpperCase()}function be(ae){p("select",ae),p("close")}function ct(){p("close")}return(ae,M)=>(_(),Tn(Cn,{to:"body"},[e.isOpen?(_(),b("div",{key:0,class:"session-picker-overlay",onClick:kt(ct,["self"])},[a("div",la,[a("div",ra,[M[1]||(M[1]=a("h2",{class:"spm-title"},"Aggiungi Sorgente Dati",-1)),a("p",ua,g(ns(Fn)(e.currentTrack))+" Â· "+g(W.value.length)+" sessioni disponibili",1),a("button",{class:"spm-close",onClick:ct},"âœ•")]),a("div",ca,[M[2]||(M[2]=a("label",{class:"link-label"},"ðŸ“‹ Incolla link sessione condivisa",-1)),a("div",da,[Un(a("input",{"onUpdate:modelValue":M[0]||(M[0]=q=>T.value=q),type:"text",class:"link-input",placeholder:"https://...?userId=...",onKeyup:Qn(U,["enter"])},null,544),[[Gn,T.value]]),a("button",{class:"link-load-btn",disabled:x.value||!T.value,onClick:U},g(x.value?"...":"Carica"),9,pa)]),k.value?(_(),b("p",va,g(k.value),1)):Z("",!0)]),M[3]||(M[3]=a("div",{class:"spm-divider"},[a("span",null,"oppure seleziona dalle tue sessioni")],-1)),a("div",fa,[(_(!0),b(O,null,Se(W.value,q=>(_(),b("div",{key:q.id,class:"session-row",onClick:Ye=>be(q.id)},[a("div",ha,[a("span",{class:H(["session-chip",`session-chip--${q.type}`])},g(Ge(q.type)),3),a("span",ga,g(q.date),1),a("span",_a,g(q.time),1),a("span",ba,g(q.car),1)]),a("div",ya,[a("div",Sa,[a("span",Ta,"GIRI "+g(q.laps),1),a("span",Ca,"STINT "+g(q.stints),1)]),a("div",Ea,[q.bestQualy?(_(),b("span",ka," Q "+g(q.bestQualy),1)):(_(),b("span",Aa," Q â€” "))]),a("div",xa,[q.bestRace?(_(),b("span",Ma," R "+g(q.bestRace),1)):(_(),b("span",Ia," R â€” "))])])],8,ma))),128)),W.value.length===0?(_(),b("div",La," Nessuna altra sessione disponibile per questa pista. ")):Z("",!0)])])])):Z("",!0)]))}}),Pa=Object.assign(En(Ra,[["__scopeId","data-v-72b43332"]]),{__name:"UiSessionPickerModal"});function Oa(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ws={exports:{}};var nn;function Da(){return nn||(nn=1,(function(e){(function(l,r,p,d){var f=["","webkit","Moz","MS","ms","o"],y=r.createElement("div"),T="function",k=Math.round,x=Math.abs,R=Date.now;function U(t,n,u){return setTimeout(q(t,u),n)}function W(t,n,u){return Array.isArray(t)?(X(t,u[n],u),!0):!1}function X(t,n,u){var v;if(t)if(t.forEach)t.forEach(n,u);else if(t.length!==d)for(v=0;v<t.length;)n.call(u,t[v],v,t),v++;else for(v in t)t.hasOwnProperty(v)&&n.call(u,t[v],v,t)}function Ge(t,n,u){var v="DEPRECATED METHOD: "+n+`
`+u+` AT 
`;return function(){var S=new Error("get-stack-trace"),C=S&&S.stack?S.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",B=l.console&&(l.console.warn||l.console.log);return B&&B.call(l.console,v,C),t.apply(this,arguments)}}var be;typeof Object.assign!="function"?be=function(n){if(n===d||n===null)throw new TypeError("Cannot convert undefined or null to object");for(var u=Object(n),v=1;v<arguments.length;v++){var S=arguments[v];if(S!==d&&S!==null)for(var C in S)S.hasOwnProperty(C)&&(u[C]=S[C])}return u}:be=Object.assign;var ct=Ge(function(n,u,v){for(var S=Object.keys(u),C=0;C<S.length;)(!v||v&&n[S[C]]===d)&&(n[S[C]]=u[S[C]]),C++;return n},"extend","Use `assign`."),ae=Ge(function(n,u){return ct(n,u,!0)},"merge","Use `assign`.");function M(t,n,u){var v=n.prototype,S;S=t.prototype=Object.create(v),S.constructor=t,S._super=v,u&&be(S,u)}function q(t,n){return function(){return t.apply(n,arguments)}}function Ye(t,n){return typeof t==T?t.apply(n&&n[0]||d,n):t}function dt(t,n){return t===d?n:t}function We(t,n,u){X(Ke(n),function(v){t.addEventListener(v,u,!1)})}function xt(t,n,u){X(Ke(n),function(v){t.removeEventListener(v,u,!1)})}function ls(t,n){for(;t;){if(t==n)return!0;t=t.parentNode}return!1}function je(t,n){return t.indexOf(n)>-1}function Ke(t){return t.trim().split(/\s+/g)}function Ze(t,n,u){if(t.indexOf&&!u)return t.indexOf(n);for(var v=0;v<t.length;){if(u&&t[v][u]==n||!u&&t[v]===n)return v;v++}return-1}function Xe(t){return Array.prototype.slice.call(t,0)}function Mt(t,n,u){for(var v=[],S=[],C=0;C<t.length;){var B=t[C][n];Ze(S,B)<0&&v.push(t[C]),S[C]=B,C++}return v=v.sort(function(K,ie){return K[n]>ie[n]}),v}function Je(t,n){for(var u,v,S=n[0].toUpperCase()+n.slice(1),C=0;C<f.length;){if(u=f[C],v=u?u+S:n,v in t)return v;C++}return d}var Cs=1;function Vt(){return Cs++}function rs(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||l}var Yt=/mobile|tablet|ip(ad|hone|od)|android/i,Ae="ontouchstart"in l,ve=Je(l,"PointerEvent")!==d,qe=Ae&&Yt.test(navigator.userAgent),xe="touch",It="pen",pt="mouse",fe="kinect",vt=25,me=1,Qe=2,ue=4,Te=8,Lt=1,ft=2,D=4,I=8,mt=16,G=ft|D,F=I|mt,w=G|F,ht=["x","y"],Rt=["clientX","clientY"];function Me(t,n){var u=this;this.manager=t,this.callback=n,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(v){Ye(t.options.enable,[t])&&u.handler(v)},this.init()}Me.prototype={handler:function(){},init:function(){this.evEl&&We(this.element,this.evEl,this.domHandler),this.evTarget&&We(this.target,this.evTarget,this.domHandler),this.evWin&&We(rs(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&xt(this.element,this.evEl,this.domHandler),this.evTarget&&xt(this.target,this.evTarget,this.domHandler),this.evWin&&xt(rs(this.element),this.evWin,this.domHandler)}};function us(t){var n,u=t.options.inputClass;return u?n=u:ve?n=Nt:qe?n=_t:Ae?n=Kt:n=gt,new n(t,Wt)}function Wt(t,n,u){var v=u.pointers.length,S=u.changedPointers.length,C=n&me&&v-S===0,B=n&(ue|Te)&&v-S===0;u.isFirst=!!C,u.isFinal=!!B,C&&(t.session={}),u.eventType=n,j(t,u),t.emit("hammer.input",u),t.recognize(u),t.session.prevInput=u}function j(t,n){var u=t.session,v=n.pointers,S=v.length;u.firstInput||(u.firstInput=Zt(n)),S>1&&!u.firstMultiple?u.firstMultiple=Zt(n):S===1&&(u.firstMultiple=!1);var C=u.firstInput,B=u.firstMultiple,pe=B?B.center:C.center,K=n.center=cs(v);n.timeStamp=R(),n.deltaTime=n.timeStamp-C.timeStamp,n.angle=Xt(pe,K),n.distance=at(pe,K),Pt(u,n),n.offsetDirection=ne(n.deltaX,n.deltaY);var ie=se(n.deltaTime,n.deltaX,n.deltaY);n.overallVelocityX=ie.x,n.overallVelocityY=ie.y,n.overallVelocity=x(ie.x)>x(ie.y)?ie.x:ie.y,n.scale=B?ds(B.pointers,v):1,n.rotation=B?ks(B.pointers,v):0,n.maxPointers=u.prevInput?n.pointers.length>u.prevInput.maxPointers?n.pointers.length:u.prevInput.maxPointers:n.pointers.length,Es(u,n);var Ue=t.element;ls(n.srcEvent.target,Ue)&&(Ue=n.srcEvent.target),n.target=Ue}function Pt(t,n){var u=n.center,v=t.offsetDelta||{},S=t.prevDelta||{},C=t.prevInput||{};(n.eventType===me||C.eventType===ue)&&(S=t.prevDelta={x:C.deltaX||0,y:C.deltaY||0},v=t.offsetDelta={x:u.x,y:u.y}),n.deltaX=S.x+(u.x-v.x),n.deltaY=S.y+(u.y-v.y)}function Es(t,n){var u=t.lastInterval||n,v=n.timeStamp-u.timeStamp,S,C,B,pe;if(n.eventType!=Te&&(v>vt||u.velocity===d)){var K=n.deltaX-u.deltaX,ie=n.deltaY-u.deltaY,Ue=se(v,K,ie);C=Ue.x,B=Ue.y,S=x(Ue.x)>x(Ue.y)?Ue.x:Ue.y,pe=ne(K,ie),t.lastInterval=n}else S=u.velocity,C=u.velocityX,B=u.velocityY,pe=u.direction;n.velocity=S,n.velocityX=C,n.velocityY=B,n.direction=pe}function Zt(t){for(var n=[],u=0;u<t.pointers.length;)n[u]={clientX:k(t.pointers[u].clientX),clientY:k(t.pointers[u].clientY)},u++;return{timeStamp:R(),pointers:n,center:cs(n),deltaX:t.deltaX,deltaY:t.deltaY}}function cs(t){var n=t.length;if(n===1)return{x:k(t[0].clientX),y:k(t[0].clientY)};for(var u=0,v=0,S=0;S<n;)u+=t[S].clientX,v+=t[S].clientY,S++;return{x:k(u/n),y:k(v/n)}}function se(t,n,u){return{x:n/t||0,y:u/t||0}}function ne(t,n){return t===n?Lt:x(t)>=x(n)?t<0?ft:D:n<0?I:mt}function at(t,n,u){u||(u=ht);var v=n[u[0]]-t[u[0]],S=n[u[1]]-t[u[1]];return Math.sqrt(v*v+S*S)}function Xt(t,n,u){u||(u=ht);var v=n[u[0]]-t[u[0]],S=n[u[1]]-t[u[1]];return Math.atan2(S,v)*180/Math.PI}function ks(t,n){return Xt(n[1],n[0],Rt)+Xt(t[1],t[0],Rt)}function ds(t,n){return at(n[0],n[1],Rt)/at(t[0],t[1],Rt)}var qt={mousedown:me,mousemove:Qe,mouseup:ue},Ot="mousedown",ps="mousemove mouseup";function gt(){this.evEl=Ot,this.evWin=ps,this.pressed=!1,Me.apply(this,arguments)}M(gt,Me,{handler:function(n){var u=qt[n.type];u&me&&n.button===0&&(this.pressed=!0),u&Qe&&n.which!==1&&(u=ue),this.pressed&&(u&ue&&(this.pressed=!1),this.callback(this.manager,u,{pointers:[n],changedPointers:[n],pointerType:pt,srcEvent:n}))}});var vs={pointerdown:me,pointermove:Qe,pointerup:ue,pointercancel:Te,pointerout:Te},fs={2:xe,3:It,4:pt,5:fe},jt="pointerdown",Dt="pointermove pointerup pointercancel";l.MSPointerEvent&&!l.PointerEvent&&(jt="MSPointerDown",Dt="MSPointerMove MSPointerUp MSPointerCancel");function Nt(){this.evEl=jt,this.evWin=Dt,Me.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}M(Nt,Me,{handler:function(n){var u=this.store,v=!1,S=n.type.toLowerCase().replace("ms",""),C=vs[S],B=fs[n.pointerType]||n.pointerType,pe=B==xe,K=Ze(u,n.pointerId,"pointerId");C&me&&(n.button===0||pe)?K<0&&(u.push(n),K=u.length-1):C&(ue|Te)&&(v=!0),!(K<0)&&(u[K]=n,this.callback(this.manager,C,{pointers:u,changedPointers:[n],pointerType:B,srcEvent:n}),v&&u.splice(K,1))}});var As={touchstart:me,touchmove:Qe,touchend:ue,touchcancel:Te},xs="touchstart",Ms="touchstart touchmove touchend touchcancel";function ms(){this.evTarget=xs,this.evWin=Ms,this.started=!1,Me.apply(this,arguments)}M(ms,Me,{handler:function(n){var u=As[n.type];if(u===me&&(this.started=!0),!!this.started){var v=Is.call(this,n,u);u&(ue|Te)&&v[0].length-v[1].length===0&&(this.started=!1),this.callback(this.manager,u,{pointers:v[0],changedPointers:v[1],pointerType:xe,srcEvent:n})}}});function Is(t,n){var u=Xe(t.touches),v=Xe(t.changedTouches);return n&(ue|Te)&&(u=Mt(u.concat(v),"identifier")),[u,v]}var Ls={touchstart:me,touchmove:Qe,touchend:ue,touchcancel:Te},Rs="touchstart touchmove touchend touchcancel";function _t(){this.evTarget=Rs,this.targetIds={},Me.apply(this,arguments)}M(_t,Me,{handler:function(n){var u=Ls[n.type],v=hs.call(this,n,u);v&&this.callback(this.manager,u,{pointers:v[0],changedPointers:v[1],pointerType:xe,srcEvent:n})}});function hs(t,n){var u=Xe(t.touches),v=this.targetIds;if(n&(me|Qe)&&u.length===1)return v[u[0].identifier]=!0,[u,u];var S,C,B=Xe(t.changedTouches),pe=[],K=this.target;if(C=u.filter(function(ie){return ls(ie.target,K)}),n===me)for(S=0;S<C.length;)v[C[S].identifier]=!0,S++;for(S=0;S<B.length;)v[B[S].identifier]&&pe.push(B[S]),n&(ue|Te)&&delete v[B[S].identifier],S++;if(pe.length)return[Mt(C.concat(pe),"identifier"),pe]}var Ps=2500,Os=25;function Kt(){Me.apply(this,arguments);var t=q(this.handler,this);this.touch=new _t(this.manager,t),this.mouse=new gt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}M(Kt,Me,{handler:function(n,u,v){var S=v.pointerType==xe,C=v.pointerType==pt;if(!(C&&v.sourceCapabilities&&v.sourceCapabilities.firesTouchEvents)){if(S)P.call(this,u,v);else if(C&&Ie.call(this,v))return;this.callback(n,u,v)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function P(t,n){t&me?(this.primaryTouch=n.changedPointers[0].identifier,he.call(this,n)):t&(ue|Te)&&he.call(this,n)}function he(t){var n=t.changedPointers[0];if(n.identifier===this.primaryTouch){var u={x:n.clientX,y:n.clientY};this.lastTouches.push(u);var v=this.lastTouches,S=function(){var C=v.indexOf(u);C>-1&&v.splice(C,1)};setTimeout(S,Ps)}}function Ie(t){for(var n=t.srcEvent.clientX,u=t.srcEvent.clientY,v=0;v<this.lastTouches.length;v++){var S=this.lastTouches[v],C=Math.abs(n-S.x),B=Math.abs(u-S.y);if(C<=Os&&B<=Os)return!0}return!1}var wt=Je(y.style,"touchAction"),J=wt!==d,Ce="compute",Bt="auto",Jt="manipulation",et="none",it="pan-x",bt="pan-y",He=gs();function we(t,n){this.manager=t,this.set(n)}we.prototype={set:function(t){t==Ce&&(t=this.compute()),J&&this.manager.element.style&&He[t]&&(this.manager.element.style[wt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return X(this.manager.recognizers,function(n){Ye(n.options.enable,[n])&&(t=t.concat(n.getTouchAction()))}),$t(t.join(" "))},preventDefaults:function(t){var n=t.srcEvent,u=t.offsetDirection;if(this.manager.session.prevented){n.preventDefault();return}var v=this.actions,S=je(v,et)&&!He[et],C=je(v,bt)&&!He[bt],B=je(v,it)&&!He[it];if(S){var pe=t.pointers.length===1,K=t.distance<2,ie=t.deltaTime<250;if(pe&&K&&ie)return}if(!(B&&C)&&(S||C&&u&G||B&&u&F))return this.preventSrc(n)},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};function $t(t){if(je(t,et))return et;var n=je(t,it),u=je(t,bt);return n&&u?et:n||u?n?it:bt:je(t,Jt)?Jt:Bt}function gs(){if(!J)return!1;var t={},n=l.CSS&&l.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(u){t[u]=n?l.CSS.supports("touch-action",u):!0}),t}var Be=1,ce=2,tt=4,Le=8,Oe=Le,yt=16,$e=32;function ze(t){this.options=be({},this.defaults,t||{}),this.id=Vt(),this.manager=null,this.options.enable=dt(this.options.enable,!0),this.state=Be,this.simultaneous={},this.requireFail=[]}ze.prototype={defaults:{},set:function(t){return be(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(W(t,"recognizeWith",this))return this;var n=this.simultaneous;return t=ot(t,this),n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return W(t,"dropRecognizeWith",this)?this:(t=ot(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(W(t,"requireFailure",this))return this;var n=this.requireFail;return t=ot(t,this),Ze(n,t)===-1&&(n.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(W(t,"dropRequireFailure",this))return this;t=ot(t,this);var n=Ze(this.requireFail,t);return n>-1&&this.requireFail.splice(n,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var n=this,u=this.state;function v(S){n.manager.emit(S,t)}u<Le&&v(n.options.event+es(u)),v(n.options.event),t.additionalEvent&&v(t.additionalEvent),u>=Le&&v(n.options.event+es(u))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=$e},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&($e|Be)))return!1;t++}return!0},recognize:function(t){var n=be({},t);if(!Ye(this.options.enable,[this,n])){this.reset(),this.state=$e;return}this.state&(Oe|yt|$e)&&(this.state=Be),this.state=this.process(n),this.state&(ce|tt|Le|yt)&&this.tryEmit(n)},process:function(t){},getTouchAction:function(){},reset:function(){}};function es(t){return t&yt?"cancel":t&Le?"end":t&tt?"move":t&ce?"start":""}function _s(t){return t==mt?"down":t==I?"up":t==ft?"left":t==D?"right":""}function ot(t,n){var u=n.manager;return u?u.get(t):t}function Re(){ze.apply(this,arguments)}M(Re,ze,{defaults:{pointers:1},attrTest:function(t){var n=this.options.pointers;return n===0||t.pointers.length===n},process:function(t){var n=this.state,u=t.eventType,v=n&(ce|tt),S=this.attrTest(t);return v&&(u&Te||!S)?n|yt:v||S?u&ue?n|Le:n&ce?n|tt:ce:$e}});function St(){Re.apply(this,arguments),this.pX=null,this.pY=null}M(St,Re,{defaults:{event:"pan",threshold:10,pointers:1,direction:w},getTouchAction:function(){var t=this.options.direction,n=[];return t&G&&n.push(bt),t&F&&n.push(it),n},directionTest:function(t){var n=this.options,u=!0,v=t.distance,S=t.direction,C=t.deltaX,B=t.deltaY;return S&n.direction||(n.direction&G?(S=C===0?Lt:C<0?ft:D,u=C!=this.pX,v=Math.abs(t.deltaX)):(S=B===0?Lt:B<0?I:mt,u=B!=this.pY,v=Math.abs(t.deltaY))),t.direction=S,u&&v>n.threshold&&S&n.direction},attrTest:function(t){return Re.prototype.attrTest.call(this,t)&&(this.state&ce||!(this.state&ce)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var n=_s(t.direction);n&&(t.additionalEvent=this.options.event+n),this._super.emit.call(this,t)}});function st(){Re.apply(this,arguments)}M(st,Re,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[et]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&ce)},emit:function(t){if(t.scale!==1){var n=t.scale<1?"in":"out";t.additionalEvent=this.options.event+n}this._super.emit.call(this,t)}});function De(){ze.apply(this,arguments),this._timer=null,this._input=null}M(De,ze,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Bt]},process:function(t){var n=this.options,u=t.pointers.length===n.pointers,v=t.distance<n.threshold,S=t.deltaTime>n.time;if(this._input=t,!v||!u||t.eventType&(ue|Te)&&!S)this.reset();else if(t.eventType&me)this.reset(),this._timer=U(function(){this.state=Oe,this.tryEmit()},n.time,this);else if(t.eventType&ue)return Oe;return $e},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Oe&&(t&&t.eventType&ue?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=R(),this.manager.emit(this.options.event,this._input)))}});function lt(){Re.apply(this,arguments)}M(lt,Re,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[et]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&ce)}});function zt(){Re.apply(this,arguments)}M(zt,Re,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:G|F,pointers:1},getTouchAction:function(){return St.prototype.getTouchAction.call(this)},attrTest:function(t){var n=this.options.direction,u;return n&(G|F)?u=t.overallVelocity:n&G?u=t.overallVelocityX:n&F&&(u=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&x(u)>this.options.velocity&&t.eventType&ue},emit:function(t){var n=_s(t.offsetDirection);n&&this.manager.emit(this.options.event+n,t),this.manager.emit(this.options.event,t)}});function Tt(){ze.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}M(Tt,ze,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Jt]},process:function(t){var n=this.options,u=t.pointers.length===n.pointers,v=t.distance<n.threshold,S=t.deltaTime<n.time;if(this.reset(),t.eventType&me&&this.count===0)return this.failTimeout();if(v&&S&&u){if(t.eventType!=ue)return this.failTimeout();var C=this.pTime?t.timeStamp-this.pTime<n.interval:!0,B=!this.pCenter||at(this.pCenter,t.center)<n.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,!B||!C?this.count=1:this.count+=1,this._input=t;var pe=this.count%n.taps;if(pe===0)return this.hasRequireFailures()?(this._timer=U(function(){this.state=Oe,this.tryEmit()},n.interval,this),ce):Oe}return $e},failTimeout:function(){return this._timer=U(function(){this.state=$e},this.options.interval,this),$e},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Oe&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ve(t,n){return n=n||{},n.recognizers=dt(n.recognizers,Ve.defaults.preset),new Ut(t,n)}Ve.VERSION="2.0.7",Ve.defaults={domEvents:!1,touchAction:Ce,enable:!0,inputTarget:null,inputClass:null,preset:[[lt,{enable:!1}],[st,{enable:!1},["rotate"]],[zt,{direction:G}],[St,{direction:G},["swipe"]],[Tt],[Tt,{event:"doubletap",taps:2},["tap"]],[De]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ft=1,Fe=2;function Ut(t,n){this.options=be({},Ve.defaults,n||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=us(this),this.touchAction=new we(this,this.options.touchAction),ts(this,!0),X(this.options.recognizers,function(u){var v=this.add(new u[0](u[1]));u[2]&&v.recognizeWith(u[2]),u[3]&&v.requireFailure(u[3])},this)}Ut.prototype={set:function(t){return be(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?Fe:Ft},recognize:function(t){var n=this.session;if(!n.stopped){this.touchAction.preventDefaults(t);var u,v=this.recognizers,S=n.curRecognizer;(!S||S&&S.state&Oe)&&(S=n.curRecognizer=null);for(var C=0;C<v.length;)u=v[C],n.stopped!==Fe&&(!S||u==S||u.canRecognizeWith(S))?u.recognize(t):u.reset(),!S&&u.state&(ce|tt|Le)&&(S=n.curRecognizer=u),C++}},get:function(t){if(t instanceof ze)return t;for(var n=this.recognizers,u=0;u<n.length;u++)if(n[u].options.event==t)return n[u];return null},add:function(t){if(W(t,"add",this))return this;var n=this.get(t.options.event);return n&&this.remove(n),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(W(t,"remove",this))return this;if(t=this.get(t),t){var n=this.recognizers,u=Ze(n,t);u!==-1&&(n.splice(u,1),this.touchAction.update())}return this},on:function(t,n){if(t!==d&&n!==d){var u=this.handlers;return X(Ke(t),function(v){u[v]=u[v]||[],u[v].push(n)}),this}},off:function(t,n){if(t!==d){var u=this.handlers;return X(Ke(t),function(v){n?u[v]&&u[v].splice(Ze(u[v],n),1):delete u[v]}),this}},emit:function(t,n){this.options.domEvents&&Gt(t,n);var u=this.handlers[t]&&this.handlers[t].slice();if(!(!u||!u.length)){n.type=t,n.preventDefault=function(){n.srcEvent.preventDefault()};for(var v=0;v<u.length;)u[v](n),v++}},destroy:function(){this.element&&ts(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ts(t,n){var u=t.element;if(u.style){var v;X(t.options.cssProps,function(S,C){v=Je(u.style,C),n?(t.oldCssProps[v]=u.style[v],u.style[v]=S):u.style[v]=t.oldCssProps[v]||""}),n||(t.oldCssProps={})}}function Gt(t,n){var u=r.createEvent("Event");u.initEvent(t,!0,!0),u.gesture=n,n.target.dispatchEvent(u)}be(Ve,{INPUT_START:me,INPUT_MOVE:Qe,INPUT_END:ue,INPUT_CANCEL:Te,STATE_POSSIBLE:Be,STATE_BEGAN:ce,STATE_CHANGED:tt,STATE_ENDED:Le,STATE_RECOGNIZED:Oe,STATE_CANCELLED:yt,STATE_FAILED:$e,DIRECTION_NONE:Lt,DIRECTION_LEFT:ft,DIRECTION_RIGHT:D,DIRECTION_UP:I,DIRECTION_DOWN:mt,DIRECTION_HORIZONTAL:G,DIRECTION_VERTICAL:F,DIRECTION_ALL:w,Manager:Ut,Input:Me,TouchAction:we,TouchInput:_t,MouseInput:gt,PointerEventInput:Nt,TouchMouseInput:Kt,SingleTouchInput:ms,Recognizer:ze,AttrRecognizer:Re,Tap:Tt,Pan:St,Swipe:zt,Pinch:st,Rotate:lt,Press:De,on:We,off:xt,each:X,merge:ae,extend:ct,assign:be,inherit:M,bindFn:q,prefixed:Je});var Ds=typeof l<"u"?l:typeof self<"u"?self:{};Ds.Hammer=Ve,e.exports?e.exports=Ve:l[p]=Ve})(window,document,"Hammer")})(ws)),ws.exports}var Na=Da();const as=Oa(Na);const os=e=>e&&e.enabled&&e.modifierKey,kn=(e,l)=>e&&l[e+"Key"],Ws=(e,l)=>e&&!l[e+"Key"];function rt(e,l,r){return e===void 0?!0:typeof e=="string"?e.indexOf(l)!==-1:typeof e=="function"?e({chart:r}).indexOf(l)!==-1:!1}function Bs(e,l){return typeof e=="function"&&(e=e({chart:l})),typeof e=="string"?{x:e.indexOf("x")!==-1,y:e.indexOf("y")!==-1}:{x:!1,y:!1}}function wa(e,l){let r;return function(){return clearTimeout(r),r=setTimeout(e,l),l}}function Ba({x:e,y:l},r){const p=r.scales,d=Object.keys(p);for(let f=0;f<d.length;f++){const y=p[d[f]];if(l>=y.top&&l<=y.bottom&&e>=y.left&&e<=y.right)return y}return null}function An(e,l,r){const{mode:p="xy",scaleMode:d,overScaleMode:f}=e||{},y=Ba(l,r),T=Bs(p,r),k=Bs(d,r);if(f){const R=Bs(f,r);for(const U of["x","y"])R[U]&&(k[U]=T[U],T[U]=!1)}if(y&&k[y.axis])return[y];const x=[];return ut(r.scales,function(R){T[R.axis]&&x.push(R)}),x}const Fs=new WeakMap;function re(e){let l=Fs.get(e);return l||(l={originalScaleLimits:{},updatedScaleLimits:{},handlers:{},panDelta:{},dragging:!1,panning:!1},Fs.set(e,l)),l}function $a(e){Fs.delete(e)}function xn(e,l,r,p){const d=Math.max(0,Math.min(1,(e-l)/r||0)),f=1-d;return{min:p*d,max:p*f}}function Mn(e,l){const r=e.isHorizontal()?l.x:l.y;return e.getValueForPixel(r)}function In(e,l,r){const p=e.max-e.min,d=p*(l-1),f=Mn(e,r);return xn(f,e.min,p,d)}function za(e,l,r){const p=Mn(e,r);if(p===void 0)return{min:e.min,max:e.max};const d=Math.log10(e.min),f=Math.log10(e.max),y=Math.log10(p),T=f-d,k=T*(l-1),x=xn(y,d,T,k);return{min:Math.pow(10,d+x.min),max:Math.pow(10,f-x.max)}}function Fa(e,l){return l&&(l[e.id]||l[e.axis])||{}}function an(e,l,r,p,d){let f=r[p];if(f==="original"){const y=e.originalScaleLimits[l.id][p];f=Ts(y.options,y.scale)}return Ts(f,d)}function Ua(e,l,r){const p=e.getValueForPixel(l),d=e.getValueForPixel(r);return{min:Math.min(p,d),max:Math.max(p,d)}}function Ga(e,{min:l,max:r,minLimit:p,maxLimit:d},f){const y=(e-r+l)/2;l-=y,r+=y;const T=f.min.options??f.min.scale,k=f.max.options??f.max.scale,x=e/1e6;return tn(l,T,x)&&(l=T),tn(r,k,x)&&(r=k),l<p?(l=p,r=Math.min(p+e,d)):r>d&&(r=d,l=Math.max(d-e,p)),{min:l,max:r}}function At(e,{min:l,max:r},p,d=!1){const f=re(e.chart),{options:y}=e,T=Fa(e,p),{minRange:k=0}=T,x=an(f,e,T,"min",-1/0),R=an(f,e,T,"max",1/0);if(d==="pan"&&(l<x||r>R))return!0;const U=e.max-e.min,W=d?Math.max(r-l,k):U;if(d&&W===k&&U<=k)return!0;const X=Ga(W,{min:l,max:r,minLimit:x,maxLimit:R},f.originalScaleLimits[e.id]);return y.min=X.min,y.max=X.max,f.updatedScaleLimits[e.id]=X,e.parse(X.min)!==e.min||e.parse(X.max)!==e.max}function Qa(e,l,r,p){const d=In(e,l,r),f={min:e.min+d.min,max:e.max-d.max};return At(e,f,p,!0)}function Ha(e,l,r,p){const d=za(e,l,r);return At(e,d,p,!0)}function Va(e,l,r,p){At(e,Ua(e,l,r),p,!0)}const on=e=>e===0||isNaN(e)?0:e<0?Math.min(Math.round(e),-1):Math.max(Math.round(e),1);function Ya(e){const r=e.getLabels().length-1;e.min>0&&(e.min-=1),e.max<r&&(e.max+=1)}function Wa(e,l,r,p){const d=In(e,l,r);e.min===e.max&&l<1&&Ya(e);const f={min:e.min+on(d.min),max:e.max-on(d.max)};return At(e,f,p,!0)}function Za(e){return e.isHorizontal()?e.width:e.height}function Xa(e,l,r){const d=e.getLabels().length-1;let{min:f,max:y}=e;const T=Math.max(y-f,1),k=Math.round(Za(e)/Math.max(T,10)),x=Math.round(Math.abs(l/k));let R;return l<-k?(y=Math.min(y+x,d),f=T===1?y:y-T,R=y===d):l>k&&(f=Math.max(0,f-x),y=T===1?f:f+T,R=f===0),At(e,{min:f,max:y},r)||R}const qa={second:500,minute:30*1e3,hour:1800*1e3,day:720*60*1e3,week:3.5*24*60*60*1e3,month:360*60*60*1e3,quarter:1440*60*60*1e3,year:4368*60*60*1e3};function Ln(e,l,r,p=!1){const{min:d,max:f,options:y}=e,T=y.time&&y.time.round,k=qa[T]||0,x=e.getValueForPixel(e.getPixelForValue(d+k)-l),R=e.getValueForPixel(e.getPixelForValue(f+k)-l);return isNaN(x)||isNaN(R)?!0:At(e,{min:x,max:R},r,p?"pan":!1)}function ln(e,l,r){return Ln(e,l,r,!0)}const Us={category:Wa,default:Qa,logarithmic:Ha},Gs={default:Va},Qs={category:Xa,default:Ln,logarithmic:ln,timeseries:ln};function ja(e,l,r){const{id:p,options:{min:d,max:f}}=e;if(!l[p]||!r[p])return!0;const y=r[p];return y.min!==d||y.max!==f}function rn(e,l){ut(e,(r,p)=>{l[p]||delete e[p]})}function Ht(e,l){const{scales:r}=e,{originalScaleLimits:p,updatedScaleLimits:d}=l;return ut(r,function(f){ja(f,p,d)&&(p[f.id]={min:{scale:f.min,options:f.options.min},max:{scale:f.max,options:f.options.max}})}),rn(p,r),rn(d,r),p}function un(e,l,r,p){const d=Us[e.type]||Us.default;de(d,[e,l,r,p])}function cn(e,l,r,p){const d=Gs[e.type]||Gs.default;de(d,[e,l,r,p])}function Ka(e){const l=e.chartArea;return{x:(l.left+l.right)/2,y:(l.top+l.bottom)/2}}function Zs(e,l,r="none",p="api"){const{x:d=1,y:f=1,focalPoint:y=Ka(e)}=typeof l=="number"?{x:l,y:l}:l,T=re(e),{options:{limits:k,zoom:x}}=T;Ht(e,T);const R=d!==1,U=f!==1,W=An(x,y,e);ut(W||e.scales,function(X){X.isHorizontal()&&R?un(X,d,y,k):!X.isHorizontal()&&U&&un(X,f,y,k)}),e.update(r),de(x.onZoom,[{chart:e,trigger:p}])}function Rn(e,l,r,p="none",d="api"){const f=re(e),{options:{limits:y,zoom:T}}=f,{mode:k="xy"}=T;Ht(e,f);const x=rt(k,"x",e),R=rt(k,"y",e);ut(e.scales,function(U){U.isHorizontal()&&x?cn(U,l.x,r.x,y):!U.isHorizontal()&&R&&cn(U,l.y,r.y,y)}),e.update(p),de(T.onZoom,[{chart:e,trigger:d}])}function Ja(e,l,r,p="none",d="api"){const f=re(e);Ht(e,f);const y=e.scales[l];At(y,r,void 0,!0),e.update(p),de(f.options.zoom?.onZoom,[{chart:e,trigger:d}])}function ei(e,l="default"){const r=re(e),p=Ht(e,r);ut(e.scales,function(d){const f=d.options;p[d.id]?(f.min=p[d.id].min.options,f.max=p[d.id].max.options):(delete f.min,delete f.max),delete r.updatedScaleLimits[d.id]}),e.update(l),de(r.options.zoom.onZoomComplete,[{chart:e}])}function ti(e,l){const r=e.originalScaleLimits[l];if(!r)return;const{min:p,max:d}=r;return Ts(d.options,d.scale)-Ts(p.options,p.scale)}function si(e){const l=re(e);let r=1,p=1;return ut(e.scales,function(d){const f=ti(l,d.id);if(f){const y=Math.round(f/(d.max-d.min)*100)/100;r=Math.min(r,y),p=Math.max(p,y)}}),r<1?r:p}function dn(e,l,r,p){const{panDelta:d}=p,f=d[e.id]||0;sn(f)===sn(l)&&(l+=f);const y=Qs[e.type]||Qs.default;de(y,[e,l,r])?d[e.id]=0:d[e.id]=l}function Pn(e,l,r,p="none"){const{x:d=0,y:f=0}=typeof l=="number"?{x:l,y:l}:l,y=re(e),{options:{pan:T,limits:k}}=y,{onPan:x}=T||{};Ht(e,y);const R=d!==0,U=f!==0;ut(r||e.scales,function(W){W.isHorizontal()&&R?dn(W,d,k,y):!W.isHorizontal()&&U&&dn(W,f,k,y)}),e.update(p),de(x,[{chart:e}])}function On(e){const l=re(e);Ht(e,l);const r={};for(const p of Object.keys(e.scales)){const{min:d,max:f}=l.originalScaleLimits[p]||{min:{},max:{}};r[p]={min:d.scale,max:f.scale}}return r}function ni(e){const l=re(e),r={};for(const p of Object.keys(e.scales))r[p]=l.updatedScaleLimits[p];return r}function ai(e){const l=On(e);for(const r of Object.keys(e.scales)){const{min:p,max:d}=l[r];if(p!==void 0&&e.scales[r].min!==p||d!==void 0&&e.scales[r].max!==d)return!0}return!1}function pn(e){const l=re(e);return l.panning||l.dragging}const vn=(e,l,r)=>Math.min(r,Math.max(l,e));function Pe(e,l){const{handlers:r}=re(e),p=r[l];p&&p.target&&(p.target.removeEventListener(l,p),delete r[l])}function is(e,l,r,p){const{handlers:d,options:f}=re(e),y=d[r];if(y&&y.target===l)return;Pe(e,r),d[r]=k=>p(e,k,f),d[r].target=l;const T=r==="wheel"?!1:void 0;l.addEventListener(r,d[r],{passive:T})}function ii(e,l){const r=re(e);r.dragStart&&(r.dragging=!0,r.dragEnd=l,e.update("none"))}function oi(e,l){const r=re(e);!r.dragStart||l.key!=="Escape"||(Pe(e,"keydown"),r.dragging=!1,r.dragStart=r.dragEnd=null,e.update("none"))}function Hs(e,l){if(e.target!==l.canvas){const r=l.canvas.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top}}return Ys(e,l)}function Dn(e,l,r){const{onZoomStart:p,onZoomRejected:d}=r;if(p){const f=Hs(l,e);if(de(p,[{chart:e,event:l,point:f}])===!1)return de(d,[{chart:e,event:l}]),!1}}function li(e,l){if(e.legend){const f=Ys(l,e);if(Xn(f,e.legend))return}const r=re(e),{pan:p,zoom:d={}}=r.options;if(l.button!==0||kn(os(p),l)||Ws(os(d.drag),l))return de(d.onZoomRejected,[{chart:e,event:l}]);Dn(e,l,d)!==!1&&(r.dragStart=l,is(e,e.canvas.ownerDocument,"mousemove",ii),is(e,window.document,"keydown",oi))}function ri({begin:e,end:l},r){let p=l.x-e.x,d=l.y-e.y;const f=Math.abs(p/d);f>r?p=Math.sign(p)*Math.abs(d*r):f<r&&(d=Math.sign(d)*Math.abs(p/r)),l.x=e.x+p,l.y=e.y+d}function fn(e,l,r,{min:p,max:d,prop:f}){e[p]=vn(Math.min(r.begin[f],r.end[f]),l[p],l[d]),e[d]=vn(Math.max(r.begin[f],r.end[f]),l[p],l[d])}function ui(e,l,r){const p={begin:Hs(l.dragStart,e),end:Hs(l.dragEnd,e)};if(r){const d=e.chartArea.width/e.chartArea.height;ri(p,d)}return p}function Nn(e,l,r,p){const d=rt(l,"x",e),f=rt(l,"y",e),{top:y,left:T,right:k,bottom:x,width:R,height:U}=e.chartArea,W={top:y,left:T,right:k,bottom:x},X=ui(e,r,p&&d&&f);d&&fn(W,e.chartArea,X,{min:"left",max:"right",prop:"x"}),f&&fn(W,e.chartArea,X,{min:"top",max:"bottom",prop:"y"});const Ge=W.right-W.left,be=W.bottom-W.top;return{...W,width:Ge,height:be,zoomX:d&&Ge?1+(R-Ge)/R:1,zoomY:f&&be?1+(U-be)/U:1}}function ci(e,l){const r=re(e);if(!r.dragStart)return;Pe(e,"mousemove");const{mode:p,onZoomComplete:d,drag:{threshold:f=0,maintainAspectRatio:y}}=r.options.zoom,T=Nn(e,p,{dragStart:r.dragStart,dragEnd:l},y),k=rt(p,"x",e)?T.width:0,x=rt(p,"y",e)?T.height:0,R=Math.sqrt(k*k+x*x);if(r.dragStart=r.dragEnd=null,R<=f){r.dragging=!1,e.update("none");return}Rn(e,{x:T.left,y:T.top},{x:T.right,y:T.bottom},"zoom","drag"),r.dragging=!1,r.filterNextClick=!0,de(d,[{chart:e}])}function di(e,l,r){if(Ws(os(r.wheel),l)){de(r.onZoomRejected,[{chart:e,event:l}]);return}if(Dn(e,l,r)!==!1&&(l.cancelable&&l.preventDefault(),l.deltaY!==void 0))return!0}function pi(e,l){const{handlers:{onZoomComplete:r},options:{zoom:p}}=re(e);if(!di(e,l,p))return;const d=l.target.getBoundingClientRect(),f=p.wheel.speed,y=l.deltaY>=0?2-1/(1-f):1+f,T={x:y,y,focalPoint:{x:l.clientX-d.left,y:l.clientY-d.top}};Zs(e,T,"zoom","wheel"),de(r,[{chart:e}])}function vi(e,l,r,p){r&&(re(e).handlers[l]=wa(()=>de(r,[{chart:e}]),p))}function fi(e,l){const r=e.canvas,{wheel:p,drag:d,onZoomComplete:f}=l.zoom;p.enabled?(is(e,r,"wheel",pi),vi(e,"onZoomComplete",f,250)):Pe(e,"wheel"),d.enabled?(is(e,r,"mousedown",li),is(e,r.ownerDocument,"mouseup",ci)):(Pe(e,"mousedown"),Pe(e,"mousemove"),Pe(e,"mouseup"),Pe(e,"keydown"))}function mi(e){Pe(e,"mousedown"),Pe(e,"mousemove"),Pe(e,"mouseup"),Pe(e,"wheel"),Pe(e,"click"),Pe(e,"keydown")}function hi(e,l){return function(r,p){const{pan:d,zoom:f={}}=l.options;if(!d||!d.enabled)return!1;const y=p&&p.srcEvent;return y&&!l.panning&&p.pointerType==="mouse"&&(Ws(os(d),y)||kn(os(f.drag),y))?(de(d.onPanRejected,[{chart:e,event:p}]),!1):!0}}function gi(e,l){const r=Math.abs(e.clientX-l.clientX),p=Math.abs(e.clientY-l.clientY),d=r/p;let f,y;return d>.3&&d<1.7?f=y=!0:r>p?f=!0:y=!0,{x:f,y}}function wn(e,l,r){if(l.scale){const{center:p,pointers:d}=r,f=1/l.scale*r.scale,y=r.target.getBoundingClientRect(),T=gi(d[0],d[1]),k=l.options.zoom.mode,x={x:T.x&&rt(k,"x",e)?f:1,y:T.y&&rt(k,"y",e)?f:1,focalPoint:{x:p.x-y.left,y:p.y-y.top}};Zs(e,x,"zoom","pinch"),l.scale=r.scale}}function _i(e,l,r){if(l.options.zoom.pinch.enabled){const p=Ys(r,e);de(l.options.zoom.onZoomStart,[{chart:e,event:r,point:p}])===!1?(l.scale=null,de(l.options.zoom.onZoomRejected,[{chart:e,event:r}])):l.scale=1}}function bi(e,l,r){l.scale&&(wn(e,l,r),l.scale=null,de(l.options.zoom.onZoomComplete,[{chart:e}]))}function Bn(e,l,r){const p=l.delta;p&&(l.panning=!0,Pn(e,{x:r.deltaX-p.x,y:r.deltaY-p.y},l.panScales),l.delta={x:r.deltaX,y:r.deltaY})}function yi(e,l,r){const{enabled:p,onPanStart:d,onPanRejected:f}=l.options.pan;if(!p)return;const y=r.target.getBoundingClientRect(),T={x:r.center.x-y.left,y:r.center.y-y.top};if(de(d,[{chart:e,event:r,point:T}])===!1)return de(f,[{chart:e,event:r}]);l.panScales=An(l.options.pan,T,e),l.delta={x:0,y:0},Bn(e,l,r)}function Si(e,l){l.delta=null,l.panning&&(l.panning=!1,l.filterNextClick=!0,de(l.options.pan.onPanComplete,[{chart:e}]))}const Vs=new WeakMap;function mn(e,l){const r=re(e),p=e.canvas,{pan:d,zoom:f}=l,y=new as.Manager(p);f&&f.pinch.enabled&&(y.add(new as.Pinch),y.on("pinchstart",T=>_i(e,r,T)),y.on("pinch",T=>wn(e,r,T)),y.on("pinchend",T=>bi(e,r,T))),d&&d.enabled&&(y.add(new as.Pan({threshold:d.threshold,enable:hi(e,r)})),y.on("panstart",T=>yi(e,r,T)),y.on("panmove",T=>Bn(e,r,T)),y.on("panend",()=>Si(e,r))),Vs.set(e,y)}function hn(e){const l=Vs.get(e);l&&(l.remove("pinchstart"),l.remove("pinch"),l.remove("pinchend"),l.remove("panstart"),l.remove("pan"),l.remove("panend"),l.destroy(),Vs.delete(e))}function Ti(e,l){const{pan:r,zoom:p}=e,{pan:d,zoom:f}=l;return p?.zoom?.pinch?.enabled!==f?.zoom?.pinch?.enabled||r?.enabled!==d?.enabled||r?.threshold!==d?.threshold}var Ci="2.2.0";function Ss(e,l,r){const p=r.zoom.drag,{dragStart:d,dragEnd:f}=re(e);if(p.drawTime!==l||!f)return;const{left:y,top:T,width:k,height:x}=Nn(e,r.zoom.mode,{dragStart:d,dragEnd:f},p.maintainAspectRatio),R=e.ctx;R.save(),R.beginPath(),R.fillStyle=p.backgroundColor||"rgba(225,225,225,0.3)",R.fillRect(y,T,k,x),p.borderWidth>0&&(R.lineWidth=p.borderWidth,R.strokeStyle=p.borderColor||"rgba(225,225,225)",R.strokeRect(y,T,k,x)),R.restore()}var Ei={id:"zoom",version:Ci,defaults:{pan:{enabled:!1,mode:"xy",threshold:10,modifierKey:null},zoom:{wheel:{enabled:!1,speed:.1,modifierKey:null},drag:{enabled:!1,drawTime:"beforeDatasetsDraw",modifierKey:null},pinch:{enabled:!1},mode:"xy"}},start:function(e,l,r){const p=re(e);p.options=r,Object.prototype.hasOwnProperty.call(r.zoom,"enabled")&&console.warn("The option `zoom.enabled` is no longer supported. Please use `zoom.wheel.enabled`, `zoom.drag.enabled`, or `zoom.pinch.enabled`."),(Object.prototype.hasOwnProperty.call(r.zoom,"overScaleMode")||Object.prototype.hasOwnProperty.call(r.pan,"overScaleMode"))&&console.warn("The option `overScaleMode` is deprecated. Please use `scaleMode` instead (and update `mode` as desired)."),as&&mn(e,r),e.pan=(d,f,y)=>Pn(e,d,f,y),e.zoom=(d,f)=>Zs(e,d,f),e.zoomRect=(d,f,y)=>Rn(e,d,f,y),e.zoomScale=(d,f,y)=>Ja(e,d,f,y),e.resetZoom=d=>ei(e,d),e.getZoomLevel=()=>si(e),e.getInitialScaleBounds=()=>On(e),e.getZoomedScaleBounds=()=>ni(e),e.isZoomedOrPanned=()=>ai(e),e.isZoomingOrPanning=()=>pn(e)},beforeEvent(e,{event:l}){if(pn(e))return!1;if(l.type==="click"||l.type==="mouseup"){const r=re(e);if(r.filterNextClick)return r.filterNextClick=!1,!1}},beforeUpdate:function(e,l,r){const p=re(e),d=p.options;p.options=r,Ti(d,r)&&(hn(e),mn(e,r)),fi(e,r)},beforeDatasetsDraw(e,l,r){Ss(e,"beforeDatasetsDraw",r)},afterDatasetsDraw(e,l,r){Ss(e,"afterDatasetsDraw",r)},beforeDraw(e,l,r){Ss(e,"beforeDraw",r)},afterDraw(e,l,r){Ss(e,"afterDraw",r)},stop:function(e){mi(e),as&&hn(e),$a(e)},panFunctions:Qs,zoomFunctions:Us,zoomRectFunctions:Gs};const ki={class:"session-detail-wrapper"},Ai={key:0,class:"share-notification"},xi={class:"nav-bar"},Mi={key:0,class:"loading-state"},Ii={key:1,class:"error-state"},Li={class:"error-text"},Ri={class:"session-header"},Pi={class:"header-row"},Oi={class:"track-name"},Di={class:"header-meta"},Ni={class:"car"},wi={class:"master-detail"},Bi={class:"master"},$i={class:"builder-panel"},zi={class:"builder-panel-header"},Fi={class:"builder-slot builder-slot--a"},Ui={class:"builder-slot-content"},Gi={key:0,class:"builder-slot-empty"},Qi={class:"builder-chip builder-chip--a1"},Hi=["title"],Vi={key:0,class:"builder-chip builder-chip--a2"},Yi={class:"builder-slot builder-slot--b"},Wi={class:"builder-slot-content"},Zi={key:0,class:"builder-slot-empty"},Xi={class:"builder-chip builder-chip--b1"},qi=["title"],ji={key:0,class:"builder-chip builder-chip--b2"},Ki={class:"cross-session-section"},Ji={class:"cross-session-header cross-session-header--a"},eo={class:"cross-session-label"},to={class:"cross-session-date"},so={class:"stint-list stint-list--builder"},no=["onClick"],ao=["disabled","title","onClick"],io=["disabled","title","onClick"],oo={class:"stint-icon-slot"},lo={class:"stint-number"},ro={class:"stint-laps"},uo={class:"cross-session-section"},co={class:"cross-session-header cross-session-header--b"},po={class:"cross-session-label"},vo={class:"stint-list stint-list--builder"},fo=["onClick"],mo=["disabled","title","onClick"],ho=["disabled","title","onClick"],go={class:"stint-icon-slot"},_o={class:"stint-number"},bo={class:"stint-laps"},yo={class:"stint-list stint-list--builder"},So=["onClick"],To=["disabled","title","onClick"],Co=["disabled","title","onClick"],Eo={class:"stint-icon-slot"},ko={class:"stint-number"},Ao={class:"stint-laps"},xo={class:"detail"},Mo={key:0,class:"empty-state-panel"},Io={key:1,class:"limited-data"},Lo={key:2,class:"compare-layout compare-style--A"},Ro={class:"compare-conditions"},Po={class:"compare-condition-card compare-condition-card--a"},Oo={class:"cond-stint-label"},Do={class:"cond-details"},No={class:"cond-item"},wo={class:"cond-item"},Bo={class:"compare-condition-card compare-condition-card--b"},$o={class:"cond-stint-label"},zo={class:"cond-details"},Fo={class:"cond-item"},Uo={class:"cond-item"},Go={class:"compare-table-wrap"},Qo={class:"ssc-table"},Ho={key:0,class:"ssc-stint-separator"},Vo={class:"ssc-table-row"},Yo={class:"ssc-td ssc-td--value"},Wo={class:"ssc-td ssc-td--value"},Zo={class:"ssc-td"},Xo={key:1,class:"ssc-delta ssc-delta--empty"},qo={class:"ssc-table-row"},jo={class:"ssc-td"},Ko={key:1,class:"ssc-delta ssc-delta--empty"},Jo={class:"ssc-table-row ssc-table-row--compact"},el={class:"ssc-td ssc-td--compact"},tl={class:"ssc-td ssc-td--compact"},sl={class:"ssc-table-row ssc-table-row--total"},nl={class:"ssc-td ssc-td--value ssc-td--duration"},al={class:"ssc-td ssc-td--value ssc-td--duration"},il={class:"ssc-header"},ol={class:"ssc-header-left"},ll={class:"ssc-stint-label"},rl={class:"ssc-condition-text"},ul={class:"ssc-cond-val"},cl={class:"ssc-condition-text"},dl={class:"ssc-cond-val"},pl={class:"ssc-header-right"},vl={class:"ssc-duration-label"},fl={class:"ssc-table"},ml={class:"ssc-table-row"},hl={class:"ssc-td ssc-td--value"},gl={class:"ssc-td ssc-td--value ssc-td--theo"},_l={class:"ssc-td"},bl={class:"ssc-table-row"},yl={class:"ssc-td ssc-td--value"},Sl={class:"ssc-td ssc-td--value ssc-td--theo"},Tl={class:"ssc-td"},Cl={key:1,class:"ssc-delta ssc-delta--na"},El={key:0,class:"ssc-target-section"},kl={class:"ssc-target-row-bottom"},Al={class:"ssc-target-value"},xl={class:"ssc-progress-section"},Ml={key:0,class:"ssc-progress-row"},Il={class:"ssc-progress-label"},Ll={class:"ssc-progress-count"},Rl={class:"ssc-progress-bar"},Pl={key:1,class:"ssc-progress-row"},Ol={class:"ssc-progress-label"},Dl={class:"ssc-progress-count"},Nl={class:"ssc-progress-bar"},wl={class:"chart-section"},Bl={class:"chart-header-row"},$l={class:"chart-title"},zl={class:"chart-toolbar"},Fl={key:0,class:"lap-manager"},Ul={class:"lap-manager-section"},Gl={class:"lap-manager-header"},Ql={class:"lap-manager-title"},Hl=["disabled"],Vl={class:"lap-manager-stint-header"},Yl={class:"lap-manager-grid"},Wl=["onClick","title"],Zl={key:1,class:"lap-manager-grid"},Xl=["onClick","title"],ql={key:2,class:"lap-manager-info"},jl={key:0,class:"lap-manager-section lap-manager-section--b"},Kl={class:"lap-manager-header"},Jl={class:"lap-manager-title"},er=["disabled"],tr={class:"lap-manager-stint-header lap-manager-stint-header--b"},sr={class:"lap-manager-grid"},nr=["onClick","title"],ar={key:1,class:"lap-manager-grid"},ir=["onClick","title"],or={key:2,class:"lap-manager-info"},lr={key:1,class:"lap-manager-section lap-manager-section--b"},rr={class:"lap-manager-header"},ur={class:"lap-manager-title"},cr=["disabled"],dr={class:"lap-manager-grid"},pr=["onClick","title"],vr={key:0,class:"lap-manager-info"},fr={class:"chart-wrap"},mr={key:1,class:"grip-legend"},hr={class:"grip-legend-label"},gr={class:"grip-legend-laps"},_r={class:"laps-section"},br={class:"laps-header-row"},yr={key:0,class:"laps-tabs"},Sr=["onClick"],Tr=["onClick"],Cr={key:1,class:"laps-title"},Er={key:0,class:"laps-table-wrap"},kr={class:"laps-table laps-table--compare"},Ar={key:0,class:"stint-header-row"},xr={colspan:"4",class:"stint-header-cell stint-header-cell--a"},Mr={key:0,class:"stint-header-label"},Ir={colspan:"4",class:"stint-header-cell stint-header-cell--b"},Lr={key:0,class:"stint-header-label"},Rr={class:"col-index"},Pr={class:"col-a time"},Or={class:"col-a sector"},Dr={class:"col-a sector"},Nr={class:"col-a sector"},wr={class:"col-b time"},Br={class:"col-b sector"},$r={class:"col-b sector"},zr={class:"col-b sector"},Fr={key:1,class:"laps-table-wrap"},Ur={class:"laps-table"},Gr={class:"time"},Qr={class:"stato"},Hr={key:0,class:"badge badge--pit"},Vr={key:1,class:"badge badge--invalid"},Yr={key:2,class:"badge badge--valid"},$s=.6,Wr=gn({__name:"SessionDetailPage",props:{sessionId:{},externalUserId:{}},emits:["back","go-to-track"],setup(e,{emit:l}){qn.register(jn,Kn,Jn,ea,ta,sa,na,aa,Ei);const{currentUser:r,getUserProfile:p}=_n(),d=z(""),f=e,y=l;E(()=>!!f.externalUserId),z(!1);const T=z(new Set),k=z(new Set),x=z(new Set),R=z(!1),U=z(null);z(1);const W=z("gold");z("A");function X(i){const s=new Set(T.value);s.has(i)?s.delete(i):s.add(i),T.value=s}function Ge(i){const s=new Set(k.value);s.has(i)?s.delete(i):s.add(i),k.value=s}function be(i){const s=new Set(x.value);s.has(i)?s.delete(i):s.add(i),x.value=s}function ct(){T.value=new Set}function ae(){k.value=new Set}function M(){x.value=new Set}function q(){U.value?.chart&&U.value.chart.resetZoom()}function Ye(){U.value?.chart&&U.value.chart.zoom(1.2)}function dt(){U.value?.chart&&U.value.chart.zoom(.8)}const{fetchSessionFull:We,loadSessions:xt,getTheoreticalTimes:ls,generateShareLink:je}=zs(),Ke=z(null),Ze=z(!0),Xe=z(null),Mt=z(!1),Je=z(!1);async function Cs(){if(!(!f.sessionId||Mt.value)){Mt.value=!0,Je.value=!1;try{const i=await je(f.sessionId);await navigator.clipboard.writeText(i),Je.value=!0,console.log("[SHARE] Link copied:",i),setTimeout(()=>{Je.value=!1},2e3)}catch(i){console.error("[SHARE] Error sharing session:",i)}finally{Mt.value=!1}}}const Vt=oa();Hn(async()=>{Ze.value=!0,Xe.value=null;try{if(r.value?.uid){const c=await p(r.value.uid);d.value=c?.nickname||r.value.displayName||"Tu"}const i=f.externalUserId||Vt.value||void 0;f.externalUserId||await xt(i);const s=await We(f.sessionId,i,!!Vt.value&&!f.externalUserId);s?(Ke.value=s,console.log("[SESSION_DETAIL] Loaded session:",s.session_info.track,s.stints.length,"stints",f.externalUserId?"(SHARED)":"")):Xe.value="Sessione non trovata"}catch(i){console.error("[SESSION_DETAIL] Load error:",i),Xe.value=i.code==="permission-denied"?"Sessione non condivisa o accesso negato":i.message||"Errore caricamento"}finally{Ze.value=!1}});const rs=z(!1),Yt=z([]),Ae=z("COMPARE"),ve=E(()=>rs.value&&Yt.value.length===2),qe=E(()=>Yt.value[0]??Ie.value),xe=E(()=>Yt.value[1]??null),It=z(!1),pt=z(null),fe=z(null),vt=E(()=>pt.value!==null),me=z(null),Qe=z(null),ue=E(()=>me.value!==null);function Te(){It.value=!0}async function Lt(i,s,c){pt.value=i,me.value=s||null,Qe.value=c||null,It.value=!1;const{fetchSessionFull:m}=zs(),o=await m(i,s);o&&(fe.value=o,console.log("[CROSS-SESSION] Loaded session B:",i,s?`(external: ${c})`:"(own)",o.session_info.track))}function ft(){pt.value=null,fe.value=null,me.value=null,Qe.value=null,D.value=null,I.value=null,F.value=null,w.value=null}const D=z(null),I=z(null),mt=E(()=>fe.value?(fe.value.stints||[]).map(s=>({number:s.stint_number,type:s.type==="Qualify"?"Q":s.type==="Race"?"R":"P",laps:s.laps?.length||0,best:s.laps?.reduce((c,m)=>!m.is_valid||m.has_pit_stop?c:c===null?m.lap_time_ms:Math.min(c,m.lap_time_ms),null),avgCleanLap:s.avg_clean_lap})):[]),G=E(()=>vt.value&&D.value!==null&&I.value!==null),F=z(null),w=z(null),ht=E(()=>F.value!==null||w.value!==null);E(()=>{if(!D.value||F.value!==null)return!1;const i=D.value+1;return P.value.stints.some(s=>s.number===i)}),E(()=>{if(!I.value||!fe.value||w.value!==null)return!1;const i=I.value+1;return(fe.value.stints||[]).some(c=>c.stint_number===i)});function Rt(){F.value=null}function Me(){w.value=null}z(null),z(null);const us=E(()=>D.value!==null||I.value!==null),Wt=E(()=>D.value!==null&&I.value!==null),j=E(()=>Wt.value&&!vt.value),Pt=E(()=>us.value&&!Wt.value&&!vt.value),Es=E(()=>{if(!Pt.value)return null;const i=D.value??I.value;return i&&P.value.stints.find(s=>s.number===i)||null}),Zt=E(()=>D.value??I.value??null),cs=E(()=>{const i=Zt.value;return i?P.value.lapsData[i]||[]:[]});E(()=>D.value&&P.value.stints.find(i=>i.number===D.value)||null),E(()=>I.value&&P.value.stints.find(i=>i.number===I.value)||null),E(()=>D.value?P.value.lapsData[D.value]||[]:[]),E(()=>I.value?P.value.lapsData[I.value]||[]:[]);const se=E(()=>{const i=[];if(D.value){const s=P.value.stints.find(c=>c.number===D.value);s&&i.push(s)}if(F.value){const s=P.value.stints.find(c=>c.number===F.value);s&&i.push(s)}return i}),ne=E(()=>{const i=[],s=vt.value&&fe.value?(fe.value.stints||[]).map(c=>({number:c.stint_number,type:c.type==="Qualify"?"Q":c.type==="Race"?"R":"P",laps:c.laps?.length||0,best:Y(c.laps?.reduce((m,o)=>!o.is_valid||o.has_pit_stop?m:m===null?o.lap_time_ms:Math.min(m,o.lap_time_ms),null)),bestMs:c.laps?.reduce((m,o)=>!o.is_valid||o.has_pit_stop?m:m===null?o.lap_time_ms:Math.min(m,o.lap_time_ms),null),avg:Y(c.avg_clean_lap),avgMs:c.avg_clean_lap,avgWarning:(c.laps?.filter(m=>m.is_valid&&!m.has_pit_stop).length||0)<5,validLapsCount:c.laps?.filter(m=>m.is_valid&&!m.has_pit_stop).length||0,durationMs:c.laps?.reduce((m,o)=>m+(o.lap_time_ms||0),0)||0})):P.value.stints;if(I.value){const c=s.find(m=>m.number===I.value);c&&i.push(c)}if(w.value){const c=s.find(m=>m.number===w.value);c&&i.push(c)}return i}),at=E(()=>Math.max(se.value.length,ne.value.length)),Xt=E(()=>se.value.reduce((i,s)=>i+(s.durationMs||0),0)),ks=E(()=>ne.value.reduce((i,s)=>i+(s.durationMs||0),0)),ds=E(()=>{const i=[];return se.value.forEach((s,c)=>{(P.value.lapsData[s.number]||[]).forEach((o,h)=>{i.push({...o,_stintIndex:c,_stintNumber:s.number,_isStintStart:h===0,_globalIndex:i.length+1})})}),i}),qt=E(()=>{const i=[];return ne.value.forEach((s,c)=>{(P.value.lapsData[s.number]||[]).forEach((o,h)=>{i.push({...o,_stintIndex:c,_stintNumber:s.number,_isStintStart:h===0,_globalIndex:i.length+1})})}),i});function Ot(i){if(!i)return"â€”";const s=i,c=Math.floor(s/6e4),m=Math.floor(s%6e4/1e3),o=s%1e3;return`${c}m ${String(m).padStart(2,"0")}.${String(o).padStart(3,"0")}s`}function ps(){D.value=null,F.value=null,I.value=null,w.value=null}function gt(i){return I.value===i||w.value===i?!1:D.value?D.value===i||F.value===i||F.value?!1:i===D.value+1:!0}function vs(i){return D.value===i||F.value===i?!1:I.value?I.value===i||w.value===i||w.value?!1:i===I.value+1:!0}function fs(i){return I.value===i||w.value===i?"GiÃ  in Strategia B":D.value?D.value===i||F.value===i?"GiÃ  in Strategia A":!F.value&&i===D.value+1?"Aggiungi come secondo stint":F.value?"Massimo 2 stint per strategia":"Solo stint consecutivo ammesso":"Aggiungi a Strategia A"}function jt(i){return D.value===i||F.value===i?"GiÃ  in Strategia A":I.value?I.value===i||w.value===i?"GiÃ  in Strategia B":!w.value&&i===I.value+1?"Aggiungi come secondo stint":w.value?"Massimo 2 stint per strategia":"Solo stint consecutivo ammesso":"Aggiungi a Strategia B"}function Dt(i){if(!D.value){D.value=i;return}!F.value&&i===D.value+1&&(F.value=i)}function Nt(i){if(!I.value){I.value=i;return}!w.value&&i===I.value+1&&(w.value=i)}function As(i){return!D.value}function xs(i){return"Usa +B per stint da altra sessione"}function Ms(i){return I.value?I.value===i||w.value===i||w.value?!1:i===I.value+1:!0}function ms(i){return I.value?I.value===i||w.value===i?"GiÃ  in Strategia B":!w.value&&i===I.value+1?"Aggiungi come secondo stint":w.value?"Massimo 2 stint per strategia":"Solo stint consecutivo ammesso":"Aggiungi a Strategia B"}function Is(i){if(!I.value){I.value=i;return}!w.value&&i===I.value+1&&(w.value=i)}function Ls(){D.value=null,F.value=null}function Rs(){I.value=null,w.value=null}function _t(i){return D.value===i||F.value===i}function hs(i){return I.value===i||w.value===i}function Ps(i){Ie.value=i}function Os(i){}function Kt(i){Ie.value=i}const P=E(()=>{if(!Ke.value)return{id:f.sessionId,track:"Caricamento...",trackId:"",type:"practice",date:"-",time:"-",car:"-",startConditions:{weather:"-",airTemp:0,trackTemp:0},bestQualy:"--:--.---",bestRace:"--:--.---",theoQualy:"--:--.---",theoRace:"--:--.---",bestDeltaQ:{value:"-",stintNum:0},bestDeltaR:{value:"-",stintNum:0},stints:[],lapsData:{}};const i=Ke.value,s=i.session_info,c=s.session_best_lap&&s.session_best_lap>0&&s.session_best_lap<=Vn?s.session_best_lap:0,m=i.stints.map(ee=>{const oe=ee.laps.filter(le=>le.is_valid&&!le.has_pit_stop),ge=oe.length,Ee=ge>0?Math.min(...oe.map(le=>le.lap_time_ms)):null,Et=5,ke=ge>=Et&&ee.avg_clean_lap?ee.avg_clean_lap:null,Qt=ge>0&&ge<Et,nt=ke?Y(ke):Qt?"min 5 giri":"â€”";return{number:ee.stint_number,type:ee.type==="Qualify"?"Q":"R",intent:ee.type==="Qualify"?"Qualy Push":"Race Pace",fuelStart:ee.fuel_start,laps:ee.laps.length,validLapsCount:ge,best:Ee?Y(Ee):"â€”",bestMs:Ee,avg:nt,avgWarning:Qt,avgMs:ke,durationMs:ee.stint_drive_time_ms||0,theoretical:Y(c),deltaVsTheo:Ee&&c?`+${((Ee-c)/1e3).toFixed(3)}`:"-",conditions:{weather:s.start_weather,avgAirTemp:s.start_air_temp,avgTrackTemp:s.start_road_temp},breakdown:{base:"-",deltaTemp:"-",deltaGrip:"-"}}}),o={};i.stints.forEach(ee=>{o[ee.stint_number]=ee.laps.map(oe=>({lap:oe.lap_number,time:Y(oe.lap_time_ms),lap_time_ms:oe.lap_time_ms,delta:c?`+${((oe.lap_time_ms-c)/1e3).toFixed(3)}`:"-",valid:oe.is_valid,pit:oe.has_pit_stop,sectors:oe.sector_times_ms?.map(ge=>(ge/1e3).toFixed(3))||["-","-","-"],sector_times_ms:oe.sector_times_ms||[],fuel:Math.round(oe.fuel_remaining),airTemp:oe.air_temp||0,weather:oe.rain_intensity||"No Rain",grip:oe.track_grip_status||"Opt"}))});let h=null,L=null,N=0,Ne=0;return i.stints.forEach(ee=>{const oe=ee.laps.filter(Ee=>Ee.is_valid&&!Ee.has_pit_stop);if(oe.length===0)return;const ge=Math.min(...oe.map(Ee=>Ee.lap_time_ms));ee.type==="Qualify"?(!h||ge<h)&&(h=ge,N=ee.stint_number):(!L||ge<L)&&(L=ge,Ne=ee.stint_number)}),{id:f.sessionId,track:s.track,trackId:s.track.toLowerCase().replace(/[^a-z0-9]/g,"_"),type:yn(s.session_type),date:Yn(s.date_start),time:Sn(s.date_start),car:bn(s.car),startConditions:{weather:s.start_weather,airTemp:s.start_air_temp,trackTemp:s.start_road_temp},bestQualy:h?Y(h):"--:--.---",bestRace:L?Y(L):"--:--.---",theoQualy:Y(c),theoRace:Y(c),bestDeltaQ:{value:h&&c?`+${((h-c)/1e3).toFixed(3)}`:"-",stintNum:N},bestDeltaR:{value:L&&c?`+${((L-c)/1e3).toFixed(3)}`:"-",stintNum:Ne},stints:m,lapsData:o}}),he=z({theoQualy:null,theoRace:null,theoAvgRace:null,dominantGrip:"Optimum",stintTemp:23,historicQualy:null,historicQualyTemp:null,historicRace:null,historicRaceTemp:null,historicAvgRace:null,historicAvgRaceTemp:null}),Ie=z(1),wt=z(!1),J=E(()=>P.value.stints.find(i=>i.number===Ie.value)),Ce=E(()=>P.value.lapsData[Ie.value]||[]),Bt=E(()=>Pt.value?Es.value:J.value),Jt=E(()=>Pt.value?Zt.value:Ie.value),et=E(()=>Pt.value?cs.value:Ce.value);E(()=>et.value.length<=1),E(()=>P.value.stints.length===1),Ns(Ce,i=>{if(i.length>0){const s=i[0]?.lap;T.value=new Set(s!=null?[s]:[])}else T.value=new Set},{immediate:!0});const it=E(()=>qe.value?P.value.stints.find(i=>i.number===qe.value):null),bt=E(()=>xe.value?P.value.stints.find(i=>i.number===xe.value):null),He=E(()=>qe.value?P.value.lapsData[qe.value]||[]:[]),we=E(()=>xe.value?P.value.lapsData[xe.value]||[]:[]),$t=E(()=>{if(!D.value)return null;const i=P.value.stints.find(s=>s.number===D.value);return i?{...i,avgCleanLap:i.avg}:null}),gs=E(()=>{if(!I.value||!fe.value)return null;const s=(fe.value.stints||[]).find(c=>c.stint_number===I.value);return s?{number:s.stint_number,type:s.type==="Qualify"?"Q":s.type==="Race"?"R":"P",laps:s.laps?.length||0,best:Y(s.laps?.reduce((c,m)=>!m.is_valid||m.has_pit_stop?c:c===null?m.lap_time_ms:Math.min(c,m.lap_time_ms),null)),avgCleanLap:Y(s.avg_clean_lap),deltaVsTheo:"â€”"}:null}),Be=E(()=>D.value?P.value.lapsData[D.value]||[]:[]),ce=E(()=>{if(!I.value||!fe.value)return[];const s=(fe.value.stints||[]).find(c=>c.stint_number===I.value);return!s||!s.laps?[]:s.laps.map((c,m)=>({lapNumber:c.lap_number||m+1,lapTime:Y(c.lap_time_ms),lapTimeMs:c.lap_time_ms,valid:c.is_valid&&!c.has_pit_stop,pit:c.has_pit_stop,s1:Y(c.sector_times_ms?.[0]),s2:Y(c.sector_times_ms?.[1]),s3:Y(c.sector_times_ms?.[2]),fuel:c.fuel_remaining,air:c.air_temp,road:c.road_temp,grip:c.track_grip_status}))});E(()=>Ae.value==="A"?He.value:we.value),E(()=>Ae.value==="A"?it.value:bt.value),E(()=>Ae.value==="A"?Be.value:ce.value),E(()=>Ae.value==="A"?$t.value:gs.value);function tt(){const i=Ae.value;if(i.startsWith("A-")){const s=parseInt(i.slice(2));if(!isNaN(s))return P.value.lapsData[s]||[]}else if(i.startsWith("B-")){const s=parseInt(i.slice(2));if(!isNaN(s)){if(j.value)return P.value.lapsData[s]||[];if(G.value&&fe.value){const m=(fe.value.stints||[]).find(o=>o.stint_number===s);if(m?.laps)return m.laps.map((o,h)=>({lapNumber:o.lap_number||h+1,lapTime:Y(o.lap_time_ms),lapTimeMs:o.lap_time_ms,valid:o.is_valid&&!o.has_pit_stop,pit:o.has_pit_stop,s1:Y(o.sector_times_ms?.[0]),s2:Y(o.sector_times_ms?.[1]),s3:Y(o.sector_times_ms?.[2]),fuel:o.fuel_remaining,air:o.air_temp,road:o.road_temp,grip:o.track_grip_status}))}return P.value.lapsData[s]||[]}}return Ce.value}const Le=E(()=>{const i=tt();let s=1/0,c=1/0,m=1/0,o=1/0;for(const h of i){if(!h.valid||h.pit)continue;const L=h.sector_times_ms||[];L[0]&&L[0]>0&&L[0]<s&&(s=L[0]),L[1]&&L[1]>0&&L[1]<c&&(c=L[1]),L[2]&&L[2]>0&&L[2]<m&&(m=L[2]);const N=h.lap_time_ms||h.lapTimeMs;N&&N>0&&N<o&&(o=N)}return{s1:s===1/0?null:s,s2:c===1/0?null:c,s3:m===1/0?null:m,lapMs:o===1/0?null:o}});function Oe(i,s){const m=(i.sector_times_ms||[])[s];if(!m||m<=0)return!1;const o=[Le.value.s1,Le.value.s2,Le.value.s3][s];return o!==null&&m===o}function yt(i){const s=i.lap_time_ms||i.lapTimeMs;return Le.value.lapMs!==null&&s===Le.value.lapMs}const $e=E(()=>{let i=[],s=[];j.value?(i=ds.value||[],s=qt.value||[]):G.value?(i=Be.value||[],s=ce.value||[]):ve.value&&(i=He.value||[],s=we.value||[]);const c=Math.max(i.length,s.length),m=[];for(let o=0;o<c;o++){const h=i[o]||null,L=s[o]||null;let N=null;if(h&&L){const Ne=n(h.time||h.lapTime||""),ee=n(L.time||L.lapTime||"");Ne>0&&ee>0&&(N=Ne-ee)}m.push({index:o+1,lapA:h,lapB:L,delta:N,deltaFormatted:N!==null?N>=0?`+${N.toFixed(3)}`:N.toFixed(3):"â€”",deltaClass:N!==null?N<0?"faster":N<=.3?"close":N<=.5?"margin":"far":"neutral",_isStintStartA:h?._isStintStart||!1,_isStintStartB:L?._isStintStart||!1,_stintNumberA:h?._stintNumber||null,_stintNumberB:L?._stintNumber||null})}return m}),ze=E(()=>{if(!F.value)return null;const i=P.value.stints.find(s=>s.number===F.value);return i?{...i,avgCleanLap:i.avg}:null}),es=E(()=>F.value?P.value.lapsData[F.value]||[]:[]),_s=E(()=>{if(!w.value||!fe.value)return null;const s=(fe.value.stints||[]).find(c=>c.stint_number===w.value);return s?{number:s.stint_number,type:s.type==="Qualify"?"Q":s.type==="Race"?"R":"P",laps:s.laps?.length||0,best:Y(s.laps?.reduce((c,m)=>!m.is_valid||m.has_pit_stop?c:c===null?m.lap_time_ms:Math.min(c,m.lap_time_ms),null)),avgCleanLap:Y(s.avg_clean_lap),durationMs:s.laps?.reduce((c,m)=>c+(m.lap_time_ms||0),0)||0}:null}),ot=E(()=>{if(!w.value||!fe.value)return[];const s=(fe.value.stints||[]).find(c=>c.stint_number===w.value);return!s||!s.laps?[]:s.laps.map((c,m)=>({lapNumber:c.lap_number||m+1,lapTime:Y(c.lap_time_ms),lapTimeMs:c.lap_time_ms,valid:c.is_valid&&!c.has_pit_stop,pit:c.has_pit_stop,s1:Y(c.sector_times_ms?.[0]),s2:Y(c.sector_times_ms?.[1]),s3:Y(c.sector_times_ms?.[2]),fuel:c.fuel_remaining,air:c.air_temp,grip:c.track_grip_status}))});E(()=>{let i=0;if($t.value){const s=Ve($t.value)||Ft(Be.value);i+=s}if(ze.value){const s=Ve(ze.value)||Ft(es.value);i+=s}return i}),E(()=>{let i=0;return gs.value&&(i+=Ft(ce.value)),_s.value&&(i+=Ft(ot.value)),i});const Re=E(()=>{const i=P.value.stints.filter(c=>c.type==="Q"&&c.laps>=2);if(i.length===0)return null;let s=i[0];return i.forEach(c=>{parseFloat(c.deltaVsTheo)<parseFloat(s.deltaVsTheo)&&(s=c)}),s}),St=E(()=>{const i=P.value.stints.filter(c=>c.type==="R"&&c.laps>=2);if(i.length===0)return null;let s=i[0];return i.forEach(c=>{parseFloat(c.deltaVsTheo)<parseFloat(s.deltaVsTheo)&&(s=c)}),s});Ns([St,Re],([i,s])=>{wt.value||(i?(Ie.value=i.number,wt.value=!0,console.log("[PRESELECTION] Best R stint:",i.number,"delta:",i.deltaVsTheo)):s&&(Ie.value=s.number,wt.value=!0,console.log("[PRESELECTION] Best Q stint:",s.number,"delta:",s.deltaVsTheo)))});function st(i){return i.type==="Q"?Re.value?.number===i.number:i.type==="R"?St.value?.number===i.number:!1}function De(i){const c=(P.value.lapsData[i.number]||[]).filter(o=>!o.pit),m=c.filter(o=>o.valid);return c.length>0&&m.length===0?{icon:"âš ï¸",message:"Tutti i giri invalidi"}:i.type==="R"&&c.length<5?{icon:"âš ï¸",message:`Stint gara troppo corto (${c.length} giri, min. 5)`}:i.type==="Q"&&c.length<=1?{icon:"âš ï¸",message:"Dati limitati (1 giro)"}:null}function lt(i){if(i<=30){const s=i/30,c=239,m=Math.round(68+47*s),o=Math.round(68+-46*s);return`rgb(${c}, ${m}, ${o})`}else if(i<=70){const s=(i-30)/40,c=Math.round(249+2*s),m=Math.round(115+76*s),o=Math.round(22+14*s);return`rgb(${c}, ${m}, ${o})`}else{const s=(i-70)/30,c=Math.round(251+-235*s),m=Math.round(191+-6*s),o=Math.round(36+93*s);return`rgb(${c}, ${m}, ${o})`}}function zt(i){const s=i.filter(m=>!m.pit&&(m.airTemp||m.air));if(s.length===0)return 0;const c=s.reduce((m,o)=>m+(o.airTemp||o.air||0),0);return Math.round(c/s.length)}function Tt(i){const s=i.filter(h=>!h.pit&&h.grip&&h.grip!=="Unknown");if(s.length===0)return"Optimum";const c={};for(const h of s){let L=h.grip==="Opt"?"Optimum":h.grip;c[L]=(c[L]||0)+1}let m="Optimum",o=0;for(const[h,L]of Object.entries(c))L>o&&(o=L,m=h);return m}function Ve(i){return i?.durationMs?Math.floor(i.durationMs/6e4):0}function Ft(i){if(!i||i.length===0)return 0;const s=i.reduce((c,m)=>c+(m.lapTimeMs||0),0);return Math.round(s/6e4)}function Fe(i){if(!i)return"â€”";if(typeof i=="string"){const s=i,c=s.split(".");if(c.length===2&&c[1]){const m=c[1].padEnd(3,"0").slice(0,3);return`${c[0]}.${m}`}return s}return typeof i=="number"?(i>1e3?i/1e3:i).toFixed(3):"â€”"}function Ut(i,s){if(!i||!s)return"â€”";const m=(i-s)/1e3;return m===0?"0.000":`${m>0?"+":""}${m.toFixed(3)}`}function ts(i,s){if(!i||!s)return"far";const m=(i-s)/1e3;return m<0?"faster":m===0?"ontarget":m<=.3?"close":m<=.5?"margin":"far"}const Gt=E(()=>{const i=Ce.value.filter(le=>!le.pit);if(i.length===0)return{airTemp:{start:0,mid:0,end:0,changed:!1},grip:{dominant:"Optimum",percentages:[],changed:!1,display:"Optimum"}};const s=Math.floor(i.length/2),c=i.length-1,m=Math.round(i[0]?.airTemp||0),o=Math.round(i[s]?.airTemp||m),h=Math.round(i[c]?.airTemp||m),L=Math.abs(m-h)>=2||Math.abs(m-o)>=2,N={},Ne=[];let ee=0;const oe=le=>le==="Opt"?"Optimum":le;for(const le of i){let _e=le.grip||"Unknown";_e=oe(_e),_e!=="Unknown"&&(N[_e]||Ne.push(_e),N[_e]=(N[_e]||0)+1,ee++)}const ge=[];let Ee="Optimum",Et=0;for(const le of Ne){const _e=N[le]||0;if(_e===0)continue;const A=Math.round(_e/ee*100);ge.push({grip:le,pct:A}),_e>Et&&(Et=_e,Ee=le)}const ke=ge.length>1;let Qt=Ee;ke&&(Qt=ge.map(le=>`${le.grip} (${le.pct}%)`).join(" â†’ "));const nt=L?Math.round((m+o+h)/3):m;return{airTemp:{start:m,mid:o,end:h,changed:L,avg:nt},grip:{dominant:Ee,percentages:ge,changed:ke,display:Qt}}});Ns([()=>Ke.value,()=>Gt.value],async([i,s])=>{if(!i)return;const c=i.session_info,m=(c.track||"").toLowerCase().replace(/[^a-z0-9]/g,"_"),o=s.grip.dominant||"Optimum",h=s.airTemp.avg||Math.round(c.start_air_temp||23),L=Wn(c.car||""),N=await ls(m,o,h,L,Vt.value||void 0);he.value={theoQualy:N.theoQualy,theoRace:N.theoRace,theoAvgRace:N.theoAvgRace,dominantGrip:o,stintTemp:h,historicQualy:N.historicQualy,historicQualyTemp:N.historicQualyTemp,historicRace:N.historicRace,historicRaceTemp:N.historicRaceTemp,historicAvgRace:N.historicAvgRace,historicAvgRaceTemp:N.historicAvgRaceTemp}},{immediate:!0});const Ds=E(()=>{let i=[];if(j.value)i=ds.value.map((A,$)=>({...A,lap:$+1}));else if(G.value){if(i=Be.value,ht.value&&F.value){const A=es.value,$=i.length,te=A.map((Q,ye)=>({...Q,lap:$+ye+1,_originalLap:Q.lap,_isSecondStint:!0}));i=[...i,...te]}}else ve.value?i=He.value:i=Ce.value;const s=i.filter(A=>!T.value.has(A.lap)),c=G.value?$t.value:ve.value?it.value:J.value,m=c?.type==="Q",o=m?he.value.theoQualy:he.value.theoRace,h=o?o/1e3:0,L=h>0?h+$s:0,N=c?.best;n(N);const Ne=A=>A.pit?!1:n(A.time)<=L,ee=A=>A.pit||!A.valid?!1:Ne(A),oe=A=>A.pit||!A.valid?!1:A.time===N,ge=s.map(A=>A.pit?"#6b7280":A.valid?Ct.value&&oe(A)?"#a855f7":Ct.value&&ee(A)?"#10b981":"#3b82f6":"#ef4444"),Ee=s.map(A=>A.pit?"#6b7280":A.valid?Ct.value&&oe(A)?"#a855f7":Ct.value&&ee(A)?"#10b981":"#3b82f6":Ct.value&&Ne(A)?"#10b981":"#ef4444"),Et=s.map(A=>!A.valid&&!A.pit&&Ct.value&&Ne(A)?2:1),ke=[{label:j.value?`Strategia A (${se.value.map(A=>`#${A.number}`).join("+")})`:ve.value?`A: Stint #${qe.value}`:"Tempo",data:s.map(A=>n(A.time)),borderColor:"#3b82f6",backgroundColor:"rgba(59,130,246,0.1)",pointBackgroundColor:ge,pointBorderColor:Ee,pointBorderWidth:Et,pointRadius:5,tension:0,order:1,segment:j.value?{borderColor:A=>s[A.p1DataIndex]?._stintIndex>0?"#60a5fa":"#3b82f6"}:void 0},{label:`Teorico ${c?.type==="Q"?"Q":"R"}`,data:s.map(()=>h),borderColor:"#f59e0b",borderDash:[5,5],pointRadius:0,order:3}];if(!m&&Ct.value&&s.length>0&&ke.push({label:`Target (+${$s}s)`,data:s.map(()=>L),borderColor:"rgba(16, 185, 129, 0.6)",borderWidth:2,borderDash:[3,3],backgroundColor:"rgba(16, 185, 129, 0.05)",fill:"origin",pointRadius:0,order:4}),Xs.value&&qs.value&&s.length>0){const A=Math.max(...s.map($=>n($.time)))+5;js.value.forEach(($,te)=>{const Q=bs[$.gripLevel]||bs.Opt,ye=s.map((Ks,$n)=>{const Js=$n+1;return Js>=$.startLap&&Js<=$.endLap?A:null});ke.push({label:`_grip_${te}`,data:ye,borderColor:"transparent",backgroundColor:Q?.bg,fill:"origin",pointRadius:0,order:10+te,spanGaps:!1})})}let nt=[];if(j.value&&qt.value.length>0){nt=qt.value.map((Q,ye)=>({...Q,lap:ye+1})).filter(Q=>!k.value.has(Q.lap));const $=ne.value.map(Q=>`#${Q.number}`).join("+"),te=nt.map(Q=>Q.pit?"#6b7280":Q.valid?Q._stintIndex>0?"#a78bfa":"#8b5cf6":"#ef4444");ke.splice(1,0,{label:`Strategia B (${$})`,data:nt.map(Q=>n(Q.time)),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,0.1)",pointBackgroundColor:te,pointRadius:5,tension:0,segment:{borderColor:Q=>nt[Q.p1DataIndex]?._stintIndex>0?"#a78bfa":"#8b5cf6"}})}if(ve.value&&we.value.length>0){const $=we.value.filter(te=>!k.value.has(te.lap));ke.splice(1,0,{label:`B: Stint #${xe.value}`,data:$.map(te=>n(te.time)),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,0.1)",pointBackgroundColor:$.map(te=>te.pit?"#6b7280":te.valid?"#8b5cf6":"#ef4444"),pointRadius:5,tension:0})}if(G.value&&ce.value.length>0){let A=ce.value.map(($,te)=>({...$,_chartIdx:te+1}));if(ht.value&&w.value){const $=ot.value,te=A.length,Q=$.map((ye,Ks)=>({...ye,_chartIdx:te+Ks+1,_isSecondStint:!0}));A=[...A,...Q]}ke.splice(1,0,{label:ht.value?`Strategia B (${w.value?"Stint #"+I.value+"+#"+w.value:"Stint #"+I.value})`:`Strategia B Â· Stint #${I.value}`,data:A.map($=>x.value.has($.lapNumber)?null:n($.lapTime)),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,0.1)",pointBackgroundColor:A.map($=>x.value.has($.lapNumber)?"transparent":$.pit?"#6b7280":$.valid?"#8b5cf6":"#ef4444"),pointRadius:A.map($=>x.value.has($.lapNumber)?0:5),tension:0,spanGaps:!1})}let le;if(j.value||G.value||ve.value){let A=s.length;if(j.value)A=Math.max(s.length,nt.length);else if(G.value){let $=ce.value.length;ht.value&&w.value&&($+=ot.value.length),A=Math.max(s.length,$)}else ve.value&&(A=Math.max(s.length,we.value.length));le=Array.from({length:A},($,te)=>`G${te+1}`)}else le=s.map(A=>`G${A.lap}`);const _e=le.length;if((j.value||G.value||ve.value)&&s.length<_e){const A=ke.find(Q=>Q.label?.startsWith("Strategia A")||Q.label?.startsWith("A:"));if(A&&Array.isArray(A.data)){const Q=A.data.length;for(let ye=Q;ye<_e;ye++)A.data.push(null),Array.isArray(A.pointBackgroundColor)&&A.pointBackgroundColor.push("transparent"),Array.isArray(A.pointRadius)&&A.pointRadius.push(0)}const $=ke.find(Q=>Q.label?.startsWith("Teorico"));if($&&Array.isArray($.data)&&$.data.length<_e){const Q=$.data[0];for(let ye=$.data.length;ye<_e;ye++)$.data.push(Q)}const te=ke.find(Q=>Q.label?.startsWith("Target"));if(te&&Array.isArray(te.data)&&te.data.length<_e){const Q=te.data[0];for(let ye=te.data.length;ye<_e;ye++)te.data.push(Q)}}return{labels:le,datasets:ke}}),t={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom",labels:{color:"rgba(255,255,255,0.7)",font:{size:11},filter:i=>!i.text.startsWith("_")}},tooltip:{backgroundColor:"rgba(15,15,25,0.95)",callbacks:{title:i=>i.length?`Giro ${i[0].label?.replace("G","")||""}`:"",label:i=>i.dataset.label?.startsWith("_")?"":`${i.dataset.label}: ${u(i.raw)}`}},zoom:{pan:{enabled:!0,mode:"x",modifierKey:void 0},zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"x",drag:{enabled:!1}},limits:{x:{min:"original",max:"original"}}}},scales:{x:{grid:{color:"rgba(255,255,255,0.08)"},ticks:{color:"rgba(255,255,255,0.6)",font:{size:11}}},y:{grid:{color:"rgba(255,255,255,0.08)"},ticks:{color:"rgba(255,255,255,0.6)",font:{size:11},callback:i=>typeof i=="number"?u(i):i}}}};function n(i){if(!i)return 0;const s=i.split(":"),c=Number(s[0])||0,m=Number(s[1])||0;return c*60+m}function u(i){return`${Math.floor(i/60)}:${(i%60).toFixed(3).padStart(6,"0")}`}function v(i){return{practice:"PRACTICE",qualify:"QUALIFY",race:"RACE"}[i]||i.toUpperCase()}function S(i){if(!i||i==="-")return"far";const s=parseFloat(i);return isNaN(s)?"far":s<0?"faster":s===0?"ontarget":s<=.3?"close":s<=.5?"margin":"far"}function C(i){if(!i)return"-";const c=i.type==="Q"?he.value.theoQualy:he.value.theoRace;if(!c)return"-";const m=n(i.best);if(m===0)return"-";const o=c/1e3,h=m-o;return h>=0?`+${h.toFixed(3)}`:h.toFixed(3)}const B=E(()=>{if(!J.value)return{value:"-",seconds:0,class:"neutral"};const i=n(J.value.best);if(i===0)return{value:"-",seconds:0,class:"neutral"};let s=null;if(J.value.type==="Q"?s=he.value.theoQualy:s=he.value.theoRace,!s)return{value:"-",seconds:0,class:"neutral"};const c=s/1e3,m=i-c,o=m>=0?`+${m.toFixed(3)}`:m.toFixed(3);return{value:o,seconds:m,class:S(o)}}),pe=E(()=>{if(!J.value)return{value:"-",seconds:0,class:"neutral"};const i=n(J.value.avg);if(i===0)return{value:"-",seconds:0,class:"neutral"};if(J.value.type==="Q")return{value:"-",seconds:0,class:"neutral"};const s=he.value.theoAvgRace;if(!s)return{value:"-",seconds:0,class:"neutral"};const c=s/1e3,m=i-c,o=m>=0?`+${m.toFixed(3)}`:m.toFixed(3);return{value:o,seconds:m,class:S(o)}}),K=E(()=>{if(!J.value||Ce.value.length===0)return{onTarget:0,total:0,pct:0,targetLine:"-"};const s=J.value.type==="Q"?he.value.theoQualy:he.value.theoRace;if(!s)return{onTarget:0,total:0,pct:0,targetLine:"-"};const m=s/1e3+$s,o=Ce.value.filter(N=>!N.pit),h=o.length;let L=0;return o.forEach(N=>{n(N.time)<=m&&L++}),{onTarget:L,total:h,pct:h>0?Math.round(L/h*100):0,targetLine:u(m)}}),ie=E(()=>{const i=Ce.value.filter(o=>!o.pit),s=i.length,c=i.filter(o=>o.valid).length,m=s-c;return{valid:c,invalid:m,total:s,pct:s>0?Math.round(c/s*100):100}}),Ue=E(()=>{if(!J.value)return{hours:0,minutes:0,seconds:0,milliseconds:0,formatted:"0:00.000",totalMs:0};let i=J.value.durationMs||0;i===0&&Ce.value.length>0&&Ce.value.forEach(N=>{i+=n(N.time)*1e3});const s=i/1e3,c=Math.floor(s/3600),m=Math.floor(s%3600/60),o=Math.floor(s%60),h=Math.round(i%1e3);let L="";return c>0?L=`${c}h ${m.toString().padStart(2,"0")}m ${o.toString().padStart(2,"0")}.${h.toString().padStart(3,"0")}s`:L=`${m}m ${o.toString().padStart(2,"0")}.${h.toString().padStart(3,"0")}s`,{hours:c,minutes:m,seconds:o,milliseconds:h,formatted:L,totalMs:i}}),Ct=z(!0),Xs=z(!1),bs={Opt:{bg:"rgba(16, 185, 129, 0.15)",border:"#10b981",label:"Optimum"},Green:{bg:"rgba(132, 204, 22, 0.15)",border:"#84cc16",label:"Green"},Greasy:{bg:"rgba(234, 179, 8, 0.15)",border:"#eab308",label:"Greasy"},Damp:{bg:"rgba(249, 115, 22, 0.15)",border:"#f97316",label:"Damp"},Wet:{bg:"rgba(59, 130, 246, 0.15)",border:"#3b82f6",label:"Wet"},Flooded:{bg:"rgba(139, 92, 246, 0.15)",border:"#8b5cf6",label:"Flooded"}},qs=E(()=>{const i=Ce.value;if(i.length<2)return!1;const s=i[0]?.grip;return i.some(c=>c.grip!==s)}),js=E(()=>{const i=Ce.value;if(i.length===0)return[];const s=[];let c=i[0]?.grip||"Opt",m=1;return i.forEach((o,h)=>{o.grip!==c&&(s.push({gripLevel:c,startLap:m,endLap:h}),c=o.grip,m=h+1)}),s.push({gripLevel:c,startLap:m,endLap:i.length}),s});return(i,s)=>{const c=zn,m=Pa;return _(),b("div",ki,[(_(),Tn(Cn,{to:"body"},[ys(Zn,{name:"slide-notification"},{default:en(()=>[Je.value?(_(),b("div",Ai,[...s[6]||(s[6]=[a("span",{class:"share-notification-icon"},"âœ“",-1),a("span",{class:"share-notification-text"},"Link copiato nella clipboard!",-1)])])):Z("",!0)]),_:1})])),ys(c,{class:"session-detail-page"},{default:en(()=>[a("div",xi,[a("button",{class:"nav-btn",onClick:s[0]||(s[0]=o=>y("back"))},[...s[7]||(s[7]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M15 18l-6-6 6-6"})],-1),V(" Torna alle sessioni ",-1)])]),a("button",{class:"nav-btn nav-btn--accent",onClick:s[1]||(s[1]=o=>y("go-to-track",P.value.trackId))},[...s[8]||(s[8]=[V(" Apri pista ",-1),a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M9 18l6-6-6-6"})],-1)])])]),Ze.value?(_(),b("div",Mi,[...s[9]||(s[9]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Caricamento sessione...",-1)])])):Xe.value?(_(),b("div",Ii,[s[10]||(s[10]=a("p",{class:"error-icon"},"âš ï¸",-1)),a("p",Li,g(Xe.value),1),a("button",{class:"nav-btn",onClick:s[2]||(s[2]=o=>y("back"))},"Torna alle sessioni")])):(_(),b(O,{key:2},[a("header",Ri,[a("div",Pi,[a("h1",Oi,g(P.value.track.toUpperCase()),1),a("span",{class:H(["type-badge",`type-badge--${P.value.type}`])},g(v(P.value.type)),3),a("button",{class:"share-session-btn",onClick:Cs,title:"Condividi questa sessione"}," ðŸ”— Condividi ")]),a("div",Di,[a("span",null,g(P.value.date),1),s[11]||(s[11]=a("span",{class:"sep"},"â€¢",-1)),a("span",null,g(P.value.time),1),s[12]||(s[12]=a("span",{class:"sep"},"â€¢",-1)),a("span",Ni,g(P.value.car),1)])]),a("div",wi,[a("aside",Bi,[a("div",$i,[a("div",zi,[s[14]||(s[14]=a("span",{class:"builder-panel-title"},"Strategy Builder",-1)),us.value?(_(),b(O,{key:0},[Wt.value?(_(),b("button",{key:0,class:"builder-combo-btn builder-combo-btn--active",onClick:ps,title:"Confronto attivo - Clicca per resettare"},[...s[13]||(s[13]=[a("span",{class:"combo-status"},"âœ“ Attivo",-1),a("span",{class:"combo-divider"},"|",-1),a("span",{class:"combo-reset"},"Ã—",-1)])])):(_(),b("button",{key:1,class:"builder-combo-btn",onClick:ps,title:"Azzera selezione"}," Ã— Reset "))],64)):Z("",!0)]),a("div",Fi,[s[15]||(s[15]=a("span",{class:"builder-slot-label"},"A",-1)),a("div",Ui,[D.value?(_(),b(O,{key:1},[a("span",Qi,[V(" #"+g(D.value)+" ",1),a("button",{class:"chip-remove",onClick:Ls,title:F.value?"Rimuovi (rimuoverÃ  anche +"+F.value+")":"Rimuovi"},"Ã—",8,Hi)]),F.value?(_(),b("span",Vi,[V(" + #"+g(F.value)+" ",1),a("button",{class:"chip-remove",onClick:Rt,title:"Rimuovi"},"Ã—")])):Z("",!0)],64)):(_(),b("span",Gi,"Seleziona stint con [+A]"))])]),a("div",Yi,[s[16]||(s[16]=a("span",{class:"builder-slot-label"},"B",-1)),a("div",Wi,[I.value?(_(),b(O,{key:1},[a("span",Xi,[V(" #"+g(I.value)+" ",1),a("button",{class:"chip-remove",onClick:Rs,title:w.value?"Rimuovi (rimuoverÃ  anche +"+w.value+")":"Rimuovi"},"Ã—",8,qi)]),w.value?(_(),b("span",ji,[V(" + #"+g(w.value)+" ",1),a("button",{class:"chip-remove",onClick:Me,title:"Rimuovi"},"Ã—")])):Z("",!0)],64)):(_(),b("span",Zi,"Seleziona stint con [+B]"))])])]),vt.value?(_(),b(O,{key:0},[a("div",Ki,[a("div",Ji,[a("span",eo,"Sessione di "+g(d.value||"Te"),1),a("span",to,g(P.value.date),1)]),a("div",so,[(_(!0),b(O,null,Se(P.value.stints,o=>(_(),b("div",{key:"a-"+o.number,class:H(["stint-item stint-item--builder",{"builder-selected":_t(o.number),viewing:Ie.value===o.number,"best-stint":st(o)}]),onClick:h=>Ps(o.number)},[a("button",{class:"stint-add-btn stint-add-btn--a",disabled:!gt(o.number),title:fs(o.number),onClick:kt(h=>Dt(o.number),["stop"])},"+A",8,ao),a("button",{class:"stint-add-btn stint-add-btn--b",disabled:!vs(o.number),title:jt(o.number),onClick:kt(h=>Nt(o.number),["stop"])},"+B",8,io),a("span",oo,[st(o)?(_(),b(O,{key:0},[V("ðŸ†")],64)):De(o)?(_(),b(O,{key:1},[V(g(De(o)?.icon),1)],64)):Z("",!0)]),a("span",lo,"#"+g(o.number),1),a("span",{class:H(["stint-type",`stint-type--${o.type.toLowerCase()}`])},g(o.type),3),a("span",ro,g(o.laps)+" Giri",1)],10,no))),128))])]),a("div",uo,[a("div",co,[a("span",po,[ue.value?(_(),b(O,{key:0},[V(" Sessione di "+g(Qe.value||"Utente Esterno"),1)],64)):(_(),b(O,{key:1},[V(" Sessione di "+g(d.value||"Te")+" (altra) ",1)],64))]),a("button",{class:"cross-session-close",onClick:ft,title:"Rimuovi questa sorgente"},"âœ•")]),a("div",vo,[(_(!0),b(O,null,Se(mt.value,o=>(_(),b("div",{key:"b-"+o.number,class:H(["stint-item stint-item--builder stint-item--b",{"builder-selected":hs(o.number)}]),onClick:h=>(o.number,void 0)},[a("button",{class:"stint-add-btn stint-add-btn--a",disabled:!As(o.number),title:xs(o.number),onClick:kt(h=>Dt(o.number),["stop"])},"+A",8,mo),a("button",{class:"stint-add-btn stint-add-btn--b",disabled:!Ms(o.number),title:ms(o.number),onClick:kt(h=>Is(o.number),["stop"])},"+B",8,ho),a("span",go,[st(o)?(_(),b(O,{key:0},[V("ðŸ†")],64)):De(o)?(_(),b(O,{key:1},[V(g(De(o)?.icon),1)],64)):Z("",!0)]),a("span",_o,"#"+g(o.number),1),a("span",{class:H(["stint-type",`stint-type--${o.type.toLowerCase()}`])},g(o.type),3),a("span",bo,g(o.laps)+" Giri",1)],10,fo))),128))])])],64)):(_(),b(O,{key:1},[s[17]||(s[17]=a("h4",{class:"master-title"},"STINT",-1)),a("div",yo,[(_(!0),b(O,null,Se(P.value.stints,o=>(_(),b("div",{key:o.number,class:H(["stint-item stint-item--builder",{selected:Ie.value===o.number,"builder-selected-a":_t(o.number),"builder-selected-b":hs(o.number),"best-stint":st(o)}]),onClick:h=>Kt(o.number)},[a("button",{class:"stint-add-btn stint-add-btn--a",disabled:!gt(o.number),title:fs(o.number),onClick:kt(h=>Dt(o.number),["stop"])},"+A",8,To),a("button",{class:"stint-add-btn stint-add-btn--b",disabled:!vs(o.number),title:jt(o.number),onClick:kt(h=>Nt(o.number),["stop"])},"+B",8,Co),a("span",Eo,[st(o)?(_(),b(O,{key:0},[V("ðŸ†")],64)):De(o)?(_(),b(O,{key:1},[V(g(De(o)?.icon),1)],64)):Z("",!0)]),a("span",ko,"#"+g(o.number),1),a("span",{class:H(["stint-type",`stint-type--${o.type.toLowerCase()}`])},g(o.type),3),a("span",Ao,g(o.laps)+" Giri",1),a("span",{class:H(["stint-delta",`delta--${S(C(o))}`])},g(C(o)),3)],10,So))),128))]),a("button",{class:"altra-sessione-btn",onClick:Te}," Confronta con altra sessione ")],64))]),a("section",xo,[!ve.value&&!j.value&&!G.value&&P.value.stints.length===0?(_(),b("div",Mo,[...s[18]||(s[18]=[a("div",{class:"empty-state-content"},[a("h3",{class:"empty-state-title"},"Nessun stint disponibile"),a("p",{class:"empty-state-text"},"Questa sessione non contiene dati di stint.")],-1)])])):Z("",!0),!ve.value&&!j.value&&J.value&&De(J.value)?(_(),b("div",Io,g(De(J.value)?.icon)+" "+g(De(J.value)?.message),1)):Z("",!0),ve.value||j.value||G.value?(_(),b("div",Lo,[a("div",Ro,[a("div",Po,[a("div",Oo,"A: Stint #"+g(j.value||G.value?D.value:qe.value),1),a("div",Do,[a("span",No,[s[19]||(s[19]=a("span",{class:"cond-lbl"},"Aria:",-1)),V(" "+g(zt(j.value||G.value?Be.value:He.value))+"Â°",1)]),a("span",wo,[s[20]||(s[20]=a("span",{class:"cond-lbl"},"Grip:",-1)),V(" "+g(Tt(j.value||G.value?Be.value:He.value)),1)])])]),a("div",Bo,[a("div",$o,"B: Stint #"+g(j.value||G.value?I.value:xe.value),1),a("div",zo,[a("span",Fo,[s[21]||(s[21]=a("span",{class:"cond-lbl"},"Aria:",-1)),V(" "+g(zt(j.value||G.value?ce.value:we.value))+"Â°",1)]),a("span",Uo,[s[22]||(s[22]=a("span",{class:"cond-lbl"},"Grip:",-1)),V(" "+g(Tt(j.value||G.value?ce.value:we.value)),1)])])])]),a("div",Go,[a("div",Qo,[s[32]||(s[32]=a("div",{class:"ssc-table-header"},[a("div",{class:"ssc-th ssc-th--label"}),a("div",{class:"ssc-th"},"STRATEGIA A"),a("div",{class:"ssc-th"},"STRATEGIA B"),a("div",{class:"ssc-th"},"- DELTA")],-1)),(_(!0),b(O,null,Se(at.value,(o,h)=>(_(),b(O,{key:h},[at.value>1?(_(),b("div",Ho,[a("span",null,"STINT "+g(h+1),1)])):Z("",!0),a("div",Vo,[s[23]||(s[23]=a("div",{class:"ssc-td ssc-td--label"},"BEST",-1)),a("div",Yo,g(se.value[h]?.best??"â€”"),1),a("div",Wo,g(ne.value[h]?.best??"â€”"),1),a("div",Zo,[se.value[h]&&ne.value[h]?(_(),b("span",{key:0,class:H(["ssc-delta",ts(se.value[h]?.bestMs,ne.value[h]?.bestMs)])},g(Ut(se.value[h]?.bestMs,ne.value[h]?.bestMs)),3)):(_(),b("span",Xo,"â€”"))])]),a("div",qo,[s[24]||(s[24]=a("div",{class:"ssc-td ssc-td--label"},"AVG",-1)),a("div",{class:H(["ssc-td","ssc-td--value",{"ssc-td--warning":se.value[h]?.avgWarning}])},[se.value[h]?.avgWarning?(_(),b(O,{key:0},[V("âš ï¸ "+g(se.value[h]?.avg),1)],64)):(_(),b(O,{key:1},[V(g(se.value[h]?.avg??"â€”"),1)],64))],2),a("div",{class:H(["ssc-td","ssc-td--value",{"ssc-td--warning":ne.value[h]?.avgWarning}])},[ne.value[h]?.avgWarning?(_(),b(O,{key:0},[V("âš ï¸ "+g(ne.value[h]?.avg),1)],64)):(_(),b(O,{key:1},[V(g(ne.value[h]?.avg??"â€”"),1)],64))],2),a("div",jo,[se.value[h]&&ne.value[h]?(_(),b("span",{key:0,class:H(["ssc-delta",ts(se.value[h]?.avgMs,ne.value[h]?.avgMs)])},g(Ut(se.value[h]?.avgMs,ne.value[h]?.avgMs)),3)):(_(),b("span",Ko,"â€”"))])]),a("div",Jo,[s[27]||(s[27]=a("div",{class:"ssc-td ssc-td--label"},"GIRI VALIDI",-1)),a("div",el,[se.value[h]?(_(),b(O,{key:0},[V(g(se.value[h].validLapsCount??0)+" su "+g(se.value[h].laps??0)+" ",1),s[25]||(s[25]=a("span",{class:"compact-sep"},"Â·",-1)),V(" "+g(Ot(se.value[h]?.durationMs)),1)],64)):(_(),b(O,{key:1},[V("â€”")],64))]),a("div",tl,[ne.value[h]?(_(),b(O,{key:0},[V(g(ne.value[h].validLapsCount??0)+" su "+g(ne.value[h].laps??0)+" ",1),s[26]||(s[26]=a("span",{class:"compact-sep"},"Â·",-1)),V(" "+g(Ot(ne.value[h]?.durationMs)),1)],64)):(_(),b(O,{key:1},[V("â€”")],64))]),s[28]||(s[28]=a("div",{class:"ssc-td"},null,-1))])],64))),128)),at.value>1?(_(),b(O,{key:0},[s[31]||(s[31]=a("div",{class:"ssc-stint-separator ssc-stint-separator--total"},[a("span",null,"TOTALE")],-1)),a("div",sl,[s[29]||(s[29]=a("div",{class:"ssc-td ssc-td--label"},"DURATA",-1)),a("div",nl,g(Ot(Xt.value)),1),a("div",al,g(Ot(ks.value)),1),s[30]||(s[30]=a("div",{class:"ssc-td"},null,-1))])],64)):Z("",!0)])])])):Z("",!0),!ve.value&&!G.value&&!j.value&&Bt.value?(_(),b("div",{key:3,class:H(["stint-stats-card",`racing-theme--${W.value}`])},[a("div",il,[a("div",ol,[a("span",{class:H(["stint-type",`stint-type--${Bt.value?.type?.toLowerCase()}`])},g(Bt.value?.type==="R"?"Race":"Qualifying"),3),a("span",ll,"STINT #"+g(Jt.value),1),s[35]||(s[35]=a("span",{class:"ssc-header-divider"},"|",-1)),a("span",rl,[s[33]||(s[33]=a("span",{class:"ssc-cond-lbl"},"ARIA",-1)),a("span",ul,g(Gt.value.airTemp.avg||Gt.value.airTemp.start)+"Â°",1)]),a("span",cl,[s[34]||(s[34]=a("span",{class:"ssc-cond-lbl"},"GRIP",-1)),a("span",dl,g(Gt.value.grip.dominant),1)])]),a("div",pl,[a("span",vl,"Durata: "+g(Ue.value.formatted),1)])]),a("div",fl,[s[38]||(s[38]=a("div",{class:"ssc-table-header"},[a("div",{class:"ssc-th ssc-th--label"}),a("div",{class:"ssc-th"},"TEMPI STINT"),a("div",{class:"ssc-th ssc-th--theo"},[V(" TEORICO "),a("span",{class:"theo-info",title:"Tempo Teorico = Storico + (TempStint - TempStorico) Ã— 100ms/Â°C"},"?")]),a("div",{class:"ssc-th"},"- DELTA")],-1)),a("div",ml,[s[36]||(s[36]=a("div",{class:"ssc-td ssc-td--label"},"BEST",-1)),a("div",hl,g(J.value?.best??"â€”:â€”.---"),1),a("div",gl,g(J.value?.type==="Q"?he.value.theoQualy?ns(Y)(he.value.theoQualy):"â€”:â€”.---":he.value.theoRace?ns(Y)(he.value.theoRace):"â€”:â€”.---"),1),a("div",_l,[a("span",{class:H(["ssc-delta",B.value.class])},g(B.value.value),3)])]),a("div",bl,[s[37]||(s[37]=a("div",{class:"ssc-td ssc-td--label"},"AVG",-1)),a("div",yl,g(J.value?.avg??"â€”:â€”.---"),1),a("div",Sl,g(J.value?.type==="Q"?"â€”":he.value.theoAvgRace?ns(Y)(he.value.theoAvgRace):"â€”:â€”.---"),1),a("div",Tl,[J.value?.type!=="Q"?(_(),b("span",{key:0,class:H(["ssc-delta",pe.value.class])},g(pe.value.value),3)):(_(),b("span",Cl,"â€”"))])])]),J.value?.type==="R"&&K.value.total>0?(_(),b("div",El,[a("div",kl,[s[39]||(s[39]=a("span",{class:"ssc-target-label"},"TARGET GARA:",-1)),a("span",Al,g(K.value.targetLine),1)])])):Z("",!0),a("div",xl,[J.value?.type==="R"&&K.value.total>0?(_(),b("div",Ml,[a("div",Il,[s[40]||(s[40]=a("span",{class:"ssc-progress-title"},"GIRI NEL TARGET",-1)),a("span",Ll,g(K.value.onTarget)+" su "+g(K.value.total),1)]),a("div",Rl,[a("div",{class:"ssc-progress-fill",style:ss({width:K.value.pct+"%",background:lt(K.value.pct)})},null,4)]),a("span",{class:"ssc-progress-pct",style:ss({color:lt(K.value.pct)})},g(K.value.pct)+"%",5)])):Z("",!0),ie.value.total>0?(_(),b("div",Pl,[a("div",Ol,[s[41]||(s[41]=a("span",{class:"ssc-progress-title"},"GIRI VALIDI",-1)),a("span",Dl,g(ie.value.valid)+" su "+g(ie.value.total),1)]),a("div",Nl,[a("div",{class:"ssc-progress-fill",style:ss({width:ie.value.pct+"%",background:lt(ie.value.pct)})},null,4)]),a("span",{class:"ssc-progress-pct",style:ss({color:lt(ie.value.pct)})},g(ie.value.pct)+"%",5)])):Z("",!0)])],2)):Z("",!0),a("div",wl,[a("div",Bl,[a("h4",$l,[ve.value?(_(),b(O,{key:0},[V("Confronto Tempi â€” A: Stint #"+g(qe.value)+" vs B: Stint #"+g(xe.value),1)],64)):(_(),b(O,{key:1},[V("Tempi Giro â€” Stint "+g(Ie.value),1)],64))]),a("div",zl,[a("button",{class:"toolbar-btn",onClick:Ye,title:"Zoom In"},[...s[42]||(s[42]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("circle",{cx:"11",cy:"11",r:"8"}),a("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),a("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),a("line",{x1:"8",y1:"11",x2:"14",y2:"11"})],-1)])]),a("button",{class:"toolbar-btn",onClick:dt,title:"Zoom Out"},[...s[43]||(s[43]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("circle",{cx:"11",cy:"11",r:"8"}),a("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),a("line",{x1:"8",y1:"11",x2:"14",y2:"11"})],-1)])]),a("button",{class:"toolbar-btn",onClick:q,title:"Reset Zoom"},[...s[44]||(s[44]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("polyline",{points:"1 4 1 10 7 10"}),a("polyline",{points:"23 20 23 14 17 14"}),a("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})],-1)])]),s[46]||(s[46]=a("div",{class:"toolbar-divider"},null,-1)),a("button",{class:H(["toolbar-btn",{"toolbar-btn--active":R.value}]),onClick:s[3]||(s[3]=o=>R.value=!R.value),title:"Gestisci Giri"},[...s[45]||(s[45]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),a("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),a("line",{x1:"9",y1:"21",x2:"9",y2:"9"})],-1)])],2)])]),R.value?(_(),b("div",Fl,[a("div",Ul,[a("div",Gl,[a("span",Ql,g(j.value?"Strategia A Â· "+se.value.map(o=>"#"+o.number).join("+"):G.value?"Strategia A Â· Stint #"+D.value:ve.value?"Strategia A Â· Stint #"+qe.value:"Escludi Giri"),1),a("button",{class:"lap-manager-reset",onClick:ct,disabled:T.value.size===0}," Reset ",8,Hl)]),j.value?(_(!0),b(O,{key:0},Se(se.value,o=>(_(),b("div",{key:"stint-a-"+o.number,class:"lap-manager-stint-group"},[a("div",Vl,"Stint #"+g(o.number),1),a("div",Yl,[(_(!0),b(O,null,Se(P.value.lapsData[o.number]||[],h=>(_(),b("button",{key:"a-"+o.number+"-"+h.lap,class:H(["lap-toggle-btn",{"lap-toggle-btn--excluded":T.value.has(h.lap)},{"lap-toggle-btn--invalid":!h.valid&&!h.pit},{"lap-toggle-btn--pit":h.pit}]),onClick:L=>X(h.lap),title:`Giro ${h.lap} - ${h.time}${h.valid?"":" (Invalido)"}${h.pit?" (Pit)":""}`},g(h.lap),11,Wl))),128))])]))),128)):(_(),b("div",Zl,[(_(!0),b(O,null,Se(G.value?Be.value:ve.value?He.value:Ce.value,o=>(_(),b("button",{key:"a-"+o.lap,class:H(["lap-toggle-btn",{"lap-toggle-btn--excluded":T.value.has(o.lap)},{"lap-toggle-btn--invalid":!o.valid&&!o.pit},{"lap-toggle-btn--pit":o.pit}]),onClick:h=>X(o.lap),title:`Giro ${o.lap} - ${o.time}${o.valid?"":" (Invalido)"}${o.pit?" (Pit)":""}`},g(o.lap),11,Xl))),128))])),T.value.size>0?(_(),b("div",ql,g(T.value.size)+" giri esclusi ",1)):Z("",!0)]),ve.value||j.value?(_(),b("div",jl,[a("div",Kl,[a("span",Jl,g(j.value?"Strategia B Â· "+ne.value.map(o=>"#"+o.number).join("+"):"B: Stint #"+xe.value),1),a("button",{class:"lap-manager-reset",onClick:ae,disabled:k.value.size===0}," Reset ",8,er)]),j.value?(_(!0),b(O,{key:0},Se(ne.value,o=>(_(),b("div",{key:"stint-b-"+o.number,class:"lap-manager-stint-group"},[a("div",tr,"Stint #"+g(o.number),1),a("div",sr,[(_(!0),b(O,null,Se(P.value.lapsData[o.number]||[],h=>(_(),b("button",{key:"b-"+o.number+"-"+h.lap,class:H(["lap-toggle-btn lap-toggle-btn--b",{"lap-toggle-btn--excluded":k.value.has(h.lap)},{"lap-toggle-btn--invalid":!h.valid&&!h.pit},{"lap-toggle-btn--pit":h.pit}]),onClick:L=>Ge(h.lap),title:`Giro ${h.lap} - ${h.time}${h.valid?"":" (Invalido)"}${h.pit?" (Pit)":""}`},g(h.lap),11,nr))),128))])]))),128)):(_(),b("div",ar,[(_(!0),b(O,null,Se(we.value,o=>(_(),b("button",{key:"b-"+o.lap,class:H(["lap-toggle-btn lap-toggle-btn--b",{"lap-toggle-btn--excluded":k.value.has(o.lap)},{"lap-toggle-btn--invalid":!o.valid&&!o.pit},{"lap-toggle-btn--pit":o.pit}]),onClick:h=>Ge(o.lap),title:`Giro ${o.lap} - ${o.time}${o.valid?"":" (Invalido)"}${o.pit?" (Pit)":""}`},g(o.lap),11,ir))),128))])),k.value.size>0?(_(),b("div",or,g(k.value.size)+" giri esclusi ",1)):Z("",!0)])):Z("",!0),G.value?(_(),b("div",lr,[a("div",rr,[a("span",ur,"Strategia B Â· Stint #"+g(I.value),1),a("button",{class:"lap-manager-reset",onClick:M,disabled:x.value.size===0}," Reset ",8,cr)]),a("div",dr,[(_(!0),b(O,null,Se(ce.value,o=>(_(),b("button",{key:"crossb-"+o.lapNumber,class:H(["lap-toggle-btn lap-toggle-btn--b",{"lap-toggle-btn--excluded":x.value.has(o.lapNumber)},{"lap-toggle-btn--invalid":!o.valid&&!o.pit},{"lap-toggle-btn--pit":o.pit}]),onClick:h=>be(o.lapNumber),title:`Giro ${o.lapNumber} - ${o.lapTime}${o.valid?"":" (Invalido)"}${o.pit?" (Pit)":""}`},g(o.lapNumber),11,pr))),128))]),x.value.size>0?(_(),b("div",vr,g(x.value.size)+" giri esclusi ",1)):Z("",!0)])):Z("",!0)])):Z("",!0),a("div",fr,[ys(ns(ia),{ref_key:"chartRef",ref:U,data:Ds.value,options:t},null,8,["data"])]),qs.value&&Xs.value?(_(),b("div",mr,[s[47]||(s[47]=a("span",{class:"grip-legend-title"},"Grip:",-1)),(_(!0),b(O,null,Se(js.value,o=>(_(),b("div",{key:`${o.gripLevel}-${o.startLap}`,class:"grip-legend-item"},[a("span",{class:"grip-legend-dot",style:ss({backgroundColor:bs[o.gripLevel]?.border||"#fff"})},null,4),a("span",hr,g(bs[o.gripLevel]?.label||o.gripLevel),1),a("span",gr,"(G"+g(o.startLap)+"-G"+g(o.endLap)+")",1)]))),128))])):Z("",!0)]),a("div",_r,[a("div",br,[ve.value||G.value||j.value?(_(),b("div",yr,[a("button",{class:H(["lap-tab lap-tab--compare",{"lap-tab--active":Ae.value==="COMPARE"}]),onClick:s[4]||(s[4]=o=>Ae.value="COMPARE")}," Confronto ",2),(_(!0),b(O,null,Se(se.value,o=>(_(),b("button",{key:"tab-a-"+o.number,class:H(["lap-tab lap-tab--a",{"lap-tab--active":Ae.value==="A-"+o.number}]),onClick:h=>Ae.value="A-"+o.number}," A: Stint #"+g(o.number),11,Sr))),128)),(_(!0),b(O,null,Se(ne.value,o=>(_(),b("button",{key:"tab-b-"+o.number,class:H(["lap-tab lap-tab--b",{"lap-tab--active":Ae.value==="B-"+o.number}]),onClick:h=>Ae.value="B-"+o.number}," B: Stint #"+g(o.number),11,Tr))),128))])):(_(),b("h4",Cr,"Tabella Giri â€” Stint "+g(Ie.value),1))]),Ae.value==="COMPARE"&&(ve.value||G.value||j.value)?(_(),b("div",Er,[a("table",kr,[s[50]||(s[50]=a("thead",null,[a("tr",null,[a("th",{class:"col-index"},"#"),a("th",{class:"col-a",colspan:"4"},"Strategia A"),a("th",{class:"col-delta"},"Î” A-B"),a("th",{class:"col-b",colspan:"4"},"Strategia B")]),a("tr",{class:"sub-header"},[a("th"),a("th",{class:"col-a"},"Tempo"),a("th",{class:"col-a"},"S1"),a("th",{class:"col-a"},"S2"),a("th",{class:"col-a"},"S3"),a("th"),a("th",{class:"col-b"},"Tempo"),a("th",{class:"col-b"},"S1"),a("th",{class:"col-b"},"S2"),a("th",{class:"col-b"},"S3")])],-1)),a("tbody",null,[(_(!0),b(O,null,Se($e.value,o=>(_(),b(O,{key:"cmp-"+o.index},[o._isStintStartA||o._isStintStartB?(_(),b("tr",Ar,[s[48]||(s[48]=a("td",{class:"stint-header-index"},null,-1)),a("td",xr,[o._isStintStartA?(_(),b("span",Mr,"A: Stint #"+g(o._stintNumberA),1)):Z("",!0)]),s[49]||(s[49]=a("td",{class:"stint-header-delta"},null,-1)),a("td",Ir,[o._isStintStartB?(_(),b("span",Lr,"B: Stint #"+g(o._stintNumberB),1)):Z("",!0)])])):Z("",!0),a("tr",null,[a("td",Rr,g(o.index),1),a("td",Pr,g(o.lapA&&(o.lapA.time||o.lapA.lapTime)||"â€”"),1),a("td",Or,g(o.lapA?Fe(o.lapA.sectors?.[0]||o.lapA.s1):"â€”"),1),a("td",Dr,g(o.lapA?Fe(o.lapA.sectors?.[1]||o.lapA.s2):"â€”"),1),a("td",Nr,g(o.lapA?Fe(o.lapA.sectors?.[2]||o.lapA.s3):"â€”"),1),a("td",{class:H(["col-delta","delta",`delta--${o.deltaClass}`])},g(o.deltaFormatted),3),a("td",wr,g(o.lapB&&(o.lapB.time||o.lapB.lapTime)||"â€”"),1),a("td",Br,g(o.lapB?Fe(o.lapB.sectors?.[0]||o.lapB.s1):"â€”"),1),a("td",$r,g(o.lapB?Fe(o.lapB.sectors?.[1]||o.lapB.s2):"â€”"),1),a("td",zr,g(o.lapB?Fe(o.lapB.sectors?.[2]||o.lapB.s3):"â€”"),1)])],64))),128))])])])):(_(),b("div",Fr,[a("table",Ur,[s[51]||(s[51]=a("thead",null,[a("tr",null,[a("th",null,"Giro"),a("th",null,"Tempo"),a("th",null,"Î” Teorico"),a("th",null,"S1"),a("th",null,"S2"),a("th",null,"S3"),a("th",null,"Fuel"),a("th",null,"AirÂ°"),a("th",null,"Grip"),a("th",null,"Stato")])],-1)),a("tbody",null,[(_(!0),b(O,null,Se(tt(),o=>(_(),b("tr",{key:o.lap||o.lapNumber,class:H({"lap-pit":o.pit,"lap-excluded":T.value.has(o.lap||o.lapNumber),"lap-best":yt(o)})},[a("td",null,g(o.lap||o.lapNumber),1),a("td",Gr,g(o.time||o.lapTime),1),a("td",{class:H(["delta",`delta--${S(o.delta)}`])},g(o.delta||"â€”"),3),a("td",{class:H(["sector",{"sector--best":Oe(o,0)}])},g(Fe(o.sectors?.[0]||o.s1)),3),a("td",{class:H(["sector",{"sector--best":Oe(o,1)}])},g(Fe(o.sectors?.[1]||o.s2)),3),a("td",{class:H(["sector",{"sector--best":Oe(o,2)}])},g(Fe(o.sectors?.[2]||o.s3)),3),a("td",null,g(o.fuel)+"L",1),a("td",null,g(Math.round(o.airTemp||o.air||0))+"Â°",1),a("td",null,g(o.grip),1),a("td",Qr,[o.pit?(_(),b("span",Hr,"PIT")):o.valid?(_(),b("span",Yr,"OK")):(_(),b("span",Vr,"INV"))])],2))),128))])])]))])])])],64))]),_:1}),ys(m,{"is-open":It.value,"current-track":P.value?.track||"","exclude-session-id":f.sessionId,onClose:s[5]||(s[5]=o=>It.value=!1),onSelect:Lt},null,8,["is-open","current-track","exclude-session-id"])])}}}),Kr=Object.assign(En(Wr,[["__scopeId","data-v-5d821495"]]),{__name:"PagesSessionDetailPage"});export{Kr as _};
