import{_ as zn}from"./cA5BAEAQ.js";import{b as gn,a2 as zs,a as _n,r as z,t as k,a4 as Y,a6 as bn,a5 as yn,ae as Tn,L as Sn,F as _,an as Cn,E as b,P as Z,aa as Et,G as a,H as g,M as ss,a3 as Fn,a7 as Un,ab as Gn,ao as Qn,Q as O,R as Te,a0 as H,_ as kn,o as Hn,ap as Vn,w as Ns,aq as Yn,I as ys,J as en,ar as Wn,K as V,$ as ts}from"./DxVKFRpb.js";import{f as ct,g as de,h as Ys,v as Ss,j as tn,s as sn,_ as Zn,C as Xn,a as qn,L as jn,P as Kn,b as Jn,p as ea,c as ta,d as sa,i as na,e as aa}from"./xJY-dFrt.js";import{u as ia}from"./CZ92alvS.js";const oa={class:"session-picker-modal"},la={class:"spm-header"},ra={class:"spm-subtitle"},ua={class:"spm-link-section"},ca={class:"link-input-row"},da=["disabled"],pa={key:0,class:"link-error"},va={class:"spm-list"},fa=["onClick"],ma={class:"row-left"},ha={class:"session-date"},ga={class:"session-time"},_a={class:"session-car"},ba={class:"row-right"},ya={class:"stat-chips"},Ta={class:"stat-chip"},Sa={class:"stat-chip"},Ca={class:"time-slot"},ka={key:0,class:"time-badge time-badge--qualy"},Ea={key:1,class:"time-badge time-badge--qualy time-badge--empty"},Aa={class:"time-slot"},xa={key:0,class:"time-badge time-badge--race"},Ma={key:1,class:"time-badge time-badge--race time-badge--empty"},Ia={key:0,class:"spm-empty"},Ra=gn({__name:"SessionPickerModal",props:{isOpen:{type:Boolean},currentTrack:{},excludeSessionId:{}},emits:["close","select"],setup(e,{emit:l}){const r=e,p=l,{sessions:d,fetchSessionFull:f}=zs(),{getUserProfile:y}=_n(),S=z(""),E=z(""),x=z(!1);function L(ae){const M=ae.match(/\/sessioni\/([^?]+)\?userId=([^&]+)/);return M&&M[1]&&M[2]?{sessionId:M[1],userId:M[2]}:null}async function U(){E.value="";const ae=L(S.value);if(!ae){E.value="Link non valido. Formato atteso: .../sessioni/ID?userId=...";return}x.value=!0;try{const M=await f(ae.sessionId,ae.userId);if(!M){E.value="Sessione non trovata o non piÃ¹ condivisa";return}const q=(M.session_info?.track||"").toLowerCase().replace(/[^a-z0-9]/g,"_"),Ye=r.currentTrack.toLowerCase().replace(/[^a-z0-9]/g,"_");if(!q.includes(Ye)&&!Ye.includes(q)){E.value=`Pista non corrispondente: ${M.session_info?.track||"sconosciuta"} vs ${r.currentTrack}`;return}let pt="Utente Esterno";try{const We=await y(ae.userId);pt=We?.nickname||We?.displayName||"Utente Esterno"}catch{}p("select",ae.sessionId,ae.userId,pt),p("close")}catch(M){console.error("[SHARE] Error loading shared session:",M),E.value=M?.code==="permission-denied"?"Sessione non piÃ¹ condivisa o accesso negato":"Errore nel caricamento della sessione"}finally{x.value=!1}}const W=k(()=>{const ae=r.currentTrack.toLowerCase().replace(/[^a-z0-9]/g,"_");return d.value.filter(M=>{if(M.sessionId===r.excludeSessionId)return!1;const q=M.meta.track.toLowerCase().replace(/[^a-z0-9]/g,"_");return q.includes(ae)||ae.includes(q)}).map(M=>({id:M.sessionId,date:X(M.meta.date_start),time:Tn(M.meta.date_start),type:yn(M.meta.session_type),car:bn(M.meta.car),laps:M.summary.laps||0,stints:M.summary.stintCount||1,bestQualy:M.summary.best_qualy_ms?Y(M.summary.best_qualy_ms):null,bestRace:M.summary.best_race_ms?Y(M.summary.best_race_ms):null}))});function X(ae){if(!ae)return"-";const M=new Date(ae);return`${M.getDate()} ${["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"][M.getMonth()]} ${M.getFullYear()}`}function Ge(ae){return{practice:"PRACTICE",qualify:"QUALIFY",race:"RACE"}[ae]||ae.toUpperCase()}function ge(ae){p("select",ae),p("close")}function dt(){p("close")}return(ae,M)=>(_(),Sn(Cn,{to:"body"},[e.isOpen?(_(),b("div",{key:0,class:"session-picker-overlay",onClick:Et(dt,["self"])},[a("div",oa,[a("div",la,[M[1]||(M[1]=a("h2",{class:"spm-title"},"Aggiungi Sorgente Dati",-1)),a("p",ra,g(ss(Fn)(e.currentTrack))+" Â· "+g(W.value.length)+" sessioni disponibili",1),a("button",{class:"spm-close",onClick:dt},"âœ•")]),a("div",ua,[M[2]||(M[2]=a("label",{class:"link-label"},"ðŸ“‹ Incolla link sessione condivisa",-1)),a("div",ca,[Un(a("input",{"onUpdate:modelValue":M[0]||(M[0]=q=>S.value=q),type:"text",class:"link-input",placeholder:"https://...?userId=...",onKeyup:Qn(U,["enter"])},null,544),[[Gn,S.value]]),a("button",{class:"link-load-btn",disabled:x.value||!S.value,onClick:U},g(x.value?"...":"Carica"),9,da)]),E.value?(_(),b("p",pa,g(E.value),1)):Z("",!0)]),M[3]||(M[3]=a("div",{class:"spm-divider"},[a("span",null,"oppure seleziona dalle tue sessioni")],-1)),a("div",va,[(_(!0),b(O,null,Te(W.value,q=>(_(),b("div",{key:q.id,class:"session-row",onClick:Ye=>ge(q.id)},[a("div",ma,[a("span",{class:H(["session-chip",`session-chip--${q.type}`])},g(Ge(q.type)),3),a("span",ha,g(q.date),1),a("span",ga,g(q.time),1),a("span",_a,g(q.car),1)]),a("div",ba,[a("div",ya,[a("span",Ta,"GIRI "+g(q.laps),1),a("span",Sa,"STINT "+g(q.stints),1)]),a("div",Ca,[q.bestQualy?(_(),b("span",ka," Q "+g(q.bestQualy),1)):(_(),b("span",Ea," Q â€” "))]),a("div",Aa,[q.bestRace?(_(),b("span",xa," R "+g(q.bestRace),1)):(_(),b("span",Ma," R â€” "))])])],8,fa))),128)),W.value.length===0?(_(),b("div",Ia," Nessuna altra sessione disponibile per questa pista. ")):Z("",!0)])])])):Z("",!0)]))}}),La=Object.assign(kn(Ra,[["__scopeId","data-v-72b43332"]]),{__name:"UiSessionPickerModal"});function Pa(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ws={exports:{}};var nn;function Oa(){return nn||(nn=1,(function(e){(function(l,r,p,d){var f=["","webkit","Moz","MS","ms","o"],y=r.createElement("div"),S="function",E=Math.round,x=Math.abs,L=Date.now;function U(t,n,u){return setTimeout(q(t,u),n)}function W(t,n,u){return Array.isArray(t)?(X(t,u[n],u),!0):!1}function X(t,n,u){var v;if(t)if(t.forEach)t.forEach(n,u);else if(t.length!==d)for(v=0;v<t.length;)n.call(u,t[v],v,t),v++;else for(v in t)t.hasOwnProperty(v)&&n.call(u,t[v],v,t)}function Ge(t,n,u){var v="DEPRECATED METHOD: "+n+`
`+u+` AT 
`;return function(){var T=new Error("get-stack-trace"),C=T&&T.stack?T.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",B=l.console&&(l.console.warn||l.console.log);return B&&B.call(l.console,v,C),t.apply(this,arguments)}}var ge;typeof Object.assign!="function"?ge=function(n){if(n===d||n===null)throw new TypeError("Cannot convert undefined or null to object");for(var u=Object(n),v=1;v<arguments.length;v++){var T=arguments[v];if(T!==d&&T!==null)for(var C in T)T.hasOwnProperty(C)&&(u[C]=T[C])}return u}:ge=Object.assign;var dt=Ge(function(n,u,v){for(var T=Object.keys(u),C=0;C<T.length;)(!v||v&&n[T[C]]===d)&&(n[T[C]]=u[T[C]]),C++;return n},"extend","Use `assign`."),ae=Ge(function(n,u){return dt(n,u,!0)},"merge","Use `assign`.");function M(t,n,u){var v=n.prototype,T;T=t.prototype=Object.create(v),T.constructor=t,T._super=v,u&&ge(T,u)}function q(t,n){return function(){return t.apply(n,arguments)}}function Ye(t,n){return typeof t==S?t.apply(n&&n[0]||d,n):t}function pt(t,n){return t===d?n:t}function We(t,n,u){X(Ke(n),function(v){t.addEventListener(v,u,!1)})}function xt(t,n,u){X(Ke(n),function(v){t.removeEventListener(v,u,!1)})}function os(t,n){for(;t;){if(t==n)return!0;t=t.parentNode}return!1}function je(t,n){return t.indexOf(n)>-1}function Ke(t){return t.trim().split(/\s+/g)}function Ze(t,n,u){if(t.indexOf&&!u)return t.indexOf(n);for(var v=0;v<t.length;){if(u&&t[v][u]==n||!u&&t[v]===n)return v;v++}return-1}function Xe(t){return Array.prototype.slice.call(t,0)}function Mt(t,n,u){for(var v=[],T=[],C=0;C<t.length;){var B=t[C][n];Ze(T,B)<0&&v.push(t[C]),T[C]=B,C++}return v=v.sort(function(J,le){return J[n]>le[n]}),v}function Je(t,n){for(var u,v,T=n[0].toUpperCase()+n.slice(1),C=0;C<f.length;){if(u=f[C],v=u?u+T:n,v in t)return v;C++}return d}var Cs=1;function ls(){return Cs++}function rs(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||l}var Ht=/mobile|tablet|ip(ad|hone|od)|android/i,ke="ontouchstart"in l,fe=Je(l,"PointerEvent")!==d,qe=ke&&Ht.test(navigator.userAgent),Ae="touch",It="pen",vt="mouse",ve="kinect",ft=25,me=1,Qe=2,ue=4,Se=8,Rt=1,mt=2,D=4,I=8,ht=16,Q=mt|D,F=I|ht,w=Q|F,gt=["x","y"],Lt=["clientX","clientY"];function xe(t,n){var u=this;this.manager=t,this.callback=n,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(v){Ye(t.options.enable,[t])&&u.handler(v)},this.init()}xe.prototype={handler:function(){},init:function(){this.evEl&&We(this.element,this.evEl,this.domHandler),this.evTarget&&We(this.target,this.evTarget,this.domHandler),this.evWin&&We(rs(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&xt(this.element,this.evEl,this.domHandler),this.evTarget&&xt(this.target,this.evTarget,this.domHandler),this.evWin&&xt(rs(this.element),this.evWin,this.domHandler)}};function us(t){var n,u=t.options.inputClass;return u?n=u:fe?n=Nt:qe?n=bt:ke?n=qt:n=_t,new n(t,Vt)}function Vt(t,n,u){var v=u.pointers.length,T=u.changedPointers.length,C=n&me&&v-T===0,B=n&(ue|Se)&&v-T===0;u.isFirst=!!C,u.isFinal=!!B,C&&(t.session={}),u.eventType=n,K(t,u),t.emit("hammer.input",u),t.recognize(u),t.session.prevInput=u}function K(t,n){var u=t.session,v=n.pointers,T=v.length;u.firstInput||(u.firstInput=Yt(n)),T>1&&!u.firstMultiple?u.firstMultiple=Yt(n):T===1&&(u.firstMultiple=!1);var C=u.firstInput,B=u.firstMultiple,pe=B?B.center:C.center,J=n.center=cs(v);n.timeStamp=L(),n.deltaTime=n.timeStamp-C.timeStamp,n.angle=Wt(pe,J),n.distance=nt(pe,J),Pt(u,n),n.offsetDirection=ne(n.deltaX,n.deltaY);var le=se(n.deltaTime,n.deltaX,n.deltaY);n.overallVelocityX=le.x,n.overallVelocityY=le.y,n.overallVelocity=x(le.x)>x(le.y)?le.x:le.y,n.scale=B?ds(B.pointers,v):1,n.rotation=B?Es(B.pointers,v):0,n.maxPointers=u.prevInput?n.pointers.length>u.prevInput.maxPointers?n.pointers.length:u.prevInput.maxPointers:n.pointers.length,ks(u,n);var Fe=t.element;os(n.srcEvent.target,Fe)&&(Fe=n.srcEvent.target),n.target=Fe}function Pt(t,n){var u=n.center,v=t.offsetDelta||{},T=t.prevDelta||{},C=t.prevInput||{};(n.eventType===me||C.eventType===ue)&&(T=t.prevDelta={x:C.deltaX||0,y:C.deltaY||0},v=t.offsetDelta={x:u.x,y:u.y}),n.deltaX=T.x+(u.x-v.x),n.deltaY=T.y+(u.y-v.y)}function ks(t,n){var u=t.lastInterval||n,v=n.timeStamp-u.timeStamp,T,C,B,pe;if(n.eventType!=Se&&(v>ft||u.velocity===d)){var J=n.deltaX-u.deltaX,le=n.deltaY-u.deltaY,Fe=se(v,J,le);C=Fe.x,B=Fe.y,T=x(Fe.x)>x(Fe.y)?Fe.x:Fe.y,pe=ne(J,le),t.lastInterval=n}else T=u.velocity,C=u.velocityX,B=u.velocityY,pe=u.direction;n.velocity=T,n.velocityX=C,n.velocityY=B,n.direction=pe}function Yt(t){for(var n=[],u=0;u<t.pointers.length;)n[u]={clientX:E(t.pointers[u].clientX),clientY:E(t.pointers[u].clientY)},u++;return{timeStamp:L(),pointers:n,center:cs(n),deltaX:t.deltaX,deltaY:t.deltaY}}function cs(t){var n=t.length;if(n===1)return{x:E(t[0].clientX),y:E(t[0].clientY)};for(var u=0,v=0,T=0;T<n;)u+=t[T].clientX,v+=t[T].clientY,T++;return{x:E(u/n),y:E(v/n)}}function se(t,n,u){return{x:n/t||0,y:u/t||0}}function ne(t,n){return t===n?Rt:x(t)>=x(n)?t<0?mt:D:n<0?I:ht}function nt(t,n,u){u||(u=gt);var v=n[u[0]]-t[u[0]],T=n[u[1]]-t[u[1]];return Math.sqrt(v*v+T*T)}function Wt(t,n,u){u||(u=gt);var v=n[u[0]]-t[u[0]],T=n[u[1]]-t[u[1]];return Math.atan2(T,v)*180/Math.PI}function Es(t,n){return Wt(n[1],n[0],Lt)+Wt(t[1],t[0],Lt)}function ds(t,n){return nt(n[0],n[1],Lt)/nt(t[0],t[1],Lt)}var Zt={mousedown:me,mousemove:Qe,mouseup:ue},Ot="mousedown",ps="mousemove mouseup";function _t(){this.evEl=Ot,this.evWin=ps,this.pressed=!1,xe.apply(this,arguments)}M(_t,xe,{handler:function(n){var u=Zt[n.type];u&me&&n.button===0&&(this.pressed=!0),u&Qe&&n.which!==1&&(u=ue),this.pressed&&(u&ue&&(this.pressed=!1),this.callback(this.manager,u,{pointers:[n],changedPointers:[n],pointerType:vt,srcEvent:n}))}});var vs={pointerdown:me,pointermove:Qe,pointerup:ue,pointercancel:Se,pointerout:Se},fs={2:Ae,3:It,4:vt,5:ve},Xt="pointerdown",Dt="pointermove pointerup pointercancel";l.MSPointerEvent&&!l.PointerEvent&&(Xt="MSPointerDown",Dt="MSPointerMove MSPointerUp MSPointerCancel");function Nt(){this.evEl=Xt,this.evWin=Dt,xe.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}M(Nt,xe,{handler:function(n){var u=this.store,v=!1,T=n.type.toLowerCase().replace("ms",""),C=vs[T],B=fs[n.pointerType]||n.pointerType,pe=B==Ae,J=Ze(u,n.pointerId,"pointerId");C&me&&(n.button===0||pe)?J<0&&(u.push(n),J=u.length-1):C&(ue|Se)&&(v=!0),!(J<0)&&(u[J]=n,this.callback(this.manager,C,{pointers:u,changedPointers:[n],pointerType:B,srcEvent:n}),v&&u.splice(J,1))}});var As={touchstart:me,touchmove:Qe,touchend:ue,touchcancel:Se},xs="touchstart",Ms="touchstart touchmove touchend touchcancel";function ms(){this.evTarget=xs,this.evWin=Ms,this.started=!1,xe.apply(this,arguments)}M(ms,xe,{handler:function(n){var u=As[n.type];if(u===me&&(this.started=!0),!!this.started){var v=Is.call(this,n,u);u&(ue|Se)&&v[0].length-v[1].length===0&&(this.started=!1),this.callback(this.manager,u,{pointers:v[0],changedPointers:v[1],pointerType:Ae,srcEvent:n})}}});function Is(t,n){var u=Xe(t.touches),v=Xe(t.changedTouches);return n&(ue|Se)&&(u=Mt(u.concat(v),"identifier")),[u,v]}var Rs={touchstart:me,touchmove:Qe,touchend:ue,touchcancel:Se},Ls="touchstart touchmove touchend touchcancel";function bt(){this.evTarget=Ls,this.targetIds={},xe.apply(this,arguments)}M(bt,xe,{handler:function(n){var u=Rs[n.type],v=hs.call(this,n,u);v&&this.callback(this.manager,u,{pointers:v[0],changedPointers:v[1],pointerType:Ae,srcEvent:n})}});function hs(t,n){var u=Xe(t.touches),v=this.targetIds;if(n&(me|Qe)&&u.length===1)return v[u[0].identifier]=!0,[u,u];var T,C,B=Xe(t.changedTouches),pe=[],J=this.target;if(C=u.filter(function(le){return os(le.target,J)}),n===me)for(T=0;T<C.length;)v[C[T].identifier]=!0,T++;for(T=0;T<B.length;)v[B[T].identifier]&&pe.push(B[T]),n&(ue|Se)&&delete v[B[T].identifier],T++;if(pe.length)return[Mt(C.concat(pe),"identifier"),pe]}var Ps=2500,Os=25;function qt(){xe.apply(this,arguments);var t=q(this.handler,this);this.touch=new bt(this.manager,t),this.mouse=new _t(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}M(qt,xe,{handler:function(n,u,v){var T=v.pointerType==Ae,C=v.pointerType==vt;if(!(C&&v.sourceCapabilities&&v.sourceCapabilities.firesTouchEvents)){if(T)P.call(this,u,v);else if(C&&Me.call(this,v))return;this.callback(n,u,v)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function P(t,n){t&me?(this.primaryTouch=n.changedPointers[0].identifier,he.call(this,n)):t&(ue|Se)&&he.call(this,n)}function he(t){var n=t.changedPointers[0];if(n.identifier===this.primaryTouch){var u={x:n.clientX,y:n.clientY};this.lastTouches.push(u);var v=this.lastTouches,T=function(){var C=v.indexOf(u);C>-1&&v.splice(C,1)};setTimeout(T,Ps)}}function Me(t){for(var n=t.srcEvent.clientX,u=t.srcEvent.clientY,v=0;v<this.lastTouches.length;v++){var T=this.lastTouches[v],C=Math.abs(n-T.x),B=Math.abs(u-T.y);if(C<=Os&&B<=Os)return!0}return!1}var wt=Je(y.style,"touchAction"),te=wt!==d,Ce="compute",Bt="auto",jt="manipulation",et="none",at="pan-x",yt="pan-y",He=gs();function Ne(t,n){this.manager=t,this.set(n)}Ne.prototype={set:function(t){t==Ce&&(t=this.compute()),te&&this.manager.element.style&&He[t]&&(this.manager.element.style[wt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return X(this.manager.recognizers,function(n){Ye(n.options.enable,[n])&&(t=t.concat(n.getTouchAction()))}),$t(t.join(" "))},preventDefaults:function(t){var n=t.srcEvent,u=t.offsetDirection;if(this.manager.session.prevented){n.preventDefault();return}var v=this.actions,T=je(v,et)&&!He[et],C=je(v,yt)&&!He[yt],B=je(v,at)&&!He[at];if(T){var pe=t.pointers.length===1,J=t.distance<2,le=t.deltaTime<250;if(pe&&J&&le)return}if(!(B&&C)&&(T||C&&u&Q||B&&u&F))return this.preventSrc(n)},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};function $t(t){if(je(t,et))return et;var n=je(t,at),u=je(t,yt);return n&&u?et:n||u?n?at:yt:je(t,jt)?jt:Bt}function gs(){if(!te)return!1;var t={},n=l.CSS&&l.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(u){t[u]=n?l.CSS.supports("touch-action",u):!0}),t}var we=1,ce=2,tt=4,Ie=8,Oe=Ie,Tt=16,Be=32;function $e(t){this.options=ge({},this.defaults,t||{}),this.id=ls(),this.manager=null,this.options.enable=pt(this.options.enable,!0),this.state=we,this.simultaneous={},this.requireFail=[]}$e.prototype={defaults:{},set:function(t){return ge(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(W(t,"recognizeWith",this))return this;var n=this.simultaneous;return t=it(t,this),n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return W(t,"dropRecognizeWith",this)?this:(t=it(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(W(t,"requireFailure",this))return this;var n=this.requireFail;return t=it(t,this),Ze(n,t)===-1&&(n.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(W(t,"dropRequireFailure",this))return this;t=it(t,this);var n=Ze(this.requireFail,t);return n>-1&&this.requireFail.splice(n,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var n=this,u=this.state;function v(T){n.manager.emit(T,t)}u<Ie&&v(n.options.event+Kt(u)),v(n.options.event),t.additionalEvent&&v(t.additionalEvent),u>=Ie&&v(n.options.event+Kt(u))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=Be},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(Be|we)))return!1;t++}return!0},recognize:function(t){var n=ge({},t);if(!Ye(this.options.enable,[this,n])){this.reset(),this.state=Be;return}this.state&(Oe|Tt|Be)&&(this.state=we),this.state=this.process(n),this.state&(ce|tt|Ie|Tt)&&this.tryEmit(n)},process:function(t){},getTouchAction:function(){},reset:function(){}};function Kt(t){return t&Tt?"cancel":t&Ie?"end":t&tt?"move":t&ce?"start":""}function _s(t){return t==ht?"down":t==I?"up":t==mt?"left":t==D?"right":""}function it(t,n){var u=n.manager;return u?u.get(t):t}function Re(){$e.apply(this,arguments)}M(Re,$e,{defaults:{pointers:1},attrTest:function(t){var n=this.options.pointers;return n===0||t.pointers.length===n},process:function(t){var n=this.state,u=t.eventType,v=n&(ce|tt),T=this.attrTest(t);return v&&(u&Se||!T)?n|Tt:v||T?u&ue?n|Ie:n&ce?n|tt:ce:Be}});function St(){Re.apply(this,arguments),this.pX=null,this.pY=null}M(St,Re,{defaults:{event:"pan",threshold:10,pointers:1,direction:w},getTouchAction:function(){var t=this.options.direction,n=[];return t&Q&&n.push(yt),t&F&&n.push(at),n},directionTest:function(t){var n=this.options,u=!0,v=t.distance,T=t.direction,C=t.deltaX,B=t.deltaY;return T&n.direction||(n.direction&Q?(T=C===0?Rt:C<0?mt:D,u=C!=this.pX,v=Math.abs(t.deltaX)):(T=B===0?Rt:B<0?I:ht,u=B!=this.pY,v=Math.abs(t.deltaY))),t.direction=T,u&&v>n.threshold&&T&n.direction},attrTest:function(t){return Re.prototype.attrTest.call(this,t)&&(this.state&ce||!(this.state&ce)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var n=_s(t.direction);n&&(t.additionalEvent=this.options.event+n),this._super.emit.call(this,t)}});function st(){Re.apply(this,arguments)}M(st,Re,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[et]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&ce)},emit:function(t){if(t.scale!==1){var n=t.scale<1?"in":"out";t.additionalEvent=this.options.event+n}this._super.emit.call(this,t)}});function De(){$e.apply(this,arguments),this._timer=null,this._input=null}M(De,$e,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Bt]},process:function(t){var n=this.options,u=t.pointers.length===n.pointers,v=t.distance<n.threshold,T=t.deltaTime>n.time;if(this._input=t,!v||!u||t.eventType&(ue|Se)&&!T)this.reset();else if(t.eventType&me)this.reset(),this._timer=U(function(){this.state=Oe,this.tryEmit()},n.time,this);else if(t.eventType&ue)return Oe;return Be},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Oe&&(t&&t.eventType&ue?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=L(),this.manager.emit(this.options.event,this._input)))}});function ot(){Re.apply(this,arguments)}M(ot,Re,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[et]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&ce)}});function zt(){Re.apply(this,arguments)}M(zt,Re,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Q|F,pointers:1},getTouchAction:function(){return St.prototype.getTouchAction.call(this)},attrTest:function(t){var n=this.options.direction,u;return n&(Q|F)?u=t.overallVelocity:n&Q?u=t.overallVelocityX:n&F&&(u=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&x(u)>this.options.velocity&&t.eventType&ue},emit:function(t){var n=_s(t.offsetDirection);n&&this.manager.emit(this.options.event+n,t),this.manager.emit(this.options.event,t)}});function Ct(){$e.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}M(Ct,$e,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[jt]},process:function(t){var n=this.options,u=t.pointers.length===n.pointers,v=t.distance<n.threshold,T=t.deltaTime<n.time;if(this.reset(),t.eventType&me&&this.count===0)return this.failTimeout();if(v&&T&&u){if(t.eventType!=ue)return this.failTimeout();var C=this.pTime?t.timeStamp-this.pTime<n.interval:!0,B=!this.pCenter||nt(this.pCenter,t.center)<n.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,!B||!C?this.count=1:this.count+=1,this._input=t;var pe=this.count%n.taps;if(pe===0)return this.hasRequireFailures()?(this._timer=U(function(){this.state=Oe,this.tryEmit()},n.interval,this),ce):Oe}return Be},failTimeout:function(){return this._timer=U(function(){this.state=Be},this.options.interval,this),Be},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Oe&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ve(t,n){return n=n||{},n.recognizers=pt(n.recognizers,Ve.defaults.preset),new Ut(t,n)}Ve.VERSION="2.0.7",Ve.defaults={domEvents:!1,touchAction:Ce,enable:!0,inputTarget:null,inputClass:null,preset:[[ot,{enable:!1}],[st,{enable:!1},["rotate"]],[zt,{direction:Q}],[St,{direction:Q},["swipe"]],[Ct],[Ct,{event:"doubletap",taps:2},["tap"]],[De]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ft=1,ze=2;function Ut(t,n){this.options=ge({},Ve.defaults,n||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=us(this),this.touchAction=new Ne(this,this.options.touchAction),Jt(this,!0),X(this.options.recognizers,function(u){var v=this.add(new u[0](u[1]));u[2]&&v.recognizeWith(u[2]),u[3]&&v.requireFailure(u[3])},this)}Ut.prototype={set:function(t){return ge(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?ze:Ft},recognize:function(t){var n=this.session;if(!n.stopped){this.touchAction.preventDefaults(t);var u,v=this.recognizers,T=n.curRecognizer;(!T||T&&T.state&Oe)&&(T=n.curRecognizer=null);for(var C=0;C<v.length;)u=v[C],n.stopped!==ze&&(!T||u==T||u.canRecognizeWith(T))?u.recognize(t):u.reset(),!T&&u.state&(ce|tt|Ie)&&(T=n.curRecognizer=u),C++}},get:function(t){if(t instanceof $e)return t;for(var n=this.recognizers,u=0;u<n.length;u++)if(n[u].options.event==t)return n[u];return null},add:function(t){if(W(t,"add",this))return this;var n=this.get(t.options.event);return n&&this.remove(n),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(W(t,"remove",this))return this;if(t=this.get(t),t){var n=this.recognizers,u=Ze(n,t);u!==-1&&(n.splice(u,1),this.touchAction.update())}return this},on:function(t,n){if(t!==d&&n!==d){var u=this.handlers;return X(Ke(t),function(v){u[v]=u[v]||[],u[v].push(n)}),this}},off:function(t,n){if(t!==d){var u=this.handlers;return X(Ke(t),function(v){n?u[v]&&u[v].splice(Ze(u[v],n),1):delete u[v]}),this}},emit:function(t,n){this.options.domEvents&&Gt(t,n);var u=this.handlers[t]&&this.handlers[t].slice();if(!(!u||!u.length)){n.type=t,n.preventDefault=function(){n.srcEvent.preventDefault()};for(var v=0;v<u.length;)u[v](n),v++}},destroy:function(){this.element&&Jt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Jt(t,n){var u=t.element;if(u.style){var v;X(t.options.cssProps,function(T,C){v=Je(u.style,C),n?(t.oldCssProps[v]=u.style[v],u.style[v]=T):u.style[v]=t.oldCssProps[v]||""}),n||(t.oldCssProps={})}}function Gt(t,n){var u=r.createEvent("Event");u.initEvent(t,!0,!0),u.gesture=n,n.target.dispatchEvent(u)}ge(Ve,{INPUT_START:me,INPUT_MOVE:Qe,INPUT_END:ue,INPUT_CANCEL:Se,STATE_POSSIBLE:we,STATE_BEGAN:ce,STATE_CHANGED:tt,STATE_ENDED:Ie,STATE_RECOGNIZED:Oe,STATE_CANCELLED:Tt,STATE_FAILED:Be,DIRECTION_NONE:Rt,DIRECTION_LEFT:mt,DIRECTION_RIGHT:D,DIRECTION_UP:I,DIRECTION_DOWN:ht,DIRECTION_HORIZONTAL:Q,DIRECTION_VERTICAL:F,DIRECTION_ALL:w,Manager:Ut,Input:xe,TouchAction:Ne,TouchInput:bt,MouseInput:_t,PointerEventInput:Nt,TouchMouseInput:qt,SingleTouchInput:ms,Recognizer:$e,AttrRecognizer:Re,Tap:Ct,Pan:St,Swipe:zt,Pinch:st,Rotate:ot,Press:De,on:We,off:xt,each:X,merge:ae,extend:dt,assign:ge,inherit:M,bindFn:q,prefixed:Je});var Ds=typeof l<"u"?l:typeof self<"u"?self:{};Ds.Hammer=Ve,e.exports?e.exports=Ve:l[p]=Ve})(window,document,"Hammer")})(ws)),ws.exports}var Da=Oa();const ns=Pa(Da);const is=e=>e&&e.enabled&&e.modifierKey,En=(e,l)=>e&&l[e+"Key"],Ws=(e,l)=>e&&!l[e+"Key"];function ut(e,l,r){return e===void 0?!0:typeof e=="string"?e.indexOf(l)!==-1:typeof e=="function"?e({chart:r}).indexOf(l)!==-1:!1}function Bs(e,l){return typeof e=="function"&&(e=e({chart:l})),typeof e=="string"?{x:e.indexOf("x")!==-1,y:e.indexOf("y")!==-1}:{x:!1,y:!1}}function Na(e,l){let r;return function(){return clearTimeout(r),r=setTimeout(e,l),l}}function wa({x:e,y:l},r){const p=r.scales,d=Object.keys(p);for(let f=0;f<d.length;f++){const y=p[d[f]];if(l>=y.top&&l<=y.bottom&&e>=y.left&&e<=y.right)return y}return null}function An(e,l,r){const{mode:p="xy",scaleMode:d,overScaleMode:f}=e||{},y=wa(l,r),S=Bs(p,r),E=Bs(d,r);if(f){const L=Bs(f,r);for(const U of["x","y"])L[U]&&(E[U]=S[U],S[U]=!1)}if(y&&E[y.axis])return[y];const x=[];return ct(r.scales,function(L){S[L.axis]&&x.push(L)}),x}const Fs=new WeakMap;function re(e){let l=Fs.get(e);return l||(l={originalScaleLimits:{},updatedScaleLimits:{},handlers:{},panDelta:{},dragging:!1,panning:!1},Fs.set(e,l)),l}function Ba(e){Fs.delete(e)}function xn(e,l,r,p){const d=Math.max(0,Math.min(1,(e-l)/r||0)),f=1-d;return{min:p*d,max:p*f}}function Mn(e,l){const r=e.isHorizontal()?l.x:l.y;return e.getValueForPixel(r)}function In(e,l,r){const p=e.max-e.min,d=p*(l-1),f=Mn(e,r);return xn(f,e.min,p,d)}function $a(e,l,r){const p=Mn(e,r);if(p===void 0)return{min:e.min,max:e.max};const d=Math.log10(e.min),f=Math.log10(e.max),y=Math.log10(p),S=f-d,E=S*(l-1),x=xn(y,d,S,E);return{min:Math.pow(10,d+x.min),max:Math.pow(10,f-x.max)}}function za(e,l){return l&&(l[e.id]||l[e.axis])||{}}function an(e,l,r,p,d){let f=r[p];if(f==="original"){const y=e.originalScaleLimits[l.id][p];f=Ss(y.options,y.scale)}return Ss(f,d)}function Fa(e,l,r){const p=e.getValueForPixel(l),d=e.getValueForPixel(r);return{min:Math.min(p,d),max:Math.max(p,d)}}function Ua(e,{min:l,max:r,minLimit:p,maxLimit:d},f){const y=(e-r+l)/2;l-=y,r+=y;const S=f.min.options??f.min.scale,E=f.max.options??f.max.scale,x=e/1e6;return tn(l,S,x)&&(l=S),tn(r,E,x)&&(r=E),l<p?(l=p,r=Math.min(p+e,d)):r>d&&(r=d,l=Math.max(d-e,p)),{min:l,max:r}}function At(e,{min:l,max:r},p,d=!1){const f=re(e.chart),{options:y}=e,S=za(e,p),{minRange:E=0}=S,x=an(f,e,S,"min",-1/0),L=an(f,e,S,"max",1/0);if(d==="pan"&&(l<x||r>L))return!0;const U=e.max-e.min,W=d?Math.max(r-l,E):U;if(d&&W===E&&U<=E)return!0;const X=Ua(W,{min:l,max:r,minLimit:x,maxLimit:L},f.originalScaleLimits[e.id]);return y.min=X.min,y.max=X.max,f.updatedScaleLimits[e.id]=X,e.parse(X.min)!==e.min||e.parse(X.max)!==e.max}function Ga(e,l,r,p){const d=In(e,l,r),f={min:e.min+d.min,max:e.max-d.max};return At(e,f,p,!0)}function Qa(e,l,r,p){const d=$a(e,l,r);return At(e,d,p,!0)}function Ha(e,l,r,p){At(e,Fa(e,l,r),p,!0)}const on=e=>e===0||isNaN(e)?0:e<0?Math.min(Math.round(e),-1):Math.max(Math.round(e),1);function Va(e){const r=e.getLabels().length-1;e.min>0&&(e.min-=1),e.max<r&&(e.max+=1)}function Ya(e,l,r,p){const d=In(e,l,r);e.min===e.max&&l<1&&Va(e);const f={min:e.min+on(d.min),max:e.max-on(d.max)};return At(e,f,p,!0)}function Wa(e){return e.isHorizontal()?e.width:e.height}function Za(e,l,r){const d=e.getLabels().length-1;let{min:f,max:y}=e;const S=Math.max(y-f,1),E=Math.round(Wa(e)/Math.max(S,10)),x=Math.round(Math.abs(l/E));let L;return l<-E?(y=Math.min(y+x,d),f=S===1?y:y-S,L=y===d):l>E&&(f=Math.max(0,f-x),y=S===1?f:f+S,L=f===0),At(e,{min:f,max:y},r)||L}const Xa={second:500,minute:30*1e3,hour:1800*1e3,day:720*60*1e3,week:3.5*24*60*60*1e3,month:360*60*60*1e3,quarter:1440*60*60*1e3,year:4368*60*60*1e3};function Rn(e,l,r,p=!1){const{min:d,max:f,options:y}=e,S=y.time&&y.time.round,E=Xa[S]||0,x=e.getValueForPixel(e.getPixelForValue(d+E)-l),L=e.getValueForPixel(e.getPixelForValue(f+E)-l);return isNaN(x)||isNaN(L)?!0:At(e,{min:x,max:L},r,p?"pan":!1)}function ln(e,l,r){return Rn(e,l,r,!0)}const Us={category:Ya,default:Ga,logarithmic:Qa},Gs={default:Ha},Qs={category:Za,default:Rn,logarithmic:ln,timeseries:ln};function qa(e,l,r){const{id:p,options:{min:d,max:f}}=e;if(!l[p]||!r[p])return!0;const y=r[p];return y.min!==d||y.max!==f}function rn(e,l){ct(e,(r,p)=>{l[p]||delete e[p]})}function Qt(e,l){const{scales:r}=e,{originalScaleLimits:p,updatedScaleLimits:d}=l;return ct(r,function(f){qa(f,p,d)&&(p[f.id]={min:{scale:f.min,options:f.options.min},max:{scale:f.max,options:f.options.max}})}),rn(p,r),rn(d,r),p}function un(e,l,r,p){const d=Us[e.type]||Us.default;de(d,[e,l,r,p])}function cn(e,l,r,p){const d=Gs[e.type]||Gs.default;de(d,[e,l,r,p])}function ja(e){const l=e.chartArea;return{x:(l.left+l.right)/2,y:(l.top+l.bottom)/2}}function Zs(e,l,r="none",p="api"){const{x:d=1,y:f=1,focalPoint:y=ja(e)}=typeof l=="number"?{x:l,y:l}:l,S=re(e),{options:{limits:E,zoom:x}}=S;Qt(e,S);const L=d!==1,U=f!==1,W=An(x,y,e);ct(W||e.scales,function(X){X.isHorizontal()&&L?un(X,d,y,E):!X.isHorizontal()&&U&&un(X,f,y,E)}),e.update(r),de(x.onZoom,[{chart:e,trigger:p}])}function Ln(e,l,r,p="none",d="api"){const f=re(e),{options:{limits:y,zoom:S}}=f,{mode:E="xy"}=S;Qt(e,f);const x=ut(E,"x",e),L=ut(E,"y",e);ct(e.scales,function(U){U.isHorizontal()&&x?cn(U,l.x,r.x,y):!U.isHorizontal()&&L&&cn(U,l.y,r.y,y)}),e.update(p),de(S.onZoom,[{chart:e,trigger:d}])}function Ka(e,l,r,p="none",d="api"){const f=re(e);Qt(e,f);const y=e.scales[l];At(y,r,void 0,!0),e.update(p),de(f.options.zoom?.onZoom,[{chart:e,trigger:d}])}function Ja(e,l="default"){const r=re(e),p=Qt(e,r);ct(e.scales,function(d){const f=d.options;p[d.id]?(f.min=p[d.id].min.options,f.max=p[d.id].max.options):(delete f.min,delete f.max),delete r.updatedScaleLimits[d.id]}),e.update(l),de(r.options.zoom.onZoomComplete,[{chart:e}])}function ei(e,l){const r=e.originalScaleLimits[l];if(!r)return;const{min:p,max:d}=r;return Ss(d.options,d.scale)-Ss(p.options,p.scale)}function ti(e){const l=re(e);let r=1,p=1;return ct(e.scales,function(d){const f=ei(l,d.id);if(f){const y=Math.round(f/(d.max-d.min)*100)/100;r=Math.min(r,y),p=Math.max(p,y)}}),r<1?r:p}function dn(e,l,r,p){const{panDelta:d}=p,f=d[e.id]||0;sn(f)===sn(l)&&(l+=f);const y=Qs[e.type]||Qs.default;de(y,[e,l,r])?d[e.id]=0:d[e.id]=l}function Pn(e,l,r,p="none"){const{x:d=0,y:f=0}=typeof l=="number"?{x:l,y:l}:l,y=re(e),{options:{pan:S,limits:E}}=y,{onPan:x}=S||{};Qt(e,y);const L=d!==0,U=f!==0;ct(r||e.scales,function(W){W.isHorizontal()&&L?dn(W,d,E,y):!W.isHorizontal()&&U&&dn(W,f,E,y)}),e.update(p),de(x,[{chart:e}])}function On(e){const l=re(e);Qt(e,l);const r={};for(const p of Object.keys(e.scales)){const{min:d,max:f}=l.originalScaleLimits[p]||{min:{},max:{}};r[p]={min:d.scale,max:f.scale}}return r}function si(e){const l=re(e),r={};for(const p of Object.keys(e.scales))r[p]=l.updatedScaleLimits[p];return r}function ni(e){const l=On(e);for(const r of Object.keys(e.scales)){const{min:p,max:d}=l[r];if(p!==void 0&&e.scales[r].min!==p||d!==void 0&&e.scales[r].max!==d)return!0}return!1}function pn(e){const l=re(e);return l.panning||l.dragging}const vn=(e,l,r)=>Math.min(r,Math.max(l,e));function Pe(e,l){const{handlers:r}=re(e),p=r[l];p&&p.target&&(p.target.removeEventListener(l,p),delete r[l])}function as(e,l,r,p){const{handlers:d,options:f}=re(e),y=d[r];if(y&&y.target===l)return;Pe(e,r),d[r]=E=>p(e,E,f),d[r].target=l;const S=r==="wheel"?!1:void 0;l.addEventListener(r,d[r],{passive:S})}function ai(e,l){const r=re(e);r.dragStart&&(r.dragging=!0,r.dragEnd=l,e.update("none"))}function ii(e,l){const r=re(e);!r.dragStart||l.key!=="Escape"||(Pe(e,"keydown"),r.dragging=!1,r.dragStart=r.dragEnd=null,e.update("none"))}function Hs(e,l){if(e.target!==l.canvas){const r=l.canvas.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top}}return Ys(e,l)}function Dn(e,l,r){const{onZoomStart:p,onZoomRejected:d}=r;if(p){const f=Hs(l,e);if(de(p,[{chart:e,event:l,point:f}])===!1)return de(d,[{chart:e,event:l}]),!1}}function oi(e,l){if(e.legend){const f=Ys(l,e);if(Zn(f,e.legend))return}const r=re(e),{pan:p,zoom:d={}}=r.options;if(l.button!==0||En(is(p),l)||Ws(is(d.drag),l))return de(d.onZoomRejected,[{chart:e,event:l}]);Dn(e,l,d)!==!1&&(r.dragStart=l,as(e,e.canvas.ownerDocument,"mousemove",ai),as(e,window.document,"keydown",ii))}function li({begin:e,end:l},r){let p=l.x-e.x,d=l.y-e.y;const f=Math.abs(p/d);f>r?p=Math.sign(p)*Math.abs(d*r):f<r&&(d=Math.sign(d)*Math.abs(p/r)),l.x=e.x+p,l.y=e.y+d}function fn(e,l,r,{min:p,max:d,prop:f}){e[p]=vn(Math.min(r.begin[f],r.end[f]),l[p],l[d]),e[d]=vn(Math.max(r.begin[f],r.end[f]),l[p],l[d])}function ri(e,l,r){const p={begin:Hs(l.dragStart,e),end:Hs(l.dragEnd,e)};if(r){const d=e.chartArea.width/e.chartArea.height;li(p,d)}return p}function Nn(e,l,r,p){const d=ut(l,"x",e),f=ut(l,"y",e),{top:y,left:S,right:E,bottom:x,width:L,height:U}=e.chartArea,W={top:y,left:S,right:E,bottom:x},X=ri(e,r,p&&d&&f);d&&fn(W,e.chartArea,X,{min:"left",max:"right",prop:"x"}),f&&fn(W,e.chartArea,X,{min:"top",max:"bottom",prop:"y"});const Ge=W.right-W.left,ge=W.bottom-W.top;return{...W,width:Ge,height:ge,zoomX:d&&Ge?1+(L-Ge)/L:1,zoomY:f&&ge?1+(U-ge)/U:1}}function ui(e,l){const r=re(e);if(!r.dragStart)return;Pe(e,"mousemove");const{mode:p,onZoomComplete:d,drag:{threshold:f=0,maintainAspectRatio:y}}=r.options.zoom,S=Nn(e,p,{dragStart:r.dragStart,dragEnd:l},y),E=ut(p,"x",e)?S.width:0,x=ut(p,"y",e)?S.height:0,L=Math.sqrt(E*E+x*x);if(r.dragStart=r.dragEnd=null,L<=f){r.dragging=!1,e.update("none");return}Ln(e,{x:S.left,y:S.top},{x:S.right,y:S.bottom},"zoom","drag"),r.dragging=!1,r.filterNextClick=!0,de(d,[{chart:e}])}function ci(e,l,r){if(Ws(is(r.wheel),l)){de(r.onZoomRejected,[{chart:e,event:l}]);return}if(Dn(e,l,r)!==!1&&(l.cancelable&&l.preventDefault(),l.deltaY!==void 0))return!0}function di(e,l){const{handlers:{onZoomComplete:r},options:{zoom:p}}=re(e);if(!ci(e,l,p))return;const d=l.target.getBoundingClientRect(),f=p.wheel.speed,y=l.deltaY>=0?2-1/(1-f):1+f,S={x:y,y,focalPoint:{x:l.clientX-d.left,y:l.clientY-d.top}};Zs(e,S,"zoom","wheel"),de(r,[{chart:e}])}function pi(e,l,r,p){r&&(re(e).handlers[l]=Na(()=>de(r,[{chart:e}]),p))}function vi(e,l){const r=e.canvas,{wheel:p,drag:d,onZoomComplete:f}=l.zoom;p.enabled?(as(e,r,"wheel",di),pi(e,"onZoomComplete",f,250)):Pe(e,"wheel"),d.enabled?(as(e,r,"mousedown",oi),as(e,r.ownerDocument,"mouseup",ui)):(Pe(e,"mousedown"),Pe(e,"mousemove"),Pe(e,"mouseup"),Pe(e,"keydown"))}function fi(e){Pe(e,"mousedown"),Pe(e,"mousemove"),Pe(e,"mouseup"),Pe(e,"wheel"),Pe(e,"click"),Pe(e,"keydown")}function mi(e,l){return function(r,p){const{pan:d,zoom:f={}}=l.options;if(!d||!d.enabled)return!1;const y=p&&p.srcEvent;return y&&!l.panning&&p.pointerType==="mouse"&&(Ws(is(d),y)||En(is(f.drag),y))?(de(d.onPanRejected,[{chart:e,event:p}]),!1):!0}}function hi(e,l){const r=Math.abs(e.clientX-l.clientX),p=Math.abs(e.clientY-l.clientY),d=r/p;let f,y;return d>.3&&d<1.7?f=y=!0:r>p?f=!0:y=!0,{x:f,y}}function wn(e,l,r){if(l.scale){const{center:p,pointers:d}=r,f=1/l.scale*r.scale,y=r.target.getBoundingClientRect(),S=hi(d[0],d[1]),E=l.options.zoom.mode,x={x:S.x&&ut(E,"x",e)?f:1,y:S.y&&ut(E,"y",e)?f:1,focalPoint:{x:p.x-y.left,y:p.y-y.top}};Zs(e,x,"zoom","pinch"),l.scale=r.scale}}function gi(e,l,r){if(l.options.zoom.pinch.enabled){const p=Ys(r,e);de(l.options.zoom.onZoomStart,[{chart:e,event:r,point:p}])===!1?(l.scale=null,de(l.options.zoom.onZoomRejected,[{chart:e,event:r}])):l.scale=1}}function _i(e,l,r){l.scale&&(wn(e,l,r),l.scale=null,de(l.options.zoom.onZoomComplete,[{chart:e}]))}function Bn(e,l,r){const p=l.delta;p&&(l.panning=!0,Pn(e,{x:r.deltaX-p.x,y:r.deltaY-p.y},l.panScales),l.delta={x:r.deltaX,y:r.deltaY})}function bi(e,l,r){const{enabled:p,onPanStart:d,onPanRejected:f}=l.options.pan;if(!p)return;const y=r.target.getBoundingClientRect(),S={x:r.center.x-y.left,y:r.center.y-y.top};if(de(d,[{chart:e,event:r,point:S}])===!1)return de(f,[{chart:e,event:r}]);l.panScales=An(l.options.pan,S,e),l.delta={x:0,y:0},Bn(e,l,r)}function yi(e,l){l.delta=null,l.panning&&(l.panning=!1,l.filterNextClick=!0,de(l.options.pan.onPanComplete,[{chart:e}]))}const Vs=new WeakMap;function mn(e,l){const r=re(e),p=e.canvas,{pan:d,zoom:f}=l,y=new ns.Manager(p);f&&f.pinch.enabled&&(y.add(new ns.Pinch),y.on("pinchstart",S=>gi(e,r,S)),y.on("pinch",S=>wn(e,r,S)),y.on("pinchend",S=>_i(e,r,S))),d&&d.enabled&&(y.add(new ns.Pan({threshold:d.threshold,enable:mi(e,r)})),y.on("panstart",S=>bi(e,r,S)),y.on("panmove",S=>Bn(e,r,S)),y.on("panend",()=>yi(e,r))),Vs.set(e,y)}function hn(e){const l=Vs.get(e);l&&(l.remove("pinchstart"),l.remove("pinch"),l.remove("pinchend"),l.remove("panstart"),l.remove("pan"),l.remove("panend"),l.destroy(),Vs.delete(e))}function Ti(e,l){const{pan:r,zoom:p}=e,{pan:d,zoom:f}=l;return p?.zoom?.pinch?.enabled!==f?.zoom?.pinch?.enabled||r?.enabled!==d?.enabled||r?.threshold!==d?.threshold}var Si="2.2.0";function Ts(e,l,r){const p=r.zoom.drag,{dragStart:d,dragEnd:f}=re(e);if(p.drawTime!==l||!f)return;const{left:y,top:S,width:E,height:x}=Nn(e,r.zoom.mode,{dragStart:d,dragEnd:f},p.maintainAspectRatio),L=e.ctx;L.save(),L.beginPath(),L.fillStyle=p.backgroundColor||"rgba(225,225,225,0.3)",L.fillRect(y,S,E,x),p.borderWidth>0&&(L.lineWidth=p.borderWidth,L.strokeStyle=p.borderColor||"rgba(225,225,225)",L.strokeRect(y,S,E,x)),L.restore()}var Ci={id:"zoom",version:Si,defaults:{pan:{enabled:!1,mode:"xy",threshold:10,modifierKey:null},zoom:{wheel:{enabled:!1,speed:.1,modifierKey:null},drag:{enabled:!1,drawTime:"beforeDatasetsDraw",modifierKey:null},pinch:{enabled:!1},mode:"xy"}},start:function(e,l,r){const p=re(e);p.options=r,Object.prototype.hasOwnProperty.call(r.zoom,"enabled")&&console.warn("The option `zoom.enabled` is no longer supported. Please use `zoom.wheel.enabled`, `zoom.drag.enabled`, or `zoom.pinch.enabled`."),(Object.prototype.hasOwnProperty.call(r.zoom,"overScaleMode")||Object.prototype.hasOwnProperty.call(r.pan,"overScaleMode"))&&console.warn("The option `overScaleMode` is deprecated. Please use `scaleMode` instead (and update `mode` as desired)."),ns&&mn(e,r),e.pan=(d,f,y)=>Pn(e,d,f,y),e.zoom=(d,f)=>Zs(e,d,f),e.zoomRect=(d,f,y)=>Ln(e,d,f,y),e.zoomScale=(d,f,y)=>Ka(e,d,f,y),e.resetZoom=d=>Ja(e,d),e.getZoomLevel=()=>ti(e),e.getInitialScaleBounds=()=>On(e),e.getZoomedScaleBounds=()=>si(e),e.isZoomedOrPanned=()=>ni(e),e.isZoomingOrPanning=()=>pn(e)},beforeEvent(e,{event:l}){if(pn(e))return!1;if(l.type==="click"||l.type==="mouseup"){const r=re(e);if(r.filterNextClick)return r.filterNextClick=!1,!1}},beforeUpdate:function(e,l,r){const p=re(e),d=p.options;p.options=r,Ti(d,r)&&(hn(e),mn(e,r)),vi(e,r)},beforeDatasetsDraw(e,l,r){Ts(e,"beforeDatasetsDraw",r)},afterDatasetsDraw(e,l,r){Ts(e,"afterDatasetsDraw",r)},beforeDraw(e,l,r){Ts(e,"beforeDraw",r)},afterDraw(e,l,r){Ts(e,"afterDraw",r)},stop:function(e){fi(e),ns&&hn(e),Ba(e)},panFunctions:Qs,zoomFunctions:Us,zoomRectFunctions:Gs};const ki={class:"session-detail-wrapper"},Ei={key:0,class:"share-notification"},Ai={class:"nav-bar"},xi={key:0,class:"loading-state"},Mi={key:1,class:"error-state"},Ii={class:"error-text"},Ri={class:"session-header"},Li={class:"header-row"},Pi={class:"track-name"},Oi={class:"header-meta"},Di={class:"car"},Ni={class:"master-detail"},wi={class:"master"},Bi={class:"builder-panel"},$i={class:"builder-panel-header"},zi={class:"builder-slot builder-slot--a"},Fi={class:"builder-slot-content"},Ui={key:0,class:"builder-slot-empty"},Gi={class:"builder-chip builder-chip--a1"},Qi=["title"],Hi={key:0,class:"builder-chip builder-chip--a2"},Vi={class:"builder-slot builder-slot--b"},Yi={class:"builder-slot-content"},Wi={key:0,class:"builder-slot-empty"},Zi={class:"builder-chip builder-chip--b1"},Xi=["title"],qi={key:0,class:"builder-chip builder-chip--b2"},ji={class:"cross-session-section"},Ki={class:"cross-session-header cross-session-header--a"},Ji={class:"cross-session-label"},eo={class:"cross-session-date"},to={class:"stint-list stint-list--builder"},so=["onClick"],no=["disabled","title","onClick"],ao=["disabled","title","onClick"],io={class:"stint-icon-slot"},oo={class:"stint-number"},lo={class:"stint-laps"},ro={class:"cross-session-section"},uo={class:"cross-session-header cross-session-header--b"},co={class:"cross-session-label"},po={class:"stint-list stint-list--builder"},vo=["onClick"],fo=["disabled","title","onClick"],mo=["disabled","title","onClick"],ho={class:"stint-icon-slot"},go={class:"stint-number"},_o={class:"stint-laps"},bo={class:"stint-list stint-list--builder"},yo=["onClick"],To=["disabled","title","onClick"],So=["disabled","title","onClick"],Co={class:"stint-icon-slot"},ko={class:"stint-number"},Eo={class:"stint-laps"},Ao={class:"detail"},xo={key:0,class:"empty-state-panel"},Mo={key:1,class:"limited-data"},Io={key:2,class:"compare-layout compare-style--A"},Ro={class:"compare-conditions"},Lo={class:"compare-condition-card compare-condition-card--a"},Po={class:"cond-stint-label"},Oo={class:"cond-details"},Do={class:"cond-item"},No={class:"cond-item"},wo={class:"compare-condition-card compare-condition-card--b"},Bo={class:"cond-stint-label"},$o={class:"cond-details"},zo={class:"cond-item"},Fo={class:"cond-item"},Uo={class:"compare-table-wrap"},Go={class:"ssc-table"},Qo={key:0,class:"ssc-stint-separator"},Ho={class:"ssc-table-row"},Vo={class:"ssc-td ssc-td--value"},Yo={class:"ssc-td ssc-td--value"},Wo={class:"ssc-td"},Zo={key:1,class:"ssc-delta ssc-delta--empty"},Xo={class:"ssc-table-row"},qo={class:"ssc-td"},jo={key:1,class:"ssc-delta ssc-delta--empty"},Ko={class:"ssc-table-row ssc-table-row--compact"},Jo={class:"ssc-td ssc-td--compact"},el={class:"ssc-td ssc-td--compact"},tl={class:"ssc-table-row ssc-table-row--total"},sl={class:"ssc-td ssc-td--value ssc-td--duration"},nl={class:"ssc-td ssc-td--value ssc-td--duration"},al={class:"ssc-header"},il={class:"ssc-header-left"},ol={class:"ssc-stint-label"},ll={class:"ssc-condition-text"},rl={class:"ssc-cond-val"},ul={class:"ssc-condition-text"},cl={class:"ssc-cond-val"},dl={class:"ssc-header-right"},pl={class:"ssc-duration-label"},vl={class:"ssc-table"},fl={class:"ssc-table-row"},ml={class:"ssc-td ssc-td--value"},hl={class:"ssc-td ssc-td--value ssc-td--theo"},gl={class:"ssc-td"},_l={class:"ssc-table-row"},bl={class:"ssc-td ssc-td--value"},yl={class:"ssc-td ssc-td--value ssc-td--theo"},Tl={class:"ssc-td"},Sl={key:1,class:"ssc-delta ssc-delta--na"},Cl={key:0,class:"ssc-target-section"},kl={class:"ssc-target-row-bottom"},El={class:"ssc-target-value"},Al={class:"ssc-progress-section"},xl={key:0,class:"ssc-progress-row"},Ml={class:"ssc-progress-label"},Il={class:"ssc-progress-count"},Rl={class:"ssc-progress-bar"},Ll={key:1,class:"ssc-progress-row"},Pl={class:"ssc-progress-label"},Ol={class:"ssc-progress-count"},Dl={class:"ssc-progress-bar"},Nl={class:"chart-section"},wl={class:"chart-header-row"},Bl={class:"chart-title"},$l={class:"chart-toolbar"},zl={key:0,class:"lap-manager"},Fl={class:"lap-manager-section"},Ul={class:"lap-manager-header"},Gl={class:"lap-manager-title"},Ql=["disabled"],Hl={class:"lap-manager-stint-header"},Vl={class:"lap-manager-grid"},Yl=["onClick","title"],Wl={key:1,class:"lap-manager-grid"},Zl=["onClick","title"],Xl={key:2,class:"lap-manager-info"},ql={key:0,class:"lap-manager-section lap-manager-section--b"},jl={class:"lap-manager-header"},Kl={class:"lap-manager-title"},Jl=["disabled"],er={class:"lap-manager-stint-header lap-manager-stint-header--b"},tr={class:"lap-manager-grid"},sr=["onClick","title"],nr={key:1,class:"lap-manager-grid"},ar=["onClick","title"],ir={key:2,class:"lap-manager-info"},or={key:1,class:"lap-manager-section lap-manager-section--b"},lr={class:"lap-manager-header"},rr={class:"lap-manager-title"},ur=["disabled"],cr={class:"lap-manager-grid"},dr=["onClick","title"],pr={key:0,class:"lap-manager-info"},vr={class:"chart-wrap"},fr={key:1,class:"grip-legend"},mr={class:"grip-legend-label"},hr={class:"grip-legend-laps"},gr={class:"laps-section"},_r={class:"laps-header-row"},br={key:0,class:"laps-tabs"},yr=["onClick"],Tr=["onClick"],Sr={key:1,class:"laps-title"},Cr={key:0,class:"laps-table-wrap"},kr={class:"laps-table laps-table--compare"},Er={key:0,class:"stint-header-row"},Ar={colspan:"4",class:"stint-header-cell stint-header-cell--a"},xr={key:0,class:"stint-header-label"},Mr={colspan:"4",class:"stint-header-cell stint-header-cell--b"},Ir={key:0,class:"stint-header-label"},Rr={class:"col-index"},Lr={class:"col-a time"},Pr={class:"col-a sector"},Or={class:"col-a sector"},Dr={class:"col-a sector"},Nr={class:"col-b time"},wr={class:"col-b sector"},Br={class:"col-b sector"},$r={class:"col-b sector"},zr={key:1,class:"laps-table-wrap"},Fr={class:"laps-table"},Ur={class:"time"},Gr={class:"stato"},Qr={key:0,class:"badge badge--pit"},Hr={key:1,class:"badge badge--invalid"},Vr={key:2,class:"badge badge--valid"},$s=.6,Yr=gn({__name:"SessionDetailPage",props:{sessionId:{},externalUserId:{}},emits:["back","go-to-track"],setup(e,{emit:l}){Xn.register(qn,jn,Kn,Jn,ea,ta,sa,na,Ci);const{currentUser:r,getUserProfile:p}=_n(),d=z(""),f=e,y=l;k(()=>!!f.externalUserId),z(!1);const S=z(new Set),E=z(new Set),x=z(new Set),L=z(!1),U=z(null);z(1);const W=z("gold");z("A");function X(o){const s=new Set(S.value);s.has(o)?s.delete(o):s.add(o),S.value=s}function Ge(o){const s=new Set(E.value);s.has(o)?s.delete(o):s.add(o),E.value=s}function ge(o){const s=new Set(x.value);s.has(o)?s.delete(o):s.add(o),x.value=s}function dt(){S.value=new Set}function ae(){E.value=new Set}function M(){x.value=new Set}function q(){U.value?.chart&&U.value.chart.resetZoom()}function Ye(){U.value?.chart&&U.value.chart.zoom(1.2)}function pt(){U.value?.chart&&U.value.chart.zoom(.8)}const{fetchSessionFull:We,loadSessions:xt,getTheoreticalTimes:os,generateShareLink:je}=zs(),Ke=z(null),Ze=z(!0),Xe=z(null),Mt=z(!1),Je=z(!1);async function Cs(){if(!(!f.sessionId||Mt.value)){Mt.value=!0,Je.value=!1;try{const o=await je(f.sessionId);await navigator.clipboard.writeText(o),Je.value=!0,console.log("[SHARE] Link copied:",o),setTimeout(()=>{Je.value=!1},2e3)}catch(o){console.error("[SHARE] Error sharing session:",o)}finally{Mt.value=!1}}}const ls=ia();Hn(async()=>{Ze.value=!0,Xe.value=null;try{if(r.value?.uid){const c=await p(r.value.uid);d.value=c?.nickname||r.value.displayName||"Tu"}const o=f.externalUserId||ls.value||void 0;f.externalUserId||await xt(o);const s=await We(f.sessionId,o);s?(Ke.value=s,console.log("[SESSION_DETAIL] Loaded session:",s.session_info.track,s.stints.length,"stints",f.externalUserId?"(SHARED)":"")):Xe.value="Sessione non trovata"}catch(o){console.error("[SESSION_DETAIL] Load error:",o),Xe.value=o.code==="permission-denied"?"Sessione non condivisa o accesso negato":o.message||"Errore caricamento"}finally{Ze.value=!1}});const rs=z(!1),Ht=z([]),ke=z("COMPARE"),fe=k(()=>rs.value&&Ht.value.length===2),qe=k(()=>Ht.value[0]??Me.value),Ae=k(()=>Ht.value[1]??null),It=z(!1),vt=z(null),ve=z(null),ft=k(()=>vt.value!==null),me=z(null),Qe=z(null),ue=k(()=>me.value!==null);function Se(){It.value=!0}async function Rt(o,s,c){vt.value=o,me.value=s||null,Qe.value=c||null,It.value=!1;const{fetchSessionFull:m}=zs(),i=await m(o,s);i&&(ve.value=i,console.log("[CROSS-SESSION] Loaded session B:",o,s?`(external: ${c})`:"(own)",i.session_info.track))}function mt(){vt.value=null,ve.value=null,me.value=null,Qe.value=null,D.value=null,I.value=null,F.value=null,w.value=null}const D=z(null),I=z(null),ht=k(()=>ve.value?(ve.value.stints||[]).map(s=>({number:s.stint_number,type:s.type==="Qualify"?"Q":s.type==="Race"?"R":"P",laps:s.laps?.length||0,best:s.laps?.reduce((c,m)=>!m.is_valid||m.has_pit_stop?c:c===null?m.lap_time_ms:Math.min(c,m.lap_time_ms),null),avgCleanLap:s.avg_clean_lap})):[]),Q=k(()=>ft.value&&D.value!==null&&I.value!==null),F=z(null),w=z(null),gt=k(()=>F.value!==null||w.value!==null);k(()=>{if(!D.value||F.value!==null)return!1;const o=D.value+1;return P.value.stints.some(s=>s.number===o)}),k(()=>{if(!I.value||!ve.value||w.value!==null)return!1;const o=I.value+1;return(ve.value.stints||[]).some(c=>c.stint_number===o)});function Lt(){F.value=null}function xe(){w.value=null}z(null),z(null);const us=k(()=>D.value!==null||I.value!==null),Vt=k(()=>D.value!==null&&I.value!==null),K=k(()=>Vt.value&&!ft.value),Pt=k(()=>us.value&&!Vt.value&&!ft.value),ks=k(()=>{if(!Pt.value)return null;const o=D.value??I.value;return o&&P.value.stints.find(s=>s.number===o)||null}),Yt=k(()=>D.value??I.value??null),cs=k(()=>{const o=Yt.value;return o?P.value.lapsData[o]||[]:[]});k(()=>D.value&&P.value.stints.find(o=>o.number===D.value)||null),k(()=>I.value&&P.value.stints.find(o=>o.number===I.value)||null),k(()=>D.value?P.value.lapsData[D.value]||[]:[]),k(()=>I.value?P.value.lapsData[I.value]||[]:[]);const se=k(()=>{const o=[];if(D.value){const s=P.value.stints.find(c=>c.number===D.value);s&&o.push(s)}if(F.value){const s=P.value.stints.find(c=>c.number===F.value);s&&o.push(s)}return o}),ne=k(()=>{const o=[],s=ft.value&&ve.value?(ve.value.stints||[]).map(c=>({number:c.stint_number,type:c.type==="Qualify"?"Q":c.type==="Race"?"R":"P",laps:c.laps?.length||0,best:Y(c.laps?.reduce((m,i)=>!i.is_valid||i.has_pit_stop?m:m===null?i.lap_time_ms:Math.min(m,i.lap_time_ms),null)),bestMs:c.laps?.reduce((m,i)=>!i.is_valid||i.has_pit_stop?m:m===null?i.lap_time_ms:Math.min(m,i.lap_time_ms),null),avg:Y(c.avg_clean_lap),avgMs:c.avg_clean_lap,avgWarning:(c.laps?.filter(m=>m.is_valid&&!m.has_pit_stop).length||0)<5,validLapsCount:c.laps?.filter(m=>m.is_valid&&!m.has_pit_stop).length||0,durationMs:c.laps?.reduce((m,i)=>m+(i.lap_time_ms||0),0)||0})):P.value.stints;if(I.value){const c=s.find(m=>m.number===I.value);c&&o.push(c)}if(w.value){const c=s.find(m=>m.number===w.value);c&&o.push(c)}return o}),nt=k(()=>Math.max(se.value.length,ne.value.length)),Wt=k(()=>se.value.reduce((o,s)=>o+(s.durationMs||0),0)),Es=k(()=>ne.value.reduce((o,s)=>o+(s.durationMs||0),0)),ds=k(()=>{const o=[];return se.value.forEach((s,c)=>{(P.value.lapsData[s.number]||[]).forEach((i,h)=>{o.push({...i,_stintIndex:c,_stintNumber:s.number,_isStintStart:h===0,_globalIndex:o.length+1})})}),o}),Zt=k(()=>{const o=[];return ne.value.forEach((s,c)=>{(P.value.lapsData[s.number]||[]).forEach((i,h)=>{o.push({...i,_stintIndex:c,_stintNumber:s.number,_isStintStart:h===0,_globalIndex:o.length+1})})}),o});function Ot(o){if(!o)return"â€”";const s=o,c=Math.floor(s/6e4),m=Math.floor(s%6e4/1e3),i=s%1e3;return`${c}m ${String(m).padStart(2,"0")}.${String(i).padStart(3,"0")}s`}function ps(){D.value=null,F.value=null,I.value=null,w.value=null}function _t(o){return I.value===o||w.value===o?!1:D.value?D.value===o||F.value===o||F.value?!1:o===D.value+1:!0}function vs(o){return D.value===o||F.value===o?!1:I.value?I.value===o||w.value===o||w.value?!1:o===I.value+1:!0}function fs(o){return I.value===o||w.value===o?"GiÃ  in Strategia B":D.value?D.value===o||F.value===o?"GiÃ  in Strategia A":!F.value&&o===D.value+1?"Aggiungi come secondo stint":F.value?"Massimo 2 stint per strategia":"Solo stint consecutivo ammesso":"Aggiungi a Strategia A"}function Xt(o){return D.value===o||F.value===o?"GiÃ  in Strategia A":I.value?I.value===o||w.value===o?"GiÃ  in Strategia B":!w.value&&o===I.value+1?"Aggiungi come secondo stint":w.value?"Massimo 2 stint per strategia":"Solo stint consecutivo ammesso":"Aggiungi a Strategia B"}function Dt(o){if(!D.value){D.value=o;return}!F.value&&o===D.value+1&&(F.value=o)}function Nt(o){if(!I.value){I.value=o;return}!w.value&&o===I.value+1&&(w.value=o)}function As(o){return!D.value}function xs(o){return"Usa +B per stint da altra sessione"}function Ms(o){return I.value?I.value===o||w.value===o||w.value?!1:o===I.value+1:!0}function ms(o){return I.value?I.value===o||w.value===o?"GiÃ  in Strategia B":!w.value&&o===I.value+1?"Aggiungi come secondo stint":w.value?"Massimo 2 stint per strategia":"Solo stint consecutivo ammesso":"Aggiungi a Strategia B"}function Is(o){if(!I.value){I.value=o;return}!w.value&&o===I.value+1&&(w.value=o)}function Rs(){D.value=null,F.value=null}function Ls(){I.value=null,w.value=null}function bt(o){return D.value===o||F.value===o}function hs(o){return I.value===o||w.value===o}function Ps(o){Me.value=o}function Os(o){}function qt(o){Me.value=o}const P=k(()=>{if(!Ke.value)return{id:f.sessionId,track:"Caricamento...",trackId:"",type:"practice",date:"-",time:"-",car:"-",startConditions:{weather:"-",airTemp:0,trackTemp:0},bestQualy:"--:--.---",bestRace:"--:--.---",theoQualy:"--:--.---",theoRace:"--:--.---",bestDeltaQ:{value:"-",stintNum:0},bestDeltaR:{value:"-",stintNum:0},stints:[],lapsData:{}};const o=Ke.value,s=o.session_info,c=o.stints.map(j=>{const ee=j.laps.filter(Ue=>Ue.is_valid&&!Ue.has_pit_stop),_e=ee.length,be=_e>0?Math.min(...ee.map(Ue=>Ue.lap_time_ms)):null,lt=5,rt=_e>=lt&&j.avg_clean_lap?j.avg_clean_lap:null,Ee=_e>0&&_e<lt,es=rt?Y(rt):Ee?"min 5 giri":"â€”";return{number:j.stint_number,type:j.type==="Qualify"?"Q":"R",intent:j.type==="Qualify"?"Qualy Push":"Race Pace",fuelStart:j.fuel_start,laps:j.laps.length,validLapsCount:_e,best:be?Y(be):"â€”",bestMs:be,avg:es,avgWarning:Ee,avgMs:rt,durationMs:j.stint_drive_time_ms||0,theoretical:Y(s.session_best_lap),deltaVsTheo:be?`+${((be-s.session_best_lap)/1e3).toFixed(3)}`:"-",conditions:{weather:s.start_weather,avgAirTemp:s.start_air_temp,avgTrackTemp:s.start_road_temp},breakdown:{base:"-",deltaTemp:"-",deltaGrip:"-"}}}),m={};o.stints.forEach(j=>{m[j.stint_number]=j.laps.map(ee=>({lap:ee.lap_number,time:Y(ee.lap_time_ms),lap_time_ms:ee.lap_time_ms,delta:`+${((ee.lap_time_ms-s.session_best_lap)/1e3).toFixed(3)}`,valid:ee.is_valid,pit:ee.has_pit_stop,sectors:ee.sector_times_ms?.map(_e=>(_e/1e3).toFixed(3))||["-","-","-"],sector_times_ms:ee.sector_times_ms||[],fuel:Math.round(ee.fuel_remaining),airTemp:ee.air_temp||0,weather:ee.rain_intensity||"No Rain",grip:ee.track_grip_status||"Opt"}))});let i=null,h=null,R=0,N=0;return o.stints.forEach(j=>{const ee=j.laps.filter(be=>be.is_valid&&!be.has_pit_stop);if(ee.length===0)return;const _e=Math.min(...ee.map(be=>be.lap_time_ms));j.type==="Qualify"?(!i||_e<i)&&(i=_e,R=j.stint_number):(!h||_e<h)&&(h=_e,N=j.stint_number)}),{id:f.sessionId,track:s.track,trackId:s.track.toLowerCase().replace(/[^a-z0-9]/g,"_"),type:yn(s.session_type),date:Vn(s.date_start),time:Tn(s.date_start),car:bn(s.car),startConditions:{weather:s.start_weather,airTemp:s.start_air_temp,trackTemp:s.start_road_temp},bestQualy:i?Y(i):"--:--.---",bestRace:h?Y(h):"--:--.---",theoQualy:Y(s.session_best_lap),theoRace:Y(s.session_best_lap),bestDeltaQ:{value:i?`+${((i-s.session_best_lap)/1e3).toFixed(3)}`:"-",stintNum:R},bestDeltaR:{value:h?`+${((h-s.session_best_lap)/1e3).toFixed(3)}`:"-",stintNum:N},stints:c,lapsData:m}}),he=z({theoQualy:null,theoRace:null,theoAvgRace:null,dominantGrip:"Optimum",stintTemp:23,historicQualy:null,historicQualyTemp:null,historicRace:null,historicRaceTemp:null,historicAvgRace:null,historicAvgRaceTemp:null}),Me=z(1),wt=z(!1),te=k(()=>P.value.stints.find(o=>o.number===Me.value)),Ce=k(()=>P.value.lapsData[Me.value]||[]),Bt=k(()=>Pt.value?ks.value:te.value),jt=k(()=>Pt.value?Yt.value:Me.value),et=k(()=>Pt.value?cs.value:Ce.value);k(()=>et.value.length<=1),k(()=>P.value.stints.length===1),Ns(Ce,o=>{if(o.length>20){const s=o[0]?.lap,c=o[o.length-1]?.lap,m=[s,c].filter(Boolean);S.value=new Set(m)}else S.value=new Set},{immediate:!0});const at=k(()=>qe.value?P.value.stints.find(o=>o.number===qe.value):null),yt=k(()=>Ae.value?P.value.stints.find(o=>o.number===Ae.value):null),He=k(()=>qe.value?P.value.lapsData[qe.value]||[]:[]),Ne=k(()=>Ae.value?P.value.lapsData[Ae.value]||[]:[]),$t=k(()=>{if(!D.value)return null;const o=P.value.stints.find(s=>s.number===D.value);return o?{...o,avgCleanLap:o.avg}:null}),gs=k(()=>{if(!I.value||!ve.value)return null;const s=(ve.value.stints||[]).find(c=>c.stint_number===I.value);return s?{number:s.stint_number,type:s.type==="Qualify"?"Q":s.type==="Race"?"R":"P",laps:s.laps?.length||0,best:Y(s.laps?.reduce((c,m)=>!m.is_valid||m.has_pit_stop?c:c===null?m.lap_time_ms:Math.min(c,m.lap_time_ms),null)),avgCleanLap:Y(s.avg_clean_lap),deltaVsTheo:"â€”"}:null}),we=k(()=>D.value?P.value.lapsData[D.value]||[]:[]),ce=k(()=>{if(!I.value||!ve.value)return[];const s=(ve.value.stints||[]).find(c=>c.stint_number===I.value);return!s||!s.laps?[]:s.laps.map((c,m)=>({lapNumber:c.lap_number||m+1,lapTime:Y(c.lap_time_ms),lapTimeMs:c.lap_time_ms,valid:c.is_valid&&!c.has_pit_stop,pit:c.has_pit_stop,s1:Y(c.sector_times_ms?.[0]),s2:Y(c.sector_times_ms?.[1]),s3:Y(c.sector_times_ms?.[2]),fuel:c.fuel_remaining,air:c.air_temp,road:c.road_temp,grip:c.track_grip_status}))});k(()=>ke.value==="A"?He.value:Ne.value),k(()=>ke.value==="A"?at.value:yt.value),k(()=>ke.value==="A"?we.value:ce.value),k(()=>ke.value==="A"?$t.value:gs.value);function tt(){const o=ke.value;if(o.startsWith("A-")){const s=parseInt(o.slice(2));if(!isNaN(s))return P.value.lapsData[s]||[]}else if(o.startsWith("B-")){const s=parseInt(o.slice(2));if(!isNaN(s)){if(K.value)return P.value.lapsData[s]||[];if(Q.value&&ve.value){const m=(ve.value.stints||[]).find(i=>i.stint_number===s);if(m?.laps)return m.laps.map((i,h)=>({lapNumber:i.lap_number||h+1,lapTime:Y(i.lap_time_ms),lapTimeMs:i.lap_time_ms,valid:i.is_valid&&!i.has_pit_stop,pit:i.has_pit_stop,s1:Y(i.sector_times_ms?.[0]),s2:Y(i.sector_times_ms?.[1]),s3:Y(i.sector_times_ms?.[2]),fuel:i.fuel_remaining,air:i.air_temp,road:i.road_temp,grip:i.track_grip_status}))}return P.value.lapsData[s]||[]}}return Ce.value}const Ie=k(()=>{const o=tt();let s=1/0,c=1/0,m=1/0,i=1/0;for(const h of o){if(!h.valid||h.pit)continue;const R=h.sector_times_ms||[];R[0]&&R[0]>0&&R[0]<s&&(s=R[0]),R[1]&&R[1]>0&&R[1]<c&&(c=R[1]),R[2]&&R[2]>0&&R[2]<m&&(m=R[2]);const N=h.lap_time_ms||h.lapTimeMs;N&&N>0&&N<i&&(i=N)}return{s1:s===1/0?null:s,s2:c===1/0?null:c,s3:m===1/0?null:m,lapMs:i===1/0?null:i}});function Oe(o,s){const m=(o.sector_times_ms||[])[s];if(!m||m<=0)return!1;const i=[Ie.value.s1,Ie.value.s2,Ie.value.s3][s];return i!==null&&m===i}function Tt(o){const s=o.lap_time_ms||o.lapTimeMs;return Ie.value.lapMs!==null&&s===Ie.value.lapMs}const Be=k(()=>{let o=[],s=[];K.value?(o=ds.value||[],s=Zt.value||[]):Q.value?(o=we.value||[],s=ce.value||[]):fe.value&&(o=He.value||[],s=Ne.value||[]);const c=Math.max(o.length,s.length),m=[];for(let i=0;i<c;i++){const h=o[i]||null,R=s[i]||null;let N=null;if(h&&R){const j=n(h.time||h.lapTime||""),ee=n(R.time||R.lapTime||"");j>0&&ee>0&&(N=ee-j)}m.push({index:i+1,lapA:h,lapB:R,delta:N,deltaFormatted:N!==null?N>=0?`+${N.toFixed(3)}`:N.toFixed(3):"â€”",deltaClass:N!==null?N<0?"faster":N<=.3?"close":N<=.5?"margin":"far":"neutral",_isStintStartA:h?._isStintStart||!1,_isStintStartB:R?._isStintStart||!1,_stintNumberA:h?._stintNumber||null,_stintNumberB:R?._stintNumber||null})}return m}),$e=k(()=>{if(!F.value)return null;const o=P.value.stints.find(s=>s.number===F.value);return o?{...o,avgCleanLap:o.avg}:null}),Kt=k(()=>F.value?P.value.lapsData[F.value]||[]:[]),_s=k(()=>{if(!w.value||!ve.value)return null;const s=(ve.value.stints||[]).find(c=>c.stint_number===w.value);return s?{number:s.stint_number,type:s.type==="Qualify"?"Q":s.type==="Race"?"R":"P",laps:s.laps?.length||0,best:Y(s.laps?.reduce((c,m)=>!m.is_valid||m.has_pit_stop?c:c===null?m.lap_time_ms:Math.min(c,m.lap_time_ms),null)),avgCleanLap:Y(s.avg_clean_lap),durationMs:s.laps?.reduce((c,m)=>c+(m.lap_time_ms||0),0)||0}:null}),it=k(()=>{if(!w.value||!ve.value)return[];const s=(ve.value.stints||[]).find(c=>c.stint_number===w.value);return!s||!s.laps?[]:s.laps.map((c,m)=>({lapNumber:c.lap_number||m+1,lapTime:Y(c.lap_time_ms),lapTimeMs:c.lap_time_ms,valid:c.is_valid&&!c.has_pit_stop,pit:c.has_pit_stop,s1:Y(c.sector_times_ms?.[0]),s2:Y(c.sector_times_ms?.[1]),s3:Y(c.sector_times_ms?.[2]),fuel:c.fuel_remaining,air:c.air_temp,grip:c.track_grip_status}))});k(()=>{let o=0;if($t.value){const s=Ve($t.value)||Ft(we.value);o+=s}if($e.value){const s=Ve($e.value)||Ft(Kt.value);o+=s}return o}),k(()=>{let o=0;return gs.value&&(o+=Ft(ce.value)),_s.value&&(o+=Ft(it.value)),o});const Re=k(()=>{const o=P.value.stints.filter(c=>c.type==="Q"&&c.laps>=2);if(o.length===0)return null;let s=o[0];return o.forEach(c=>{parseFloat(c.deltaVsTheo)<parseFloat(s.deltaVsTheo)&&(s=c)}),s}),St=k(()=>{const o=P.value.stints.filter(c=>c.type==="R"&&c.laps>=2);if(o.length===0)return null;let s=o[0];return o.forEach(c=>{parseFloat(c.deltaVsTheo)<parseFloat(s.deltaVsTheo)&&(s=c)}),s});Ns([St,Re],([o,s])=>{wt.value||(o?(Me.value=o.number,wt.value=!0,console.log("[PRESELECTION] Best R stint:",o.number,"delta:",o.deltaVsTheo)):s&&(Me.value=s.number,wt.value=!0,console.log("[PRESELECTION] Best Q stint:",s.number,"delta:",s.deltaVsTheo)))});function st(o){return o.type==="Q"?Re.value?.number===o.number:o.type==="R"?St.value?.number===o.number:!1}function De(o){const c=(P.value.lapsData[o.number]||[]).filter(i=>!i.pit),m=c.filter(i=>i.valid);return c.length>0&&m.length===0?{icon:"âš ï¸",message:"Tutti i giri invalidi"}:o.type==="R"&&c.length<5?{icon:"âš ï¸",message:`Stint gara troppo corto (${c.length} giri, min. 5)`}:o.type==="Q"&&c.length<=1?{icon:"âš ï¸",message:"Dati limitati (1 giro)"}:null}function ot(o){if(o<=30){const s=o/30,c=239,m=Math.round(68+47*s),i=Math.round(68+-46*s);return`rgb(${c}, ${m}, ${i})`}else if(o<=70){const s=(o-30)/40,c=Math.round(249+2*s),m=Math.round(115+76*s),i=Math.round(22+14*s);return`rgb(${c}, ${m}, ${i})`}else{const s=(o-70)/30,c=Math.round(251+-235*s),m=Math.round(191+-6*s),i=Math.round(36+93*s);return`rgb(${c}, ${m}, ${i})`}}function zt(o){const s=o.filter(m=>!m.pit&&(m.airTemp||m.air));if(s.length===0)return 0;const c=s.reduce((m,i)=>m+(i.airTemp||i.air||0),0);return Math.round(c/s.length)}function Ct(o){const s=o.filter(h=>!h.pit&&h.grip&&h.grip!=="Unknown");if(s.length===0)return"Optimum";const c={};for(const h of s){let R=h.grip==="Opt"?"Optimum":h.grip;c[R]=(c[R]||0)+1}let m="Optimum",i=0;for(const[h,R]of Object.entries(c))R>i&&(i=R,m=h);return m}function Ve(o){return o?.durationMs?Math.floor(o.durationMs/6e4):0}function Ft(o){if(!o||o.length===0)return 0;const s=o.reduce((c,m)=>c+(m.lapTimeMs||0),0);return Math.round(s/6e4)}function ze(o){if(!o)return"â€”";if(typeof o=="string"){const s=o,c=s.split(".");if(c.length===2&&c[1]){const m=c[1].padEnd(3,"0").slice(0,3);return`${c[0]}.${m}`}return s}return typeof o=="number"?(o>1e3?o/1e3:o).toFixed(3):"â€”"}function Ut(o,s){if(!o||!s)return"â€”";const m=(o-s)/1e3;return m===0?"0.000":`${m>0?"+":""}${m.toFixed(3)}`}function Jt(o,s){if(!o||!s)return"far";const m=(o-s)/1e3;return m<0?"faster":m===0?"ontarget":m<=.3?"close":m<=.5?"margin":"far"}const Gt=k(()=>{const o=Ce.value.filter(ie=>!ie.pit);if(o.length===0)return{airTemp:{start:0,mid:0,end:0,changed:!1},grip:{dominant:"Optimum",percentages:[],changed:!1,display:"Optimum"}};const s=Math.floor(o.length/2),c=o.length-1,m=Math.round(o[0]?.airTemp||0),i=Math.round(o[s]?.airTemp||m),h=Math.round(o[c]?.airTemp||m),R=Math.abs(m-h)>=2||Math.abs(m-i)>=2,N={},j=[];let ee=0;const _e=ie=>ie==="Opt"?"Optimum":ie;for(const ie of o){let Le=ie.grip||"Unknown";Le=_e(Le),Le!=="Unknown"&&(N[Le]||j.push(Le),N[Le]=(N[Le]||0)+1,ee++)}const be=[];let lt="Optimum",rt=0;for(const ie of j){const Le=N[ie]||0;if(Le===0)continue;const A=Math.round(Le/ee*100);be.push({grip:ie,pct:A}),Le>rt&&(rt=Le,lt=ie)}const Ee=be.length>1;let es=lt;Ee&&(es=be.map(ie=>`${ie.grip} (${ie.pct}%)`).join(" â†’ "));const Ue=R?Math.round((m+i+h)/3):m;return{airTemp:{start:m,mid:i,end:h,changed:R,avg:Ue},grip:{dominant:lt,percentages:be,changed:Ee,display:es}}});Ns([()=>Ke.value,()=>Gt.value],async([o,s])=>{if(!o)return;const c=o.session_info,m=(c.track||"").toLowerCase().replace(/[^a-z0-9]/g,"_"),i=s.grip.dominant||"Optimum",h=s.airTemp.avg||Math.round(c.start_air_temp||23),R=Yn(c.car||""),N=await os(m,i,h,R,ls.value||void 0);he.value={theoQualy:N.theoQualy,theoRace:N.theoRace,theoAvgRace:N.theoAvgRace,dominantGrip:i,stintTemp:h,historicQualy:N.historicQualy,historicQualyTemp:N.historicQualyTemp,historicRace:N.historicRace,historicRaceTemp:N.historicRaceTemp,historicAvgRace:N.historicAvgRace,historicAvgRaceTemp:N.historicAvgRaceTemp}},{immediate:!0});const Ds=k(()=>{let o=[];if(K.value)o=ds.value.map((A,$)=>({...A,lap:$+1}));else if(Q.value){if(o=we.value,gt.value&&F.value){const A=Kt.value,$=o.length,oe=A.map((G,ye)=>({...G,lap:$+ye+1,_originalLap:G.lap,_isSecondStint:!0}));o=[...o,...oe]}}else fe.value?o=He.value:o=Ce.value;const s=o.filter(A=>!S.value.has(A.lap)),c=Q.value?$t.value:fe.value?at.value:te.value,m=c?.type==="Q",i=m?he.value.theoQualy:he.value.theoRace,h=i?i/1e3:0,R=h>0?h+$s:0,N=c?.best;n(N);const j=A=>A.pit?!1:n(A.time)<=R,ee=A=>A.pit||!A.valid?!1:j(A),_e=A=>A.pit||!A.valid?!1:A.time===N,be=s.map(A=>A.pit?"#6b7280":A.valid?kt.value&&_e(A)?"#a855f7":kt.value&&ee(A)?"#10b981":"#3b82f6":"#ef4444"),lt=s.map(A=>A.pit?"#6b7280":A.valid?kt.value&&_e(A)?"#a855f7":kt.value&&ee(A)?"#10b981":"#3b82f6":kt.value&&j(A)?"#10b981":"#ef4444"),rt=s.map(A=>!A.valid&&!A.pit&&kt.value&&j(A)?2:1),Ee=[{label:K.value?`Strategia A (${se.value.map(A=>`#${A.number}`).join("+")})`:fe.value?`A: Stint #${qe.value}`:"Tempo",data:s.map(A=>n(A.time)),borderColor:"#3b82f6",backgroundColor:"rgba(59,130,246,0.1)",pointBackgroundColor:be,pointBorderColor:lt,pointBorderWidth:rt,pointRadius:5,tension:0,order:1,segment:K.value?{borderColor:A=>s[A.p1DataIndex]?._stintIndex>0?"#60a5fa":"#3b82f6"}:void 0},{label:`Teorico ${c?.type==="Q"?"Q":"R"}`,data:s.map(()=>h),borderColor:"#f59e0b",borderDash:[5,5],pointRadius:0,order:3}];if(!m&&kt.value&&s.length>0&&Ee.push({label:`Target (+${$s}s)`,data:s.map(()=>R),borderColor:"rgba(16, 185, 129, 0.6)",borderWidth:2,borderDash:[3,3],backgroundColor:"rgba(16, 185, 129, 0.05)",fill:"origin",pointRadius:0,order:4}),Xs.value&&qs.value&&s.length>0){const A=Math.max(...s.map($=>n($.time)))+5;js.value.forEach(($,oe)=>{const G=bs[$.gripLevel]||bs.Opt,ye=s.map((Ks,$n)=>{const Js=$n+1;return Js>=$.startLap&&Js<=$.endLap?A:null});Ee.push({label:`_grip_${oe}`,data:ye,borderColor:"transparent",backgroundColor:G?.bg,fill:"origin",pointRadius:0,order:10+oe,spanGaps:!1})})}let Ue=[];if(K.value&&Zt.value.length>0){Ue=Zt.value.map((G,ye)=>({...G,lap:ye+1})).filter(G=>!E.value.has(G.lap));const $=ne.value.map(G=>`#${G.number}`).join("+"),oe=Ue.map(G=>G.pit?"#6b7280":G.valid?G._stintIndex>0?"#a78bfa":"#8b5cf6":"#ef4444");Ee.splice(1,0,{label:`Strategia B (${$})`,data:Ue.map(G=>n(G.time)),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,0.1)",pointBackgroundColor:oe,pointRadius:5,tension:0,segment:{borderColor:G=>Ue[G.p1DataIndex]?._stintIndex>0?"#a78bfa":"#8b5cf6"}})}if(fe.value&&Ne.value.length>0){const $=Ne.value.filter(oe=>!E.value.has(oe.lap));Ee.splice(1,0,{label:`B: Stint #${Ae.value}`,data:$.map(oe=>n(oe.time)),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,0.1)",pointBackgroundColor:$.map(oe=>oe.pit?"#6b7280":oe.valid?"#8b5cf6":"#ef4444"),pointRadius:5,tension:0})}if(Q.value&&ce.value.length>0){let A=ce.value.map(($,oe)=>({...$,_chartIdx:oe+1}));if(gt.value&&w.value){const $=it.value,oe=A.length,G=$.map((ye,Ks)=>({...ye,_chartIdx:oe+Ks+1,_isSecondStint:!0}));A=[...A,...G]}Ee.splice(1,0,{label:gt.value?`Strategia B (${w.value?"Stint #"+I.value+"+#"+w.value:"Stint #"+I.value})`:`Strategia B Â· Stint #${I.value}`,data:A.map($=>x.value.has($.lapNumber)?null:n($.lapTime)),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,0.1)",pointBackgroundColor:A.map($=>x.value.has($.lapNumber)?"transparent":$.pit?"#6b7280":$.valid?"#8b5cf6":"#ef4444"),pointRadius:A.map($=>x.value.has($.lapNumber)?0:5),tension:0,spanGaps:!1})}let ie=s.length;if(K.value)ie=Math.max(s.length,Ue.length);else if(Q.value){let A=ce.value.length;gt.value&&w.value&&(A+=it.value.length),ie=Math.max(s.length,A)}else fe.value&&(ie=Math.max(s.length,Ne.value.length));const Le=Array.from({length:ie},(A,$)=>`G${$+1}`);if((K.value||Q.value||fe.value)&&s.length<ie){const A=Ee.find(G=>G.label?.startsWith("Strategia A")||G.label?.startsWith("A:"));if(A&&Array.isArray(A.data)){const G=A.data.length;for(let ye=G;ye<ie;ye++)A.data.push(null),Array.isArray(A.pointBackgroundColor)&&A.pointBackgroundColor.push("transparent"),Array.isArray(A.pointRadius)&&A.pointRadius.push(0)}const $=Ee.find(G=>G.label?.startsWith("Teorico"));if($&&Array.isArray($.data)&&$.data.length<ie){const G=$.data[0];for(let ye=$.data.length;ye<ie;ye++)$.data.push(G)}const oe=Ee.find(G=>G.label?.startsWith("Target"));if(oe&&Array.isArray(oe.data)&&oe.data.length<ie){const G=oe.data[0];for(let ye=oe.data.length;ye<ie;ye++)oe.data.push(G)}}return{labels:Le,datasets:Ee}}),t={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom",labels:{color:"rgba(255,255,255,0.7)",font:{size:11},filter:o=>!o.text.startsWith("_")}},tooltip:{backgroundColor:"rgba(15,15,25,0.95)",callbacks:{label:o=>o.dataset.label?.startsWith("_")?"":`${o.dataset.label}: ${u(o.raw)}`}},zoom:{pan:{enabled:!0,mode:"x",modifierKey:void 0},zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"x",drag:{enabled:!1}},limits:{x:{min:"original",max:"original"}}}},scales:{x:{grid:{color:"rgba(255,255,255,0.08)"},ticks:{color:"rgba(255,255,255,0.6)",font:{size:11}}},y:{grid:{color:"rgba(255,255,255,0.08)"},ticks:{color:"rgba(255,255,255,0.6)",font:{size:11},callback:o=>typeof o=="number"?u(o):o}}}};function n(o){if(!o)return 0;const s=o.split(":"),c=Number(s[0])||0,m=Number(s[1])||0;return c*60+m}function u(o){return`${Math.floor(o/60)}:${(o%60).toFixed(3).padStart(6,"0")}`}function v(o){return{practice:"PRACTICE",qualify:"QUALIFY",race:"RACE"}[o]||o.toUpperCase()}function T(o){if(!o||o==="-")return"far";const s=parseFloat(o);return isNaN(s)?"far":s<0?"faster":s===0?"ontarget":s<=.3?"close":s<=.5?"margin":"far"}function C(o){if(!o)return"-";const c=o.type==="Q"?he.value.theoQualy:he.value.theoRace;if(!c)return"-";const m=n(o.best);if(m===0)return"-";const i=c/1e3,h=m-i;return h>=0?`+${h.toFixed(3)}`:h.toFixed(3)}const B=k(()=>{if(!te.value)return{value:"-",seconds:0,class:"neutral"};const o=n(te.value.best);if(o===0)return{value:"-",seconds:0,class:"neutral"};let s=null;if(te.value.type==="Q"?s=he.value.theoQualy:s=he.value.theoRace,!s)return{value:"-",seconds:0,class:"neutral"};const c=s/1e3,m=o-c,i=m>=0?`+${m.toFixed(3)}`:m.toFixed(3);return{value:i,seconds:m,class:T(i)}}),pe=k(()=>{if(!te.value)return{value:"-",seconds:0,class:"neutral"};const o=n(te.value.avg);if(o===0)return{value:"-",seconds:0,class:"neutral"};if(te.value.type==="Q")return{value:"-",seconds:0,class:"neutral"};const s=he.value.theoAvgRace;if(!s)return{value:"-",seconds:0,class:"neutral"};const c=s/1e3,m=o-c,i=m>=0?`+${m.toFixed(3)}`:m.toFixed(3);return{value:i,seconds:m,class:T(i)}}),J=k(()=>{if(!te.value||Ce.value.length===0)return{onTarget:0,total:0,pct:0,targetLine:"-"};const s=te.value.type==="Q"?he.value.theoQualy:he.value.theoRace;if(!s)return{onTarget:0,total:0,pct:0,targetLine:"-"};const m=s/1e3+$s,i=Ce.value.filter(N=>!N.pit),h=i.length;let R=0;return i.forEach(N=>{n(N.time)<=m&&R++}),{onTarget:R,total:h,pct:h>0?Math.round(R/h*100):0,targetLine:u(m)}}),le=k(()=>{const o=Ce.value.filter(i=>!i.pit),s=o.length,c=o.filter(i=>i.valid).length,m=s-c;return{valid:c,invalid:m,total:s,pct:s>0?Math.round(c/s*100):100}}),Fe=k(()=>{if(!te.value)return{hours:0,minutes:0,seconds:0,milliseconds:0,formatted:"0:00.000",totalMs:0};let o=te.value.durationMs||0;o===0&&Ce.value.length>0&&Ce.value.forEach(N=>{o+=n(N.time)*1e3});const s=o/1e3,c=Math.floor(s/3600),m=Math.floor(s%3600/60),i=Math.floor(s%60),h=Math.round(o%1e3);let R="";return c>0?R=`${c}h ${m.toString().padStart(2,"0")}m ${i.toString().padStart(2,"0")}.${h.toString().padStart(3,"0")}s`:R=`${m}m ${i.toString().padStart(2,"0")}.${h.toString().padStart(3,"0")}s`,{hours:c,minutes:m,seconds:i,milliseconds:h,formatted:R,totalMs:o}}),kt=z(!0),Xs=z(!1),bs={Opt:{bg:"rgba(16, 185, 129, 0.15)",border:"#10b981",label:"Optimum"},Green:{bg:"rgba(132, 204, 22, 0.15)",border:"#84cc16",label:"Green"},Greasy:{bg:"rgba(234, 179, 8, 0.15)",border:"#eab308",label:"Greasy"},Damp:{bg:"rgba(249, 115, 22, 0.15)",border:"#f97316",label:"Damp"},Wet:{bg:"rgba(59, 130, 246, 0.15)",border:"#3b82f6",label:"Wet"},Flooded:{bg:"rgba(139, 92, 246, 0.15)",border:"#8b5cf6",label:"Flooded"}},qs=k(()=>{const o=Ce.value;if(o.length<2)return!1;const s=o[0]?.grip;return o.some(c=>c.grip!==s)}),js=k(()=>{const o=Ce.value;if(o.length===0)return[];const s=[];let c=o[0]?.grip||"Opt",m=1;return o.forEach((i,h)=>{i.grip!==c&&(s.push({gripLevel:c,startLap:m,endLap:h}),c=i.grip,m=h+1)}),s.push({gripLevel:c,startLap:m,endLap:o.length}),s});return(o,s)=>{const c=zn,m=La;return _(),b("div",ki,[(_(),Sn(Cn,{to:"body"},[ys(Wn,{name:"slide-notification"},{default:en(()=>[Je.value?(_(),b("div",Ei,[...s[6]||(s[6]=[a("span",{class:"share-notification-icon"},"âœ“",-1),a("span",{class:"share-notification-text"},"Link copiato nella clipboard!",-1)])])):Z("",!0)]),_:1})])),ys(c,{class:"session-detail-page"},{default:en(()=>[a("div",Ai,[a("button",{class:"nav-btn",onClick:s[0]||(s[0]=i=>y("back"))},[...s[7]||(s[7]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M15 18l-6-6 6-6"})],-1),V(" Torna alle sessioni ",-1)])]),a("button",{class:"nav-btn nav-btn--accent",onClick:s[1]||(s[1]=i=>y("go-to-track",P.value.trackId))},[...s[8]||(s[8]=[V(" Apri pista ",-1),a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M9 18l6-6-6-6"})],-1)])])]),Ze.value?(_(),b("div",xi,[...s[9]||(s[9]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Caricamento sessione...",-1)])])):Xe.value?(_(),b("div",Mi,[s[10]||(s[10]=a("p",{class:"error-icon"},"âš ï¸",-1)),a("p",Ii,g(Xe.value),1),a("button",{class:"nav-btn",onClick:s[2]||(s[2]=i=>y("back"))},"Torna alle sessioni")])):(_(),b(O,{key:2},[a("header",Ri,[a("div",Li,[a("h1",Pi,g(P.value.track.toUpperCase()),1),a("span",{class:H(["type-badge",`type-badge--${P.value.type}`])},g(v(P.value.type)),3),a("button",{class:"share-session-btn",onClick:Cs,title:"Condividi questa sessione"}," ðŸ”— Condividi ")]),a("div",Oi,[a("span",null,g(P.value.date),1),s[11]||(s[11]=a("span",{class:"sep"},"â€¢",-1)),a("span",null,g(P.value.time),1),s[12]||(s[12]=a("span",{class:"sep"},"â€¢",-1)),a("span",Di,g(P.value.car),1)])]),a("div",Ni,[a("aside",wi,[a("div",Bi,[a("div",$i,[s[14]||(s[14]=a("span",{class:"builder-panel-title"},"Strategy Builder",-1)),us.value?(_(),b(O,{key:0},[Vt.value?(_(),b("button",{key:0,class:"builder-combo-btn builder-combo-btn--active",onClick:ps,title:"Confronto attivo - Clicca per resettare"},[...s[13]||(s[13]=[a("span",{class:"combo-status"},"âœ“ Attivo",-1),a("span",{class:"combo-divider"},"|",-1),a("span",{class:"combo-reset"},"Ã—",-1)])])):(_(),b("button",{key:1,class:"builder-combo-btn",onClick:ps,title:"Azzera selezione"}," Ã— Reset "))],64)):Z("",!0)]),a("div",zi,[s[15]||(s[15]=a("span",{class:"builder-slot-label"},"A",-1)),a("div",Fi,[D.value?(_(),b(O,{key:1},[a("span",Gi,[V(" #"+g(D.value)+" ",1),a("button",{class:"chip-remove",onClick:Rs,title:F.value?"Rimuovi (rimuoverÃ  anche +"+F.value+")":"Rimuovi"},"Ã—",8,Qi)]),F.value?(_(),b("span",Hi,[V(" + #"+g(F.value)+" ",1),a("button",{class:"chip-remove",onClick:Lt,title:"Rimuovi"},"Ã—")])):Z("",!0)],64)):(_(),b("span",Ui,"Seleziona stint con [+A]"))])]),a("div",Vi,[s[16]||(s[16]=a("span",{class:"builder-slot-label"},"B",-1)),a("div",Yi,[I.value?(_(),b(O,{key:1},[a("span",Zi,[V(" #"+g(I.value)+" ",1),a("button",{class:"chip-remove",onClick:Ls,title:w.value?"Rimuovi (rimuoverÃ  anche +"+w.value+")":"Rimuovi"},"Ã—",8,Xi)]),w.value?(_(),b("span",qi,[V(" + #"+g(w.value)+" ",1),a("button",{class:"chip-remove",onClick:xe,title:"Rimuovi"},"Ã—")])):Z("",!0)],64)):(_(),b("span",Wi,"Seleziona stint con [+B]"))])])]),ft.value?(_(),b(O,{key:0},[a("div",ji,[a("div",Ki,[a("span",Ji,"Sessione di "+g(d.value||"Te"),1),a("span",eo,g(P.value.date),1)]),a("div",to,[(_(!0),b(O,null,Te(P.value.stints,i=>(_(),b("div",{key:"a-"+i.number,class:H(["stint-item stint-item--builder",{"builder-selected":bt(i.number),viewing:Me.value===i.number,"best-stint":st(i)}]),onClick:h=>Ps(i.number)},[a("button",{class:"stint-add-btn stint-add-btn--a",disabled:!_t(i.number),title:fs(i.number),onClick:Et(h=>Dt(i.number),["stop"])},"+A",8,no),a("button",{class:"stint-add-btn stint-add-btn--b",disabled:!vs(i.number),title:Xt(i.number),onClick:Et(h=>Nt(i.number),["stop"])},"+B",8,ao),a("span",io,[st(i)?(_(),b(O,{key:0},[V("ðŸ†")],64)):De(i)?(_(),b(O,{key:1},[V(g(De(i)?.icon),1)],64)):Z("",!0)]),a("span",oo,"#"+g(i.number),1),a("span",{class:H(["stint-type",`stint-type--${i.type.toLowerCase()}`])},g(i.type),3),a("span",lo,g(i.laps)+" Giri",1)],10,so))),128))])]),a("div",ro,[a("div",uo,[a("span",co,[ue.value?(_(),b(O,{key:0},[V(" Sessione di "+g(Qe.value||"Utente Esterno"),1)],64)):(_(),b(O,{key:1},[V(" Sessione di "+g(d.value||"Te")+" (altra) ",1)],64))]),a("button",{class:"cross-session-close",onClick:mt,title:"Rimuovi questa sorgente"},"âœ•")]),a("div",po,[(_(!0),b(O,null,Te(ht.value,i=>(_(),b("div",{key:"b-"+i.number,class:H(["stint-item stint-item--builder stint-item--b",{"builder-selected":hs(i.number)}]),onClick:h=>(i.number,void 0)},[a("button",{class:"stint-add-btn stint-add-btn--a",disabled:!As(i.number),title:xs(i.number),onClick:Et(h=>Dt(i.number),["stop"])},"+A",8,fo),a("button",{class:"stint-add-btn stint-add-btn--b",disabled:!Ms(i.number),title:ms(i.number),onClick:Et(h=>Is(i.number),["stop"])},"+B",8,mo),a("span",ho,[st(i)?(_(),b(O,{key:0},[V("ðŸ†")],64)):De(i)?(_(),b(O,{key:1},[V(g(De(i)?.icon),1)],64)):Z("",!0)]),a("span",go,"#"+g(i.number),1),a("span",{class:H(["stint-type",`stint-type--${i.type.toLowerCase()}`])},g(i.type),3),a("span",_o,g(i.laps)+" Giri",1)],10,vo))),128))])])],64)):(_(),b(O,{key:1},[s[17]||(s[17]=a("h4",{class:"master-title"},"STINT",-1)),a("div",bo,[(_(!0),b(O,null,Te(P.value.stints,i=>(_(),b("div",{key:i.number,class:H(["stint-item stint-item--builder",{selected:Me.value===i.number,"builder-selected-a":bt(i.number),"builder-selected-b":hs(i.number),"best-stint":st(i)}]),onClick:h=>qt(i.number)},[a("button",{class:"stint-add-btn stint-add-btn--a",disabled:!_t(i.number),title:fs(i.number),onClick:Et(h=>Dt(i.number),["stop"])},"+A",8,To),a("button",{class:"stint-add-btn stint-add-btn--b",disabled:!vs(i.number),title:Xt(i.number),onClick:Et(h=>Nt(i.number),["stop"])},"+B",8,So),a("span",Co,[st(i)?(_(),b(O,{key:0},[V("ðŸ†")],64)):De(i)?(_(),b(O,{key:1},[V(g(De(i)?.icon),1)],64)):Z("",!0)]),a("span",ko,"#"+g(i.number),1),a("span",{class:H(["stint-type",`stint-type--${i.type.toLowerCase()}`])},g(i.type),3),a("span",Eo,g(i.laps)+" Giri",1),a("span",{class:H(["stint-delta",`delta--${T(C(i))}`])},g(C(i)),3)],10,yo))),128))]),a("button",{class:"altra-sessione-btn",onClick:Se}," Confronta con altra sessione ")],64))]),a("section",Ao,[!fe.value&&!K.value&&!Q.value&&P.value.stints.length===0?(_(),b("div",xo,[...s[18]||(s[18]=[a("div",{class:"empty-state-content"},[a("h3",{class:"empty-state-title"},"Nessun stint disponibile"),a("p",{class:"empty-state-text"},"Questa sessione non contiene dati di stint.")],-1)])])):Z("",!0),!fe.value&&!K.value&&te.value&&De(te.value)?(_(),b("div",Mo,g(De(te.value)?.icon)+" "+g(De(te.value)?.message),1)):Z("",!0),fe.value||K.value||Q.value?(_(),b("div",Io,[a("div",Ro,[a("div",Lo,[a("div",Po,"A: Stint #"+g(K.value||Q.value?D.value:qe.value),1),a("div",Oo,[a("span",Do,[s[19]||(s[19]=a("span",{class:"cond-lbl"},"Aria:",-1)),V(" "+g(zt(K.value||Q.value?we.value:He.value))+"Â°",1)]),a("span",No,[s[20]||(s[20]=a("span",{class:"cond-lbl"},"Grip:",-1)),V(" "+g(Ct(K.value||Q.value?we.value:He.value)),1)])])]),a("div",wo,[a("div",Bo,"B: Stint #"+g(K.value||Q.value?I.value:Ae.value),1),a("div",$o,[a("span",zo,[s[21]||(s[21]=a("span",{class:"cond-lbl"},"Aria:",-1)),V(" "+g(zt(K.value||Q.value?ce.value:Ne.value))+"Â°",1)]),a("span",Fo,[s[22]||(s[22]=a("span",{class:"cond-lbl"},"Grip:",-1)),V(" "+g(Ct(K.value||Q.value?ce.value:Ne.value)),1)])])])]),a("div",Uo,[a("div",Go,[s[32]||(s[32]=a("div",{class:"ssc-table-header"},[a("div",{class:"ssc-th ssc-th--label"}),a("div",{class:"ssc-th"},"STRATEGIA A"),a("div",{class:"ssc-th"},"STRATEGIA B"),a("div",{class:"ssc-th"},"- DELTA")],-1)),(_(!0),b(O,null,Te(nt.value,(i,h)=>(_(),b(O,{key:h},[nt.value>1?(_(),b("div",Qo,[a("span",null,"STINT "+g(h+1),1)])):Z("",!0),a("div",Ho,[s[23]||(s[23]=a("div",{class:"ssc-td ssc-td--label"},"BEST",-1)),a("div",Vo,g(se.value[h]?.best??"â€”"),1),a("div",Yo,g(ne.value[h]?.best??"â€”"),1),a("div",Wo,[se.value[h]&&ne.value[h]?(_(),b("span",{key:0,class:H(["ssc-delta",Jt(se.value[h]?.bestMs,ne.value[h]?.bestMs)])},g(Ut(se.value[h]?.bestMs,ne.value[h]?.bestMs)),3)):(_(),b("span",Zo,"â€”"))])]),a("div",Xo,[s[24]||(s[24]=a("div",{class:"ssc-td ssc-td--label"},"AVG",-1)),a("div",{class:H(["ssc-td","ssc-td--value",{"ssc-td--warning":se.value[h]?.avgWarning}])},[se.value[h]?.avgWarning?(_(),b(O,{key:0},[V("âš ï¸ "+g(se.value[h]?.avg),1)],64)):(_(),b(O,{key:1},[V(g(se.value[h]?.avg??"â€”"),1)],64))],2),a("div",{class:H(["ssc-td","ssc-td--value",{"ssc-td--warning":ne.value[h]?.avgWarning}])},[ne.value[h]?.avgWarning?(_(),b(O,{key:0},[V("âš ï¸ "+g(ne.value[h]?.avg),1)],64)):(_(),b(O,{key:1},[V(g(ne.value[h]?.avg??"â€”"),1)],64))],2),a("div",qo,[se.value[h]&&ne.value[h]?(_(),b("span",{key:0,class:H(["ssc-delta",Jt(se.value[h]?.avgMs,ne.value[h]?.avgMs)])},g(Ut(se.value[h]?.avgMs,ne.value[h]?.avgMs)),3)):(_(),b("span",jo,"â€”"))])]),a("div",Ko,[s[27]||(s[27]=a("div",{class:"ssc-td ssc-td--label"},"GIRI VALIDI",-1)),a("div",Jo,[se.value[h]?(_(),b(O,{key:0},[V(g(se.value[h].validLapsCount??0)+" su "+g(se.value[h].laps??0)+" ",1),s[25]||(s[25]=a("span",{class:"compact-sep"},"Â·",-1)),V(" "+g(Ot(se.value[h]?.durationMs)),1)],64)):(_(),b(O,{key:1},[V("â€”")],64))]),a("div",el,[ne.value[h]?(_(),b(O,{key:0},[V(g(ne.value[h].validLapsCount??0)+" su "+g(ne.value[h].laps??0)+" ",1),s[26]||(s[26]=a("span",{class:"compact-sep"},"Â·",-1)),V(" "+g(Ot(ne.value[h]?.durationMs)),1)],64)):(_(),b(O,{key:1},[V("â€”")],64))]),s[28]||(s[28]=a("div",{class:"ssc-td"},null,-1))])],64))),128)),nt.value>1?(_(),b(O,{key:0},[s[31]||(s[31]=a("div",{class:"ssc-stint-separator ssc-stint-separator--total"},[a("span",null,"TOTALE")],-1)),a("div",tl,[s[29]||(s[29]=a("div",{class:"ssc-td ssc-td--label"},"DURATA",-1)),a("div",sl,g(Ot(Wt.value)),1),a("div",nl,g(Ot(Es.value)),1),s[30]||(s[30]=a("div",{class:"ssc-td"},null,-1))])],64)):Z("",!0)])])])):Z("",!0),!fe.value&&!Q.value&&!K.value&&Bt.value?(_(),b("div",{key:3,class:H(["stint-stats-card",`racing-theme--${W.value}`])},[a("div",al,[a("div",il,[a("span",{class:H(["stint-type",`stint-type--${Bt.value?.type?.toLowerCase()}`])},g(Bt.value?.type==="R"?"Race":"Qualifying"),3),a("span",ol,"STINT #"+g(jt.value),1),s[35]||(s[35]=a("span",{class:"ssc-header-divider"},"|",-1)),a("span",ll,[s[33]||(s[33]=a("span",{class:"ssc-cond-lbl"},"ARIA",-1)),a("span",rl,g(Gt.value.airTemp.avg||Gt.value.airTemp.start)+"Â°",1)]),a("span",ul,[s[34]||(s[34]=a("span",{class:"ssc-cond-lbl"},"GRIP",-1)),a("span",cl,g(Gt.value.grip.dominant),1)])]),a("div",dl,[a("span",pl,"Durata: "+g(Fe.value.formatted),1)])]),a("div",vl,[s[38]||(s[38]=a("div",{class:"ssc-table-header"},[a("div",{class:"ssc-th ssc-th--label"}),a("div",{class:"ssc-th"},"TEMPI STINT"),a("div",{class:"ssc-th ssc-th--theo"},[V(" TEORICO "),a("span",{class:"theo-info",title:"Tempo Teorico = Storico + (TempStint - TempStorico) Ã— 100ms/Â°C"},"?")]),a("div",{class:"ssc-th"},"- DELTA")],-1)),a("div",fl,[s[36]||(s[36]=a("div",{class:"ssc-td ssc-td--label"},"BEST",-1)),a("div",ml,g(te.value?.best??"â€”:â€”.---"),1),a("div",hl,g(te.value?.type==="Q"?he.value.theoQualy?ss(Y)(he.value.theoQualy):"â€”:â€”.---":he.value.theoRace?ss(Y)(he.value.theoRace):"â€”:â€”.---"),1),a("div",gl,[a("span",{class:H(["ssc-delta",B.value.class])},g(B.value.value),3)])]),a("div",_l,[s[37]||(s[37]=a("div",{class:"ssc-td ssc-td--label"},"AVG",-1)),a("div",bl,g(te.value?.avg??"â€”:â€”.---"),1),a("div",yl,g(te.value?.type==="Q"?"â€”":he.value.theoAvgRace?ss(Y)(he.value.theoAvgRace):"â€”:â€”.---"),1),a("div",Tl,[te.value?.type!=="Q"?(_(),b("span",{key:0,class:H(["ssc-delta",pe.value.class])},g(pe.value.value),3)):(_(),b("span",Sl,"â€”"))])])]),te.value?.type==="R"&&J.value.total>0?(_(),b("div",Cl,[a("div",kl,[s[39]||(s[39]=a("span",{class:"ssc-target-label"},"TARGET GARA:",-1)),a("span",El,g(J.value.targetLine),1)])])):Z("",!0),a("div",Al,[te.value?.type==="R"&&J.value.total>0?(_(),b("div",xl,[a("div",Ml,[s[40]||(s[40]=a("span",{class:"ssc-progress-title"},"GIRI NEL TARGET",-1)),a("span",Il,g(J.value.onTarget)+" su "+g(J.value.total),1)]),a("div",Rl,[a("div",{class:"ssc-progress-fill",style:ts({width:J.value.pct+"%",background:ot(J.value.pct)})},null,4)]),a("span",{class:"ssc-progress-pct",style:ts({color:ot(J.value.pct)})},g(J.value.pct)+"%",5)])):Z("",!0),le.value.total>0?(_(),b("div",Ll,[a("div",Pl,[s[41]||(s[41]=a("span",{class:"ssc-progress-title"},"GIRI VALIDI",-1)),a("span",Ol,g(le.value.valid)+" su "+g(le.value.total),1)]),a("div",Dl,[a("div",{class:"ssc-progress-fill",style:ts({width:le.value.pct+"%",background:ot(le.value.pct)})},null,4)]),a("span",{class:"ssc-progress-pct",style:ts({color:ot(le.value.pct)})},g(le.value.pct)+"%",5)])):Z("",!0)])],2)):Z("",!0),a("div",Nl,[a("div",wl,[a("h4",Bl,[fe.value?(_(),b(O,{key:0},[V("Confronto Tempi â€” A: Stint #"+g(qe.value)+" vs B: Stint #"+g(Ae.value),1)],64)):(_(),b(O,{key:1},[V("Tempi Giro â€” Stint "+g(Me.value),1)],64))]),a("div",$l,[a("button",{class:"toolbar-btn",onClick:Ye,title:"Zoom In"},[...s[42]||(s[42]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("circle",{cx:"11",cy:"11",r:"8"}),a("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),a("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),a("line",{x1:"8",y1:"11",x2:"14",y2:"11"})],-1)])]),a("button",{class:"toolbar-btn",onClick:pt,title:"Zoom Out"},[...s[43]||(s[43]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("circle",{cx:"11",cy:"11",r:"8"}),a("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),a("line",{x1:"8",y1:"11",x2:"14",y2:"11"})],-1)])]),a("button",{class:"toolbar-btn",onClick:q,title:"Reset Zoom"},[...s[44]||(s[44]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("polyline",{points:"1 4 1 10 7 10"}),a("polyline",{points:"23 20 23 14 17 14"}),a("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})],-1)])]),s[46]||(s[46]=a("div",{class:"toolbar-divider"},null,-1)),a("button",{class:H(["toolbar-btn",{"toolbar-btn--active":L.value}]),onClick:s[3]||(s[3]=i=>L.value=!L.value),title:"Gestisci Giri"},[...s[45]||(s[45]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),a("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),a("line",{x1:"9",y1:"21",x2:"9",y2:"9"})],-1)])],2)])]),L.value?(_(),b("div",zl,[a("div",Fl,[a("div",Ul,[a("span",Gl,g(K.value?"Strategia A Â· "+se.value.map(i=>"#"+i.number).join("+"):Q.value?"Strategia A Â· Stint #"+D.value:fe.value?"Strategia A Â· Stint #"+qe.value:"Escludi Giri"),1),a("button",{class:"lap-manager-reset",onClick:dt,disabled:S.value.size===0}," Reset ",8,Ql)]),K.value?(_(!0),b(O,{key:0},Te(se.value,i=>(_(),b("div",{key:"stint-a-"+i.number,class:"lap-manager-stint-group"},[a("div",Hl,"Stint #"+g(i.number),1),a("div",Vl,[(_(!0),b(O,null,Te(P.value.lapsData[i.number]||[],h=>(_(),b("button",{key:"a-"+i.number+"-"+h.lap,class:H(["lap-toggle-btn",{"lap-toggle-btn--excluded":S.value.has(h.lap)},{"lap-toggle-btn--invalid":!h.valid&&!h.pit},{"lap-toggle-btn--pit":h.pit}]),onClick:R=>X(h.lap),title:`Giro ${h.lap} - ${h.time}${h.valid?"":" (Invalido)"}${h.pit?" (Pit)":""}`},g(h.lap),11,Yl))),128))])]))),128)):(_(),b("div",Wl,[(_(!0),b(O,null,Te(Q.value?we.value:fe.value?He.value:Ce.value,i=>(_(),b("button",{key:"a-"+i.lap,class:H(["lap-toggle-btn",{"lap-toggle-btn--excluded":S.value.has(i.lap)},{"lap-toggle-btn--invalid":!i.valid&&!i.pit},{"lap-toggle-btn--pit":i.pit}]),onClick:h=>X(i.lap),title:`Giro ${i.lap} - ${i.time}${i.valid?"":" (Invalido)"}${i.pit?" (Pit)":""}`},g(i.lap),11,Zl))),128))])),S.value.size>0?(_(),b("div",Xl,g(S.value.size)+" giri esclusi ",1)):Z("",!0)]),fe.value||K.value?(_(),b("div",ql,[a("div",jl,[a("span",Kl,g(K.value?"Strategia B Â· "+ne.value.map(i=>"#"+i.number).join("+"):"B: Stint #"+Ae.value),1),a("button",{class:"lap-manager-reset",onClick:ae,disabled:E.value.size===0}," Reset ",8,Jl)]),K.value?(_(!0),b(O,{key:0},Te(ne.value,i=>(_(),b("div",{key:"stint-b-"+i.number,class:"lap-manager-stint-group"},[a("div",er,"Stint #"+g(i.number),1),a("div",tr,[(_(!0),b(O,null,Te(P.value.lapsData[i.number]||[],h=>(_(),b("button",{key:"b-"+i.number+"-"+h.lap,class:H(["lap-toggle-btn lap-toggle-btn--b",{"lap-toggle-btn--excluded":E.value.has(h.lap)},{"lap-toggle-btn--invalid":!h.valid&&!h.pit},{"lap-toggle-btn--pit":h.pit}]),onClick:R=>Ge(h.lap),title:`Giro ${h.lap} - ${h.time}${h.valid?"":" (Invalido)"}${h.pit?" (Pit)":""}`},g(h.lap),11,sr))),128))])]))),128)):(_(),b("div",nr,[(_(!0),b(O,null,Te(Ne.value,i=>(_(),b("button",{key:"b-"+i.lap,class:H(["lap-toggle-btn lap-toggle-btn--b",{"lap-toggle-btn--excluded":E.value.has(i.lap)},{"lap-toggle-btn--invalid":!i.valid&&!i.pit},{"lap-toggle-btn--pit":i.pit}]),onClick:h=>Ge(i.lap),title:`Giro ${i.lap} - ${i.time}${i.valid?"":" (Invalido)"}${i.pit?" (Pit)":""}`},g(i.lap),11,ar))),128))])),E.value.size>0?(_(),b("div",ir,g(E.value.size)+" giri esclusi ",1)):Z("",!0)])):Z("",!0),Q.value?(_(),b("div",or,[a("div",lr,[a("span",rr,"Strategia B Â· Stint #"+g(I.value),1),a("button",{class:"lap-manager-reset",onClick:M,disabled:x.value.size===0}," Reset ",8,ur)]),a("div",cr,[(_(!0),b(O,null,Te(ce.value,i=>(_(),b("button",{key:"crossb-"+i.lapNumber,class:H(["lap-toggle-btn lap-toggle-btn--b",{"lap-toggle-btn--excluded":x.value.has(i.lapNumber)},{"lap-toggle-btn--invalid":!i.valid&&!i.pit},{"lap-toggle-btn--pit":i.pit}]),onClick:h=>ge(i.lapNumber),title:`Giro ${i.lapNumber} - ${i.lapTime}${i.valid?"":" (Invalido)"}${i.pit?" (Pit)":""}`},g(i.lapNumber),11,dr))),128))]),x.value.size>0?(_(),b("div",pr,g(x.value.size)+" giri esclusi ",1)):Z("",!0)])):Z("",!0)])):Z("",!0),a("div",vr,[ys(ss(aa),{ref_key:"chartRef",ref:U,data:Ds.value,options:t},null,8,["data"])]),qs.value&&Xs.value?(_(),b("div",fr,[s[47]||(s[47]=a("span",{class:"grip-legend-title"},"Grip:",-1)),(_(!0),b(O,null,Te(js.value,i=>(_(),b("div",{key:`${i.gripLevel}-${i.startLap}`,class:"grip-legend-item"},[a("span",{class:"grip-legend-dot",style:ts({backgroundColor:bs[i.gripLevel]?.border||"#fff"})},null,4),a("span",mr,g(bs[i.gripLevel]?.label||i.gripLevel),1),a("span",hr,"(G"+g(i.startLap)+"-G"+g(i.endLap)+")",1)]))),128))])):Z("",!0)]),a("div",gr,[a("div",_r,[fe.value||Q.value||K.value?(_(),b("div",br,[a("button",{class:H(["lap-tab lap-tab--compare",{"lap-tab--active":ke.value==="COMPARE"}]),onClick:s[4]||(s[4]=i=>ke.value="COMPARE")}," Confronto ",2),(_(!0),b(O,null,Te(se.value,i=>(_(),b("button",{key:"tab-a-"+i.number,class:H(["lap-tab lap-tab--a",{"lap-tab--active":ke.value==="A-"+i.number}]),onClick:h=>ke.value="A-"+i.number}," A: Stint #"+g(i.number),11,yr))),128)),(_(!0),b(O,null,Te(ne.value,i=>(_(),b("button",{key:"tab-b-"+i.number,class:H(["lap-tab lap-tab--b",{"lap-tab--active":ke.value==="B-"+i.number}]),onClick:h=>ke.value="B-"+i.number}," B: Stint #"+g(i.number),11,Tr))),128))])):(_(),b("h4",Sr,"Tabella Giri â€” Stint "+g(Me.value),1))]),ke.value==="COMPARE"&&(fe.value||Q.value||K.value)?(_(),b("div",Cr,[a("table",kr,[s[50]||(s[50]=a("thead",null,[a("tr",null,[a("th",{class:"col-index"},"#"),a("th",{class:"col-a",colspan:"4"},"Strategia A"),a("th",{class:"col-delta"},"Î” A-B"),a("th",{class:"col-b",colspan:"4"},"Strategia B")]),a("tr",{class:"sub-header"},[a("th"),a("th",{class:"col-a"},"Tempo"),a("th",{class:"col-a"},"S1"),a("th",{class:"col-a"},"S2"),a("th",{class:"col-a"},"S3"),a("th"),a("th",{class:"col-b"},"Tempo"),a("th",{class:"col-b"},"S1"),a("th",{class:"col-b"},"S2"),a("th",{class:"col-b"},"S3")])],-1)),a("tbody",null,[(_(!0),b(O,null,Te(Be.value,i=>(_(),b(O,{key:"cmp-"+i.index},[i._isStintStartA||i._isStintStartB?(_(),b("tr",Er,[s[48]||(s[48]=a("td",{class:"stint-header-index"},null,-1)),a("td",Ar,[i._isStintStartA?(_(),b("span",xr,"A: Stint #"+g(i._stintNumberA),1)):Z("",!0)]),s[49]||(s[49]=a("td",{class:"stint-header-delta"},null,-1)),a("td",Mr,[i._isStintStartB?(_(),b("span",Ir,"B: Stint #"+g(i._stintNumberB),1)):Z("",!0)])])):Z("",!0),a("tr",null,[a("td",Rr,g(i.index),1),a("td",Lr,g(i.lapA&&(i.lapA.time||i.lapA.lapTime)||"â€”"),1),a("td",Pr,g(i.lapA?ze(i.lapA.sectors?.[0]||i.lapA.s1):"â€”"),1),a("td",Or,g(i.lapA?ze(i.lapA.sectors?.[1]||i.lapA.s2):"â€”"),1),a("td",Dr,g(i.lapA?ze(i.lapA.sectors?.[2]||i.lapA.s3):"â€”"),1),a("td",{class:H(["col-delta","delta",`delta--${i.deltaClass}`])},g(i.deltaFormatted),3),a("td",Nr,g(i.lapB&&(i.lapB.time||i.lapB.lapTime)||"â€”"),1),a("td",wr,g(i.lapB?ze(i.lapB.sectors?.[0]||i.lapB.s1):"â€”"),1),a("td",Br,g(i.lapB?ze(i.lapB.sectors?.[1]||i.lapB.s2):"â€”"),1),a("td",$r,g(i.lapB?ze(i.lapB.sectors?.[2]||i.lapB.s3):"â€”"),1)])],64))),128))])])])):(_(),b("div",zr,[a("table",Fr,[s[51]||(s[51]=a("thead",null,[a("tr",null,[a("th",null,"Giro"),a("th",null,"Tempo"),a("th",null,"Î” Teorico"),a("th",null,"S1"),a("th",null,"S2"),a("th",null,"S3"),a("th",null,"Fuel"),a("th",null,"AirÂ°"),a("th",null,"Grip"),a("th",null,"Stato")])],-1)),a("tbody",null,[(_(!0),b(O,null,Te(tt(),i=>(_(),b("tr",{key:i.lap||i.lapNumber,class:H({"lap-pit":i.pit,"lap-excluded":S.value.has(i.lap||i.lapNumber),"lap-best":Tt(i)})},[a("td",null,g(i.lap||i.lapNumber),1),a("td",Ur,g(i.time||i.lapTime),1),a("td",{class:H(["delta",`delta--${T(i.delta)}`])},g(i.delta||"â€”"),3),a("td",{class:H(["sector",{"sector--best":Oe(i,0)}])},g(ze(i.sectors?.[0]||i.s1)),3),a("td",{class:H(["sector",{"sector--best":Oe(i,1)}])},g(ze(i.sectors?.[1]||i.s2)),3),a("td",{class:H(["sector",{"sector--best":Oe(i,2)}])},g(ze(i.sectors?.[2]||i.s3)),3),a("td",null,g(i.fuel)+"L",1),a("td",null,g(Math.round(i.airTemp||i.air||0))+"Â°",1),a("td",null,g(i.grip),1),a("td",Gr,[i.pit?(_(),b("span",Qr,"PIT")):i.valid?(_(),b("span",Vr,"OK")):(_(),b("span",Hr,"INV"))])],2))),128))])])]))])])])],64))]),_:1}),ys(m,{"is-open":It.value,"current-track":P.value?.track||"","exclude-session-id":f.sessionId,onClose:s[5]||(s[5]=i=>It.value=!1),onSelect:Rt},null,8,["is-open","current-track","exclude-session-id"])])}}}),jr=Object.assign(kn(Yr,[["__scopeId","data-v-ae8ab1c8"]]),{__name:"PagesSessionDetailPage"});export{jr as _};
