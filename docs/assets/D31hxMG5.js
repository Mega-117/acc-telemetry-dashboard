import{_ as z}from"./xOCTEXod.js";import{b as D,a2 as I,r as w,o as E,w as F,t as f,a4 as p,L as G,F as i,J as O,G as t,E as r,H as n,a0 as l,Q as S,R as C,M as U,K as h,_ as $}from"./DNIypS_s.js";import{u as A}from"./DgQP2i11.js";import{u as N}from"./Bwh6ISvG.js";const H={class:"page-header"},V={class:"page-subtitle"},Z={class:"view-toggle"},j={key:0,class:"tracks-grid"},q=["onClick"],J={class:"card-image-section"},K=["src","alt"],W={key:1,class:"card-image-placeholder"},Y={class:"card-content"},X={class:"track-name"},ss={class:"track-stats"},ts={class:"track-sessions"},as={class:"track-last"},es={class:"track-times"},ns={key:1,class:"tracks-list"},os=["onClick"],is={class:"lr-name"},rs={class:"lr-country"},ls={class:"lr-sessions"},cs={class:"lr-last"},ms=D({__name:"PistePage",emits:["go-to-track"],setup(us,{emit:x}){const{getPublicPath:P}=A(),T=x,{trackStats:d,loadSessions:M,getTrackBests:R}=I(),v=N(),_=w({});E(async()=>{await M(v.value||void 0)}),F(d,async()=>{if(d.value.length>0){for(const e of d.value){const s=e.track.toLowerCase().replace(/[^a-z0-9]/g,"_");try{const a=(await R(s,v.value||void 0))?.Optimum;_.value[s]={bestQualy:a?.bestQualy||null,bestRace:a?.bestRace||null}}catch(o){console.warn(`[PISTE] Failed to load trackBests for ${s}:`,o)}}console.log("[PISTE] Loaded trackBests from getTrackBests (same source as TrackDetail):",_.value)}},{immediate:!0});const u=w("card"),Q={monza:{name:"Monza",country:"IT",length:"5.793 km",image:"/tracks/track_monza.png"},donington:{name:"Donington Park",country:"GB",length:"4.020 km",image:"/tracks/track_donington.png"},spa:{name:"Spa-Francorchamps",country:"BE",length:"7.004 km",image:"/tracks/track_spa.png"},paul_ricard:{name:"Paul Ricard",country:"FR",length:"5.842 km",image:"/tracks/track_paul_ricard.png"},valencia:{name:"Valencia",country:"ES",length:"4.005 km",image:"/tracks/track_valencia.png"},barcelona:{name:"Barcelona-Catalunya",country:"ES",length:"4.655 km",image:"/tracks/track_barcelona.png"},brands_hatch:{name:"Brands Hatch",country:"GB",length:"3.908 km",image:"/tracks/track_brands_hatch.png"},hungaroring:{name:"Hungaroring",country:"HU",length:"4.381 km",image:"/tracks/track_hungaroring.png"},imola:{name:"Imola",country:"IT",length:"4.909 km",image:"/tracks/track_imola.png"},kyalami:{name:"Kyalami",country:"ZA",length:"4.522 km",image:"/tracks/track_kyalami.png"},laguna_seca:{name:"Laguna Seca",country:"US",length:"3.602 km",image:"/tracks/track_laguna_seca.png"},misano:{name:"Misano",country:"IT",length:"4.226 km",image:"/tracks/track_misano.png"},mount_panorama:{name:"Mount Panorama",country:"AU",length:"6.213 km",image:"/tracks/track_mount_panorama.png"},nurburgring:{name:"NÃ¼rburgring",country:"DE",length:"5.148 km",image:"/tracks/track_nurburgring.png"},oulton_park:{name:"Oulton Park",country:"GB",length:"4.307 km",image:"/tracks/track_oulton_park.png"},silverstone:{name:"Silverstone",country:"GB",length:"5.891 km",image:"/tracks/track_silverstone.png"},snetterton:{name:"Snetterton",country:"GB",length:"4.779 km",image:"/tracks/track_snetterton.png"},suzuka:{name:"Suzuka",country:"JP",length:"5.807 km",image:"/tracks/track_suzuka.png"},watkins_glen:{name:"Watkins Glen",country:"US",length:"5.472 km",image:"/tracks/track_watkins_glen.png"},zandvoort:{name:"Zandvoort",country:"NL",length:"4.259 km",image:"/tracks/track_zandvoort.png"},zolder:{name:"Zolder",country:"BE",length:"4.011 km",image:"/tracks/track_zolder.png"},cota:{name:"COTA",country:"US",length:"5.513 km",image:"/tracks/track_cota.png"},indianapolis:{name:"Indianapolis",country:"US",length:"4.192 km",image:"/tracks/track_indianapolis.png"},red_bull_ring:{name:"Red Bull Ring",country:"AT",length:"4.318 km",image:"/tracks/track_red_bull_ring.png"}},L=f(()=>{const e=Object.entries(Q).map(([s,o])=>({id:s,...o,sessions:0,lastSession:void 0,lastSessionFull:void 0,bestQualy:void 0,bestRace:void 0}));for(const s of d.value){const o=s.track.toLowerCase().replace(/[^a-z0-9]/g,"_"),a=e.find(B=>B.id===o||B.name.toLowerCase()===s.track.toLowerCase()),m=_.value[o],c=m?.bestQualy,g=m?.bestRace;(s.track.toLowerCase().includes("valencia")||s.track.toLowerCase().includes("suzuka"))&&console.log(`[PISTE DEBUG] ${s.track}:`,{trackBestsSource:"trackBestsMap (getTrackBests)",optimumBestQualy:c,optimumBestRace:g,oldBestByGrip:s.bestByGrip?.Optimum}),a?(a.sessions=s.sessions,a.lastSession=s.lastSession?.split("T")[0],a.lastSessionFull=s.lastSession,a.bestQualy=c?p(c):void 0,a.bestRace=g?p(g):void 0):e.push({id:o,name:s.track,country:"??",length:"?.??? km",image:void 0,sessions:s.sessions,lastSession:s.lastSession?.split("T")[0],lastSessionFull:s.lastSession,bestQualy:c?p(c):void 0,bestRace:g?p(g):void 0})}return e}),k=f(()=>[...L.value].sort((e,s)=>e.sessions>0&&s.sessions>0?(s.lastSessionFull||"").localeCompare(e.lastSessionFull||""):e.sessions>0&&s.sessions===0?-1:e.sessions===0&&s.sessions>0?1:e.name.localeCompare(s.name)));function y(e){if(!e)return"Nessuna sessione";const s=new Date(e),o=s.getDate(),m=["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"][s.getMonth()],c=s.getFullYear();return`${o} ${m} ${c}`}function b(e){T("go-to-track",e)}return(e,s)=>{const o=z;return i(),G(o,null,{default:O(()=>[s[9]||(s[9]=t("h1",{class:"page-title"},"PISTE",-1)),t("div",H,[t("p",V,n(k.value.filter(a=>a.sessions>0).length)+" piste visitate su "+n(k.value.length)+" totali",1),t("div",Z,[t("button",{class:l(["view-btn",{"view-btn--active":u.value==="card"}]),onClick:s[0]||(s[0]=a=>u.value="card"),title:"Card"},[...s[2]||(s[2]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),t("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1"}),t("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1"}),t("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"})],-1)])],2),t("button",{class:l(["view-btn",{"view-btn--active":u.value==="list"}]),onClick:s[1]||(s[1]=a=>u.value="list"),title:"Lista"},[...s[3]||(s[3]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"})],-1)])],2)])]),u.value==="card"?(i(),r("div",j,[(i(!0),r(S,null,C(k.value,a=>(i(),r("div",{key:a.id,class:l(["track-card",{"track-card--unplayed":a.sessions===0}]),onClick:m=>b(a.id)},[t("div",J,[a.image?(i(),r("img",{key:0,src:U(P)(a.image),alt:a.name,class:"card-track-image"},null,8,K)):(i(),r("div",W,[...s[4]||(s[4]=[t("span",{class:"placeholder-icon"},"ðŸ",-1)])]))]),t("div",Y,[t("h3",X,n(a.name),1),t("div",ss,[t("span",ts,n(a.sessions)+" sessioni",1),s[5]||(s[5]=t("span",{class:"track-separator"},"Â·",-1)),t("span",as,n(y(a.lastSession)),1)]),t("div",es,[t("span",{class:l(["time-badge","time-badge--qualy",{"time-badge--empty":!a.bestQualy}])}," Q "+n(a.bestQualy||"â€”:â€”.---"),3),t("span",{class:l(["time-badge","time-badge--race",{"time-badge--empty":!a.bestRace}])}," R "+n(a.bestRace||"â€”:â€”.---"),3)]),s[6]||(s[6]=t("button",{class:"track-cta"},[h(" Dettaglio pista "),t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})])],-1))])],10,q))),128))])):(i(),r("div",ns,[s[8]||(s[8]=t("div",{class:"list-header"},[t("span",{class:"lh-name"},"Pista"),t("span",{class:"lh-sessions"},"Sessioni"),t("span",{class:"lh-last"},"Ultima sessione"),t("span",{class:"lh-best"},"Best Q"),t("span",{class:"lh-best"},"Best R"),t("span",{class:"lh-cta"})],-1)),(i(!0),r(S,null,C(k.value,a=>(i(),r("div",{key:a.id,class:l(["list-row",{"list-row--unplayed":a.sessions===0}]),onClick:m=>b(a.id)},[t("span",is,[t("span",rs,n(a.country),1),h(" "+n(a.name),1)]),t("span",ls,n(a.sessions),1),t("span",cs,n(y(a.lastSession)),1),t("span",{class:l(["lr-time","lr-time--qualy",{"lr-time--empty":!a.bestQualy}])}," Q "+n(a.bestQualy||"â€”:â€”.---"),3),t("span",{class:l(["lr-time","lr-time--race",{"lr-time--empty":!a.bestRace}])}," R "+n(a.bestRace||"â€”:â€”.---"),3),s[7]||(s[7]=t("span",{class:"lr-cta"},[h(" Dettaglio "),t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})])],-1))],10,os))),128))]))]),_:1})}}}),_s=Object.assign($(ms,[["__scopeId","data-v-055415f7"]]),{__name:"PagesPistePage"});export{_s as _};
