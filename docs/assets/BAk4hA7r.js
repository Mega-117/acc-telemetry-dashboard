import{_ as M}from"./DBmMnW0z.js";import{b as U,a as B,r as h,m as F,o as P,C as r,D as i,E as e,F as l,a4 as V,a6 as q,I as m,a7 as A,O as E,P as O,a8 as T,U as N,R as x,a9 as D,V as w,J as z,H as G,_ as R}from"./gcXKy2jh.js";const H={class:"piloti-page"},J={class:"page-header"},Q={class:"page-subtitle"},Y={class:"search-box"},j={key:0,class:"state-box"},K={key:1,class:"state-box state-box--empty"},W={key:2,class:"state-box"},X={key:3,class:"pilots-list"},Z={class:"lr-name"},ss={class:"pilot-avatar"},as={class:"lr-nickname"},es={class:"lr-sessions"},ts={class:"lr-last"},ns=U({__name:"index",setup(os){const{currentUser:_}=B(),c=h([]),g=h(!0),d=h(""),y=F(()=>{if(!d.value.trim())return c.value;const s=d.value.toLowerCase();return c.value.filter(a=>{const n=`${a.firstName||""} ${a.lastName||""}`.toLowerCase(),t=(a.nickname||"").toLowerCase(),f=(a.email||"").toLowerCase();return n.includes(s)||t.includes(s)||f.includes(s)})}),C=async()=>{if(_.value)try{const s=T(N(x,"users"),D("role","==","pilot"),D("coachId","==",_.value.uid)),n=(await w(s)).docs.map(o=>({uid:o.id,...o.data()})),t=new Date;t.setDate(t.getDate()-7);const f=t.toISOString();for(const o of n)try{const v=N(x,`users/${o.uid}/sessions`),b=await w(v);let u,k=0;b.docs.forEach(L=>{const p=L.data().meta?.date_start;p&&((!u||p>u)&&(u=p),p>=f&&k++)}),o.lastSession=u,o.totalSessions=k}catch(v){console.warn(`Could not fetch sessions for pilot ${o.uid}:`,v)}c.value=n}catch(s){console.error("Error fetching pilots:",s)}finally{g.value=!1}};function S(s){return s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.nickname}function I(s){return s.firstName&&s.lastName?`${s.firstName[0]}${s.lastName[0]}`.toUpperCase():s.nickname.slice(0,2).toUpperCase()}function $(s){if(!s)return"Mai attivo";const a=new Date(s);return`${a.getDate()} ${["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"][a.getMonth()]} ${a.getFullYear()}`}return P(()=>{C()}),(s,a)=>{const n=M;return i(),r("div",H,[a[5]||(a[5]=e("h1",{class:"page-title"},"I MIEI PILOTI",-1)),e("div",J,[e("p",Q,l(c.value.length)+" piloti assegnati",1),e("div",Y,[a[1]||(a[1]=e("svg",{class:"search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"M21 21l-4.35-4.35"})],-1)),V(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>d.value=t),type:"text",placeholder:"Cerca pilota...",class:"search-input"},null,512),[[q,d.value]])])]),g.value?(i(),r("div",j," Caricamento piloti... ")):c.value.length===0?(i(),r("div",K,[...a[2]||(a[2]=[e("p",null,"Nessun pilota assegnato",-1),e("small",null,[m("Per assegnare un pilota, vai nella Firebase Console e aggiungi il campo "),e("code",null,"coachId"),m(" con il tuo UID al documento del pilota.")],-1)])])):y.value.length===0?(i(),r("div",W,' Nessun pilota trovato per "'+l(d.value)+'" ',1)):(i(),r("div",X,[a[4]||(a[4]=A('<div class="list-header" data-v-16863fad><span class="lh-name" data-v-16863fad>Pilota</span><span class="lh-nickname" data-v-16863fad>Nickname</span><span class="lh-sessions" data-v-16863fad>Sessioni (7gg)</span><span class="lh-last" data-v-16863fad>Ultima attivit√†</span><span class="lh-cta" data-v-16863fad></span></div>',1)),(i(!0),r(E,null,O(y.value,t=>(i(),z(n,{key:t.uid,to:`/piloti/${t.uid}`,class:"list-row"},{default:G(()=>[e("span",Z,[e("span",ss,l(I(t)),1),m(" "+l(S(t)),1)]),e("span",as,l(t.nickname),1),e("span",es,l(t.totalSessions||0),1),e("span",ts,l($(t.lastSession)),1),a[3]||(a[3]=e("span",{class:"lr-cta"},[m(" Visualizza "),e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 18l6-6-6-6"})])],-1))]),_:2},1032,["to"]))),128))]))])}}}),cs=R(ns,[["__scopeId","data-v-16863fad"]]);export{cs as default};
