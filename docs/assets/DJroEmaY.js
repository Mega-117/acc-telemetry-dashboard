import{_ as wn}from"./B8eVOSqV.js";import{b as fn,a2 as Bs,a as mn,r as $,t as k,a4 as Q,a6 as hn,a5 as gn,ad as _n,L as bn,F as _,am as yn,E as b,P as W,a9 as Ct,G as a,H as g,M as ts,a3 as Bn,a7 as $n,aa as zn,an as Fn,Q as O,R as Se,a0 as Y,_ as Tn,o as Un,ao as Gn,w as Os,I as bs,J as js,ap as Qn,K as V,$ as es}from"./BZElv6jr.js";import{f as dt,g as ce,h as Hs,v as Ts,j as Ks,s as Js,_ as Hn,C as Vn,a as Yn,L as Wn,P as Zn,b as Xn,p as qn,c as jn,d as Kn,i as Jn,e as ea}from"./VLSqd9l6.js";import{u as ta}from"./BhhFScsI.js";const sa={class:"session-picker-modal"},na={class:"spm-header"},aa={class:"spm-subtitle"},ia={class:"spm-link-section"},oa={class:"link-input-row"},la=["disabled"],ra={key:0,class:"link-error"},ua={class:"spm-list"},ca=["onClick"],da={class:"row-left"},pa={class:"session-date"},va={class:"session-time"},fa={class:"session-car"},ma={class:"row-right"},ha={class:"stat-chips"},ga={class:"stat-chip"},_a={class:"stat-chip"},ba={class:"time-slot"},ya={key:0,class:"time-badge time-badge--qualy"},Ta={key:1,class:"time-badge time-badge--qualy time-badge--empty"},Sa={class:"time-slot"},Ca={key:0,class:"time-badge time-badge--race"},ka={key:1,class:"time-badge time-badge--race time-badge--empty"},Ea={key:0,class:"spm-empty"},Aa=fn({__name:"SessionPickerModal",props:{isOpen:{type:Boolean},currentTrack:{},excludeSessionId:{}},emits:["close","select"],setup(e,{emit:l}){const r=e,d=l,{sessions:c,fetchSessionFull:f}=Bs(),{getUserProfile:y}=mn(),S=$(""),E=$(""),x=$(!1);function I(ae){const M=ae.match(/\/sessioni\/([^?]+)\?userId=([^&]+)/);return M&&M[1]&&M[2]?{sessionId:M[1],userId:M[2]}:null}async function F(){E.value="";const ae=I(S.value);if(!ae){E.value="Link non valido. Formato atteso: .../sessioni/ID?userId=...";return}x.value=!0;try{const M=await f(ae.sessionId,ae.userId);if(!M){E.value="Sessione non trovata o non piÃ¹ condivisa";return}const X=(M.session_info?.track||"").toLowerCase().replace(/[^a-z0-9]/g,"_"),Ve=r.currentTrack.toLowerCase().replace(/[^a-z0-9]/g,"_");if(!X.includes(Ve)&&!Ve.includes(X)){E.value=`Pista non corrispondente: ${M.session_info?.track||"sconosciuta"} vs ${r.currentTrack}`;return}let vt="Utente Esterno";try{const Ye=await y(ae.userId);vt=Ye?.nickname||Ye?.displayName||"Utente Esterno"}catch{}d("select",ae.sessionId,ae.userId,vt),d("close")}catch(M){console.error("[SHARE] Error loading shared session:",M),E.value=M?.code==="permission-denied"?"Sessione non piÃ¹ condivisa o accesso negato":"Errore nel caricamento della sessione"}finally{x.value=!1}}const H=k(()=>{const ae=r.currentTrack.toLowerCase().replace(/[^a-z0-9]/g,"_");return c.value.filter(M=>{if(M.sessionId===r.excludeSessionId)return!1;const X=M.meta.track.toLowerCase().replace(/[^a-z0-9]/g,"_");return X.includes(ae)||ae.includes(X)}).map(M=>({id:M.sessionId,date:Z(M.meta.date_start),time:_n(M.meta.date_start),type:gn(M.meta.session_type),car:hn(M.meta.car),laps:M.summary.laps||0,stints:M.summary.stintCount||1,bestQualy:M.summary.best_qualy_ms?Q(M.summary.best_qualy_ms):null,bestRace:M.summary.best_race_ms?Q(M.summary.best_race_ms):null}))});function Z(ae){if(!ae)return"-";const M=new Date(ae);return`${M.getDate()} ${["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"][M.getMonth()]} ${M.getFullYear()}`}function Ue(ae){return{practice:"PRACTICE",qualify:"QUALIFY",race:"RACE"}[ae]||ae.toUpperCase()}function ge(ae){d("select",ae),d("close")}function pt(){d("close")}return(ae,M)=>(_(),bn(yn,{to:"body"},[e.isOpen?(_(),b("div",{key:0,class:"session-picker-overlay",onClick:Ct(pt,["self"])},[a("div",sa,[a("div",na,[M[1]||(M[1]=a("h2",{class:"spm-title"},"Aggiungi Sorgente Dati",-1)),a("p",aa,g(ts(Bn)(e.currentTrack))+" Â· "+g(H.value.length)+" sessioni disponibili",1),a("button",{class:"spm-close",onClick:pt},"âœ•")]),a("div",ia,[M[2]||(M[2]=a("label",{class:"link-label"},"ðŸ“‹ Incolla link sessione condivisa",-1)),a("div",oa,[$n(a("input",{"onUpdate:modelValue":M[0]||(M[0]=X=>S.value=X),type:"text",class:"link-input",placeholder:"https://...?userId=...",onKeyup:Fn(F,["enter"])},null,544),[[zn,S.value]]),a("button",{class:"link-load-btn",disabled:x.value||!S.value,onClick:F},g(x.value?"...":"Carica"),9,la)]),E.value?(_(),b("p",ra,g(E.value),1)):W("",!0)]),M[3]||(M[3]=a("div",{class:"spm-divider"},[a("span",null,"oppure seleziona dalle tue sessioni")],-1)),a("div",ua,[(_(!0),b(O,null,Se(H.value,X=>(_(),b("div",{key:X.id,class:"session-row",onClick:Ve=>ge(X.id)},[a("div",da,[a("span",{class:Y(["session-chip",`session-chip--${X.type}`])},g(Ue(X.type)),3),a("span",pa,g(X.date),1),a("span",va,g(X.time),1),a("span",fa,g(X.car),1)]),a("div",ma,[a("div",ha,[a("span",ga,"GIRI "+g(X.laps),1),a("span",_a,"STINT "+g(X.stints),1)]),a("div",ba,[X.bestQualy?(_(),b("span",ya," Q "+g(X.bestQualy),1)):(_(),b("span",Ta," Q â€” "))]),a("div",Sa,[X.bestRace?(_(),b("span",Ca," R "+g(X.bestRace),1)):(_(),b("span",ka," R â€” "))])])],8,ca))),128)),H.value.length===0?(_(),b("div",Ea," Nessuna altra sessione disponibile per questa pista. ")):W("",!0)])])])):W("",!0)]))}}),xa=Object.assign(Tn(Aa,[["__scopeId","data-v-72b43332"]]),{__name:"UiSessionPickerModal"});function Ma(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ds={exports:{}};var en;function Ra(){return en||(en=1,(function(e){(function(l,r,d,c){var f=["","webkit","Moz","MS","ms","o"],y=r.createElement("div"),S="function",E=Math.round,x=Math.abs,I=Date.now;function F(t,n,u){return setTimeout(X(t,u),n)}function H(t,n,u){return Array.isArray(t)?(Z(t,u[n],u),!0):!1}function Z(t,n,u){var v;if(t)if(t.forEach)t.forEach(n,u);else if(t.length!==c)for(v=0;v<t.length;)n.call(u,t[v],v,t),v++;else for(v in t)t.hasOwnProperty(v)&&n.call(u,t[v],v,t)}function Ue(t,n,u){var v="DEPRECATED METHOD: "+n+`
`+u+` AT 
`;return function(){var T=new Error("get-stack-trace"),C=T&&T.stack?T.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",P=l.console&&(l.console.warn||l.console.log);return P&&P.call(l.console,v,C),t.apply(this,arguments)}}var ge;typeof Object.assign!="function"?ge=function(n){if(n===c||n===null)throw new TypeError("Cannot convert undefined or null to object");for(var u=Object(n),v=1;v<arguments.length;v++){var T=arguments[v];if(T!==c&&T!==null)for(var C in T)T.hasOwnProperty(C)&&(u[C]=T[C])}return u}:ge=Object.assign;var pt=Ue(function(n,u,v){for(var T=Object.keys(u),C=0;C<T.length;)(!v||v&&n[T[C]]===c)&&(n[T[C]]=u[T[C]]),C++;return n},"extend","Use `assign`."),ae=Ue(function(n,u){return pt(n,u,!0)},"merge","Use `assign`.");function M(t,n,u){var v=n.prototype,T;T=t.prototype=Object.create(v),T.constructor=t,T._super=v,u&&ge(T,u)}function X(t,n){return function(){return t.apply(n,arguments)}}function Ve(t,n){return typeof t==S?t.apply(n&&n[0]||c,n):t}function vt(t,n){return t===c?n:t}function Ye(t,n,u){Z(Je(n),function(v){t.addEventListener(v,u,!1)})}function Et(t,n,u){Z(Je(n),function(v){t.removeEventListener(v,u,!1)})}function is(t,n){for(;t;){if(t==n)return!0;t=t.parentNode}return!1}function Ke(t,n){return t.indexOf(n)>-1}function Je(t){return t.trim().split(/\s+/g)}function We(t,n,u){if(t.indexOf&&!u)return t.indexOf(n);for(var v=0;v<t.length;){if(u&&t[v][u]==n||!u&&t[v]===n)return v;v++}return-1}function Ze(t){return Array.prototype.slice.call(t,0)}function At(t,n,u){for(var v=[],T=[],C=0;C<t.length;){var P=t[C][n];We(T,P)<0&&v.push(t[C]),T[C]=P,C++}return v=v.sort(function(se,_e){return se[n]>_e[n]}),v}function et(t,n){for(var u,v,T=n[0].toUpperCase()+n.slice(1),C=0;C<f.length;){if(u=f[C],v=u?u+T:n,v in t)return v;C++}return c}var Ss=1;function os(){return Ss++}function ls(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||l}var Ut=/mobile|tablet|ip(ad|hone|od)|android/i,Ae="ontouchstart"in l,fe=et(l,"PointerEvent")!==c,Xe=Ae&&Ut.test(navigator.userAgent),Re="touch",xt="pen",ft="mouse",pe="kinect",mt=25,me=1,Ge=2,re=4,Ce=8,Mt=1,ht=2,D=4,R=8,gt=16,G=ht|D,z=R|gt,w=G|z,_t=["x","y"],Rt=["clientX","clientY"];function Ie(t,n){var u=this;this.manager=t,this.callback=n,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(v){Ve(t.options.enable,[t])&&u.handler(v)},this.init()}Ie.prototype={handler:function(){},init:function(){this.evEl&&Ye(this.element,this.evEl,this.domHandler),this.evTarget&&Ye(this.target,this.evTarget,this.domHandler),this.evWin&&Ye(ls(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Et(this.element,this.evEl,this.domHandler),this.evTarget&&Et(this.target,this.evTarget,this.domHandler),this.evWin&&Et(ls(this.element),this.evWin,this.domHandler)}};function rs(t){var n,u=t.options.inputClass;return u?n=u:fe?n=Ot:Xe?n=yt:Ae?n=Wt:n=bt,new n(t,Gt)}function Gt(t,n,u){var v=u.pointers.length,T=u.changedPointers.length,C=n&me&&v-T===0,P=n&(re|Ce)&&v-T===0;u.isFirst=!!C,u.isFinal=!!P,C&&(t.session={}),u.eventType=n,j(t,u),t.emit("hammer.input",u),t.recognize(u),t.session.prevInput=u}function j(t,n){var u=t.session,v=n.pointers,T=v.length;u.firstInput||(u.firstInput=Qt(n)),T>1&&!u.firstMultiple?u.firstMultiple=Qt(n):T===1&&(u.firstMultiple=!1);var C=u.firstInput,P=u.firstMultiple,ve=P?P.center:C.center,se=n.center=us(v);n.timeStamp=I(),n.deltaTime=n.timeStamp-C.timeStamp,n.angle=Ht(ve,se),n.distance=nt(ve,se),It(u,n),n.offsetDirection=te(n.deltaX,n.deltaY);var _e=ee(n.deltaTime,n.deltaX,n.deltaY);n.overallVelocityX=_e.x,n.overallVelocityY=_e.y,n.overallVelocity=x(_e.x)>x(_e.y)?_e.x:_e.y,n.scale=P?cs(P.pointers,v):1,n.rotation=P?ks(P.pointers,v):0,n.maxPointers=u.prevInput?n.pointers.length>u.prevInput.maxPointers?n.pointers.length:u.prevInput.maxPointers:n.pointers.length,Cs(u,n);var xe=t.element;is(n.srcEvent.target,xe)&&(xe=n.srcEvent.target),n.target=xe}function It(t,n){var u=n.center,v=t.offsetDelta||{},T=t.prevDelta||{},C=t.prevInput||{};(n.eventType===me||C.eventType===re)&&(T=t.prevDelta={x:C.deltaX||0,y:C.deltaY||0},v=t.offsetDelta={x:u.x,y:u.y}),n.deltaX=T.x+(u.x-v.x),n.deltaY=T.y+(u.y-v.y)}function Cs(t,n){var u=t.lastInterval||n,v=n.timeStamp-u.timeStamp,T,C,P,ve;if(n.eventType!=Ce&&(v>mt||u.velocity===c)){var se=n.deltaX-u.deltaX,_e=n.deltaY-u.deltaY,xe=ee(v,se,_e);C=xe.x,P=xe.y,T=x(xe.x)>x(xe.y)?xe.x:xe.y,ve=te(se,_e),t.lastInterval=n}else T=u.velocity,C=u.velocityX,P=u.velocityY,ve=u.direction;n.velocity=T,n.velocityX=C,n.velocityY=P,n.direction=ve}function Qt(t){for(var n=[],u=0;u<t.pointers.length;)n[u]={clientX:E(t.pointers[u].clientX),clientY:E(t.pointers[u].clientY)},u++;return{timeStamp:I(),pointers:n,center:us(n),deltaX:t.deltaX,deltaY:t.deltaY}}function us(t){var n=t.length;if(n===1)return{x:E(t[0].clientX),y:E(t[0].clientY)};for(var u=0,v=0,T=0;T<n;)u+=t[T].clientX,v+=t[T].clientY,T++;return{x:E(u/n),y:E(v/n)}}function ee(t,n,u){return{x:n/t||0,y:u/t||0}}function te(t,n){return t===n?Mt:x(t)>=x(n)?t<0?ht:D:n<0?R:gt}function nt(t,n,u){u||(u=_t);var v=n[u[0]]-t[u[0]],T=n[u[1]]-t[u[1]];return Math.sqrt(v*v+T*T)}function Ht(t,n,u){u||(u=_t);var v=n[u[0]]-t[u[0]],T=n[u[1]]-t[u[1]];return Math.atan2(T,v)*180/Math.PI}function ks(t,n){return Ht(n[1],n[0],Rt)+Ht(t[1],t[0],Rt)}function cs(t,n){return nt(n[0],n[1],Rt)/nt(t[0],t[1],Rt)}var Vt={mousedown:me,mousemove:Ge,mouseup:re},Lt="mousedown",ds="mousemove mouseup";function bt(){this.evEl=Lt,this.evWin=ds,this.pressed=!1,Ie.apply(this,arguments)}M(bt,Ie,{handler:function(n){var u=Vt[n.type];u&me&&n.button===0&&(this.pressed=!0),u&Ge&&n.which!==1&&(u=re),this.pressed&&(u&re&&(this.pressed=!1),this.callback(this.manager,u,{pointers:[n],changedPointers:[n],pointerType:ft,srcEvent:n}))}});var ps={pointerdown:me,pointermove:Ge,pointerup:re,pointercancel:Ce,pointerout:Ce},vs={2:Re,3:xt,4:ft,5:pe},Yt="pointerdown",Pt="pointermove pointerup pointercancel";l.MSPointerEvent&&!l.PointerEvent&&(Yt="MSPointerDown",Pt="MSPointerMove MSPointerUp MSPointerCancel");function Ot(){this.evEl=Yt,this.evWin=Pt,Ie.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}M(Ot,Ie,{handler:function(n){var u=this.store,v=!1,T=n.type.toLowerCase().replace("ms",""),C=ps[T],P=vs[n.pointerType]||n.pointerType,ve=P==Re,se=We(u,n.pointerId,"pointerId");C&me&&(n.button===0||ve)?se<0&&(u.push(n),se=u.length-1):C&(re|Ce)&&(v=!0),!(se<0)&&(u[se]=n,this.callback(this.manager,C,{pointers:u,changedPointers:[n],pointerType:P,srcEvent:n}),v&&u.splice(se,1))}});var Es={touchstart:me,touchmove:Ge,touchend:re,touchcancel:Ce},As="touchstart",xs="touchstart touchmove touchend touchcancel";function fs(){this.evTarget=As,this.evWin=xs,this.started=!1,Ie.apply(this,arguments)}M(fs,Ie,{handler:function(n){var u=Es[n.type];if(u===me&&(this.started=!0),!!this.started){var v=Ms.call(this,n,u);u&(re|Ce)&&v[0].length-v[1].length===0&&(this.started=!1),this.callback(this.manager,u,{pointers:v[0],changedPointers:v[1],pointerType:Re,srcEvent:n})}}});function Ms(t,n){var u=Ze(t.touches),v=Ze(t.changedTouches);return n&(re|Ce)&&(u=At(u.concat(v),"identifier")),[u,v]}var Rs={touchstart:me,touchmove:Ge,touchend:re,touchcancel:Ce},Is="touchstart touchmove touchend touchcancel";function yt(){this.evTarget=Is,this.targetIds={},Ie.apply(this,arguments)}M(yt,Ie,{handler:function(n){var u=Rs[n.type],v=ms.call(this,n,u);v&&this.callback(this.manager,u,{pointers:v[0],changedPointers:v[1],pointerType:Re,srcEvent:n})}});function ms(t,n){var u=Ze(t.touches),v=this.targetIds;if(n&(me|Ge)&&u.length===1)return v[u[0].identifier]=!0,[u,u];var T,C,P=Ze(t.changedTouches),ve=[],se=this.target;if(C=u.filter(function(_e){return is(_e.target,se)}),n===me)for(T=0;T<C.length;)v[C[T].identifier]=!0,T++;for(T=0;T<P.length;)v[P[T].identifier]&&ve.push(P[T]),n&(re|Ce)&&delete v[P[T].identifier],T++;if(ve.length)return[At(C.concat(ve),"identifier"),ve]}var Ls=2500,Ps=25;function Wt(){Ie.apply(this,arguments);var t=X(this.handler,this);this.touch=new yt(this.manager,t),this.mouse=new bt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}M(Wt,Ie,{handler:function(n,u,v){var T=v.pointerType==Re,C=v.pointerType==ft;if(!(C&&v.sourceCapabilities&&v.sourceCapabilities.firesTouchEvents)){if(T)L.call(this,u,v);else if(C&&Le.call(this,v))return;this.callback(n,u,v)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function L(t,n){t&me?(this.primaryTouch=n.changedPointers[0].identifier,he.call(this,n)):t&(re|Ce)&&he.call(this,n)}function he(t){var n=t.changedPointers[0];if(n.identifier===this.primaryTouch){var u={x:n.clientX,y:n.clientY};this.lastTouches.push(u);var v=this.lastTouches,T=function(){var C=v.indexOf(u);C>-1&&v.splice(C,1)};setTimeout(T,Ls)}}function Le(t){for(var n=t.srcEvent.clientX,u=t.srcEvent.clientY,v=0;v<this.lastTouches.length;v++){var T=this.lastTouches[v],C=Math.abs(n-T.x),P=Math.abs(u-T.y);if(C<=Ps&&P<=Ps)return!0}return!1}var Dt=et(y.style,"touchAction"),J=Dt!==c,ke="compute",Nt="auto",Zt="manipulation",tt="none",at="pan-x",Tt="pan-y",Qe=hs();function we(t,n){this.manager=t,this.set(n)}we.prototype={set:function(t){t==ke&&(t=this.compute()),J&&this.manager.element.style&&Qe[t]&&(this.manager.element.style[Dt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return Z(this.manager.recognizers,function(n){Ve(n.options.enable,[n])&&(t=t.concat(n.getTouchAction()))}),wt(t.join(" "))},preventDefaults:function(t){var n=t.srcEvent,u=t.offsetDirection;if(this.manager.session.prevented){n.preventDefault();return}var v=this.actions,T=Ke(v,tt)&&!Qe[tt],C=Ke(v,Tt)&&!Qe[Tt],P=Ke(v,at)&&!Qe[at];if(T){var ve=t.pointers.length===1,se=t.distance<2,_e=t.deltaTime<250;if(ve&&se&&_e)return}if(!(P&&C)&&(T||C&&u&G||P&&u&z))return this.preventSrc(n)},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};function wt(t){if(Ke(t,tt))return tt;var n=Ke(t,at),u=Ke(t,Tt);return n&&u?tt:n||u?n?at:Tt:Ke(t,Zt)?Zt:Nt}function hs(){if(!J)return!1;var t={},n=l.CSS&&l.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(u){t[u]=n?l.CSS.supports("touch-action",u):!0}),t}var Be=1,ue=2,it=4,qe=8,$e=qe,ot=16,ze=32;function Ne(t){this.options=ge({},this.defaults,t||{}),this.id=os(),this.manager=null,this.options.enable=vt(this.options.enable,!0),this.state=Be,this.simultaneous={},this.requireFail=[]}Ne.prototype={defaults:{},set:function(t){return ge(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(H(t,"recognizeWith",this))return this;var n=this.simultaneous;return t=je(t,this),n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return H(t,"dropRecognizeWith",this)?this:(t=je(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(H(t,"requireFailure",this))return this;var n=this.requireFail;return t=je(t,this),We(n,t)===-1&&(n.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(H(t,"dropRequireFailure",this))return this;t=je(t,this);var n=We(this.requireFail,t);return n>-1&&this.requireFail.splice(n,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var n=this,u=this.state;function v(T){n.manager.emit(T,t)}u<qe&&v(n.options.event+Xt(u)),v(n.options.event),t.additionalEvent&&v(t.additionalEvent),u>=qe&&v(n.options.event+Xt(u))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=ze},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(ze|Be)))return!1;t++}return!0},recognize:function(t){var n=ge({},t);if(!Ve(this.options.enable,[this,n])){this.reset(),this.state=ze;return}this.state&($e|ot|ze)&&(this.state=Be),this.state=this.process(n),this.state&(ue|it|qe|ot)&&this.tryEmit(n)},process:function(t){},getTouchAction:function(){},reset:function(){}};function Xt(t){return t&ot?"cancel":t&qe?"end":t&it?"move":t&ue?"start":""}function qt(t){return t==gt?"down":t==R?"up":t==ht?"left":t==D?"right":""}function je(t,n){var u=n.manager;return u?u.get(t):t}function de(){Ne.apply(this,arguments)}M(de,Ne,{defaults:{pointers:1},attrTest:function(t){var n=this.options.pointers;return n===0||t.pointers.length===n},process:function(t){var n=this.state,u=t.eventType,v=n&(ue|it),T=this.attrTest(t);return v&&(u&Ce||!T)?n|ot:v||T?u&re?n|qe:n&ue?n|it:ue:ze}});function st(){de.apply(this,arguments),this.pX=null,this.pY=null}M(st,de,{defaults:{event:"pan",threshold:10,pointers:1,direction:w},getTouchAction:function(){var t=this.options.direction,n=[];return t&G&&n.push(Tt),t&z&&n.push(at),n},directionTest:function(t){var n=this.options,u=!0,v=t.distance,T=t.direction,C=t.deltaX,P=t.deltaY;return T&n.direction||(n.direction&G?(T=C===0?Mt:C<0?ht:D,u=C!=this.pX,v=Math.abs(t.deltaX)):(T=P===0?Mt:P<0?R:gt,u=P!=this.pY,v=Math.abs(t.deltaY))),t.direction=T,u&&v>n.threshold&&T&n.direction},attrTest:function(t){return de.prototype.attrTest.call(this,t)&&(this.state&ue||!(this.state&ue)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var n=qt(t.direction);n&&(t.additionalEvent=this.options.event+n),this._super.emit.call(this,t)}});function Bt(){de.apply(this,arguments)}M(Bt,de,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[tt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&ue)},emit:function(t){if(t.scale!==1){var n=t.scale<1?"in":"out";t.additionalEvent=this.options.event+n}this._super.emit.call(this,t)}});function $t(){Ne.apply(this,arguments),this._timer=null,this._input=null}M($t,Ne,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Nt]},process:function(t){var n=this.options,u=t.pointers.length===n.pointers,v=t.distance<n.threshold,T=t.deltaTime>n.time;if(this._input=t,!v||!u||t.eventType&(re|Ce)&&!T)this.reset();else if(t.eventType&me)this.reset(),this._timer=F(function(){this.state=$e,this.tryEmit()},n.time,this);else if(t.eventType&re)return $e;return ze},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===$e&&(t&&t.eventType&re?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=I(),this.manager.emit(this.options.event,this._input)))}});function zt(){de.apply(this,arguments)}M(zt,de,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[tt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&ue)}});function lt(){de.apply(this,arguments)}M(lt,de,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:G|z,pointers:1},getTouchAction:function(){return st.prototype.getTouchAction.call(this)},attrTest:function(t){var n=this.options.direction,u;return n&(G|z)?u=t.overallVelocity:n&G?u=t.overallVelocityX:n&z&&(u=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&x(u)>this.options.velocity&&t.eventType&re},emit:function(t){var n=qt(t.offsetDirection);n&&this.manager.emit(this.options.event+n,t),this.manager.emit(this.options.event,t)}});function Pe(){Ne.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}M(Pe,Ne,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Zt]},process:function(t){var n=this.options,u=t.pointers.length===n.pointers,v=t.distance<n.threshold,T=t.deltaTime<n.time;if(this.reset(),t.eventType&me&&this.count===0)return this.failTimeout();if(v&&T&&u){if(t.eventType!=re)return this.failTimeout();var C=this.pTime?t.timeStamp-this.pTime<n.interval:!0,P=!this.pCenter||nt(this.pCenter,t.center)<n.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,!P||!C?this.count=1:this.count+=1,this._input=t;var ve=this.count%n.taps;if(ve===0)return this.hasRequireFailures()?(this._timer=F(function(){this.state=$e,this.tryEmit()},n.interval,this),ue):$e}return ze},failTimeout:function(){return this._timer=F(function(){this.state=ze},this.options.interval,this),ze},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==$e&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function He(t,n){return n=n||{},n.recognizers=vt(n.recognizers,He.defaults.preset),new jt(t,n)}He.VERSION="2.0.7",He.defaults={domEvents:!1,touchAction:ke,enable:!0,inputTarget:null,inputClass:null,preset:[[zt,{enable:!1}],[Bt,{enable:!1},["rotate"]],[lt,{direction:G}],[st,{direction:G},["swipe"]],[Pe],[Pe,{event:"doubletap",taps:2},["tap"]],[$t]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var gs=1,St=2;function jt(t,n){this.options=ge({},He.defaults,n||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=rs(this),this.touchAction=new we(this,this.options.touchAction),_s(this,!0),Z(this.options.recognizers,function(u){var v=this.add(new u[0](u[1]));u[2]&&v.recognizeWith(u[2]),u[3]&&v.requireFailure(u[3])},this)}jt.prototype={set:function(t){return ge(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?St:gs},recognize:function(t){var n=this.session;if(!n.stopped){this.touchAction.preventDefaults(t);var u,v=this.recognizers,T=n.curRecognizer;(!T||T&&T.state&$e)&&(T=n.curRecognizer=null);for(var C=0;C<v.length;)u=v[C],n.stopped!==St&&(!T||u==T||u.canRecognizeWith(T))?u.recognize(t):u.reset(),!T&&u.state&(ue|it|qe)&&(T=n.curRecognizer=u),C++}},get:function(t){if(t instanceof Ne)return t;for(var n=this.recognizers,u=0;u<n.length;u++)if(n[u].options.event==t)return n[u];return null},add:function(t){if(H(t,"add",this))return this;var n=this.get(t.options.event);return n&&this.remove(n),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(H(t,"remove",this))return this;if(t=this.get(t),t){var n=this.recognizers,u=We(n,t);u!==-1&&(n.splice(u,1),this.touchAction.update())}return this},on:function(t,n){if(t!==c&&n!==c){var u=this.handlers;return Z(Je(t),function(v){u[v]=u[v]||[],u[v].push(n)}),this}},off:function(t,n){if(t!==c){var u=this.handlers;return Z(Je(t),function(v){n?u[v]&&u[v].splice(We(u[v],n),1):delete u[v]}),this}},emit:function(t,n){this.options.domEvents&&Ee(t,n);var u=this.handlers[t]&&this.handlers[t].slice();if(!(!u||!u.length)){n.type=t,n.preventDefault=function(){n.srcEvent.preventDefault()};for(var v=0;v<u.length;)u[v](n),v++}},destroy:function(){this.element&&_s(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function _s(t,n){var u=t.element;if(u.style){var v;Z(t.options.cssProps,function(T,C){v=et(u.style,C),n?(t.oldCssProps[v]=u.style[v],u.style[v]=T):u.style[v]=t.oldCssProps[v]||""}),n||(t.oldCssProps={})}}function Ee(t,n){var u=r.createEvent("Event");u.initEvent(t,!0,!0),u.gesture=n,n.target.dispatchEvent(u)}ge(He,{INPUT_START:me,INPUT_MOVE:Ge,INPUT_END:re,INPUT_CANCEL:Ce,STATE_POSSIBLE:Be,STATE_BEGAN:ue,STATE_CHANGED:it,STATE_ENDED:qe,STATE_RECOGNIZED:$e,STATE_CANCELLED:ot,STATE_FAILED:ze,DIRECTION_NONE:Mt,DIRECTION_LEFT:ht,DIRECTION_RIGHT:D,DIRECTION_UP:R,DIRECTION_DOWN:gt,DIRECTION_HORIZONTAL:G,DIRECTION_VERTICAL:z,DIRECTION_ALL:w,Manager:jt,Input:Ie,TouchAction:we,TouchInput:yt,MouseInput:bt,PointerEventInput:Ot,TouchMouseInput:Wt,SingleTouchInput:fs,Recognizer:Ne,AttrRecognizer:de,Tap:Pe,Pan:st,Swipe:lt,Pinch:Bt,Rotate:zt,Press:$t,on:Ye,off:Et,each:Z,merge:ae,extend:pt,assign:ge,inherit:M,bindFn:X,prefixed:et});var Kt=typeof l<"u"?l:typeof self<"u"?self:{};Kt.Hammer=He,e.exports?e.exports=He:l[d]=He})(window,document,"Hammer")})(Ds)),Ds.exports}var Ia=Ra();const ss=Ma(Ia);const as=e=>e&&e.enabled&&e.modifierKey,Sn=(e,l)=>e&&l[e+"Key"],Vs=(e,l)=>e&&!l[e+"Key"];function ct(e,l,r){return e===void 0?!0:typeof e=="string"?e.indexOf(l)!==-1:typeof e=="function"?e({chart:r}).indexOf(l)!==-1:!1}function Ns(e,l){return typeof e=="function"&&(e=e({chart:l})),typeof e=="string"?{x:e.indexOf("x")!==-1,y:e.indexOf("y")!==-1}:{x:!1,y:!1}}function La(e,l){let r;return function(){return clearTimeout(r),r=setTimeout(e,l),l}}function Pa({x:e,y:l},r){const d=r.scales,c=Object.keys(d);for(let f=0;f<c.length;f++){const y=d[c[f]];if(l>=y.top&&l<=y.bottom&&e>=y.left&&e<=y.right)return y}return null}function Cn(e,l,r){const{mode:d="xy",scaleMode:c,overScaleMode:f}=e||{},y=Pa(l,r),S=Ns(d,r),E=Ns(c,r);if(f){const I=Ns(f,r);for(const F of["x","y"])I[F]&&(E[F]=S[F],S[F]=!1)}if(y&&E[y.axis])return[y];const x=[];return dt(r.scales,function(I){S[I.axis]&&x.push(I)}),x}const $s=new WeakMap;function le(e){let l=$s.get(e);return l||(l={originalScaleLimits:{},updatedScaleLimits:{},handlers:{},panDelta:{},dragging:!1,panning:!1},$s.set(e,l)),l}function Oa(e){$s.delete(e)}function kn(e,l,r,d){const c=Math.max(0,Math.min(1,(e-l)/r||0)),f=1-c;return{min:d*c,max:d*f}}function En(e,l){const r=e.isHorizontal()?l.x:l.y;return e.getValueForPixel(r)}function An(e,l,r){const d=e.max-e.min,c=d*(l-1),f=En(e,r);return kn(f,e.min,d,c)}function Da(e,l,r){const d=En(e,r);if(d===void 0)return{min:e.min,max:e.max};const c=Math.log10(e.min),f=Math.log10(e.max),y=Math.log10(d),S=f-c,E=S*(l-1),x=kn(y,c,S,E);return{min:Math.pow(10,c+x.min),max:Math.pow(10,f-x.max)}}function Na(e,l){return l&&(l[e.id]||l[e.axis])||{}}function tn(e,l,r,d,c){let f=r[d];if(f==="original"){const y=e.originalScaleLimits[l.id][d];f=Ts(y.options,y.scale)}return Ts(f,c)}function wa(e,l,r){const d=e.getValueForPixel(l),c=e.getValueForPixel(r);return{min:Math.min(d,c),max:Math.max(d,c)}}function Ba(e,{min:l,max:r,minLimit:d,maxLimit:c},f){const y=(e-r+l)/2;l-=y,r+=y;const S=f.min.options??f.min.scale,E=f.max.options??f.max.scale,x=e/1e6;return Ks(l,S,x)&&(l=S),Ks(r,E,x)&&(r=E),l<d?(l=d,r=Math.min(d+e,c)):r>c&&(r=c,l=Math.max(c-e,d)),{min:l,max:r}}function kt(e,{min:l,max:r},d,c=!1){const f=le(e.chart),{options:y}=e,S=Na(e,d),{minRange:E=0}=S,x=tn(f,e,S,"min",-1/0),I=tn(f,e,S,"max",1/0);if(c==="pan"&&(l<x||r>I))return!0;const F=e.max-e.min,H=c?Math.max(r-l,E):F;if(c&&H===E&&F<=E)return!0;const Z=Ba(H,{min:l,max:r,minLimit:x,maxLimit:I},f.originalScaleLimits[e.id]);return y.min=Z.min,y.max=Z.max,f.updatedScaleLimits[e.id]=Z,e.parse(Z.min)!==e.min||e.parse(Z.max)!==e.max}function $a(e,l,r,d){const c=An(e,l,r),f={min:e.min+c.min,max:e.max-c.max};return kt(e,f,d,!0)}function za(e,l,r,d){const c=Da(e,l,r);return kt(e,c,d,!0)}function Fa(e,l,r,d){kt(e,wa(e,l,r),d,!0)}const sn=e=>e===0||isNaN(e)?0:e<0?Math.min(Math.round(e),-1):Math.max(Math.round(e),1);function Ua(e){const r=e.getLabels().length-1;e.min>0&&(e.min-=1),e.max<r&&(e.max+=1)}function Ga(e,l,r,d){const c=An(e,l,r);e.min===e.max&&l<1&&Ua(e);const f={min:e.min+sn(c.min),max:e.max-sn(c.max)};return kt(e,f,d,!0)}function Qa(e){return e.isHorizontal()?e.width:e.height}function Ha(e,l,r){const c=e.getLabels().length-1;let{min:f,max:y}=e;const S=Math.max(y-f,1),E=Math.round(Qa(e)/Math.max(S,10)),x=Math.round(Math.abs(l/E));let I;return l<-E?(y=Math.min(y+x,c),f=S===1?y:y-S,I=y===c):l>E&&(f=Math.max(0,f-x),y=S===1?f:f+S,I=f===0),kt(e,{min:f,max:y},r)||I}const Va={second:500,minute:30*1e3,hour:1800*1e3,day:720*60*1e3,week:3.5*24*60*60*1e3,month:360*60*60*1e3,quarter:1440*60*60*1e3,year:4368*60*60*1e3};function xn(e,l,r,d=!1){const{min:c,max:f,options:y}=e,S=y.time&&y.time.round,E=Va[S]||0,x=e.getValueForPixel(e.getPixelForValue(c+E)-l),I=e.getValueForPixel(e.getPixelForValue(f+E)-l);return isNaN(x)||isNaN(I)?!0:kt(e,{min:x,max:I},r,d?"pan":!1)}function nn(e,l,r){return xn(e,l,r,!0)}const zs={category:Ga,default:$a,logarithmic:za},Fs={default:Fa},Us={category:Ha,default:xn,logarithmic:nn,timeseries:nn};function Ya(e,l,r){const{id:d,options:{min:c,max:f}}=e;if(!l[d]||!r[d])return!0;const y=r[d];return y.min!==c||y.max!==f}function an(e,l){dt(e,(r,d)=>{l[d]||delete e[d]})}function Ft(e,l){const{scales:r}=e,{originalScaleLimits:d,updatedScaleLimits:c}=l;return dt(r,function(f){Ya(f,d,c)&&(d[f.id]={min:{scale:f.min,options:f.options.min},max:{scale:f.max,options:f.options.max}})}),an(d,r),an(c,r),d}function on(e,l,r,d){const c=zs[e.type]||zs.default;ce(c,[e,l,r,d])}function ln(e,l,r,d){const c=Fs[e.type]||Fs.default;ce(c,[e,l,r,d])}function Wa(e){const l=e.chartArea;return{x:(l.left+l.right)/2,y:(l.top+l.bottom)/2}}function Ys(e,l,r="none",d="api"){const{x:c=1,y:f=1,focalPoint:y=Wa(e)}=typeof l=="number"?{x:l,y:l}:l,S=le(e),{options:{limits:E,zoom:x}}=S;Ft(e,S);const I=c!==1,F=f!==1,H=Cn(x,y,e);dt(H||e.scales,function(Z){Z.isHorizontal()&&I?on(Z,c,y,E):!Z.isHorizontal()&&F&&on(Z,f,y,E)}),e.update(r),ce(x.onZoom,[{chart:e,trigger:d}])}function Mn(e,l,r,d="none",c="api"){const f=le(e),{options:{limits:y,zoom:S}}=f,{mode:E="xy"}=S;Ft(e,f);const x=ct(E,"x",e),I=ct(E,"y",e);dt(e.scales,function(F){F.isHorizontal()&&x?ln(F,l.x,r.x,y):!F.isHorizontal()&&I&&ln(F,l.y,r.y,y)}),e.update(d),ce(S.onZoom,[{chart:e,trigger:c}])}function Za(e,l,r,d="none",c="api"){const f=le(e);Ft(e,f);const y=e.scales[l];kt(y,r,void 0,!0),e.update(d),ce(f.options.zoom?.onZoom,[{chart:e,trigger:c}])}function Xa(e,l="default"){const r=le(e),d=Ft(e,r);dt(e.scales,function(c){const f=c.options;d[c.id]?(f.min=d[c.id].min.options,f.max=d[c.id].max.options):(delete f.min,delete f.max),delete r.updatedScaleLimits[c.id]}),e.update(l),ce(r.options.zoom.onZoomComplete,[{chart:e}])}function qa(e,l){const r=e.originalScaleLimits[l];if(!r)return;const{min:d,max:c}=r;return Ts(c.options,c.scale)-Ts(d.options,d.scale)}function ja(e){const l=le(e);let r=1,d=1;return dt(e.scales,function(c){const f=qa(l,c.id);if(f){const y=Math.round(f/(c.max-c.min)*100)/100;r=Math.min(r,y),d=Math.max(d,y)}}),r<1?r:d}function rn(e,l,r,d){const{panDelta:c}=d,f=c[e.id]||0;Js(f)===Js(l)&&(l+=f);const y=Us[e.type]||Us.default;ce(y,[e,l,r])?c[e.id]=0:c[e.id]=l}function Rn(e,l,r,d="none"){const{x:c=0,y:f=0}=typeof l=="number"?{x:l,y:l}:l,y=le(e),{options:{pan:S,limits:E}}=y,{onPan:x}=S||{};Ft(e,y);const I=c!==0,F=f!==0;dt(r||e.scales,function(H){H.isHorizontal()&&I?rn(H,c,E,y):!H.isHorizontal()&&F&&rn(H,f,E,y)}),e.update(d),ce(x,[{chart:e}])}function In(e){const l=le(e);Ft(e,l);const r={};for(const d of Object.keys(e.scales)){const{min:c,max:f}=l.originalScaleLimits[d]||{min:{},max:{}};r[d]={min:c.scale,max:f.scale}}return r}function Ka(e){const l=le(e),r={};for(const d of Object.keys(e.scales))r[d]=l.updatedScaleLimits[d];return r}function Ja(e){const l=In(e);for(const r of Object.keys(e.scales)){const{min:d,max:c}=l[r];if(d!==void 0&&e.scales[r].min!==d||c!==void 0&&e.scales[r].max!==c)return!0}return!1}function un(e){const l=le(e);return l.panning||l.dragging}const cn=(e,l,r)=>Math.min(r,Math.max(l,e));function De(e,l){const{handlers:r}=le(e),d=r[l];d&&d.target&&(d.target.removeEventListener(l,d),delete r[l])}function ns(e,l,r,d){const{handlers:c,options:f}=le(e),y=c[r];if(y&&y.target===l)return;De(e,r),c[r]=E=>d(e,E,f),c[r].target=l;const S=r==="wheel"?!1:void 0;l.addEventListener(r,c[r],{passive:S})}function ei(e,l){const r=le(e);r.dragStart&&(r.dragging=!0,r.dragEnd=l,e.update("none"))}function ti(e,l){const r=le(e);!r.dragStart||l.key!=="Escape"||(De(e,"keydown"),r.dragging=!1,r.dragStart=r.dragEnd=null,e.update("none"))}function Gs(e,l){if(e.target!==l.canvas){const r=l.canvas.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top}}return Hs(e,l)}function Ln(e,l,r){const{onZoomStart:d,onZoomRejected:c}=r;if(d){const f=Gs(l,e);if(ce(d,[{chart:e,event:l,point:f}])===!1)return ce(c,[{chart:e,event:l}]),!1}}function si(e,l){if(e.legend){const f=Hs(l,e);if(Hn(f,e.legend))return}const r=le(e),{pan:d,zoom:c={}}=r.options;if(l.button!==0||Sn(as(d),l)||Vs(as(c.drag),l))return ce(c.onZoomRejected,[{chart:e,event:l}]);Ln(e,l,c)!==!1&&(r.dragStart=l,ns(e,e.canvas.ownerDocument,"mousemove",ei),ns(e,window.document,"keydown",ti))}function ni({begin:e,end:l},r){let d=l.x-e.x,c=l.y-e.y;const f=Math.abs(d/c);f>r?d=Math.sign(d)*Math.abs(c*r):f<r&&(c=Math.sign(c)*Math.abs(d/r)),l.x=e.x+d,l.y=e.y+c}function dn(e,l,r,{min:d,max:c,prop:f}){e[d]=cn(Math.min(r.begin[f],r.end[f]),l[d],l[c]),e[c]=cn(Math.max(r.begin[f],r.end[f]),l[d],l[c])}function ai(e,l,r){const d={begin:Gs(l.dragStart,e),end:Gs(l.dragEnd,e)};if(r){const c=e.chartArea.width/e.chartArea.height;ni(d,c)}return d}function Pn(e,l,r,d){const c=ct(l,"x",e),f=ct(l,"y",e),{top:y,left:S,right:E,bottom:x,width:I,height:F}=e.chartArea,H={top:y,left:S,right:E,bottom:x},Z=ai(e,r,d&&c&&f);c&&dn(H,e.chartArea,Z,{min:"left",max:"right",prop:"x"}),f&&dn(H,e.chartArea,Z,{min:"top",max:"bottom",prop:"y"});const Ue=H.right-H.left,ge=H.bottom-H.top;return{...H,width:Ue,height:ge,zoomX:c&&Ue?1+(I-Ue)/I:1,zoomY:f&&ge?1+(F-ge)/F:1}}function ii(e,l){const r=le(e);if(!r.dragStart)return;De(e,"mousemove");const{mode:d,onZoomComplete:c,drag:{threshold:f=0,maintainAspectRatio:y}}=r.options.zoom,S=Pn(e,d,{dragStart:r.dragStart,dragEnd:l},y),E=ct(d,"x",e)?S.width:0,x=ct(d,"y",e)?S.height:0,I=Math.sqrt(E*E+x*x);if(r.dragStart=r.dragEnd=null,I<=f){r.dragging=!1,e.update("none");return}Mn(e,{x:S.left,y:S.top},{x:S.right,y:S.bottom},"zoom","drag"),r.dragging=!1,r.filterNextClick=!0,ce(c,[{chart:e}])}function oi(e,l,r){if(Vs(as(r.wheel),l)){ce(r.onZoomRejected,[{chart:e,event:l}]);return}if(Ln(e,l,r)!==!1&&(l.cancelable&&l.preventDefault(),l.deltaY!==void 0))return!0}function li(e,l){const{handlers:{onZoomComplete:r},options:{zoom:d}}=le(e);if(!oi(e,l,d))return;const c=l.target.getBoundingClientRect(),f=d.wheel.speed,y=l.deltaY>=0?2-1/(1-f):1+f,S={x:y,y,focalPoint:{x:l.clientX-c.left,y:l.clientY-c.top}};Ys(e,S,"zoom","wheel"),ce(r,[{chart:e}])}function ri(e,l,r,d){r&&(le(e).handlers[l]=La(()=>ce(r,[{chart:e}]),d))}function ui(e,l){const r=e.canvas,{wheel:d,drag:c,onZoomComplete:f}=l.zoom;d.enabled?(ns(e,r,"wheel",li),ri(e,"onZoomComplete",f,250)):De(e,"wheel"),c.enabled?(ns(e,r,"mousedown",si),ns(e,r.ownerDocument,"mouseup",ii)):(De(e,"mousedown"),De(e,"mousemove"),De(e,"mouseup"),De(e,"keydown"))}function ci(e){De(e,"mousedown"),De(e,"mousemove"),De(e,"mouseup"),De(e,"wheel"),De(e,"click"),De(e,"keydown")}function di(e,l){return function(r,d){const{pan:c,zoom:f={}}=l.options;if(!c||!c.enabled)return!1;const y=d&&d.srcEvent;return y&&!l.panning&&d.pointerType==="mouse"&&(Vs(as(c),y)||Sn(as(f.drag),y))?(ce(c.onPanRejected,[{chart:e,event:d}]),!1):!0}}function pi(e,l){const r=Math.abs(e.clientX-l.clientX),d=Math.abs(e.clientY-l.clientY),c=r/d;let f,y;return c>.3&&c<1.7?f=y=!0:r>d?f=!0:y=!0,{x:f,y}}function On(e,l,r){if(l.scale){const{center:d,pointers:c}=r,f=1/l.scale*r.scale,y=r.target.getBoundingClientRect(),S=pi(c[0],c[1]),E=l.options.zoom.mode,x={x:S.x&&ct(E,"x",e)?f:1,y:S.y&&ct(E,"y",e)?f:1,focalPoint:{x:d.x-y.left,y:d.y-y.top}};Ys(e,x,"zoom","pinch"),l.scale=r.scale}}function vi(e,l,r){if(l.options.zoom.pinch.enabled){const d=Hs(r,e);ce(l.options.zoom.onZoomStart,[{chart:e,event:r,point:d}])===!1?(l.scale=null,ce(l.options.zoom.onZoomRejected,[{chart:e,event:r}])):l.scale=1}}function fi(e,l,r){l.scale&&(On(e,l,r),l.scale=null,ce(l.options.zoom.onZoomComplete,[{chart:e}]))}function Dn(e,l,r){const d=l.delta;d&&(l.panning=!0,Rn(e,{x:r.deltaX-d.x,y:r.deltaY-d.y},l.panScales),l.delta={x:r.deltaX,y:r.deltaY})}function mi(e,l,r){const{enabled:d,onPanStart:c,onPanRejected:f}=l.options.pan;if(!d)return;const y=r.target.getBoundingClientRect(),S={x:r.center.x-y.left,y:r.center.y-y.top};if(ce(c,[{chart:e,event:r,point:S}])===!1)return ce(f,[{chart:e,event:r}]);l.panScales=Cn(l.options.pan,S,e),l.delta={x:0,y:0},Dn(e,l,r)}function hi(e,l){l.delta=null,l.panning&&(l.panning=!1,l.filterNextClick=!0,ce(l.options.pan.onPanComplete,[{chart:e}]))}const Qs=new WeakMap;function pn(e,l){const r=le(e),d=e.canvas,{pan:c,zoom:f}=l,y=new ss.Manager(d);f&&f.pinch.enabled&&(y.add(new ss.Pinch),y.on("pinchstart",S=>vi(e,r,S)),y.on("pinch",S=>On(e,r,S)),y.on("pinchend",S=>fi(e,r,S))),c&&c.enabled&&(y.add(new ss.Pan({threshold:c.threshold,enable:di(e,r)})),y.on("panstart",S=>mi(e,r,S)),y.on("panmove",S=>Dn(e,r,S)),y.on("panend",()=>hi(e,r))),Qs.set(e,y)}function vn(e){const l=Qs.get(e);l&&(l.remove("pinchstart"),l.remove("pinch"),l.remove("pinchend"),l.remove("panstart"),l.remove("pan"),l.remove("panend"),l.destroy(),Qs.delete(e))}function gi(e,l){const{pan:r,zoom:d}=e,{pan:c,zoom:f}=l;return d?.zoom?.pinch?.enabled!==f?.zoom?.pinch?.enabled||r?.enabled!==c?.enabled||r?.threshold!==c?.threshold}var _i="2.2.0";function ys(e,l,r){const d=r.zoom.drag,{dragStart:c,dragEnd:f}=le(e);if(d.drawTime!==l||!f)return;const{left:y,top:S,width:E,height:x}=Pn(e,r.zoom.mode,{dragStart:c,dragEnd:f},d.maintainAspectRatio),I=e.ctx;I.save(),I.beginPath(),I.fillStyle=d.backgroundColor||"rgba(225,225,225,0.3)",I.fillRect(y,S,E,x),d.borderWidth>0&&(I.lineWidth=d.borderWidth,I.strokeStyle=d.borderColor||"rgba(225,225,225)",I.strokeRect(y,S,E,x)),I.restore()}var bi={id:"zoom",version:_i,defaults:{pan:{enabled:!1,mode:"xy",threshold:10,modifierKey:null},zoom:{wheel:{enabled:!1,speed:.1,modifierKey:null},drag:{enabled:!1,drawTime:"beforeDatasetsDraw",modifierKey:null},pinch:{enabled:!1},mode:"xy"}},start:function(e,l,r){const d=le(e);d.options=r,Object.prototype.hasOwnProperty.call(r.zoom,"enabled")&&console.warn("The option `zoom.enabled` is no longer supported. Please use `zoom.wheel.enabled`, `zoom.drag.enabled`, or `zoom.pinch.enabled`."),(Object.prototype.hasOwnProperty.call(r.zoom,"overScaleMode")||Object.prototype.hasOwnProperty.call(r.pan,"overScaleMode"))&&console.warn("The option `overScaleMode` is deprecated. Please use `scaleMode` instead (and update `mode` as desired)."),ss&&pn(e,r),e.pan=(c,f,y)=>Rn(e,c,f,y),e.zoom=(c,f)=>Ys(e,c,f),e.zoomRect=(c,f,y)=>Mn(e,c,f,y),e.zoomScale=(c,f,y)=>Za(e,c,f,y),e.resetZoom=c=>Xa(e,c),e.getZoomLevel=()=>ja(e),e.getInitialScaleBounds=()=>In(e),e.getZoomedScaleBounds=()=>Ka(e),e.isZoomedOrPanned=()=>Ja(e),e.isZoomingOrPanning=()=>un(e)},beforeEvent(e,{event:l}){if(un(e))return!1;if(l.type==="click"||l.type==="mouseup"){const r=le(e);if(r.filterNextClick)return r.filterNextClick=!1,!1}},beforeUpdate:function(e,l,r){const d=le(e),c=d.options;d.options=r,gi(c,r)&&(vn(e),pn(e,r)),ui(e,r)},beforeDatasetsDraw(e,l,r){ys(e,"beforeDatasetsDraw",r)},afterDatasetsDraw(e,l,r){ys(e,"afterDatasetsDraw",r)},beforeDraw(e,l,r){ys(e,"beforeDraw",r)},afterDraw(e,l,r){ys(e,"afterDraw",r)},stop:function(e){ci(e),ss&&vn(e),Oa(e)},panFunctions:Us,zoomFunctions:zs,zoomRectFunctions:Fs};const yi={class:"session-detail-wrapper"},Ti={key:0,class:"share-notification"},Si={class:"nav-bar"},Ci={key:0,class:"loading-state"},ki={key:1,class:"error-state"},Ei={class:"error-text"},Ai={class:"session-header"},xi={class:"header-row"},Mi={class:"track-name"},Ri={class:"header-meta"},Ii={class:"car"},Li={class:"master-detail"},Pi={class:"master"},Oi={class:"builder-panel"},Di={class:"builder-panel-header"},Ni={class:"builder-slot builder-slot--a"},wi={class:"builder-slot-content"},Bi={key:0,class:"builder-slot-empty"},$i={class:"builder-chip builder-chip--a1"},zi=["title"],Fi={key:0,class:"builder-chip builder-chip--a2"},Ui={class:"builder-slot builder-slot--b"},Gi={class:"builder-slot-content"},Qi={key:0,class:"builder-slot-empty"},Hi={class:"builder-chip builder-chip--b1"},Vi=["title"],Yi={key:0,class:"builder-chip builder-chip--b2"},Wi={class:"cross-session-section"},Zi={class:"cross-session-header cross-session-header--a"},Xi={class:"cross-session-label"},qi={class:"cross-session-date"},ji={class:"stint-list stint-list--builder"},Ki=["onClick"],Ji=["disabled","title","onClick"],eo=["disabled","title","onClick"],to={class:"stint-icon-slot"},so={class:"stint-number"},no={class:"stint-laps"},ao={class:"cross-session-section"},io={class:"cross-session-header cross-session-header--b"},oo={class:"cross-session-label"},lo={class:"stint-list stint-list--builder"},ro=["onClick"],uo=["disabled","title","onClick"],co=["disabled","title","onClick"],po={class:"stint-icon-slot"},vo={class:"stint-number"},fo={class:"stint-laps"},mo={class:"stint-list stint-list--builder"},ho=["onClick"],go=["disabled","title","onClick"],_o=["disabled","title","onClick"],bo={class:"stint-icon-slot"},yo={class:"stint-number"},To={class:"stint-laps"},So={class:"detail"},Co={key:0,class:"empty-state-panel"},ko={key:1,class:"limited-data"},Eo={key:2,class:"compare-layout compare-style--A"},Ao={class:"compare-conditions"},xo={class:"compare-condition-card compare-condition-card--a"},Mo={class:"cond-stint-label"},Ro={class:"cond-details"},Io={class:"cond-item"},Lo={class:"cond-item"},Po={class:"compare-condition-card compare-condition-card--b"},Oo={class:"cond-stint-label"},Do={class:"cond-details"},No={class:"cond-item"},wo={class:"cond-item"},Bo={class:"compare-table-wrap"},$o={class:"ssc-table"},zo={key:0,class:"ssc-stint-separator"},Fo={class:"ssc-table-row"},Uo={class:"ssc-td ssc-td--value"},Go={class:"ssc-td ssc-td--value"},Qo={class:"ssc-td"},Ho={key:1,class:"ssc-delta ssc-delta--empty"},Vo={class:"ssc-table-row"},Yo={class:"ssc-td"},Wo={key:1,class:"ssc-delta ssc-delta--empty"},Zo={class:"ssc-table-row ssc-table-row--compact"},Xo={class:"ssc-td ssc-td--compact"},qo={class:"ssc-td ssc-td--compact"},jo={class:"ssc-table-row ssc-table-row--total"},Ko={class:"ssc-td ssc-td--value ssc-td--duration"},Jo={class:"ssc-td ssc-td--value ssc-td--duration"},el={class:"ssc-header"},tl={class:"ssc-header-left"},sl={class:"ssc-stint-label"},nl={class:"ssc-condition-text"},al={class:"ssc-cond-val"},il={class:"ssc-condition-text"},ol={class:"ssc-cond-val"},ll={class:"ssc-header-right"},rl={class:"ssc-duration-label"},ul={class:"ssc-table"},cl={class:"ssc-table-row"},dl={class:"ssc-td ssc-td--value"},pl={class:"ssc-td ssc-td--value ssc-td--theo"},vl={class:"ssc-td"},fl={class:"ssc-table-row"},ml={class:"ssc-td ssc-td--value"},hl={class:"ssc-td ssc-td--value ssc-td--theo"},gl={class:"ssc-td"},_l={key:1,class:"ssc-delta ssc-delta--na"},bl={key:0,class:"ssc-target-section"},yl={class:"ssc-target-row-bottom"},Tl={class:"ssc-target-value"},Sl={class:"ssc-progress-section"},Cl={key:0,class:"ssc-progress-row"},kl={class:"ssc-progress-label"},El={class:"ssc-progress-count"},Al={class:"ssc-progress-bar"},xl={key:1,class:"ssc-progress-row"},Ml={class:"ssc-progress-label"},Rl={class:"ssc-progress-count"},Il={class:"ssc-progress-bar"},Ll={class:"chart-section"},Pl={class:"chart-header-row"},Ol={class:"chart-title"},Dl={class:"chart-toolbar"},Nl={key:0,class:"lap-manager"},wl={class:"lap-manager-section"},Bl={class:"lap-manager-header"},$l={class:"lap-manager-title"},zl=["disabled"],Fl={class:"lap-manager-stint-header"},Ul={class:"lap-manager-grid"},Gl=["onClick","title"],Ql={key:1,class:"lap-manager-grid"},Hl=["onClick","title"],Vl={key:2,class:"lap-manager-info"},Yl={key:0,class:"lap-manager-section lap-manager-section--b"},Wl={class:"lap-manager-header"},Zl={class:"lap-manager-title"},Xl=["disabled"],ql={class:"lap-manager-stint-header lap-manager-stint-header--b"},jl={class:"lap-manager-grid"},Kl=["onClick","title"],Jl={key:1,class:"lap-manager-grid"},er=["onClick","title"],tr={key:2,class:"lap-manager-info"},sr={key:1,class:"lap-manager-section lap-manager-section--b"},nr={class:"lap-manager-header"},ar={class:"lap-manager-title"},ir=["disabled"],or={class:"lap-manager-grid"},lr=["onClick","title"],rr={key:0,class:"lap-manager-info"},ur={class:"chart-wrap"},cr={key:1,class:"grip-legend"},dr={class:"grip-legend-label"},pr={class:"grip-legend-laps"},vr={class:"laps-section"},fr={class:"laps-header-row"},mr={key:0,class:"laps-tabs"},hr=["onClick"],gr=["onClick"],_r={key:1,class:"laps-title"},br={key:0,class:"laps-table-wrap"},yr={class:"laps-table laps-table--compare"},Tr={key:0,class:"stint-header-row"},Sr={colspan:"4",class:"stint-header-cell stint-header-cell--a"},Cr={key:0,class:"stint-header-label"},kr={colspan:"4",class:"stint-header-cell stint-header-cell--b"},Er={key:0,class:"stint-header-label"},Ar={class:"col-index"},xr={class:"col-a time"},Mr={class:"col-a sector"},Rr={class:"col-a sector"},Ir={class:"col-a sector"},Lr={class:"col-b time"},Pr={class:"col-b sector"},Or={class:"col-b sector"},Dr={class:"col-b sector"},Nr={key:1,class:"laps-table-wrap"},wr={class:"laps-table"},Br={class:"time"},$r={class:"sector"},zr={class:"sector"},Fr={class:"sector"},Ur={class:"stato"},Gr={key:0,class:"badge badge--pit"},Qr={key:1,class:"badge badge--invalid"},Hr={key:2,class:"badge badge--valid"},ws=.6,Vr=fn({__name:"SessionDetailPage",props:{sessionId:{},externalUserId:{}},emits:["back","go-to-track"],setup(e,{emit:l}){Vn.register(Yn,Wn,Zn,Xn,qn,jn,Kn,Jn,bi);const{currentUser:r,getUserProfile:d}=mn(),c=$(""),f=e,y=l;k(()=>!!f.externalUserId),$(!1);const S=$(new Set),E=$(new Set),x=$(new Set),I=$(!1),F=$(null);$(1);const H=$("gold");$("A");function Z(i){const s=new Set(S.value);s.has(i)?s.delete(i):s.add(i),S.value=s}function Ue(i){const s=new Set(E.value);s.has(i)?s.delete(i):s.add(i),E.value=s}function ge(i){const s=new Set(x.value);s.has(i)?s.delete(i):s.add(i),x.value=s}function pt(){S.value=new Set}function ae(){E.value=new Set}function M(){x.value=new Set}function X(){F.value?.chart&&F.value.chart.resetZoom()}function Ve(){F.value?.chart&&F.value.chart.zoom(1.2)}function vt(){F.value?.chart&&F.value.chart.zoom(.8)}const{fetchSessionFull:Ye,loadSessions:Et,getTheoreticalTimes:is,generateShareLink:Ke}=Bs(),Je=$(null),We=$(!0),Ze=$(null),At=$(!1),et=$(!1);async function Ss(){if(!(!f.sessionId||At.value)){At.value=!0,et.value=!1;try{const i=await Ke(f.sessionId);await navigator.clipboard.writeText(i),et.value=!0,console.log("[SHARE] Link copied:",i),setTimeout(()=>{et.value=!1},2e3)}catch(i){console.error("[SHARE] Error sharing session:",i)}finally{At.value=!1}}}const os=ta();Un(async()=>{We.value=!0,Ze.value=null;try{if(r.value?.uid){const p=await d(r.value.uid);c.value=p?.nickname||r.value.displayName||"Tu"}const i=f.externalUserId||os.value||void 0;f.externalUserId||await Et(i);const s=await Ye(f.sessionId,i);s?(Je.value=s,console.log("[SESSION_DETAIL] Loaded session:",s.session_info.track,s.stints.length,"stints",f.externalUserId?"(SHARED)":"")):Ze.value="Sessione non trovata"}catch(i){console.error("[SESSION_DETAIL] Load error:",i),Ze.value=i.code==="permission-denied"?"Sessione non condivisa o accesso negato":i.message||"Errore caricamento"}finally{We.value=!1}});const ls=$(!1),Ut=$([]),Ae=$("COMPARE"),fe=k(()=>ls.value&&Ut.value.length===2),Xe=k(()=>Ut.value[0]??Le.value),Re=k(()=>Ut.value[1]??null),xt=$(!1),ft=$(null),pe=$(null),mt=k(()=>ft.value!==null),me=$(null),Ge=$(null),re=k(()=>me.value!==null);function Ce(){xt.value=!0}async function Mt(i,s,p){ft.value=i,me.value=s||null,Ge.value=p||null,xt.value=!1;const{fetchSessionFull:m}=Bs(),o=await m(i,s);o&&(pe.value=o,console.log("[CROSS-SESSION] Loaded session B:",i,s?`(external: ${p})`:"(own)",o.session_info.track))}function ht(){ft.value=null,pe.value=null,me.value=null,Ge.value=null,D.value=null,R.value=null,z.value=null,w.value=null}const D=$(null),R=$(null),gt=k(()=>pe.value?(pe.value.stints||[]).map(s=>({number:s.stint_number,type:s.type==="Qualify"?"Q":s.type==="Race"?"R":"P",laps:s.laps?.length||0,best:s.laps?.reduce((p,m)=>!m.is_valid||m.has_pit_stop?p:p===null?m.lap_time_ms:Math.min(p,m.lap_time_ms),null),avgCleanLap:s.avg_clean_lap})):[]),G=k(()=>mt.value&&D.value!==null&&R.value!==null),z=$(null),w=$(null),_t=k(()=>z.value!==null||w.value!==null);k(()=>{if(!D.value||z.value!==null)return!1;const i=D.value+1;return L.value.stints.some(s=>s.number===i)}),k(()=>{if(!R.value||!pe.value||w.value!==null)return!1;const i=R.value+1;return(pe.value.stints||[]).some(p=>p.stint_number===i)});function Rt(){z.value=null}function Ie(){w.value=null}$(null),$(null);const rs=k(()=>D.value!==null||R.value!==null),Gt=k(()=>D.value!==null&&R.value!==null),j=k(()=>Gt.value&&!mt.value),It=k(()=>rs.value&&!Gt.value&&!mt.value),Cs=k(()=>{if(!It.value)return null;const i=D.value??R.value;return i&&L.value.stints.find(s=>s.number===i)||null}),Qt=k(()=>D.value??R.value??null),us=k(()=>{const i=Qt.value;return i?L.value.lapsData[i]||[]:[]});k(()=>D.value&&L.value.stints.find(i=>i.number===D.value)||null),k(()=>R.value&&L.value.stints.find(i=>i.number===R.value)||null),k(()=>D.value?L.value.lapsData[D.value]||[]:[]),k(()=>R.value?L.value.lapsData[R.value]||[]:[]);const ee=k(()=>{const i=[];if(D.value){const s=L.value.stints.find(p=>p.number===D.value);s&&i.push(s)}if(z.value){const s=L.value.stints.find(p=>p.number===z.value);s&&i.push(s)}return i}),te=k(()=>{const i=[],s=mt.value&&pe.value?(pe.value.stints||[]).map(p=>({number:p.stint_number,type:p.type==="Qualify"?"Q":p.type==="Race"?"R":"P",laps:p.laps?.length||0,best:Q(p.laps?.reduce((m,o)=>!o.is_valid||o.has_pit_stop?m:m===null?o.lap_time_ms:Math.min(m,o.lap_time_ms),null)),bestMs:p.laps?.reduce((m,o)=>!o.is_valid||o.has_pit_stop?m:m===null?o.lap_time_ms:Math.min(m,o.lap_time_ms),null),avg:Q(p.avg_clean_lap),avgMs:p.avg_clean_lap,avgWarning:(p.laps?.filter(m=>m.is_valid&&!m.has_pit_stop).length||0)<5,validLapsCount:p.laps?.filter(m=>m.is_valid&&!m.has_pit_stop).length||0,durationMs:p.laps?.reduce((m,o)=>m+(o.lap_time_ms||0),0)||0})):L.value.stints;if(R.value){const p=s.find(m=>m.number===R.value);p&&i.push(p)}if(w.value){const p=s.find(m=>m.number===w.value);p&&i.push(p)}return i}),nt=k(()=>Math.max(ee.value.length,te.value.length)),Ht=k(()=>ee.value.reduce((i,s)=>i+(s.durationMs||0),0)),ks=k(()=>te.value.reduce((i,s)=>i+(s.durationMs||0),0)),cs=k(()=>{const i=[];return ee.value.forEach((s,p)=>{(L.value.lapsData[s.number]||[]).forEach((o,h)=>{i.push({...o,_stintIndex:p,_stintNumber:s.number,_isStintStart:h===0,_globalIndex:i.length+1})})}),i}),Vt=k(()=>{const i=[];return te.value.forEach((s,p)=>{(L.value.lapsData[s.number]||[]).forEach((o,h)=>{i.push({...o,_stintIndex:p,_stintNumber:s.number,_isStintStart:h===0,_globalIndex:i.length+1})})}),i});function Lt(i){if(!i)return"â€”";const s=i,p=Math.floor(s/6e4),m=Math.floor(s%6e4/1e3),o=s%1e3;return`${p}m ${String(m).padStart(2,"0")}.${String(o).padStart(3,"0")}s`}function ds(){D.value=null,z.value=null,R.value=null,w.value=null}function bt(i){return R.value===i||w.value===i?!1:D.value?D.value===i||z.value===i||z.value?!1:i===D.value+1:!0}function ps(i){return D.value===i||z.value===i?!1:R.value?R.value===i||w.value===i||w.value?!1:i===R.value+1:!0}function vs(i){return R.value===i||w.value===i?"GiÃ  in Strategia B":D.value?D.value===i||z.value===i?"GiÃ  in Strategia A":!z.value&&i===D.value+1?"Aggiungi come secondo stint":z.value?"Massimo 2 stint per strategia":"Solo stint consecutivo ammesso":"Aggiungi a Strategia A"}function Yt(i){return D.value===i||z.value===i?"GiÃ  in Strategia A":R.value?R.value===i||w.value===i?"GiÃ  in Strategia B":!w.value&&i===R.value+1?"Aggiungi come secondo stint":w.value?"Massimo 2 stint per strategia":"Solo stint consecutivo ammesso":"Aggiungi a Strategia B"}function Pt(i){if(!D.value){D.value=i;return}!z.value&&i===D.value+1&&(z.value=i)}function Ot(i){if(!R.value){R.value=i;return}!w.value&&i===R.value+1&&(w.value=i)}function Es(i){return!D.value}function As(i){return"Usa +B per stint da altra sessione"}function xs(i){return R.value?R.value===i||w.value===i||w.value?!1:i===R.value+1:!0}function fs(i){return R.value?R.value===i||w.value===i?"GiÃ  in Strategia B":!w.value&&i===R.value+1?"Aggiungi come secondo stint":w.value?"Massimo 2 stint per strategia":"Solo stint consecutivo ammesso":"Aggiungi a Strategia B"}function Ms(i){if(!R.value){R.value=i;return}!w.value&&i===R.value+1&&(w.value=i)}function Rs(){D.value=null,z.value=null}function Is(){R.value=null,w.value=null}function yt(i){return D.value===i||z.value===i}function ms(i){return R.value===i||w.value===i}function Ls(i){Le.value=i}function Ps(i){}function Wt(i){Le.value=i}const L=k(()=>{if(!Je.value)return{id:f.sessionId,track:"Caricamento...",trackId:"",type:"practice",date:"-",time:"-",car:"-",startConditions:{weather:"-",airTemp:0,trackTemp:0},bestQualy:"--:--.---",bestRace:"--:--.---",theoQualy:"--:--.---",theoRace:"--:--.---",bestDeltaQ:{value:"-",stintNum:0},bestDeltaR:{value:"-",stintNum:0},stints:[],lapsData:{}};const i=Je.value,s=i.session_info,p=i.stints.map(q=>{const ne=q.laps.filter(Fe=>Fe.is_valid&&!Fe.has_pit_stop),be=ne.length,ye=be>0?Math.min(...ne.map(Fe=>Fe.lap_time_ms)):null,rt=5,ut=be>=rt&&q.avg_clean_lap?q.avg_clean_lap:null,Me=be>0&&be<rt,Jt=ut?Q(ut):Me?"min 5 giri":"â€”";return{number:q.stint_number,type:q.type==="Qualify"?"Q":"R",intent:q.type==="Qualify"?"Qualy Push":"Race Pace",fuelStart:q.fuel_start,laps:q.laps.length,validLapsCount:be,best:ye?Q(ye):"â€”",bestMs:ye,avg:Jt,avgWarning:Me,avgMs:ut,durationMs:q.stint_drive_time_ms||0,theoretical:Q(s.session_best_lap),deltaVsTheo:ye?`+${((ye-s.session_best_lap)/1e3).toFixed(3)}`:"-",conditions:{weather:s.start_weather,avgAirTemp:s.start_air_temp,avgTrackTemp:s.start_road_temp},breakdown:{base:"-",deltaTemp:"-",deltaGrip:"-"}}}),m={};i.stints.forEach(q=>{m[q.stint_number]=q.laps.map(ne=>({lap:ne.lap_number,time:Q(ne.lap_time_ms),delta:`+${((ne.lap_time_ms-s.session_best_lap)/1e3).toFixed(3)}`,valid:ne.is_valid,pit:ne.has_pit_stop,sectors:ne.sector_times_ms?.map(be=>(be/1e3).toFixed(1))||["-","-","-"],fuel:Math.round(ne.fuel_remaining),airTemp:ne.air_temp||0,weather:ne.rain_intensity||"No Rain",grip:ne.track_grip_status||"Opt"}))});let o=null,h=null,N=0,K=0;return i.stints.forEach(q=>{const ne=q.laps.filter(ye=>ye.is_valid&&!ye.has_pit_stop);if(ne.length===0)return;const be=Math.min(...ne.map(ye=>ye.lap_time_ms));q.type==="Qualify"?(!o||be<o)&&(o=be,N=q.stint_number):(!h||be<h)&&(h=be,K=q.stint_number)}),{id:f.sessionId,track:s.track,trackId:s.track.toLowerCase().replace(/[^a-z0-9]/g,"_"),type:gn(s.session_type),date:Gn(s.date_start),time:_n(s.date_start),car:hn(s.car),startConditions:{weather:s.start_weather,airTemp:s.start_air_temp,trackTemp:s.start_road_temp},bestQualy:o?Q(o):"--:--.---",bestRace:h?Q(h):"--:--.---",theoQualy:Q(s.session_best_lap),theoRace:Q(s.session_best_lap),bestDeltaQ:{value:o?`+${((o-s.session_best_lap)/1e3).toFixed(3)}`:"-",stintNum:N},bestDeltaR:{value:h?`+${((h-s.session_best_lap)/1e3).toFixed(3)}`:"-",stintNum:K},stints:p,lapsData:m}}),he=$({theoQualy:null,theoRace:null,theoAvgRace:null,dominantGrip:"Optimum",stintTemp:23,historicQualy:null,historicQualyTemp:null,historicRace:null,historicRaceTemp:null,historicAvgRace:null,historicAvgRaceTemp:null}),Le=$(1),Dt=$(!1),J=k(()=>L.value.stints.find(i=>i.number===Le.value)),ke=k(()=>L.value.lapsData[Le.value]||[]),Nt=k(()=>It.value?Cs.value:J.value),Zt=k(()=>It.value?Qt.value:Le.value),tt=k(()=>It.value?us.value:ke.value);k(()=>tt.value.length<=1),k(()=>L.value.stints.length===1),Os(ke,i=>{if(i.length>20){const s=i[0]?.lap,p=i[i.length-1]?.lap,m=[s,p].filter(Boolean);S.value=new Set(m)}else S.value=new Set},{immediate:!0});const at=k(()=>Xe.value?L.value.stints.find(i=>i.number===Xe.value):null),Tt=k(()=>Re.value?L.value.stints.find(i=>i.number===Re.value):null),Qe=k(()=>Xe.value?L.value.lapsData[Xe.value]||[]:[]),we=k(()=>Re.value?L.value.lapsData[Re.value]||[]:[]),wt=k(()=>{if(!D.value)return null;const i=L.value.stints.find(s=>s.number===D.value);return i?{...i,avgCleanLap:i.avg}:null}),hs=k(()=>{if(!R.value||!pe.value)return null;const s=(pe.value.stints||[]).find(p=>p.stint_number===R.value);return s?{number:s.stint_number,type:s.type==="Qualify"?"Q":s.type==="Race"?"R":"P",laps:s.laps?.length||0,best:Q(s.laps?.reduce((p,m)=>!m.is_valid||m.has_pit_stop?p:p===null?m.lap_time_ms:Math.min(p,m.lap_time_ms),null)),avgCleanLap:Q(s.avg_clean_lap),deltaVsTheo:"â€”"}:null}),Be=k(()=>D.value?L.value.lapsData[D.value]||[]:[]),ue=k(()=>{if(!R.value||!pe.value)return[];const s=(pe.value.stints||[]).find(p=>p.stint_number===R.value);return!s||!s.laps?[]:s.laps.map((p,m)=>({lapNumber:p.lap_number||m+1,lapTime:Q(p.lap_time_ms),lapTimeMs:p.lap_time_ms,valid:p.is_valid&&!p.has_pit_stop,pit:p.has_pit_stop,s1:Q(p.sector_times_ms?.[0]),s2:Q(p.sector_times_ms?.[1]),s3:Q(p.sector_times_ms?.[2]),fuel:p.fuel_remaining,air:p.air_temp,road:p.road_temp,grip:p.track_grip_status}))});k(()=>Ae.value==="A"?Qe.value:we.value),k(()=>Ae.value==="A"?at.value:Tt.value),k(()=>Ae.value==="A"?Be.value:ue.value),k(()=>Ae.value==="A"?wt.value:hs.value);function it(){const i=Ae.value;if(i.startsWith("A-")){const s=parseInt(i.slice(2));if(!isNaN(s))return L.value.lapsData[s]||[]}else if(i.startsWith("B-")){const s=parseInt(i.slice(2));if(!isNaN(s)){if(j.value)return L.value.lapsData[s]||[];if(G.value&&pe.value){const m=(pe.value.stints||[]).find(o=>o.stint_number===s);if(m?.laps)return m.laps.map((o,h)=>({lapNumber:o.lap_number||h+1,lapTime:Q(o.lap_time_ms),lapTimeMs:o.lap_time_ms,valid:o.is_valid&&!o.has_pit_stop,pit:o.has_pit_stop,s1:Q(o.sector_times_ms?.[0]),s2:Q(o.sector_times_ms?.[1]),s3:Q(o.sector_times_ms?.[2]),fuel:o.fuel_remaining,air:o.air_temp,road:o.road_temp,grip:o.track_grip_status}))}return L.value.lapsData[s]||[]}}return ke.value}const qe=k(()=>{let i=[],s=[];j.value?(i=cs.value||[],s=Vt.value||[]):G.value?(i=Be.value||[],s=ue.value||[]):fe.value&&(i=Qe.value||[],s=we.value||[]);const p=Math.max(i.length,s.length),m=[];for(let o=0;o<p;o++){const h=i[o]||null,N=s[o]||null;let K=null;if(h&&N){const q=Ee(h.time||h.lapTime||""),ne=Ee(N.time||N.lapTime||"");q>0&&ne>0&&(K=ne-q)}m.push({index:o+1,lapA:h,lapB:N,delta:K,deltaFormatted:K!==null?K>=0?`+${K.toFixed(3)}`:K.toFixed(3):"â€”",deltaClass:K!==null?K<0?"faster":K<=.3?"close":K<=.5?"margin":"far":"neutral",_isStintStartA:h?._isStintStart||!1,_isStintStartB:N?._isStintStart||!1,_stintNumberA:h?._stintNumber||null,_stintNumberB:N?._stintNumber||null})}return m}),$e=k(()=>{if(!z.value)return null;const i=L.value.stints.find(s=>s.number===z.value);return i?{...i,avgCleanLap:i.avg}:null}),ot=k(()=>z.value?L.value.lapsData[z.value]||[]:[]),ze=k(()=>{if(!w.value||!pe.value)return null;const s=(pe.value.stints||[]).find(p=>p.stint_number===w.value);return s?{number:s.stint_number,type:s.type==="Qualify"?"Q":s.type==="Race"?"R":"P",laps:s.laps?.length||0,best:Q(s.laps?.reduce((p,m)=>!m.is_valid||m.has_pit_stop?p:p===null?m.lap_time_ms:Math.min(p,m.lap_time_ms),null)),avgCleanLap:Q(s.avg_clean_lap),durationMs:s.laps?.reduce((p,m)=>p+(m.lap_time_ms||0),0)||0}:null}),Ne=k(()=>{if(!w.value||!pe.value)return[];const s=(pe.value.stints||[]).find(p=>p.stint_number===w.value);return!s||!s.laps?[]:s.laps.map((p,m)=>({lapNumber:p.lap_number||m+1,lapTime:Q(p.lap_time_ms),lapTimeMs:p.lap_time_ms,valid:p.is_valid&&!p.has_pit_stop,pit:p.has_pit_stop,s1:Q(p.sector_times_ms?.[0]),s2:Q(p.sector_times_ms?.[1]),s3:Q(p.sector_times_ms?.[2]),fuel:p.fuel_remaining,air:p.air_temp,grip:p.track_grip_status}))});k(()=>{let i=0;if(wt.value){const s=zt(wt.value)||lt(Be.value);i+=s}if($e.value){const s=zt($e.value)||lt(ot.value);i+=s}return i}),k(()=>{let i=0;return hs.value&&(i+=lt(ue.value)),ze.value&&(i+=lt(Ne.value)),i});const Xt=k(()=>{const i=L.value.stints.filter(p=>p.type==="Q"&&p.laps>=2);if(i.length===0)return null;let s=i[0];return i.forEach(p=>{parseFloat(p.deltaVsTheo)<parseFloat(s.deltaVsTheo)&&(s=p)}),s}),qt=k(()=>{const i=L.value.stints.filter(p=>p.type==="R"&&p.laps>=2);if(i.length===0)return null;let s=i[0];return i.forEach(p=>{parseFloat(p.deltaVsTheo)<parseFloat(s.deltaVsTheo)&&(s=p)}),s});Os([qt,Xt],([i,s])=>{Dt.value||(i?(Le.value=i.number,Dt.value=!0,console.log("[PRESELECTION] Best R stint:",i.number,"delta:",i.deltaVsTheo)):s&&(Le.value=s.number,Dt.value=!0,console.log("[PRESELECTION] Best Q stint:",s.number,"delta:",s.deltaVsTheo)))});function je(i){return i.type==="Q"?Xt.value?.number===i.number:i.type==="R"?qt.value?.number===i.number:!1}function de(i){const p=(L.value.lapsData[i.number]||[]).filter(o=>!o.pit),m=p.filter(o=>o.valid);return p.length>0&&m.length===0?{icon:"âš ï¸",message:"Tutti i giri invalidi"}:i.type==="R"&&p.length<5?{icon:"âš ï¸",message:`Stint gara troppo corto (${p.length} giri, min. 5)`}:i.type==="Q"&&p.length<=1?{icon:"âš ï¸",message:"Dati limitati (1 giro)"}:null}function st(i){if(i<=30){const s=i/30,p=239,m=Math.round(68+47*s),o=Math.round(68+-46*s);return`rgb(${p}, ${m}, ${o})`}else if(i<=70){const s=(i-30)/40,p=Math.round(249+2*s),m=Math.round(115+76*s),o=Math.round(22+14*s);return`rgb(${p}, ${m}, ${o})`}else{const s=(i-70)/30,p=Math.round(251+-235*s),m=Math.round(191+-6*s),o=Math.round(36+93*s);return`rgb(${p}, ${m}, ${o})`}}function Bt(i){const s=i.filter(m=>!m.pit&&(m.airTemp||m.air));if(s.length===0)return 0;const p=s.reduce((m,o)=>m+(o.airTemp||o.air||0),0);return Math.round(p/s.length)}function $t(i){const s=i.filter(h=>!h.pit&&h.grip&&h.grip!=="Unknown");if(s.length===0)return"Optimum";const p={};for(const h of s){let N=h.grip==="Opt"?"Optimum":h.grip;p[N]=(p[N]||0)+1}let m="Optimum",o=0;for(const[h,N]of Object.entries(p))N>o&&(o=N,m=h);return m}function zt(i){return i?.durationMs?Math.floor(i.durationMs/6e4):0}function lt(i){if(!i||i.length===0)return 0;const s=i.reduce((p,m)=>p+(m.lapTimeMs||0),0);return Math.round(s/6e4)}function Pe(i){if(!i)return"â€”";if(typeof i=="string"){const s=i,p=s.split(".");if(p.length===2&&p[1]){const m=p[1].padEnd(3,"0").slice(0,3);return`${p[0]}.${m}`}return s}return typeof i=="number"?(i>1e3?i/1e3:i).toFixed(3):"â€”"}function He(i,s){if(!i||!s)return"â€”";const m=(s-i)/1e3;return m===0?"0.000":`${m>0?"+":""}${m.toFixed(3)}`}function gs(i,s){if(!i||!s)return"far";const m=(s-i)/1e3;return m<0?"faster":m===0?"ontarget":m<=.3?"close":m<=.5?"margin":"far"}const St=k(()=>{const i=ke.value.filter(ie=>!ie.pit);if(i.length===0)return{airTemp:{start:0,mid:0,end:0,changed:!1},grip:{dominant:"Optimum",percentages:[],changed:!1,display:"Optimum"}};const s=Math.floor(i.length/2),p=i.length-1,m=Math.round(i[0]?.airTemp||0),o=Math.round(i[s]?.airTemp||m),h=Math.round(i[p]?.airTemp||m),N=Math.abs(m-h)>=2||Math.abs(m-o)>=2,K={},q=[];let ne=0;const be=ie=>ie==="Opt"?"Optimum":ie;for(const ie of i){let Oe=ie.grip||"Unknown";Oe=be(Oe),Oe!=="Unknown"&&(K[Oe]||q.push(Oe),K[Oe]=(K[Oe]||0)+1,ne++)}const ye=[];let rt="Optimum",ut=0;for(const ie of q){const Oe=K[ie]||0;if(Oe===0)continue;const A=Math.round(Oe/ne*100);ye.push({grip:ie,pct:A}),Oe>ut&&(ut=Oe,rt=ie)}const Me=ye.length>1;let Jt=rt;Me&&(Jt=ye.map(ie=>`${ie.grip} (${ie.pct}%)`).join(" â†’ "));const Fe=N?Math.round((m+o+h)/3):m;return{airTemp:{start:m,mid:o,end:h,changed:N,avg:Fe},grip:{dominant:rt,percentages:ye,changed:Me,display:Jt}}});Os([()=>Je.value,()=>St.value],async([i,s])=>{if(!i)return;const p=i.session_info,m=(p.track||"").toLowerCase().replace(/[^a-z0-9]/g,"_"),o=s.grip.dominant||"Optimum",h=s.airTemp.avg||Math.round(p.start_air_temp||23),N=await is(m,o,h,os.value||void 0);he.value={theoQualy:N.theoQualy,theoRace:N.theoRace,theoAvgRace:N.theoAvgRace,dominantGrip:o,stintTemp:h,historicQualy:N.historicQualy,historicQualyTemp:N.historicQualyTemp,historicRace:N.historicRace,historicRaceTemp:N.historicRaceTemp,historicAvgRace:N.historicAvgRace,historicAvgRaceTemp:N.historicAvgRaceTemp}},{immediate:!0});const jt=k(()=>{let i=[];if(j.value)i=cs.value.map((A,B)=>({...A,lap:B+1}));else if(G.value){if(i=Be.value,_t.value&&z.value){const A=ot.value,B=i.length,oe=A.map((U,Te)=>({...U,lap:B+Te+1,_originalLap:U.lap,_isSecondStint:!0}));i=[...i,...oe]}}else fe.value?i=Qe.value:i=ke.value;const s=i.filter(A=>!S.value.has(A.lap)),p=G.value?wt.value:fe.value?at.value:J.value,m=p?.type==="Q",o=m?he.value.theoQualy:he.value.theoRace,h=o?o/1e3:0,N=h>0?h+ws:0,K=p?.best;Ee(K);const q=A=>A.pit?!1:Ee(A.time)<=N,ne=A=>A.pit||!A.valid?!1:q(A),be=A=>A.pit||!A.valid?!1:A.time===K,ye=s.map(A=>A.pit?"#6b7280":A.valid?se.value&&be(A)?"#a855f7":se.value&&ne(A)?"#10b981":"#3b82f6":"#ef4444"),rt=s.map(A=>A.pit?"#6b7280":A.valid?se.value&&be(A)?"#a855f7":se.value&&ne(A)?"#10b981":"#3b82f6":se.value&&q(A)?"#10b981":"#ef4444"),ut=s.map(A=>!A.valid&&!A.pit&&se.value&&q(A)?2:1),Me=[{label:j.value?`Strategia A (${ee.value.map(A=>`#${A.number}`).join("+")})`:fe.value?`A: Stint #${Xe.value}`:"Tempo",data:s.map(A=>Ee(A.time)),borderColor:"#3b82f6",backgroundColor:"rgba(59,130,246,0.1)",pointBackgroundColor:ye,pointBorderColor:rt,pointBorderWidth:ut,pointRadius:5,tension:0,order:1,segment:j.value?{borderColor:A=>s[A.p1DataIndex]?._stintIndex>0?"#60a5fa":"#3b82f6"}:void 0},{label:`Teorico ${p?.type==="Q"?"Q":"R"}`,data:s.map(()=>h),borderColor:"#f59e0b",borderDash:[5,5],pointRadius:0,order:3}];if(!m&&se.value&&s.length>0&&Me.push({label:`Target (+${ws}s)`,data:s.map(()=>N),borderColor:"rgba(16, 185, 129, 0.6)",borderWidth:2,borderDash:[3,3],backgroundColor:"rgba(16, 185, 129, 0.05)",fill:"origin",pointRadius:0,order:4}),_e.value&&Ws.value&&s.length>0){const A=Math.max(...s.map(B=>Ee(B.time)))+5;Zs.value.forEach((B,oe)=>{const U=xe[B.gripLevel]||xe.Opt,Te=s.map((Xs,Nn)=>{const qs=Nn+1;return qs>=B.startLap&&qs<=B.endLap?A:null});Me.push({label:`_grip_${oe}`,data:Te,borderColor:"transparent",backgroundColor:U?.bg,fill:"origin",pointRadius:0,order:10+oe,spanGaps:!1})})}let Fe=[];if(j.value&&Vt.value.length>0){Fe=Vt.value.map((U,Te)=>({...U,lap:Te+1})).filter(U=>!E.value.has(U.lap));const B=te.value.map(U=>`#${U.number}`).join("+"),oe=Fe.map(U=>U.pit?"#6b7280":U.valid?U._stintIndex>0?"#a78bfa":"#8b5cf6":"#ef4444");Me.splice(1,0,{label:`Strategia B (${B})`,data:Fe.map(U=>Ee(U.time)),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,0.1)",pointBackgroundColor:oe,pointRadius:5,tension:0,segment:{borderColor:U=>Fe[U.p1DataIndex]?._stintIndex>0?"#a78bfa":"#8b5cf6"}})}if(fe.value&&we.value.length>0){const B=we.value.filter(oe=>!E.value.has(oe.lap));Me.splice(1,0,{label:`B: Stint #${Re.value}`,data:B.map(oe=>Ee(oe.time)),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,0.1)",pointBackgroundColor:B.map(oe=>oe.pit?"#6b7280":oe.valid?"#8b5cf6":"#ef4444"),pointRadius:5,tension:0})}if(G.value&&ue.value.length>0){let A=ue.value.map((B,oe)=>({...B,_chartIdx:oe+1}));if(_t.value&&w.value){const B=Ne.value,oe=A.length,U=B.map((Te,Xs)=>({...Te,_chartIdx:oe+Xs+1,_isSecondStint:!0}));A=[...A,...U]}Me.splice(1,0,{label:_t.value?`Strategia B (${w.value?"Stint #"+R.value+"+#"+w.value:"Stint #"+R.value})`:`Strategia B Â· Stint #${R.value}`,data:A.map(B=>x.value.has(B.lapNumber)?null:Ee(B.lapTime)),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,0.1)",pointBackgroundColor:A.map(B=>x.value.has(B.lapNumber)?"transparent":B.pit?"#6b7280":B.valid?"#8b5cf6":"#ef4444"),pointRadius:A.map(B=>x.value.has(B.lapNumber)?0:5),tension:0,spanGaps:!1})}let ie=s.length;if(j.value)ie=Math.max(s.length,Fe.length);else if(G.value){let A=ue.value.length;_t.value&&w.value&&(A+=Ne.value.length),ie=Math.max(s.length,A)}else fe.value&&(ie=Math.max(s.length,we.value.length));const Oe=Array.from({length:ie},(A,B)=>`G${B+1}`);if((j.value||G.value||fe.value)&&s.length<ie){const A=Me.find(U=>U.label?.startsWith("Strategia A")||U.label?.startsWith("A:"));if(A&&Array.isArray(A.data)){const U=A.data.length;for(let Te=U;Te<ie;Te++)A.data.push(null),Array.isArray(A.pointBackgroundColor)&&A.pointBackgroundColor.push("transparent"),Array.isArray(A.pointRadius)&&A.pointRadius.push(0)}const B=Me.find(U=>U.label?.startsWith("Teorico"));if(B&&Array.isArray(B.data)&&B.data.length<ie){const U=B.data[0];for(let Te=B.data.length;Te<ie;Te++)B.data.push(U)}const oe=Me.find(U=>U.label?.startsWith("Target"));if(oe&&Array.isArray(oe.data)&&oe.data.length<ie){const U=oe.data[0];for(let Te=oe.data.length;Te<ie;Te++)oe.data.push(U)}}return{labels:Oe,datasets:Me}}),_s={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom",labels:{color:"rgba(255,255,255,0.7)",font:{size:11},filter:i=>!i.text.startsWith("_")}},tooltip:{backgroundColor:"rgba(15,15,25,0.95)",callbacks:{label:i=>i.dataset.label?.startsWith("_")?"":`${i.dataset.label}: ${Kt(i.raw)}`}},zoom:{pan:{enabled:!0,mode:"x",modifierKey:void 0},zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"x",drag:{enabled:!1}},limits:{x:{min:"original",max:"original"}}}},scales:{x:{grid:{color:"rgba(255,255,255,0.08)"},ticks:{color:"rgba(255,255,255,0.6)",font:{size:11}}},y:{grid:{color:"rgba(255,255,255,0.08)"},ticks:{color:"rgba(255,255,255,0.6)",font:{size:11},callback:i=>typeof i=="number"?Kt(i):i}}}};function Ee(i){if(!i)return 0;const s=i.split(":"),p=Number(s[0])||0,m=Number(s[1])||0;return p*60+m}function Kt(i){return`${Math.floor(i/60)}:${(i%60).toFixed(3).padStart(6,"0")}`}function t(i){return{practice:"PRACTICE",qualify:"QUALIFY",race:"RACE"}[i]||i.toUpperCase()}function n(i){if(!i||i==="-")return"far";const s=parseFloat(i);return isNaN(s)?"far":s<0?"faster":s===0?"ontarget":s<=.3?"close":s<=.5?"margin":"far"}function u(i){if(!i)return"-";const p=i.type==="Q"?he.value.theoQualy:he.value.theoRace;if(!p)return"-";const m=Ee(i.best);if(m===0)return"-";const o=p/1e3,h=m-o;return h>=0?`+${h.toFixed(3)}`:h.toFixed(3)}const v=k(()=>{if(!J.value)return{value:"-",seconds:0,class:"neutral"};const i=Ee(J.value.best);if(i===0)return{value:"-",seconds:0,class:"neutral"};let s=null;if(J.value.type==="Q"?s=he.value.theoQualy:s=he.value.theoRace,!s)return{value:"-",seconds:0,class:"neutral"};const p=s/1e3,m=i-p,o=m>=0?`+${m.toFixed(3)}`:m.toFixed(3);return{value:o,seconds:m,class:n(o)}}),T=k(()=>{if(!J.value)return{value:"-",seconds:0,class:"neutral"};const i=Ee(J.value.avg);if(i===0)return{value:"-",seconds:0,class:"neutral"};if(J.value.type==="Q")return{value:"-",seconds:0,class:"neutral"};const s=he.value.theoAvgRace;if(!s)return{value:"-",seconds:0,class:"neutral"};const p=s/1e3,m=i-p,o=m>=0?`+${m.toFixed(3)}`:m.toFixed(3);return{value:o,seconds:m,class:n(o)}}),C=k(()=>{if(!J.value||ke.value.length===0)return{onTarget:0,total:0,pct:0,targetLine:"-"};const s=J.value.type==="Q"?he.value.theoQualy:he.value.theoRace;if(!s)return{onTarget:0,total:0,pct:0,targetLine:"-"};const m=s/1e3+ws,o=ke.value.filter(K=>!K.pit),h=o.length;let N=0;return o.forEach(K=>{Ee(K.time)<=m&&N++}),{onTarget:N,total:h,pct:h>0?Math.round(N/h*100):0,targetLine:Kt(m)}}),P=k(()=>{const i=ke.value.filter(o=>!o.pit),s=i.length,p=i.filter(o=>o.valid).length,m=s-p;return{valid:p,invalid:m,total:s,pct:s>0?Math.round(p/s*100):100}}),ve=k(()=>{if(!J.value)return{hours:0,minutes:0,seconds:0,milliseconds:0,formatted:"0:00.000",totalMs:0};let i=J.value.durationMs||0;i===0&&ke.value.length>0&&ke.value.forEach(K=>{i+=Ee(K.time)*1e3});const s=i/1e3,p=Math.floor(s/3600),m=Math.floor(s%3600/60),o=Math.floor(s%60),h=Math.round(i%1e3);let N="";return p>0?N=`${p}h ${m.toString().padStart(2,"0")}m ${o.toString().padStart(2,"0")}.${h.toString().padStart(3,"0")}s`:N=`${m}m ${o.toString().padStart(2,"0")}.${h.toString().padStart(3,"0")}s`,{hours:p,minutes:m,seconds:o,milliseconds:h,formatted:N,totalMs:i}}),se=$(!0),_e=$(!1),xe={Opt:{bg:"rgba(16, 185, 129, 0.15)",border:"#10b981",label:"Optimum"},Green:{bg:"rgba(132, 204, 22, 0.15)",border:"#84cc16",label:"Green"},Greasy:{bg:"rgba(234, 179, 8, 0.15)",border:"#eab308",label:"Greasy"},Damp:{bg:"rgba(249, 115, 22, 0.15)",border:"#f97316",label:"Damp"},Wet:{bg:"rgba(59, 130, 246, 0.15)",border:"#3b82f6",label:"Wet"},Flooded:{bg:"rgba(139, 92, 246, 0.15)",border:"#8b5cf6",label:"Flooded"}},Ws=k(()=>{const i=ke.value;if(i.length<2)return!1;const s=i[0]?.grip;return i.some(p=>p.grip!==s)}),Zs=k(()=>{const i=ke.value;if(i.length===0)return[];const s=[];let p=i[0]?.grip||"Opt",m=1;return i.forEach((o,h)=>{o.grip!==p&&(s.push({gripLevel:p,startLap:m,endLap:h}),p=o.grip,m=h+1)}),s.push({gripLevel:p,startLap:m,endLap:i.length}),s});return(i,s)=>{const p=wn,m=xa;return _(),b("div",yi,[(_(),bn(yn,{to:"body"},[bs(Qn,{name:"slide-notification"},{default:js(()=>[et.value?(_(),b("div",Ti,[...s[6]||(s[6]=[a("span",{class:"share-notification-icon"},"âœ“",-1),a("span",{class:"share-notification-text"},"Link copiato nella clipboard!",-1)])])):W("",!0)]),_:1})])),bs(p,{class:"session-detail-page"},{default:js(()=>[a("div",Si,[a("button",{class:"nav-btn",onClick:s[0]||(s[0]=o=>y("back"))},[...s[7]||(s[7]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M15 18l-6-6 6-6"})],-1),V(" Torna alle sessioni ",-1)])]),a("button",{class:"nav-btn nav-btn--accent",onClick:s[1]||(s[1]=o=>y("go-to-track",L.value.trackId))},[...s[8]||(s[8]=[V(" Apri pista ",-1),a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M9 18l6-6-6-6"})],-1)])])]),We.value?(_(),b("div",Ci,[...s[9]||(s[9]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Caricamento sessione...",-1)])])):Ze.value?(_(),b("div",ki,[s[10]||(s[10]=a("p",{class:"error-icon"},"âš ï¸",-1)),a("p",Ei,g(Ze.value),1),a("button",{class:"nav-btn",onClick:s[2]||(s[2]=o=>y("back"))},"Torna alle sessioni")])):(_(),b(O,{key:2},[a("header",Ai,[a("div",xi,[a("h1",Mi,g(L.value.track.toUpperCase()),1),a("span",{class:Y(["type-badge",`type-badge--${L.value.type}`])},g(t(L.value.type)),3),a("button",{class:"share-session-btn",onClick:Ss,title:"Condividi questa sessione"}," ðŸ”— Condividi ")]),a("div",Ri,[a("span",null,g(L.value.date),1),s[11]||(s[11]=a("span",{class:"sep"},"â€¢",-1)),a("span",null,g(L.value.time),1),s[12]||(s[12]=a("span",{class:"sep"},"â€¢",-1)),a("span",Ii,g(L.value.car),1)])]),a("div",Li,[a("aside",Pi,[a("div",Oi,[a("div",Di,[s[14]||(s[14]=a("span",{class:"builder-panel-title"},"Strategy Builder",-1)),rs.value?(_(),b(O,{key:0},[Gt.value?(_(),b("button",{key:0,class:"builder-combo-btn builder-combo-btn--active",onClick:ds,title:"Confronto attivo - Clicca per resettare"},[...s[13]||(s[13]=[a("span",{class:"combo-status"},"âœ“ Attivo",-1),a("span",{class:"combo-divider"},"|",-1),a("span",{class:"combo-reset"},"Ã—",-1)])])):(_(),b("button",{key:1,class:"builder-combo-btn",onClick:ds,title:"Azzera selezione"}," Ã— Reset "))],64)):W("",!0)]),a("div",Ni,[s[15]||(s[15]=a("span",{class:"builder-slot-label"},"A",-1)),a("div",wi,[D.value?(_(),b(O,{key:1},[a("span",$i,[V(" #"+g(D.value)+" ",1),a("button",{class:"chip-remove",onClick:Rs,title:z.value?"Rimuovi (rimuoverÃ  anche +"+z.value+")":"Rimuovi"},"Ã—",8,zi)]),z.value?(_(),b("span",Fi,[V(" + #"+g(z.value)+" ",1),a("button",{class:"chip-remove",onClick:Rt,title:"Rimuovi"},"Ã—")])):W("",!0)],64)):(_(),b("span",Bi,"Seleziona stint con [+A]"))])]),a("div",Ui,[s[16]||(s[16]=a("span",{class:"builder-slot-label"},"B",-1)),a("div",Gi,[R.value?(_(),b(O,{key:1},[a("span",Hi,[V(" #"+g(R.value)+" ",1),a("button",{class:"chip-remove",onClick:Is,title:w.value?"Rimuovi (rimuoverÃ  anche +"+w.value+")":"Rimuovi"},"Ã—",8,Vi)]),w.value?(_(),b("span",Yi,[V(" + #"+g(w.value)+" ",1),a("button",{class:"chip-remove",onClick:Ie,title:"Rimuovi"},"Ã—")])):W("",!0)],64)):(_(),b("span",Qi,"Seleziona stint con [+B]"))])])]),mt.value?(_(),b(O,{key:0},[a("div",Wi,[a("div",Zi,[a("span",Xi,"Sessione di "+g(c.value||"Te"),1),a("span",qi,g(L.value.date),1)]),a("div",ji,[(_(!0),b(O,null,Se(L.value.stints,o=>(_(),b("div",{key:"a-"+o.number,class:Y(["stint-item stint-item--builder",{"builder-selected":yt(o.number),viewing:Le.value===o.number,"best-stint":je(o)}]),onClick:h=>Ls(o.number)},[a("button",{class:"stint-add-btn stint-add-btn--a",disabled:!bt(o.number),title:vs(o.number),onClick:Ct(h=>Pt(o.number),["stop"])},"+A",8,Ji),a("button",{class:"stint-add-btn stint-add-btn--b",disabled:!ps(o.number),title:Yt(o.number),onClick:Ct(h=>Ot(o.number),["stop"])},"+B",8,eo),a("span",to,[je(o)?(_(),b(O,{key:0},[V("ðŸ†")],64)):de(o)?(_(),b(O,{key:1},[V(g(de(o)?.icon),1)],64)):W("",!0)]),a("span",so,"#"+g(o.number),1),a("span",{class:Y(["stint-type",`stint-type--${o.type.toLowerCase()}`])},g(o.type),3),a("span",no,g(o.laps)+" Giri",1)],10,Ki))),128))])]),a("div",ao,[a("div",io,[a("span",oo,[re.value?(_(),b(O,{key:0},[V(" Sessione di "+g(Ge.value||"Utente Esterno"),1)],64)):(_(),b(O,{key:1},[V(" Sessione di "+g(c.value||"Te")+" (altra) ",1)],64))]),a("button",{class:"cross-session-close",onClick:ht,title:"Rimuovi questa sorgente"},"âœ•")]),a("div",lo,[(_(!0),b(O,null,Se(gt.value,o=>(_(),b("div",{key:"b-"+o.number,class:Y(["stint-item stint-item--builder stint-item--b",{"builder-selected":ms(o.number)}]),onClick:h=>(o.number,void 0)},[a("button",{class:"stint-add-btn stint-add-btn--a",disabled:!Es(o.number),title:As(o.number),onClick:Ct(h=>Pt(o.number),["stop"])},"+A",8,uo),a("button",{class:"stint-add-btn stint-add-btn--b",disabled:!xs(o.number),title:fs(o.number),onClick:Ct(h=>Ms(o.number),["stop"])},"+B",8,co),a("span",po,[je(o)?(_(),b(O,{key:0},[V("ðŸ†")],64)):de(o)?(_(),b(O,{key:1},[V(g(de(o)?.icon),1)],64)):W("",!0)]),a("span",vo,"#"+g(o.number),1),a("span",{class:Y(["stint-type",`stint-type--${o.type.toLowerCase()}`])},g(o.type),3),a("span",fo,g(o.laps)+" Giri",1)],10,ro))),128))])])],64)):(_(),b(O,{key:1},[s[17]||(s[17]=a("h4",{class:"master-title"},"STINT",-1)),a("div",mo,[(_(!0),b(O,null,Se(L.value.stints,o=>(_(),b("div",{key:o.number,class:Y(["stint-item stint-item--builder",{selected:Le.value===o.number,"builder-selected-a":yt(o.number),"builder-selected-b":ms(o.number),"best-stint":je(o)}]),onClick:h=>Wt(o.number)},[a("button",{class:"stint-add-btn stint-add-btn--a",disabled:!bt(o.number),title:vs(o.number),onClick:Ct(h=>Pt(o.number),["stop"])},"+A",8,go),a("button",{class:"stint-add-btn stint-add-btn--b",disabled:!ps(o.number),title:Yt(o.number),onClick:Ct(h=>Ot(o.number),["stop"])},"+B",8,_o),a("span",bo,[je(o)?(_(),b(O,{key:0},[V("ðŸ†")],64)):de(o)?(_(),b(O,{key:1},[V(g(de(o)?.icon),1)],64)):W("",!0)]),a("span",yo,"#"+g(o.number),1),a("span",{class:Y(["stint-type",`stint-type--${o.type.toLowerCase()}`])},g(o.type),3),a("span",To,g(o.laps)+" Giri",1),a("span",{class:Y(["stint-delta",`delta--${n(u(o))}`])},g(u(o)),3)],10,ho))),128))]),a("button",{class:"altra-sessione-btn",onClick:Ce}," Confronta con altra sessione ")],64))]),a("section",So,[!fe.value&&!j.value&&!G.value&&L.value.stints.length===0?(_(),b("div",Co,[...s[18]||(s[18]=[a("div",{class:"empty-state-content"},[a("h3",{class:"empty-state-title"},"Nessun stint disponibile"),a("p",{class:"empty-state-text"},"Questa sessione non contiene dati di stint.")],-1)])])):W("",!0),!fe.value&&!j.value&&J.value&&de(J.value)?(_(),b("div",ko,g(de(J.value)?.icon)+" "+g(de(J.value)?.message),1)):W("",!0),fe.value||j.value||G.value?(_(),b("div",Eo,[a("div",Ao,[a("div",xo,[a("div",Mo,"A: Stint #"+g(j.value||G.value?D.value:Xe.value),1),a("div",Ro,[a("span",Io,[s[19]||(s[19]=a("span",{class:"cond-lbl"},"Aria:",-1)),V(" "+g(Bt(j.value||G.value?Be.value:Qe.value))+"Â°",1)]),a("span",Lo,[s[20]||(s[20]=a("span",{class:"cond-lbl"},"Grip:",-1)),V(" "+g($t(j.value||G.value?Be.value:Qe.value)),1)])])]),a("div",Po,[a("div",Oo,"B: Stint #"+g(j.value||G.value?R.value:Re.value),1),a("div",Do,[a("span",No,[s[21]||(s[21]=a("span",{class:"cond-lbl"},"Aria:",-1)),V(" "+g(Bt(j.value||G.value?ue.value:we.value))+"Â°",1)]),a("span",wo,[s[22]||(s[22]=a("span",{class:"cond-lbl"},"Grip:",-1)),V(" "+g($t(j.value||G.value?ue.value:we.value)),1)])])])]),a("div",Bo,[a("div",$o,[s[32]||(s[32]=a("div",{class:"ssc-table-header"},[a("div",{class:"ssc-th ssc-th--label"}),a("div",{class:"ssc-th"},"STRATEGIA A"),a("div",{class:"ssc-th"},"STRATEGIA B"),a("div",{class:"ssc-th"},"- DELTA")],-1)),(_(!0),b(O,null,Se(nt.value,(o,h)=>(_(),b(O,{key:h},[nt.value>1?(_(),b("div",zo,[a("span",null,"STINT "+g(h+1),1)])):W("",!0),a("div",Fo,[s[23]||(s[23]=a("div",{class:"ssc-td ssc-td--label"},"BEST",-1)),a("div",Uo,g(ee.value[h]?.best??"â€”"),1),a("div",Go,g(te.value[h]?.best??"â€”"),1),a("div",Qo,[ee.value[h]&&te.value[h]?(_(),b("span",{key:0,class:Y(["ssc-delta",gs(ee.value[h]?.bestMs,te.value[h]?.bestMs)])},g(He(ee.value[h]?.bestMs,te.value[h]?.bestMs)),3)):(_(),b("span",Ho,"â€”"))])]),a("div",Vo,[s[24]||(s[24]=a("div",{class:"ssc-td ssc-td--label"},"AVG",-1)),a("div",{class:Y(["ssc-td","ssc-td--value",{"ssc-td--warning":ee.value[h]?.avgWarning}])},[ee.value[h]?.avgWarning?(_(),b(O,{key:0},[V("âš ï¸ "+g(ee.value[h]?.avg),1)],64)):(_(),b(O,{key:1},[V(g(ee.value[h]?.avg??"â€”"),1)],64))],2),a("div",{class:Y(["ssc-td","ssc-td--value",{"ssc-td--warning":te.value[h]?.avgWarning}])},[te.value[h]?.avgWarning?(_(),b(O,{key:0},[V("âš ï¸ "+g(te.value[h]?.avg),1)],64)):(_(),b(O,{key:1},[V(g(te.value[h]?.avg??"â€”"),1)],64))],2),a("div",Yo,[ee.value[h]&&te.value[h]?(_(),b("span",{key:0,class:Y(["ssc-delta",gs(ee.value[h]?.avgMs,te.value[h]?.avgMs)])},g(He(ee.value[h]?.avgMs,te.value[h]?.avgMs)),3)):(_(),b("span",Wo,"â€”"))])]),a("div",Zo,[s[27]||(s[27]=a("div",{class:"ssc-td ssc-td--label"},"GIRI VALIDI",-1)),a("div",Xo,[ee.value[h]?(_(),b(O,{key:0},[V(g(ee.value[h].validLapsCount??0)+" su "+g(ee.value[h].laps??0)+" ",1),s[25]||(s[25]=a("span",{class:"compact-sep"},"Â·",-1)),V(" "+g(Lt(ee.value[h]?.durationMs)),1)],64)):(_(),b(O,{key:1},[V("â€”")],64))]),a("div",qo,[te.value[h]?(_(),b(O,{key:0},[V(g(te.value[h].validLapsCount??0)+" su "+g(te.value[h].laps??0)+" ",1),s[26]||(s[26]=a("span",{class:"compact-sep"},"Â·",-1)),V(" "+g(Lt(te.value[h]?.durationMs)),1)],64)):(_(),b(O,{key:1},[V("â€”")],64))]),s[28]||(s[28]=a("div",{class:"ssc-td"},null,-1))])],64))),128)),nt.value>1?(_(),b(O,{key:0},[s[31]||(s[31]=a("div",{class:"ssc-stint-separator ssc-stint-separator--total"},[a("span",null,"TOTALE")],-1)),a("div",jo,[s[29]||(s[29]=a("div",{class:"ssc-td ssc-td--label"},"DURATA",-1)),a("div",Ko,g(Lt(Ht.value)),1),a("div",Jo,g(Lt(ks.value)),1),s[30]||(s[30]=a("div",{class:"ssc-td"},null,-1))])],64)):W("",!0)])])])):W("",!0),!fe.value&&!G.value&&!j.value&&Nt.value?(_(),b("div",{key:3,class:Y(["stint-stats-card",`racing-theme--${H.value}`])},[a("div",el,[a("div",tl,[a("span",{class:Y(["stint-type",`stint-type--${Nt.value?.type?.toLowerCase()}`])},g(Nt.value?.type==="R"?"Race":"Qualifying"),3),a("span",sl,"STINT #"+g(Zt.value),1),s[35]||(s[35]=a("span",{class:"ssc-header-divider"},"|",-1)),a("span",nl,[s[33]||(s[33]=a("span",{class:"ssc-cond-lbl"},"ARIA",-1)),a("span",al,g(St.value.airTemp.avg||St.value.airTemp.start)+"Â°",1)]),a("span",il,[s[34]||(s[34]=a("span",{class:"ssc-cond-lbl"},"GRIP",-1)),a("span",ol,g(St.value.grip.dominant),1)])]),a("div",ll,[a("span",rl,"Durata: "+g(ve.value.formatted),1)])]),a("div",ul,[s[38]||(s[38]=a("div",{class:"ssc-table-header"},[a("div",{class:"ssc-th ssc-th--label"}),a("div",{class:"ssc-th"},"TEMPI STINT"),a("div",{class:"ssc-th"},"TEORICO"),a("div",{class:"ssc-th"},"- DELTA")],-1)),a("div",cl,[s[36]||(s[36]=a("div",{class:"ssc-td ssc-td--label"},"BEST",-1)),a("div",dl,g(J.value?.best??"â€”:â€”.---"),1),a("div",pl,g(J.value?.type==="Q"?he.value.theoQualy?ts(Q)(he.value.theoQualy):"â€”:â€”.---":he.value.theoRace?ts(Q)(he.value.theoRace):"â€”:â€”.---"),1),a("div",vl,[a("span",{class:Y(["ssc-delta",v.value.class])},g(v.value.value),3)])]),a("div",fl,[s[37]||(s[37]=a("div",{class:"ssc-td ssc-td--label"},"AVG",-1)),a("div",ml,g(J.value?.avg??"â€”:â€”.---"),1),a("div",hl,g(J.value?.type==="Q"?"â€”":he.value.theoAvgRace?ts(Q)(he.value.theoAvgRace):"â€”:â€”.---"),1),a("div",gl,[J.value?.type!=="Q"?(_(),b("span",{key:0,class:Y(["ssc-delta",T.value.class])},g(T.value.value),3)):(_(),b("span",_l,"â€”"))])])]),J.value?.type==="R"&&C.value.total>0?(_(),b("div",bl,[a("div",yl,[s[39]||(s[39]=a("span",{class:"ssc-target-label"},"TARGET GARA:",-1)),a("span",Tl,g(C.value.targetLine),1)])])):W("",!0),a("div",Sl,[J.value?.type==="R"&&C.value.total>0?(_(),b("div",Cl,[a("div",kl,[s[40]||(s[40]=a("span",{class:"ssc-progress-title"},"GIRI NEL TARGET",-1)),a("span",El,g(C.value.onTarget)+" su "+g(C.value.total),1)]),a("div",Al,[a("div",{class:"ssc-progress-fill",style:es({width:C.value.pct+"%",background:st(C.value.pct)})},null,4)]),a("span",{class:"ssc-progress-pct",style:es({color:st(C.value.pct)})},g(C.value.pct)+"%",5)])):W("",!0),P.value.total>0?(_(),b("div",xl,[a("div",Ml,[s[41]||(s[41]=a("span",{class:"ssc-progress-title"},"GIRI VALIDI",-1)),a("span",Rl,g(P.value.valid)+" su "+g(P.value.total),1)]),a("div",Il,[a("div",{class:"ssc-progress-fill",style:es({width:P.value.pct+"%",background:st(P.value.pct)})},null,4)]),a("span",{class:"ssc-progress-pct",style:es({color:st(P.value.pct)})},g(P.value.pct)+"%",5)])):W("",!0)])],2)):W("",!0),a("div",Ll,[a("div",Pl,[a("h4",Ol,[fe.value?(_(),b(O,{key:0},[V("Confronto Tempi â€” A: Stint #"+g(Xe.value)+" vs B: Stint #"+g(Re.value),1)],64)):(_(),b(O,{key:1},[V("Tempi Giro â€” Stint "+g(Le.value),1)],64))]),a("div",Dl,[a("button",{class:"toolbar-btn",onClick:Ve,title:"Zoom In"},[...s[42]||(s[42]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("circle",{cx:"11",cy:"11",r:"8"}),a("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),a("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),a("line",{x1:"8",y1:"11",x2:"14",y2:"11"})],-1)])]),a("button",{class:"toolbar-btn",onClick:vt,title:"Zoom Out"},[...s[43]||(s[43]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("circle",{cx:"11",cy:"11",r:"8"}),a("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),a("line",{x1:"8",y1:"11",x2:"14",y2:"11"})],-1)])]),a("button",{class:"toolbar-btn",onClick:X,title:"Reset Zoom"},[...s[44]||(s[44]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("polyline",{points:"1 4 1 10 7 10"}),a("polyline",{points:"23 20 23 14 17 14"}),a("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})],-1)])]),s[46]||(s[46]=a("div",{class:"toolbar-divider"},null,-1)),a("button",{class:Y(["toolbar-btn",{"toolbar-btn--active":I.value}]),onClick:s[3]||(s[3]=o=>I.value=!I.value),title:"Gestisci Giri"},[...s[45]||(s[45]=[a("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),a("line",{x1:"3",y1:"9",x2:"21",y2:"9"}),a("line",{x1:"9",y1:"21",x2:"9",y2:"9"})],-1)])],2)])]),I.value?(_(),b("div",Nl,[a("div",wl,[a("div",Bl,[a("span",$l,g(j.value?"Strategia A Â· "+ee.value.map(o=>"#"+o.number).join("+"):G.value?"Strategia A Â· Stint #"+D.value:fe.value?"Strategia A Â· Stint #"+Xe.value:"Escludi Giri"),1),a("button",{class:"lap-manager-reset",onClick:pt,disabled:S.value.size===0}," Reset ",8,zl)]),j.value?(_(!0),b(O,{key:0},Se(ee.value,o=>(_(),b("div",{key:"stint-a-"+o.number,class:"lap-manager-stint-group"},[a("div",Fl,"Stint #"+g(o.number),1),a("div",Ul,[(_(!0),b(O,null,Se(L.value.lapsData[o.number]||[],h=>(_(),b("button",{key:"a-"+o.number+"-"+h.lap,class:Y(["lap-toggle-btn",{"lap-toggle-btn--excluded":S.value.has(h.lap)},{"lap-toggle-btn--invalid":!h.valid&&!h.pit},{"lap-toggle-btn--pit":h.pit}]),onClick:N=>Z(h.lap),title:`Giro ${h.lap} - ${h.time}${h.valid?"":" (Invalido)"}${h.pit?" (Pit)":""}`},g(h.lap),11,Gl))),128))])]))),128)):(_(),b("div",Ql,[(_(!0),b(O,null,Se(G.value?Be.value:fe.value?Qe.value:ke.value,o=>(_(),b("button",{key:"a-"+o.lap,class:Y(["lap-toggle-btn",{"lap-toggle-btn--excluded":S.value.has(o.lap)},{"lap-toggle-btn--invalid":!o.valid&&!o.pit},{"lap-toggle-btn--pit":o.pit}]),onClick:h=>Z(o.lap),title:`Giro ${o.lap} - ${o.time}${o.valid?"":" (Invalido)"}${o.pit?" (Pit)":""}`},g(o.lap),11,Hl))),128))])),S.value.size>0?(_(),b("div",Vl,g(S.value.size)+" giri esclusi ",1)):W("",!0)]),fe.value||j.value?(_(),b("div",Yl,[a("div",Wl,[a("span",Zl,g(j.value?"Strategia B Â· "+te.value.map(o=>"#"+o.number).join("+"):"B: Stint #"+Re.value),1),a("button",{class:"lap-manager-reset",onClick:ae,disabled:E.value.size===0}," Reset ",8,Xl)]),j.value?(_(!0),b(O,{key:0},Se(te.value,o=>(_(),b("div",{key:"stint-b-"+o.number,class:"lap-manager-stint-group"},[a("div",ql,"Stint #"+g(o.number),1),a("div",jl,[(_(!0),b(O,null,Se(L.value.lapsData[o.number]||[],h=>(_(),b("button",{key:"b-"+o.number+"-"+h.lap,class:Y(["lap-toggle-btn lap-toggle-btn--b",{"lap-toggle-btn--excluded":E.value.has(h.lap)},{"lap-toggle-btn--invalid":!h.valid&&!h.pit},{"lap-toggle-btn--pit":h.pit}]),onClick:N=>Ue(h.lap),title:`Giro ${h.lap} - ${h.time}${h.valid?"":" (Invalido)"}${h.pit?" (Pit)":""}`},g(h.lap),11,Kl))),128))])]))),128)):(_(),b("div",Jl,[(_(!0),b(O,null,Se(we.value,o=>(_(),b("button",{key:"b-"+o.lap,class:Y(["lap-toggle-btn lap-toggle-btn--b",{"lap-toggle-btn--excluded":E.value.has(o.lap)},{"lap-toggle-btn--invalid":!o.valid&&!o.pit},{"lap-toggle-btn--pit":o.pit}]),onClick:h=>Ue(o.lap),title:`Giro ${o.lap} - ${o.time}${o.valid?"":" (Invalido)"}${o.pit?" (Pit)":""}`},g(o.lap),11,er))),128))])),E.value.size>0?(_(),b("div",tr,g(E.value.size)+" giri esclusi ",1)):W("",!0)])):W("",!0),G.value?(_(),b("div",sr,[a("div",nr,[a("span",ar,"Strategia B Â· Stint #"+g(R.value),1),a("button",{class:"lap-manager-reset",onClick:M,disabled:x.value.size===0}," Reset ",8,ir)]),a("div",or,[(_(!0),b(O,null,Se(ue.value,o=>(_(),b("button",{key:"crossb-"+o.lapNumber,class:Y(["lap-toggle-btn lap-toggle-btn--b",{"lap-toggle-btn--excluded":x.value.has(o.lapNumber)},{"lap-toggle-btn--invalid":!o.valid&&!o.pit},{"lap-toggle-btn--pit":o.pit}]),onClick:h=>ge(o.lapNumber),title:`Giro ${o.lapNumber} - ${o.lapTime}${o.valid?"":" (Invalido)"}${o.pit?" (Pit)":""}`},g(o.lapNumber),11,lr))),128))]),x.value.size>0?(_(),b("div",rr,g(x.value.size)+" giri esclusi ",1)):W("",!0)])):W("",!0)])):W("",!0),a("div",ur,[bs(ts(ea),{ref_key:"chartRef",ref:F,data:jt.value,options:_s},null,8,["data"])]),Ws.value&&_e.value?(_(),b("div",cr,[s[47]||(s[47]=a("span",{class:"grip-legend-title"},"Grip:",-1)),(_(!0),b(O,null,Se(Zs.value,o=>(_(),b("div",{key:`${o.gripLevel}-${o.startLap}`,class:"grip-legend-item"},[a("span",{class:"grip-legend-dot",style:es({backgroundColor:xe[o.gripLevel]?.border||"#fff"})},null,4),a("span",dr,g(xe[o.gripLevel]?.label||o.gripLevel),1),a("span",pr,"(G"+g(o.startLap)+"-G"+g(o.endLap)+")",1)]))),128))])):W("",!0)]),a("div",vr,[a("div",fr,[fe.value||G.value||j.value?(_(),b("div",mr,[a("button",{class:Y(["lap-tab lap-tab--compare",{"lap-tab--active":Ae.value==="COMPARE"}]),onClick:s[4]||(s[4]=o=>Ae.value="COMPARE")}," Confronto ",2),(_(!0),b(O,null,Se(ee.value,o=>(_(),b("button",{key:"tab-a-"+o.number,class:Y(["lap-tab lap-tab--a",{"lap-tab--active":Ae.value==="A-"+o.number}]),onClick:h=>Ae.value="A-"+o.number}," A: Stint #"+g(o.number),11,hr))),128)),(_(!0),b(O,null,Se(te.value,o=>(_(),b("button",{key:"tab-b-"+o.number,class:Y(["lap-tab lap-tab--b",{"lap-tab--active":Ae.value==="B-"+o.number}]),onClick:h=>Ae.value="B-"+o.number}," B: Stint #"+g(o.number),11,gr))),128))])):(_(),b("h4",_r,"Tabella Giri â€” Stint "+g(Le.value),1))]),Ae.value==="COMPARE"&&(fe.value||G.value||j.value)?(_(),b("div",br,[a("table",yr,[s[50]||(s[50]=a("thead",null,[a("tr",null,[a("th",{class:"col-index"},"#"),a("th",{class:"col-a",colspan:"4"},"Strategia A"),a("th",{class:"col-delta"},"Î” A-B"),a("th",{class:"col-b",colspan:"4"},"Strategia B")]),a("tr",{class:"sub-header"},[a("th"),a("th",{class:"col-a"},"Tempo"),a("th",{class:"col-a"},"S1"),a("th",{class:"col-a"},"S2"),a("th",{class:"col-a"},"S3"),a("th"),a("th",{class:"col-b"},"Tempo"),a("th",{class:"col-b"},"S1"),a("th",{class:"col-b"},"S2"),a("th",{class:"col-b"},"S3")])],-1)),a("tbody",null,[(_(!0),b(O,null,Se(qe.value,o=>(_(),b(O,{key:"cmp-"+o.index},[o._isStintStartA||o._isStintStartB?(_(),b("tr",Tr,[s[48]||(s[48]=a("td",{class:"stint-header-index"},null,-1)),a("td",Sr,[o._isStintStartA?(_(),b("span",Cr,"A: Stint #"+g(o._stintNumberA),1)):W("",!0)]),s[49]||(s[49]=a("td",{class:"stint-header-delta"},null,-1)),a("td",kr,[o._isStintStartB?(_(),b("span",Er,"B: Stint #"+g(o._stintNumberB),1)):W("",!0)])])):W("",!0),a("tr",null,[a("td",Ar,g(o.index),1),a("td",xr,g(o.lapA&&(o.lapA.time||o.lapA.lapTime)||"â€”"),1),a("td",Mr,g(o.lapA?Pe(o.lapA.sectors?.[0]||o.lapA.s1):"â€”"),1),a("td",Rr,g(o.lapA?Pe(o.lapA.sectors?.[1]||o.lapA.s2):"â€”"),1),a("td",Ir,g(o.lapA?Pe(o.lapA.sectors?.[2]||o.lapA.s3):"â€”"),1),a("td",{class:Y(["col-delta","delta",`delta--${o.deltaClass}`])},g(o.deltaFormatted),3),a("td",Lr,g(o.lapB&&(o.lapB.time||o.lapB.lapTime)||"â€”"),1),a("td",Pr,g(o.lapB?Pe(o.lapB.sectors?.[0]||o.lapB.s1):"â€”"),1),a("td",Or,g(o.lapB?Pe(o.lapB.sectors?.[1]||o.lapB.s2):"â€”"),1),a("td",Dr,g(o.lapB?Pe(o.lapB.sectors?.[2]||o.lapB.s3):"â€”"),1)])],64))),128))])])])):(_(),b("div",Nr,[a("table",wr,[s[51]||(s[51]=a("thead",null,[a("tr",null,[a("th",null,"Giro"),a("th",null,"Tempo"),a("th",null,"Î” Teorico"),a("th",null,"S1"),a("th",null,"S2"),a("th",null,"S3"),a("th",null,"Fuel"),a("th",null,"AirÂ°"),a("th",null,"Grip"),a("th",null,"Stato")])],-1)),a("tbody",null,[(_(!0),b(O,null,Se(it(),o=>(_(),b("tr",{key:o.lap||o.lapNumber,class:Y({"lap-pit":o.pit,"lap-excluded":S.value.has(o.lap||o.lapNumber)})},[a("td",null,g(o.lap||o.lapNumber),1),a("td",Br,g(o.time||o.lapTime),1),a("td",{class:Y(["delta",`delta--${n(o.delta)}`])},g(o.delta||"â€”"),3),a("td",$r,g(Pe(o.sectors?.[0]||o.s1)),1),a("td",zr,g(Pe(o.sectors?.[1]||o.s2)),1),a("td",Fr,g(Pe(o.sectors?.[2]||o.s3)),1),a("td",null,g(o.fuel)+"L",1),a("td",null,g(Math.round(o.airTemp||o.air||0))+"Â°",1),a("td",null,g(o.grip),1),a("td",Ur,[o.pit?(_(),b("span",Gr,"PIT")):o.valid?(_(),b("span",Hr,"OK")):(_(),b("span",Qr,"INV"))])],2))),128))])])]))])])])],64))]),_:1}),bs(m,{"is-open":xt.value,"current-track":L.value?.track||"","exclude-session-id":f.sessionId,onClose:s[5]||(s[5]=o=>xt.value=!1),onSelect:Mt},null,8,["is-open","current-track","exclude-session-id"])])}}}),qr=Object.assign(Tn(Vr,[["__scopeId","data-v-2a251451"]]),{__name:"PagesSessionDetailPage"});export{qr as _};
