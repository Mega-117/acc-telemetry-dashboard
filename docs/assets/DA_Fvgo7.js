import{_ as rt}from"./Cx_N8t4A.js";import{u as lt,b as O,f as _,g as ct,a as ut,_ as dt}from"./BlpzeAZo.js";import{b as j,o as mt,t as p,r as T,c as pt,L as Y,F as u,J as gt,G as t,K as R,H as i,M as S,I as V,a0 as U,E as d,P as H,Q as J,a1 as _t,a6 as vt,O as M,_ as bt,$ as yt,n as W}from"./Bf400IeT.js";import{C as kt,a as ht,L as ft,P as Ct,b as Tt,p as Rt,c as St,d as It,i as Pt,e as Bt}from"./Bdj_a-RS.js";import{u as Nt}from"./CBWyZPKV.js";const xt={class:"track-header"},Lt={class:"track-header-image"},wt=["src","alt"],Mt={class:"track-header-info"},At={class:"track-country-badge"},Qt={class:"track-title"},Dt={class:"track-fullname"},zt={class:"track-meta"},$t={class:"meta-item"},Gt={class:"meta-item"},Ft={class:"meta-item"},Et={class:"page-layout"},qt={class:"main-content"},Ot={class:"section"},Vt={class:"chart-container"},Ut={class:"chart-wrapper"},Ht=["onClick"],Jt={class:"row-left"},Wt={class:"session-time"},jt={class:"session-date"},Yt={class:"session-car"},Kt={class:"row-right"},Xt={class:"stat-chips"},Zt={class:"stat-chip"},te={class:"stat-chip"},ee={class:"time-slot"},se={key:0,class:"time-badge time-badge--qualy"},ae={key:1,class:"time-badge time-badge--qualy time-badge--empty"},ne={class:"time-slot"},oe={key:0,class:"time-badge time-badge--race"},ie={key:1,class:"time-badge time-badge--race time-badge--empty"},re={class:"sidebar"},le={class:"sidebar-section"},ce={class:"section-header-row"},ue=["value"],de={class:"best-times-stack"},me={class:"best-time-card best-time-card--qualy"},pe={class:"time-value"},ge={key:0,class:"time-conditions"},_e={key:1,class:"no-data-hint"},ve={class:"best-time-card best-time-card--race"},be={class:"time-value"},ye={key:0,class:"time-conditions"},ke={key:1,class:"no-data-hint"},he={class:"best-time-card best-time-card--avg"},fe={class:"time-value"},Ce={key:0,class:"time-conditions"},Te={key:1,class:"no-data-hint"},Re={class:"sidebar-section"},Se={class:"activity-stack"},Ie={class:"activity-item"},Pe={class:"activity-value"},Be={class:"activity-item"},Ne={class:"activity-value"},xe={class:"activity-label"},Le={class:"activity-item"},we={class:"activity-value"},Me={class:"activity-item"},Ae={class:"activity-value"},A=20,Qe=j({__name:"TrackDetailPage",props:{trackId:{},fromSession:{}},emits:["back"],setup(Q,{emit:f}){const{getPublicPath:I}=Nt();kt.register(ht,ft,Ct,Tt,Rt,St,It,Pt);const m=Q,P=f,{sessions:D,trackStats:z,loadSessions:B}=lt();mt(async()=>{await B()});const v=p(()=>{const a=m.trackId.toLowerCase().replace(/[^a-z0-9]/g,"_");return D.value.filter(e=>{const n=e.meta.track.toLowerCase().replace(/[^a-z0-9]/g,"_");return n.includes(a)||a.includes(n)}).sort((e,n)=>n.meta.date_start.localeCompare(e.meta.date_start))}),$=p(()=>{const a=m.trackId.toLowerCase().replace(/[^a-z0-9]/g,"_");return z.value.find(e=>{const n=e.track.toLowerCase().replace(/[^a-z0-9]/g,"_");return n.includes(a)||a.includes(n)})}),G={monza:{name:"Monza",fullName:"Autodromo Nazionale Monza",country:"Italia",countryCode:"IT",length:"5.793 km",turns:11,image:"/tracks/track_monza.png"},spa:{name:"Spa-Francorchamps",fullName:"Circuit de Spa-Francorchamps",country:"Belgio",countryCode:"BE",length:"7.004 km",turns:19,image:"/tracks/track_spa.png"},spa_francorchamps:{name:"Spa-Francorchamps",fullName:"Circuit de Spa-Francorchamps",country:"Belgio",countryCode:"BE",length:"7.004 km",turns:19,image:"/tracks/track_spa.png"},suzuka:{name:"Suzuka",fullName:"Suzuka International Racing Course",country:"Giappone",countryCode:"JP",length:"5.807 km",turns:18,image:"/tracks/track_suzuka.png"},donington:{name:"Donington Park",fullName:"Donington Park Racing Circuit",country:"Regno Unito",countryCode:"GB",length:"4.020 km",turns:12,image:"/tracks/track_donington.png"},donington_park:{name:"Donington Park",fullName:"Donington Park Racing Circuit",country:"Regno Unito",countryCode:"GB",length:"4.020 km",turns:12,image:"/tracks/track_donington.png"},valencia:{name:"Valencia",fullName:"Circuit Ricardo Tormo",country:"Spagna",countryCode:"ES",length:"4.005 km",turns:14,image:"/tracks/track_valencia.png"},nurburgring:{name:"Nürburgring",fullName:"Nürburgring Grand Prix Strecke",country:"Germania",countryCode:"DE",length:"5.148 km",turns:16,image:"/tracks/track_nurburgring.png"},silverstone:{name:"Silverstone",fullName:"Silverstone Circuit",country:"Regno Unito",countryCode:"GB",length:"5.891 km",turns:18,image:"/tracks/track_silverstone.png"},imola:{name:"Imola",fullName:"Autodromo Enzo e Dino Ferrari",country:"Italia",countryCode:"IT",length:"4.909 km",turns:19,image:"/tracks/track_imola.png"},barcelona:{name:"Barcelona",fullName:"Circuit de Barcelona-Catalunya",country:"Spagna",countryCode:"ES",length:"4.655 km",turns:16,image:"/tracks/track_barcelona.png"}},K=["Optimum","Fast","Green","Greasy","Damp","Wet","Flood"],b=T("Optimum"),c=p(()=>{const a=m.trackId.toLowerCase().replace(/[^a-z0-9]/g,"_"),e=G[a]||G[m.trackId]||{name:O(m.trackId),fullName:O(m.trackId),country:"-",countryCode:"??",length:"-",turns:0,image:"/tracks/track_default.png"},n=$.value,r=b.value,s=n?.bestByGrip?.[r],l=s?.bestQualy||null,o=s?.bestRace||null,g=s?.bestAvgRace||null,w=l?{airTemp:s?.bestQualyTemp||0,roadTemp:0,grip:r}:null,y=o?{airTemp:s?.bestRaceTemp||0,roadTemp:0,grip:r}:null,k=g?{airTemp:s?.bestAvgRaceTemp||0,roadTemp:0,grip:r}:null;return{id:m.trackId,...e,sessions:v.value.length,lastSession:n?.lastSession||"-",bestQualy:l?_(l):null,bestRace:o?_(o):null,bestAvgRace:g?_(g):null,bestQualyConditions:w,bestRaceConditions:y,bestAvgRaceConditions:k,hasGripData:!!l||!!o||!!g}}),N=p(()=>v.value.map(a=>{const e=ct(a.meta.session_type),n=new Date(a.meta.date_start),r=a.summary||{};let s,l;if(r.best_qualy_ms&&(s=_(r.best_qualy_ms)),r.best_race_ms&&(l=_(r.best_race_ms)),!s&&!l&&r.bestLap){const o=_(r.bestLap);a.meta.session_type===1?s=o:(a.meta.session_type,l=o)}return{id:a.sessionId,date:a.meta.date_start.split("T")[0],time:n.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"}),type:e,car:ut(a.meta.car),laps:r.laps||0,stints:r.stintCount||0,bestQualy:s,bestRace:l}})),x=T(1),X=p(()=>Math.max(1,Math.ceil(N.value.length/A))),Z=p(()=>{const a=(x.value-1)*A,e=a+A;return N.value.slice(a,e)}),F=T(null),L=T(!1);function tt(){L.value=!0}const h=p(()=>{const a=v.value.reduce((l,o)=>l+(o.summary?.laps||0),0),e=v.value.reduce((l,o)=>l+(o.summary?.lapsValid||0),0),n=v.value.reduce((l,o)=>l+(o.summary?.totalTime||0),0),r=Math.floor(n/36e5),s=Math.floor(n%36e5/6e4);return{totalLaps:a,validLaps:e,validPercentage:a>0?Math.round(e/a*100):0,timeOnTrack:`${r}h ${s}m`,sessionsCount:v.value.length,lastActivity:$.value?.lastSession||"-"}}),E=p(()=>[...v.value].sort((e,n)=>e.meta.date_start.localeCompare(n.meta.date_start)).map(e=>{const n=e.summary,r=e.meta.date_start?.split("T")[0]||"",[s,l,o]=r.split("-"),g=["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"],w=o&&l?`${parseInt(o)} ${g[parseInt(l)-1]}`:"N/A";let y=n?.best_qualy_ms||null;!y&&e.meta.session_type===1&&n?.bestLap&&(y=n.bestLap);let k=n?.best_race_ms||null;return!k&&(e.meta.session_type===0||e.meta.session_type===2)&&n?.bestLap&&(k=n.bestLap),{date:w,sessionId:e.sessionId,bestQualy:y?_(y):void 0,bestRace:k?_(k):void 0}}));function C(a){if(!a||!a.includes(":"))return 0;const e=a.split(":"),n=parseInt(e[0]||"0"),s=(e[1]||"0.000").split("."),l=parseInt(s[0]||"0"),o=parseInt(s[1]||"0");return n*60+l+o/1e3}function q(a){const e=Math.floor(a/60),n=(a%60).toFixed(3);return`${e}:${n.padStart(6,"0")}`}const et=p(()=>{const a=E.value,e=a.map(s=>s.date),n=a.map(s=>s.bestQualy?C(s.bestQualy):null),r=a.map(s=>s.bestRace?C(s.bestRace):null);return{labels:e,datasets:[{label:"Best Qualifying",data:n,borderColor:"#f0b400",backgroundColor:"rgba(240, 180, 0, 0.1)",borderWidth:2.5,pointRadius:5,pointHoverRadius:7,pointBackgroundColor:"#f0b400",pointBorderColor:"#f0b400",tension:.3,fill:!1},{label:"Best Race",data:r,borderColor:"#ff6464",backgroundColor:"rgba(255, 100, 100, 0.1)",borderWidth:2.5,pointRadius:5,pointHoverRadius:7,pointBackgroundColor:"#ff6464",pointBorderColor:"#ff6464",tension:.3,fill:!1}]}}),st=p(()=>{const a=E.value,e=a.filter(o=>o.bestQualy).map(o=>C(o.bestQualy)),n=a.filter(o=>o.bestRace).map(o=>C(o.bestRace)),r=[...e,...n],s=Math.min(...r)-.5,l=Math.max(...r)+.5;return{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{display:!0,position:"bottom",labels:{color:"rgba(255, 255, 255, 0.7)",usePointStyle:!0,padding:20,font:{family:"'Inter', sans-serif",size:12}}},tooltip:{enabled:!0,backgroundColor:"rgba(20, 20, 30, 0.95)",titleColor:"#fff",bodyColor:"rgba(255, 255, 255, 0.8)",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,padding:12,callbacks:{label:function(o){const g=o.parsed.y;return g===null?"":`${o.dataset.label}: ${q(g)}`}}}},scales:{x:{grid:{color:"rgba(255, 255, 255, 0.06)",drawBorder:!1},ticks:{color:"rgba(255, 255, 255, 0.5)",font:{family:"'Inter', sans-serif",size:11}}},y:{min:s,max:l,grid:{color:"rgba(255, 255, 255, 0.06)",drawBorder:!1},ticks:{color:"rgba(255, 255, 255, 0.5)",font:{family:"'JetBrains Mono', monospace",size:11},callback:function(o){return q(o)}}}}}});function at(a){const e=new Date(a),n=e.getDate(),s=["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"][e.getMonth()],l=e.getFullYear();return`${n} ${s} ${l}`}function nt(a){return{practice:"PRACTICE",qualify:"QUALIFY",race:"RACE"}[a]}const ot=pt();function it(a){ot.push(`/sessioni/${a}`)}return(a,e)=>{const n=rt,r=dt;return u(),Y(r,null,{default:gt(()=>[t("button",{class:"back-button",onClick:e[0]||(e[0]=s=>P("back"))},[e[4]||(e[4]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1)),R(" "+i(m.fromSession?"Torna alla sessione":"Torna alle piste"),1)]),t("div",xt,[t("div",Lt,[t("img",{src:S(I)(c.value.image),alt:c.value.name},null,8,wt)]),t("div",Mt,[t("span",At,i(c.value.countryCode),1),t("h1",Qt,i(c.value.name),1),t("p",Dt,i(c.value.fullName),1),t("div",zt,[t("span",$t,[e[5]||(e[5]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),t("path",{d:"M2 17l10 5 10-5"}),t("path",{d:"M2 12l10 5 10-5"})],-1)),R(" "+i(c.value.length),1)]),t("span",Gt,[e[6]||(e[6]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),t("path",{d:"M9 12l2 2 4-4"})],-1)),R(" "+i(c.value.turns)+" curve ",1)]),t("span",Ft,[e[7]||(e[7]=t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),t("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),t("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),t("line",{x1:"3",y1:"10",x2:"21",y2:"10"})],-1)),R(" "+i(c.value.sessions)+" sessioni ",1)])])])]),t("div",Et,[t("div",qt,[t("div",Ot,[e[8]||(e[8]=t("h2",{class:"section-title"},"Storico Tempi",-1)),t("div",Vt,[t("div",Ut,[V(S(Bt),{data:et.value,options:st.value},null,8,["data","options"])])])]),t("div",{ref_key:"sessionsRef",ref:F,class:"section"},[e[10]||(e[10]=t("h2",{class:"section-title"},"Sessioni Recenti",-1)),t("div",{class:U(["sessions-list",{"sessions-list--fading":L.value}]),onTransitionend:e[1]||(e[1]=s=>L.value=!1)},[(u(!0),d(H,null,J(Z.value,s=>(u(),d("div",{key:s.id,class:"session-row",onClick:l=>it(s.id)},[t("div",Jt,[t("span",{class:U(["session-chip",`session-chip--${s.type}`])},i(nt(s.type)),3),t("span",Wt,i(s.time),1),t("span",jt,i(at(s.date)),1),t("span",Yt,i(s.car),1)]),t("div",Kt,[t("div",Xt,[t("span",Zt,"GIRI "+i(s.laps),1),t("span",te,"STINT "+i(s.stints),1)]),t("div",ee,[s.bestQualy?(u(),d("span",se," Q "+i(s.bestQualy),1)):(u(),d("span",ae," Q — "))]),t("div",ne,[s.bestRace?(u(),d("span",oe," R "+i(s.bestRace),1)):(u(),d("span",ie," R — "))]),e[9]||(e[9]=t("span",{class:"session-cta"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})])],-1))])],8,Ht))),128))],34)],512),V(n,{currentPage:x.value,"onUpdate:currentPage":e[2]||(e[2]=s=>x.value=s),"total-pages":X.value,"total-items":N.value.length,"scroll-target":F.value,"item-label":"sessioni",onPageChange:tt},null,8,["currentPage","total-pages","total-items","scroll-target"])]),t("aside",re,[t("div",le,[t("div",ce,[e[11]||(e[11]=t("h2",{class:"section-title"},"Migliori Tempi",-1)),_t(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>b.value=s),class:"grip-selector"},[(u(),d(H,null,J(K,s=>t("option",{key:s,value:s},i(s),9,ue)),64))],512),[[vt,b.value]])]),t("div",de,[t("div",me,[e[12]||(e[12]=t("span",{class:"time-label"},"Best Stint Qualifying",-1)),t("span",pe,i(c.value.bestQualy||"—:—.---"),1),c.value.bestQualyConditions?(u(),d("span",ge,[t("span",null,"Aria "+i(c.value.bestQualyConditions.airTemp)+"°C",1)])):c.value.bestQualy?M("",!0):(u(),d("span",_e,"Nessun dato per "+i(b.value),1))]),t("div",ve,[e[13]||(e[13]=t("span",{class:"time-label"},"Best Stint Race",-1)),t("span",be,i(c.value.bestRace||"—:—.---"),1),c.value.bestRaceConditions?(u(),d("span",ye,[t("span",null,"Aria "+i(c.value.bestRaceConditions.airTemp)+"°C",1)])):c.value.bestRace?M("",!0):(u(),d("span",ke,"Nessun dato per "+i(b.value),1))]),t("div",he,[e[14]||(e[14]=t("span",{class:"time-label"},"Best Stint Avg Race",-1)),t("span",fe,i(c.value.bestAvgRace||"—:—.---"),1),c.value.bestAvgRaceConditions?(u(),d("span",Ce,[t("span",null,"Aria "+i(c.value.bestAvgRaceConditions.airTemp)+"°C",1)])):c.value.bestAvgRace?M("",!0):(u(),d("span",Te,"Nessun dato per "+i(b.value),1))])])]),t("div",Re,[e[18]||(e[18]=t("h2",{class:"section-title"},"Attività Totale",-1)),t("div",Se,[t("div",Ie,[t("span",Pe,i(h.value.totalLaps),1),e[15]||(e[15]=t("span",{class:"activity-label"},"Giri Totali",-1))]),t("div",Be,[t("span",Ne,i(h.value.validLaps),1),t("span",xe,"Giri Validi ("+i(h.value.validPercentage)+"%)",1)]),t("div",Le,[t("span",we,i(h.value.timeOnTrack),1),e[16]||(e[16]=t("span",{class:"activity-label"},"Tempo in Pista",-1))]),t("div",Me,[t("span",Ae,i(h.value.sessionsCount),1),e[17]||(e[17]=t("span",{class:"activity-label"},"Sessioni",-1))])])])])])]),_:1})}}}),De=Object.assign(bt(Qe,[["__scopeId","data-v-908ec659"]]),{__name:"PagesTrackDetailPage"}),qe=j({__name:"[id]",setup(Q){const f=yt(),I=p(()=>f.params.id),m=p(()=>f.query.from);function P(){m.value?W(`/sessioni/${m.value}`):W("/piste")}return(D,z)=>{const B=De;return u(),Y(B,{"track-id":S(I),"from-session":S(m),onBack:P},null,8,["track-id","from-session"])}}});export{qe as default};
